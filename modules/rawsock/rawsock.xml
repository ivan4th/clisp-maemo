<?xml version="1.0" encoding="UTF-8"?>

<section id="rawsock"><title>Raw Socket Access.</title>

<para>This is the raw socket interface, as described in &socket-h;.
Sockets are represented by their &fixnum-t; &file-des;s.</para>

<simpara>When this module is present, &features-var; contains the
 symbol <constant>:RAWSOCK</constant>.</simpara>

<warning id="rawsock-use-sockets"><title>Use &socket-stream; instead!</title>
 <simpara>This interface is very low-level, and you probably do not need
 it - unless you are doing something <emphasis>very</emphasis> unusual.
 If you are interested in TCP/IP (Internet) sockets, you should use
 &socket-stream;s, &not-e; this package.</simpara></warning>

<warning id="rawsock-not-streams"><title>Do &not-e; use &make-stream;!</title>
 <simpara>You can turn such a raw socket into a usual lisp &stream-t;
  using &make-stream;, but you should be <emphasis>extremely</emphasis>
  careful with such dubious actions!  See the &clisp-devel;
  <ulink url="http://sourceforge.net/mailarchive/message.php?msg_id=7203955"
         >mailing list archives</ulink> for more details.</simpara></warning>

<para>We implement access to
 <simplelist columns="4">
  <member>&accept;</member><member>&bind;</member><member>&connect;</member>
  <member>&getpeername;</member><member>&getsockname;</member>
  <member>&listen-c;</member><member>&htonl;</member><member>&htons;</member>
  <member>&ntohl;</member><member>&ntohs;</member>
  <member>&recv;</member><member>&recvfrom;</member><member>&recvmsg;</member>
  <member>&send;</member><member>&sendmsg;</member><member>&sendto;</member>
  <member>&socket;</member><member>&socketpair;</member>
  <member>&shutdown;</member></simplelist>
 using same-named lisp functions in package
 <quote role="package">RAWSOCK</quote>.
 Additionally,<itemizedlist>
  <listitem><simpara><function>RAWSOCK:SOCK-READ</function>
    calls &read-c;;</simpara></listitem>
  <listitem><simpara><function>RAWSOCK:SOCK-WRITE</function>
    calls &write-c;;</simpara></listitem>
 <listitem><simpara><function>RAWSOCK:SOCK-CLOSE</function>
   calls &close-c;.</simpara></listitem></itemizedlist></para>

<para>We do not interface to &getsockopt; and &setsockopt;,
 they are available through &so-opt;.</para>

<para>We do not interface to &select; or &poll;,
 they are available through &so-status;.</para>

<variablelist id="rawsock-add-on"><title>Additional Functions</title>
 <varlistentry><term><code>(RAWSOCK:CONVERT-ADDRESS
    <replaceable>family</replaceable> &addr-r;)</code></term>
  <listitem><simpara>convert between &string-t; and &integer-t; IP
    &addr-r; representations using &inet_addr;, &inet_ntoa;, &inet_ntop;,
    or &inet_pton;.</simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:MAKE-SOCKADDR
    <replaceable>family</replaceable> &data-r;)</code></term>
  <listitem><simpara>create a <type>sockaddr</type> object.
 </simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:SOCKADDR-FAMILY
    <replaceable>sockaddr</replaceable>)</code></term>
  <listitem><simpara>return the numeric family of a
    <type>sockaddr</type> object.</simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:SOCKADDR-DATA
    <replaceable>sockaddr</replaceable>)</code></term>
  <listitem><simpara>return a &fresh; data vector of a
    <type>sockaddr</type> object.</simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:OPEN-UNIX-SOCKET
    &path-r; &optional-amp; &type-r;)</code></term>
  <listitem><simpara>open a &unix; socket special file.
 </simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:MAKE-MSGHDR &data-r;)</code></term>
  <listitem><simpara>Create a <type>RAWSOCK:MSGHDR</type> object for
    &sendmsg; and &recvmsg;.</simpara></listitem></varlistentry>
 <varlistentry>
  <term><code>(RAWSOCK:IPCSUM &optional-amp; &buf-r;)</code></term>
  <term><code>(RAWSOCK:ICMPCSUM &optional-amp; &buf-r;)</code></term>
  <term><code>(RAWSOCK:TCPCSUM &optional-amp; &buf-r;)</code></term>
  <term><code>(RAWSOCK:UDPCSUM &optional-amp; &buf-r;)</code></term>
  <listitem><simpara>Compute the appropriate protocol checksum.
    &buf-r; defaults to the internal buffer.
 </simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:BUFFER)</code></term>
  <listitem><simpara>Return the internal buffer, used as the default
    argument in the checksum functions and when &nil; is passed as the
    &buf-r; argument to the i/o functions like &sendto;.
 </simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:RESIZE-BUFFER &size-r;)</code></term>
  <listitem><simpara>Resize the internal buffer.
 </simpara></listitem></varlistentry>
 <varlistentry><term><code>(RAWSOCK:CONFIGDEV &sock-r; &name-r; &addr-r;
    &key-amp; <replaceable>promisc</replaceable>
    <replaceable>noarp</replaceable>)</code></term>
  <listitem><simpara>Set some socket options and IP &addr-r; with &ioctl;.
 </simpara></listitem></varlistentry>
</variablelist>

</section>
