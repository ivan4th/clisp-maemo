<!doctype html public "-//W3C//DTD HTML 3.2//EN">
<!-- $Id$ -->
<!-- define: HS="http://www.harlequin.com/education/books/HyperSpec"
     or HS="file:/usr/doc/lisp/HyperSpec" -->
<html>
<head>
<title>CLISP implementation notes</title>
<meta name="author" content="Bruno Haible">
<meta name="keywords" content="Lisp, Common Lisp, CLISP">
</head>

<!-- TODO: Add symbol index -->

<!-- Rules for this file:
  * Use only HTML 3.2 commands which work in a large range of browsers.
  * Literal symbols are written in <code>...</code> font, in lowercase.
  * At the definition point of a symbol, this symbol is written in
    <strong>...</strong> face.
  * Platform depencencies are emphasized like this:
<dl>
<dt><em>Platform dependent: UNIX, DOS, OS/2, Win32, Amiga, Acorn
platforms only.
</em></dt>
<dd>
...
</dd>
</dl>
  * Multi-line code snippets with <sub> and <sup> are passed through
      sed -e 's, ,\&nbsp;,g' -e 's,^,<code>,' -e 's,$,</code><br>,'
    The reverse filter is
      sed -e 's,\&nbsp;, ,g' -e 's,^<code>,,' -e 's,</code><br>$,,'
    You cannot use <pre> because <sub> and <sup> are not valid HTML inside
    <pre> (the rationale being that <pre> ensures fixed spacing, which is
    disturbed by <sub>'s smaller font).
  * Multi-line code snippets without <sub> and <sup> can be written either
    as above, or as
          <pre>
          <code> .....
          ........
          </code>
          </pre>
    Other combinations don't work:
    - <code><pre>...</pre></code> is not valid HTML, according to the DTD.
    - <pre><code>...</code></pre>
      leaves a blank line in Netscape but not in Lynx.
    - <pre><code>
      ....</code></pre>
      leaves two blank lines in Netscape and one blank line in Lynx.
    - <pre>
      <code>....</code></pre>
      leaves one blank line in both Netscape and Lynx.
-->

<body>
<h1 align=center>Implementation Notes for CLISP</h1>

<h4 align=center>Last modified: February 10, 1999.</h4>
<center>
<img src="clisp.gif" width=48 height=48>
</center>

<p>This implementation is mostly compatible to the <a
href="http://www.x3.org/tc_home/j13sd4.htm">ANSI CL standard X3.226-1994
"Programming Language Common Lisp"</a>, available as <a
href="http://www.harlequin.com/education/books/HyperSpec/FrontMatter/index.html">
Common Lisp HyperSpec (CLHS)</a> on line (but the printed ANSI document
remains the authoritative source of information).  This document is
indexed in parallel to CLHS.

<p>Other sources are

<p><blockquote>
<cite> Guy L. Steele Jr.: Common Lisp - The Language (1st ed.).<br>
       Digital Press 1984, 465 pages.<br>
       (&quot;CLtL1&quot; for short)
</cite></blockquote>
<p>and
<p><blockquote>
<cite> Guy L. Steele Jr.: Common Lisp - The Language (2nd ed.).<br>
       Digital Press 1990, 1032 pages.<br>
       (&quot;CLtL2&quot; for short)
</cite>
       <a
       href="http://www.cs.cmu.edu/afs/cs.cmu.edu/project/ai-repository/ai/html/cltl/cltl2.html">available
       on-line</a>
</blockquote>

<p>These notes document the differences between the CLISP implementation
of Common Lisp and the ANSI CL standard, and some implementation
details.

<!-- The differences between CLtL1 and CLtL2 are made up of X3J13
votes. CLISP's position with respect to these votes is listed in <a
HREF="../doc/cltl2.txt">cltl2.txt</a>.  -->


<h2>Chapter Index</h2>

<ol>
 <a href="#intro"><li></a><a rel=child href="CLHSROOT/Body/chap-1.html">
   <b>Introduction</b></a>
 <a href="#syntax"><li></a><a rel=child href="CLHSROOT/Body/chap-2.html">
   <b>Syntax</b></a>
 <a href="#eval"><li></a><a rel=child href="CLHSROOT/Body/chap-3.html">
   <b>Evaluation and Compilation</b></a>
 <a href="#types"><li></a><a rel=child href="CLHSROOT/Body/chap-4.html">
   <b>Types and Classes</b></a>
 <a href="#data"><li></a><a rel=child href="CLHSROOT/Body/chap-5.html">
   <b>Data and Control Flow</b></a>
 <a href="#iteration"><li></a><a rel=child href="CLHSROOT/Body/chap-6.html">
   <b>Iteration</b></a>
 <a href="#objects"><li></a><a rel=child href="CLHSROOT/Body/chap-7.html">
   <b>Objects</b></a>
 <a href="#structures"><li></a><a rel=child href="CLHSROOT/Body/chap-8.html">
   <b>Structures</b></a>
 <a href="#conditions"><li></a><a rel=child href="CLHSROOT/Body/chap-9.html">
   <b>Conditions</b></a>
 <a href="#symbols"><li></a><a rel=child href="CLHSROOT/Body/chap-10.html">
   <b>Symbols</b></a>
 <a href="#packages"><li></a><a rel=child href="CLHSROOT/Body/chap-11.html">
   <b>Packages</b></a>
 <a href="#numbers"><li></a><a rel=child href="CLHSROOT/Body/chap-12.html">
   <b>Numbers</b></a>
 <a href="#characters"><li></a><a rel=child href="CLHSROOT/Body/chap-13.html">
   <b>Characters</b></a>
 <a href="#conses"><li></a><a rel=child href="CLHSROOT/Body/chap-14.html">
   <b>Conses</b></a>
 <a href="#arrays"><li></a><a rel=child href="CLHSROOT/Body/chap-15.html">
   <b>Arrays</b></a>
 <a href="#strings"><li></a><a rel=child href="CLHSROOT/Body/chap-16.html">
   <b>Strings</b></a>
 <a href="#sequences"><li></a><a rel=child href="CLHSROOT/Body/chap-17.html">
   <b>Sequences</b></a>
 <a href="#hash"><li></a><a rel=child href="CLHSROOT/Body/chap-18.html">
   <b>Hash Tables</b></a>
 <a href="#filenames"><li></a><a rel=child href="CLHSROOT/Body/chap-19.html">
   <b>Filenames</b></a>
 <a href="#files"><li></a><a rel=child href="CLHSROOT/Body/chap-20.html">
   <b>Files</b></a>
 <a href="#streams"><li></a><a rel=child href="CLHSROOT/Body/chap-21.html">
   <b>Streams</b></a>
 <a href="#printer"><li></a><a rel=child href="CLHSROOT/Body/chap-22.html">
   <b>Printer</b></a>
 <a href="#reader"><li></a><a rel=child href="CLHSROOT/Body/chap-23.html">
   <b>Reader</b></a>
 <a href="#system"><li></a><a rel=child href="CLHSROOT/Body/chap-24.html">
   <b>System Construction</b></a>
 <a href="#environment"><li></a><a rel=child href="CLHSROOT/Body/chap-25.html">
   <b>Environment</b></a>
 <a href="#glossary"><li></a><a rel=child href="CLHSROOT/Body/chap-26.html">
   <b>Glossary</b></a>
</ol>

<ul>
 <li><a href="CLHSROOT/Body/chap-a.html"><b>Appendix</b></a>
 <li><a href="CLHSROOT/Issues/Issues-Categorized.html">
  <b>X3J13 Issue Index</b></a> (categorized)
</UL>

<a href="#extensions"><h1>Extensions:</h1></a>

<ol>
 <li><a href="#extensions"><b>Platform independent Extensions</b></a>
  <ol>
   <li><a href="#image">Saving an Image</a>
   <li><a href="#quit">Quitting Lisp</a>
   <li><a href="#language">The Language</a>
   <li><a href="#weak">Weak Pointers</a>
   <li><a href="#final">Finalization</a>
   <li><a href="#prompt">The Prompt</a>
  </ol>
 <li><a href="#debugger"><b>The Debugger and Stepper</b></a>
 <li><a href="#platform"><b>Platform specific Extensions</b></a>
  <ol>
   <li><a href="#edit">The Editor</a>
   <li><a href="#screen">Random Screen Access</a>
   <li><a href="#modules">External Modules</a>
   <li><a href="#dffi">The Foreign Function Call Facility</a>
   <li><a href="#affi">The Amiga Foreign Function Call Facility</a>
   <li><a href="#rexx">ARexx</a>
   <li><a href="#graphics">Graphics Primitives</a>
   <li><a href="#socket">Socket Streams</a>
   <li><a href="#script">CLISP as a script interpreter</a>
   <li><a href="#shell">Shell</a>
   <li><a href="#other">Other</a>
  </ol>
</ol>

<a name="intro"></a><a href="CLHSROOT/Body/chap-1.html">
<h2>Chapter 1: Introduction</h2></a>

<p>No notes.

<a name="syntax"></a><a href="CLHSROOT/Body/chap-2.html">
<h2>Chapter 2: Syntax</h2></a>

<a href="CLHSROOT/Body/sec_2-3-4.html">
<h3>2.3.4 Symbols as Tokens</h3></a>

<p>A &quot;reserved token&quot;, i.e. a token that has potential number
syntax but cannot be interpreted as a number, is interpreted as symbol
when being read. (CLtL1 p. 341)

<a href="CLHSROOT/Body/sec_2-3-5.html">
<h3>2.3.5 Valid Patterns for Tokens</h3></a>

<p>When a token with package markers is read, then (CLtL1 p. 343/344) no
checking is done whether the package part and the symbol-name part do
not have number syntax. (What's the purpose of this check?) So we
consider tokens like <CODE>USER::</CODE> or <CODE>:1</CODE> or
<CODE>LISP::4711</CODE> or <CODE>21:3</CODE> as symbols.

<a href="CLHSROOT/Body/sec_2-4-5.html">
<h3>2.4.5 Double-Quote</h3></a>

All attributes of the accumulated characters are removed.

<a href="CLHSROOT/Body/sec_2-4-6.html">
<h3>2.4.5 Backquote</h3></a>

<p>backquote read macro also works when nested. Example:
<PRE>
   <CODE>(eval ``(,#'(lambda () ',a) ,#'(lambda () ',b)))</CODE>
 = <CODE>(eval `(list #'(lambda () ',a) #'(lambda () ',b)))</CODE>
 = <CODE>(eval (list 'list (list 'function (list 'lambda nil (list 'quote a)))
                     (list 'function (list 'lambda nil (list 'quote b)))
   )     )</CODE>
</PRE>

<P>Multiple backquote combinations like <CODE>,,@</CODE> or
<CODE>,@,@</CODE> are not implemented. Their use would be confusing
anyway.

<a name="eval"></a><a href="CLHSROOT/Body/chap-3.html">
<h2>Chapter 3: Evaluation and Compilation</h2></a>

<p>All the functions built by <code>function</code>, <code>compile</code>
and the like are atoms. There are built-in functions written in C,
compiled functions (both of type <code>compiled-function</code>) and
interpreted functions (of type <code>function</code>).  The possible
function names (CLtL1 p. 59) are symbols and lambda expressions.

<p>As in Scheme, the macro <code>(the-environment)</code> returns the
current lexical environment. This works only in interpreted code and is
not compilable!

<p><code>(eval-env <var>form</var> [<var>env</var>])</code> evaluates a
form in a given lexical environment, just if the form had been part of
the program text that environment came from.

<a href="CLHSROOT/Body/sec_3-2-1.html">
<h3>3.2.1 Compiler Terminology</h3></a>

CLISP compiles to platform-independent byte-code.

<a href="CLHSROOT/Body/sec_3-3.html">
<h3>3.2.1 Declarations</h3></a>

<p>The ANSI macro <code>declaim</code> is implemented.

<p>The declarations <code>(type <var>type</var> <var>var</var>
...)</code>, <code>(ftype <var>type</var> <var>fun</var> ...)</code>,
<code>(function <var>name</var> <var>arglist</var>
<var>result-type</var>)</code>, <code>(optimize (<var>quality</var>
<var>value</var>) ...)</code> are ignored by the interpreter and the
compiler.

<p>The ANSI CL declaration <code>(optimize (debug ...))</code> is legal.

<P>Additional declarations:
<UL>
<LI>
  The ANSI CL declaration <code>(ignorable <var>var</var> ...)</code>
  affects the variable binding for the variable <var>var</var>. The
  compiler will not warn about the variable, regardless whether it is
  used or not.
<LI>
  The declaration <code>(compile)</code> has the effect that the current
  form is compiled prior to execution.
  Examples:
  <P>
  <code>(locally (declare (compile)) <var>form</var>)</code>
  executes a compiled version of form.
  <P>
  <PRE><code>(let ((x 0))
  (flet ((inc () (declare (compile)) (incf x))
         (dec () (decf x)))
    (values #'inc #'dec)
) )
</code></PRE>
  returns two functions. The first is compiled and increments
  <code>x</code>, the second is interpreted (slower) and decrements the
  same <code>x</code>.
</UL>

<p>The type assertion <code>(the <var>value-type</var>
<var>form</var>)</code> enforces a type check in interpreted code. No
type check is done in compiled code.
<P>
<DL>
<DT><EM>If using the optional package <code>macros3</code>:</EM></DT>
<DD>
The macro <STRONG><code>ethe</code></STRONG>:
<code>(ethe <var>value-type</var> <var>form</var>)</code> enforces a type check in both interpreted and
compiled code.
</DD>
</DL>

<a href="CLHSROOT/Body/sec_3-3.html">
<h3>3.8 The Evaluation and Compilation Dictionary</h3></a>

<a href="CLHSROOT/speope_load-time-value.html">
<h4>load-time-value</h4></a>

<P>The ANSI CL special operator <code>load-time-value</code> is
implemented. <code>(load-time-value <var>form</var>)</code> is like
<code>(quote #,<var>form</var>)</code> except that the former can be
generated by macros.


<a name="types"></a><a href="CLHSROOT/Body/chap-4.html">
<h2>Chapter 4: Types and Classes</h2></a>

<a href="CLHSROOT/Body/sec_4-2-3.html">
<h3>4.2.3 Type Specifiers.</h3></a>

<p>The ANSI type specifier <code>(eql <var>object</var>)</code> denotes
the singleton set {<var>object</var>}.

<p>The general form of the <code>complex</code> type specifier is
<code>(complex <var>type-of-real-part</var>
<var>type-of-imaginary-part</var>)</code>.  The type specifier
<code>(complex <var>type</var>)</code> is equivalent to <code>(complex
<var>type</var> <var>type</var>)</code>.

<p>The ANSI type specifier <code>(real <var>low</var>
<var>high</var>)</code> denotes the real numbers between <var>low</var>
and <var>high</var>.

<p><code>deftype</code> lambda lists are subject to destructuring
(nested lambda lists are allowed, as in <code>defmacro</code>) and may
contain a <code>&amp;whole</code> marker, but no
<code>&amp;environment</code> marker.

<p> <code>(<STRONG>type-expand-1</STRONG> <var>typespec</var>)</code>:
If <var>typespec</var> is a user-defined type,
<code>type-expand-1</code> will expand it once and return two values:
the expansion and <code>t</code>. If <var>typespec</var> is not a
user-defined type, then the two values <var>typespec</var> and
<code>nil</code> are returned.

<p><code>(<STRONG>type-expand</STRONG> <var>typespec</var>)</code>: This
is similar to <code>(type-expand-1 <var>typespec</var>)</code>, but
repeatedly expands <var>typespec</var> until it is no longer a
user-defined type. A second value of <code>t</code> or <code>nil</code>
is returned as for <code>type-expand-1</code>, indicating whether the
original <var>typespec</var> was a user-defined type.

<p>The possible results of <code>type-of</code> are:
<TABLE>
 <TR> <TD>
  <code>cons</code>
 <TR> <TD>
  <code>symbol</code> <code>null</code> <code>boolean</code>
 <TR> <TD>
  <code>fixnum</code> <code>bignum</code> <code>ratio</code>
  <code>short-float</code> <code>single-float</code>
  <code>double-float</code> <code>long-float</code> <code>complex</code>
 <TR> <TD>
  <code>character</code> <code>base-char</code>
 <TR> <TD>
  <code>(array <var>element-type</var> <var>dimensions</var>)</code>,
  <code>(simple-array <var>element-type</var> <var>dimensions</var>)</code>
 <TR> <TD>
  <code>(vector t <var>size</var>)</code>,
  <code>(simple-vector <var>size</var>)</code>
 <TR> <TD>
  <code>(string <var>size</var>)</code>,
  <code>(simple-string <var>size</var>)</code>
 <TR> <TD>
  <code>(base-string <var>size</var>)</code>,
  <code>(simple-base-string <var>size</var>)</code>
 <TR> <TD>
  <code>(bit-vector <var>size</var>)</code>,
  <code>(simple-bit-vector <var>size</var>)</code>
 <TR> <TD>
 <code>function</code> <code>compiled-function</code>
 <TR> <TD>
  <code>stream</code> <code>file-stream</code>
  <code>synonym-stream</code> <code>broadcast-stream</code>
  <code>concatenated-stream</code> <code>two-way-stream</code>
  <code>echo-stream</code>
  <code>string-stream</code>
 <TR> <TD>
  <code>package</code> <code>hash-table</code> <code>readtable</code>
  <code>pathname</code> <code>logical-pathname</code>
  <code>random-state</code> <code>byte</code>
 <TR> <TD>
  <code>load-time-eval</code> <code>symbol-macro</code>
  <code>encoding</code> <code>foreign-variable</code>
  <code>foreign-function</code>
 <TR> <TD>
  <code>weak-pointer</code> <code>read-label</code>
  <code>frame-pointer</code> <code>system-internal</code>
 <TR> <TD>
  <code>address</code> (should not occur)
 <TR> <TD>
  any other symbol (structure types or CLOS classes)
 <TR> <TD>
  a class (CLOS classes without proper name)
</TABLE>

<a href="CLHSROOT/Body/sec_4-3.html">
<H3>4.3 Classes</H3></a>

<p>The CLOS symbols are exported from the package
<code>&quot;CLOS&quot;</code> and thus normally visible in all user
packages. If you don't want them (for example, if you want to use PCL
instead of CLOS), do <code>(unuse-package &quot;CLOS&quot;)</code>.

<p>
<dl>
 <dt>The functions
  <dd><code>slot-value</code>, <code>slot-boundp</code>,
  <code>slot-makunbound</code>, <code>slot-exists-p</code>,
  <code>find-class</code>, <code>(setf find-class)</code>,
  <code>class-of</code>, <code>call-next-method</code>,
  <code>next-method-p</code>, <code>class-name</code>, <code>(setf
  class-name)</code>, <code>no-applicable-method</code>,
  <code>no-next-method</code>, <code>find-method</code>,
  <code>add-method</code>, <code>remove-method</code>,
  <code>compute-applicable-methods</code>,
  <code>method-qualifiers</code>, <code>function-keywords</code>,
  <code>slot-missing</code>, <code>slot-unbound</code>,
  <code>print-object</code>, <code>describe-object</code>,
  <code>make-instance</code>, <code>initialize-instance</code>,
  <code>reinitialize-instance</code>, <code>shared-initialize</code>,
 <dt>the macros
  <dd><code>with-slots</code>, <code>with-accessors</code>,
  <code>defclass</code>, <code>defmethod</code>,
  <code>defgeneric</code>, <code>generic-function</code>,
  <code>generic-flet</code>, <code>generic-labels</code>,
 <dt>the classes
  <dd><code>standard-class</code>, <code>structure-class</code>,
  <code>built-in-class</code>, <code>standard-object</code>,
  <code>standard-generic-function</code>, <code>standard-method</code>
  and all predefined classes,
 <dt>and the method combination
  <dd> <code>standard</code>
</dl>
are implemented.


<h4>Deviations from ANSI CL:</h4>

<p><code>defclass</code> : It <EM>is</EM> required that the superclasses
of a class be defined before the <code>defclass</code> form for the
class is evaluated.

<P><code>defclass</code> supports the option <code>:metaclass
structure-class</code>. This option is necessary in order to define a
subclass of a <code>defstruct</code>-defined structure type using
<code>defclass</code> instead of <code>defstruct</code>.

<P>The <code>real</code> type is added to the predefined classes listed
in table 28-1.

<P>Only <code>standard</code> method combination is implemented.

<P>When <code>call-next-method</code> is called with arguments, the rule
that the ordered set of applicable methods must be the same as for the
original arguments is enforced by the implementation only in interpreted
code.

<P><code>call-next-method</code> and <code>next-method-p</code> are
local macros, not local functions.  Use <code>#'(lambda ()
(call-next-method))</code> instead of <code>#'call-next-method</code> if
you really need it as a function.

<P>There is a generic function
<code><STRONG>no-primary-method</STRONG></code> (analogous to
<code>no-applicable-method</code>) which is called when a generic
function of the class <code>standard-generic-function</code> is invoked
and no primary method on that generic function is applicable.

<P><code>generic-flet</code> and <code>generic-labels</code> are
implemented as macros, not as special operators.

<P>The function <code>ensure-generic-function</code> is not implemented.

<P><code>add-method</code> can put methods into other generic functions
than the one the method came from.

<P><code>print-object</code> and <code>describe-object</code> are only
called on objects of type <code>standard-object</code>.

<P><code>describe-object</code> should not call <code>describe</code>
recursively as this would produce more information than is likely to be
useful to a human reader.

<P><code>documentation</code> still has the CLtL1 implementation.

<P>User-defined method combination is not supported.  The macros
<code>define-method-combination</code>, <code>call-method</code> and the
functions <code>invalid-method-error</code>,
<code>method-combination-error</code>, <code>method-qualifiers</code>
are not implemented.

<P>The special operator <code>with-added-methods</code> is not implemented.

<P>Redefining classes is not supported.  The function
<code>update-instance-for-redefined-class</code> is not implemented.

<P>Changing the class of a given instance is not supported.  The the
functions <code>change-class</code>,
<code>update-instance-for-different-class</code>,
<code>make-instances-obsolete</code> are not implemented.

<a name="data"></a><a href="CLHSROOT/Body/chap-5.html">
<h2>Chapter 5: Data and Control Flow</h2></a>

<a href="CLHSROOT/Body/sec_the_data__w_dictionary.html">
<h3>5.3. The Data and Control Flow Dictionary</h3></a>

<p>In addition to the 24 special operators listed on p. 57 (CLtL2: p. 73),
the ANSI CL special operators <code>locally</code>,
<code>symbol-macrolet</code>, <code>load-time-value</code> are
implemented, and the macros <code>psetq</code>, <code>prog1</code>,
<code>prog2</code>, <code>when</code>, <code>unless</code>,
<code>cond</code>, <code>case</code>, <code>multiple-value-list</code>,
<code>multiple-value-bind</code>, <code>multiple-value-setq</code>,
<code>and</code>, <code>or</code> are implemented as special operators.

<p><code>prog1</code>, <code>prog2</code>, <code>and</code>,
<code>or</code>, <code>psetq</code>, <code>when</code>,
<code>unless</code>, <code>cond</code>, <code>case</code>,
<code>multiple-value-list</code>, <code>multiple-value-bind</code>,
<code>multiple-value-setq</code> are implemented as special operators and,
as such, rather efficient.

<a href="CLHSROOT/mac_destructuring-bind.html">
<h4>destructuring-bind</h4></a>

<p>The ANSI macro <code>destructuring-bind</code> is implemented. It
does not perform full error checking.

<a href="CLHSROOT/fun_compiled-function-p.html">
<h4>compiled-function-p</h4></a>

<p><code>compiled-function-p</code> returns <code>t</code> on built-in
functions written in C, compiled functions and special operator
handlers. Therefore <code>compiled-function</code> is not a subtype of
<code>function</code>.

<a href="CLHSROOT/fun_eq.html">
<h4>eq</h4></a>

<p><code>eq</code> compares characters and fixnums as <code>eql</code>
does. No unnecessary copies are made of characters and
numbers. Nevertheless, one should use <code>eql</code>.

<P><code>(let ((x y)) (eq x x))</code> always returns <code>t</code>,
regardless of <code>y</code>.

<a href="CLHSROOT/acc_symbol-function.html">
<h4>symbol-function</h4></a>

<p><code>(setf (symbol-function <var>symbol</var>)
<var>object</var>)</code> requires <var>object</var> to be either a
function, a <code>symbol-function</code> return value or a lambda
expression. A lambda expression is thereby immediately converted to a
function.

<a href="CLHSROOT/mac_setfcm_psetf.html">
<h4>setf</h4></a>

<P><code>setf</code> also accepts places yielding multiple values.

<P>Additional places:
<DL>
 <DT><code>funcall</code>:
  <DD>
   <code>(setf (funcall #'<var>symbol</var> ...) <var>object</var>)</code> and
   <code>(setf (funcall '<var>symbol</var> ...) <var>object</var>)</code>
   are equivalent to
   <code>(setf (<var>symbol</var> ...) <var>object</var>)</code>.

 <DT><code>get-dispatch-macro-character</code>:
  <DD>
   <code>(setf (get-dispatch-macro-character ...) ...)</code>
   performs a <code>set-dispatch-macro-character</code>.

 <DT><code>long-float-digits</code>:
  <DD>
   <code>(setf (long-float-digits) <var>digits</var>)</code> sets the
   default mantissa length of long floats to <var>digits</var> bits.

 <DT><code>values</code>:
  <DD>
   <code>(setf (values <var>place<SUB>1</SUB></var>
   ... <var>place<SUB>k</SUB></var>) <var>form</var>)</code>
   is approximately equivalent to

   <p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(multiple-value-bind&nbsp;(dummy1&nbsp;...&nbsp;dummyk)&nbsp;<var>form</var></code><BR>
   <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(setf&nbsp;<var>place<SUB>1</SUB></var>&nbsp;dummy1&nbsp;...&nbsp;<var>place<SUB>k</SUB></var>&nbsp;dummyk)</code><BR>
   <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(values&nbsp;dummy1&nbsp;...&nbsp;dummyk)</code><BR>
   <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</code><BR>
   <p>Example:
    <code>(setf (values a b) (values b a))</code> interchanges the
    values of <code>a</code> and <code>b</code>.

 <DT><code>values-list</code>:
  <DD>
  <code>(setf (values-list <var>list</var>) <var>form</var>)</code>  is
  equivalent to
  <code>(values-list (setf <var>list</var> (multiple-value-list
  <var>form</var>)))</code>
</DL>

<P><code>&amp;key</code> markers in <code>defsetf</code> lambda lists
are supported, but the corresponding keywords must appear literally in
the program text.

<P><code>(get-setf-method <var>form</var> &amp;optional
<var>env</var>)</code> and <code>(get-setf-method-multiple-value
<var>form</var> &amp;optional <var>env</var>)</code> receives as
optional argument the environment necessary for macro expansions.  In
<code>define-setf-method</code> lambda lists, one can specify
<code>&amp;environment</code> and a variable, which will be bound to the
environment. This environment should be passed to all calls of
<code>get-setf-method</code> and
<code>get-setf-method-multiple-value</code>.  If this is done, even
local macros will be interpreted as places correctly.

<!-- #ifdef IMMUTABLE -->
<DL>
<DT><EM>Platform dependent: UNIX platforms only, and only in clisp
binaries built with compile-time flag <code>IMMUTABLE</code>.</EM></DT>
<DD>
Attempts to modify read-only data will signal an error. Program text and
quoted constants loaded from files are considered read-only data. This
check is only performed for conses and arrays, not for user-defined data
types.
</DD>
</DL>
<!-- #endif -->
<P>
<code>(function <var>symbol</var>)</code> returns the local function
definition established by <code>flet</code> or <code>labels</code>, if
it exists, otherwise the global function definition.
<P>
The ANSI CL place <code>(fdefinition <var>function-name</var>)</code> is
implemented.
<P>
<code>(special-operator-p <var>symbol</var>)</code> returns <code>nil</code>
or <code>t</code>. If it returns <code>t</code>, then
<code>(symbol-function <var>symbol</var>)</code> returns the (useless)
special operator handler.

<p>The ANSI CL special operator <code>symbol-macrolet</code> is implemented.

<P>The macro <STRONG><code>define-symbol-macro</code></STRONG>
establishes symbol macros with global scope (as opposed to symbol macros
defined with <code>symbol-macrolet</code>, which have local scope):
<code>(define-symbol-macro <var>symbol</var>
<var>expansion</var>)</code>.

<BR>The function <STRONG><code>symbol-macro-expand</code></STRONG> tests
for a symbol macro: If <var>symbol</var> is defined as symbol macro,
<code>(symbol-macro-expand <var>symbol</var>)</code> returns two values,
<code>t</code> and the expansion, else it returns <code>nil</code>.

<BR>Calling <code>boundp</code> on a symbol defined as symbol macro
returns <code>t</code>.

<BR>Calling <code>symbol-value</code> on a symbol defined as symbol
macro returns the value of the expansion. Calling <code>set</code> on a
symbol defined as symbol macro calls <code>setf</code> on the expansion.

<BR>Calling <code>makunbound</code> on a symbol defined as symbol macro
removes the symbol macro definition.

<P>
<DL>
<DT><EM>If using the optional package <code>macros3</code>:</EM></DT>
<DD>
  The macros <STRONG><code>letf</code></STRONG> and
  <STRONG><code>letf*</code></STRONG> are like <code>let</code> and
  <code>let*</code>, resp., except that they
  can bind places, even places with multiple values.
  Example:
  <DL>
  <DT><code>(letf (((values a b) <var>form</var>)) ...)</code></DT>
  <DD>is equivalent to
      <code>(multiple-value-bind (a b) <var>form</var> ...)</code>
  </DD>
  <DT><code>(letf (((first l) 7)) ...)</code></DT>
  <DD>is approximately equivalent to
    <PRE><code>    (let* ((#:g1 l) (#:g2 (first #:g1)))
      (unwind-protect (progn (setf (first #:g1) 7) ...)
                      (setf (first #:g1) #:g2)
    ) )
    </code></PRE>
  </DD>
  </DL>
</DD>
</DL>

<p><code>call-arguments-limit</code> is 65536 on 16-bit processors,
4294967296 on 32-bit processors.

<p><code>multiple-values-limit</code> = 128

<a href="CLHSROOT/Body/mac_lambda.html">
<h4>lambda</h4></a>

<code>lambda-list-keywords</code> =
    <code>(&amp;optional &amp;rest &amp;key &amp;allow-other-keys
    &amp;aux &amp;body &amp;whole &amp;environment)</code>

<p><code>lambda-parameters-limit</code> is 65536 on 16-bit processors,
4294967296 on 32-bit processors.

<h4><a href="CLHSROOT/Body/mac_defun.html">defun</a> &amp;
    <a href="CLHSROOT/Body/mac_defmacro.html">defmacro</a></h4>

<code>defun</code> and <code>defmacro</code> are allowed in non-toplevel
positions. As an example, consider the old (CLtL1) definition of
<code>gensym</code>:

<PRE><code>(let ((gensym-prefix &quot;G&quot;)
      (gensym-count 1))
  (defun gensym (&amp;optional (x nil s))
    (when s
      (cond ((stringp x) (setq gensym-prefix x))
            ((integerp x)
             (if (minusp x)
               (error &quot;~S: index ~S is negative&quot; 'gensym x)
               (setq gensym-count x)
            ))
            (t (error &quot;~S: argument ~S of wrong type&quot; 'gensym x))
    ) )
    (prog1
      (make-symbol
        (concatenate 'string
          gensym-prefix
          (write-to-string gensym-count :base 10 :radix nil)
      ) )
      (incf gensym-count)
) ) )
</code></PRE>

<a href="CLHSROOT/Body/dec_special.html">
<h4>special</h4></a>

<code>(proclaim '(special <var>var</var>))</code> declarations may not
be undone. The same holds for <code>defvar</code>,
<code>defparameter</code> and <code>defconstant</code> declarations.

<p>It is an error if a <code>defconstant</code> variable is bound at the
moment the <code>defconstant</code> is executed, but
<code>defconstant</code> does not check this.

<p>Constants may not be bound dynamically or lexically.

<a href="CLHSROOT/speope_eval-when.html">
<h4>eval-when</h4></a>

<code>eval-when</code> also accepts the situations <code>(not
eval)</code> and <code>(not compile)</code>.

<a href="CLHSROOT/fun_function-_a-expression.html">
<h4>function-lambda-expression</h4></a>

<P>The ANSI CL function <code>function-lambda-expression</code> is
implemented.  <code>(function-lambda-expression
<var>function</var>)</code> returns information about the source of an
interpreted function: lambda-expression, lexical environment, name.

<a href="CLHSROOT/fun_complement.html">
<h4>complement</h4></a>

<p>The ANSI CL function <code>complement</code> is implemented.

<a name="iteration"></a><a href="CLHSROOT/Body/chap-6.html">
<h2>Chapter 6: Iteration</h2></a>

<p>No notes.

<a name="objects"></a><a href="CLHSROOT/Body/chap-7.html">
<h2>Chapter 7: Objects</h2></a>

<p>No notes.

<a name="structures"></a><a href="CLHSROOT/Body/chap-8.html">
<h2>Chapter 8: Structures</h2></a>

<p>The <code>:print-function</code> option should contain a lambda
  expression <code>(lambda (structure stream depth) (declare (ignore
  depth)) ...)</code> This lambda expression names a function whose task
  is to output the external representation of structure onto the
  stream. This may be done by outputting text onto the stream using
  <code>write-char</code>, <code>write-string</code>,
  <code>write</code>, <code>prin1</code>, <code>princ</code>,
  <code>print</code>, <code>pprint</code>, <code>format</code> and the
  like. The following rules must be obeyed:

<UL>
 <LI>The value of <code>*print-escape*</code> must be respected.

 <LI>The value of <code>*print-pretty*</code> should not and cannot be
  respected, since the pretty-print mechanism is not accessible from
  outside.

 <LI>The value of <code>*print-circle*</code> need not to be
  respected. This is managed by the system. (But the print-circle
  mechanism handles only those objects that are (direct or indirect)
  components of structure.)

 <LI>The value of <code>*print-level*</code> is respected by
  <code>write</code>, <code>prin1</code>, <code>princ</code>,
  <code>print</code>, <code>pprint</code>, <code>format ~A</code>,
  <code>format ~S</code>, <code>format ~W</code> and <code>format
  ~D,~B,~O,~X,~R,~F,~E,~G,~$</code> with not-numerical arguments.
  Therefore the print-level mechanism works automatically if only these
  functions are used for outputting objects and if they are not called
  on objects with nesting level &gt; 1. (The print-level mechanism does
  not recognize how many parentheses you have output. It only counts how
  many times it was called recursively.)

 <LI>The value of <code>*print-length*</code> must be respected,
  especially if you are outputting an arbitrary number of components.

 <LI>The value of <code>*print-readably*</code> must be
  respected. Remember that the values of <code>*print-escape*</code>,
  <code>*print-level*</code>, <code>*print-length*</code> don't matter
  if <code>*print-readably*</code> is true.  The value of
  <code>*print-readably*</code> is respected by
  <code>print-unreadable-object</code>, <code>write</code>,
  <code>prin1</code>, <code>princ</code>, <code>print</code>,
  <code>pprint</code>, <code>format ~A</code>, <code>format ~S</code>,
  <code>format ~W</code> and <code>format
  ~D,~B,~O,~X,~R,~F,~E,~G,~$</code> with not-numerical arguments.
  Therefore <code>*print-readably*</code> will be respected
  automatically if only these functions are used for outputting objects.

 <LI>You need not bother about the values of <code>*print-base*</code>,
  <code>*print-radix*</code>, <code>*print-case*</code>,
  <code>*print-gensym*</code>, <code>*print-array*</code>,
  <code>*print-closure*</code>, <code>*print-rpars*</code>,
  <code>*print-indent-lists*</code>.
</UL>

<P>The <code>:inherit</code> option is exactly like
<code>:include</code> except that it doesn't create
new accessors for the inherited slots.


<a name="conditions"></a><a href="CLHSROOT/Body/chap-9.html">
<h2>Chapter 9: Conditions</h2></a>

<p>When an error occurred, you are in a break loop. You can evaluate
forms as usual. The <code>help</code> command (or help key if there is
one) lists the available debugging commands.

The macro <code>(<STRONG>muffle-cerrors</STRONG>
{<var>form</var>}*)</code> executes the <var>form</var>s. When a
continuable error occurs, no message is printed. Instead, the
<code>continue</code> restart is invoked.

<P>The macro <code>(<STRONG>appease-cerrors</STRONG>
{<var>form</var>}*)</code> executes the <var>form</var>s. When a
continuable error occurs, the error is printed as a warning and the
<code>continue</code> restart is invoked.

<P>The macro <code>(<STRONG>exit-on-error</STRONG>
{<var>form</var>}*)</code> executes the <var>form</var>s. When a
non-continuable error or a Ctrl-C interrupt occurs, the error is printed
and CLISP terminates with error status.

<P>The macro <code><STRONG>with-restarts</STRONG></code> is like
<code>restart-case</code>, except that the forms are specified after the
restart clauses instead of before them, and the restarts created are not
implicitly associated to any condition.
  <code>(with-restarts
  (</code>{<var>restart-clause</var>}*<code>)</code>
  {<var>form</var>}*<code>)</code>
is therefore equivalent to <code>(restart-case (progn
</code>{<var>form</var>}*<code>)</code>
{<var>restart-clause</var>}*<code>)</code>.

<a href="CLHSROOT/sec_the_condi_s_dictionary.html">
<H3>9.2. The Conditions Dictionary</H3></a>

<a href="CLHSROOT/fun_signal.html">
<h4>signal</h4></a>

The default condition type for conditions created by <code>signal</code>
is <code>simple-condition</code>, not <code>simple-error</code>.

<a href="CLHSROOT/mac_restart-case.html">
<h4>restart-case</h4></a>

In <code>restart-case</code> clauses the argument list can also be
specified after the keyword/value pairs instead of before them. The
syntax therefore is <code>(restart-case <var>form</var>
{<var>restart-clause</var>}*)</code> with

<TABLE>
  <TR><TD><var>restart-clause</var> ::=
   <TD>  <code>(<var>restart-name</var></code> <var>arglist</var>
   {<var>keyword value</var>}* {<var>form</var>}*<code>)</code>
  <TR><TD>
   <TD>| <code>(<var>restart-name</var></code> {<var>keyword
   value</var>}* <var>arglist</var> {<var>form</var>}*<code>)</code>
</TABLE>

<a href="CLHSROOT/sec_the_condi_s_dictionary.html">
<h4>compute-restarts</h4></a>

<code>compute-restarts</code> and <code>find-restart</code> behave as
specified in ANSI CL: If the optional condition argument is not
<code>nil</code>, only restarts associated with that condition and
restarts associated to no condition at all are considered.  Therefore
the effect of associating a restart to a condition is not to activate
it, but to hide it from other conditions. This makes the syntax
dependent implicit association performed by <code>restart-case</code>
nearly obsolete.

<a href="CLHSROOT/contyp_simple-warning.html">
<h4>simple-warning</h4></a>

The default condition type for conditions created by <code>warn</code>
is <code>simple-warning</code>, not <code>simple-error</code>.


<a name="symbols"></a><a href="CLHSROOT/Body/chap-10.html">
<h2>Chapter 10: Symbols</h2></a>

<p>No notes.

<a name="packages"></a><a href="CLHSROOT/Body/chap-11.html">
<h2>Chapter 11: Packages</h2></a>

<p>The package <code>SYSTEM</code> has the nicknames
<code>&quot;SYS&quot;</code> and, additionally,
<code>&quot;COMPILER&quot;</code>.

<p>The ANSI packages
<UL>
 <LI> <code>COMMON-LISP</code> with nickname <code>&quot;CL&quot;</code> and
 <LI> <code>COMMON-LISP-USER</code> with nickname
 <code>&quot;CL-USER&quot;</code>
</UL>

are implemented. The package <code>COMMON-LISP</code> exports only those
symbols from the ANSI CL standard that are actually implemented.

<a href="CLHSROOT/sec_the_packa_s_dictionary.html">
<H3>11.2. The Packages Dictionary</H3></a>

<a href="CLHSROOT/fun_make-package.html">
<h4>make-package</h4></a>

<p>For <code>make-package</code>, the default value of the
<code>:use</code> argument is <code>(&quot;LISP&quot;
&quot;CLOS&quot;)</code>.

<a href="CLHSROOT/mac_defpackage.html">
<h4>defpackage</h4></a>

<p>The ANSI CL macro <code>defpackage</code> is implemented.

<a href="CLHSROOT/mac_in-package.html">
<h4>in-package</h4></a>

<p><code>make-package</code> and <code>in-package</code> accept a
keyword argument <code>:case-sensitive</code>.  Similarly,
<code>defpackage</code> accepts an option
<code>:case-sensitive</code>. When its value is non-<code>nil</code>,
the package will be case sensitive, i.e. the reader will not
case-convert symbol names before looking them up or creating them in
this package. The package names are still subject to
<code>(readtable-case *readtable*)</code>, though.

<a name="numbers"></a><a href="CLHSROOT/Body/chap-12.html">
<h2>Chapter 12: Numbers</h2></a>

<p>The type <code>number</code> is the disjoint union of the types
<code>real</code> and <code>complex</code>. (CLtL wording:
&quot;exhaustive partition&quot;)

<p>The type <code>real</code> is the disjoint union of the types
<code>rational</code> and <code>float</code>.

<p>The type <code>rational</code> is the disjoint union of the types
<code>integer</code> and <code>ratio</code>.

<p>The type <code>integer</code> is the disjoint union of the types
<code>fixnum</code> and <code>bignum</code>.

<p>The type <code>float</code> is the disjoint union of the types
<code>short-float</code>, <code>single-float</code>,
<code>double-float</code> and <code>long-float</code>.

<a href="CLHSROOT/sec_12-1-4.html">
<H3>12.1.4 Floating-point Computations.</H3></a>

There are four floating point types: short-float, single-float, double-float
and long-float:
<TABLE BORDER=1>
  <TR> <TH>               <TH>sign    <TH>mantissa   <TH>exponent  <TH>comment
  <TR> <TH>short-float    <TD>1 bit   <TD ALIGN=CENTER>16+1 bits   <TD ALIGN=CENTER>8 bits   <TD>&nbsp;
  <TR> <TH>single-float   <TD>1 bit   <TD ALIGN=CENTER>23+1 bits   <TD ALIGN=CENTER>8 bits   <TD>CLISP uses IEEE format
  <TR> <TH>double-float   <TD>1 bit   <TD ALIGN=CENTER>52+1 bits  <TD ALIGN=CENTER>11 bits   <TD>CLISP uses IEEE format
  <TR> <TH>long-float     <TD>1 bit   <TD ALIGN=CENTER>&gt;=64 bits  <TD ALIGN=CENTER>32 bits   <TD>&nbsp;
</TABLE>

<P>The single and double float formats are those of the IEEE standard
(1981), except that CLISP does not support features like +0, -0, +inf,
-inf, gradual underflow, NaN, etc. (Common Lisp does not make use of
these features.)

<P>Long floats have variable mantissa length, which is a multiple of 16
(or 32, depending on the word size of the processor). The default length
used when long floats are read is given by the place
<strong><code>(lisp:long-float-digits)</code></strong>.  It can be set by
<code>(setf (lisp:long-float-digits) <var>nnn</var>)</code>, where
<var>nnn</var> is a positive integer.

<p>Example: <code>(setf (lisp:long-float-digits) 3322)</code> sets the
default precision of long floats to 1000 decimal digits.

<a href="CLHSROOT/sec_12-1-4-4.html">
<h4>12.1.4.4 Rule of Float Precision Contagion</h4></a>

The floating point contagion is controlled by the variable
<strong><code>lisp:*floating-point-contagion-ansi*</code></strong>.
When it is non-nil, contagion is done as per the ANSI CL standard:
short-&gt;single-&gt;double-&gt;long.
<DL><DT>Rationale:</DT>
<DD>See it pragmatically: save what you can and let others worry about
 the rest.</DD>
<DT>Short:</DT>
<DD>CL knows the number's precision, not accuracy, so preserving
 the precision can be accomplished reliably, while anything relating to
 the accuracy is just a speculation - only the user (programmer) knows
 what it is in each case.</DD>
<DT>Long:</DT>
<DD>A float is an approximation of a real number.  One can think of it
 as a random variable with the mean equal to itself and standard
 deviation equal to half the last significant digit.  E.g.,
 <code>1.5</code> is actually <code>1.5+-0.05</code>.  Consider adding
 <code>1.5</code> and <code>1.75</code>.  ANSI requires that <code>(+ 1.5
 1.75)</code> return <code>3.25</code>, while traditional CLISP would
 return <code>3.3</code>.  The implied random variables are:
 <code>3.25+-0.005</code> and <code>3.3+-0.05</code>.  Note that the
 CLISP's way <B>DOES</B> lie about the mean: the mean <B>IS</B>
 <code>3.25</code> and nothing else, while the ANSI's way <B>COULD</B> be
 lying about the deviation (accuracy): if the implied accuracy of
 <code>1.5 (0.05)</code> is its actual accuracy, then the accuracy of the
 result cannot be smaller that that.  Therefore, since CL has no way of
 knowing the actual accuracy, ANSI CL (and all the other standard
 engineering programming languages, like C, FORTRAN etc) decides that
 keeping the accuracy correct is the business of the programmer, while
 the language should preserve what it can - the precision.</DD>
<DT>Experience:</DT>
<DD> Rounding errors accumulate, and if a computation is conducted with
 insufficient precision, an outright incorrect result can be returned.
 (E.g., <code>E(x^2)-E(x)^2</code> can be negative!)  The user should not
 mix floats of different precision (that's what
 <code>*warn-on-floating-point-contagion*</code> is for), but s/he should
 not be penalized for this too harshly.
</DD></DL>
<P>When <code>*floating-point-contagion-ansi*</code> is nil, the
traditional CLISP method is used, namely:
<P>The result of an arithmetic operation whose arguments are of
different float types is rounded to the float format of the shortest
(least precise) of the arguments:
    rational -&gt; long float -&gt; double float -&gt; single float
    -&gt; short float
(in contrast to <a href="CLHSROOT/sec_12-1-4-4.html">12.1.4.4 Rule of Float
Precision Contagion</a>!)

<DL>
<DT>Rationale:</DT>
<DD>
  See it mathematically.  Add intervals:
  {1.0 &plusmn; 1e-8} + {1.0 &plusmn; 1e-16} = {2.0 &plusmn; 1e-8}
  So, if we add <code>1.0s0</code> and <code>1.0d0</code>, we should get
  <code>2.0s0</code>.
</DD>
<DT>Shortly:</DT>
<DD>
  Do not suggest accuracy of a result by giving it a precision that is
  greater than its accuracy.
</DD>
<DT>Example:</DT>
<DD>
  <code>(- (+ 1.7 pi) pi)</code> should not return
  <code>1.700000726342836417234L0</code>, it should return
  <code>1.7f0</code> (or <code>1.700001f0</code> if there were rounding
  errors).
</DD>
<DT>Experience:</DT>
<DD>
  If in a computation using thousands of short floats, a long float
  (like pi) happens to be used, the long precision should not propagate
  throughout all the intermediate values. Otherwise, the long result
  would look precise, but its accuracy is only that of a short float;
  furthermore much computation time would be lost by calculating with
  long floats when only short floats would be needed.
</DD>
</DL>

<p>If the variable
<STRONG><code>lisp:*warn-on-floating-point-contagion*</code></STRONG> is
true, a warning is emitted for every coercion involving different
floating-point types.  <p>When rational numbers are to be converted to
floats (due to <code>float</code>, <code>coerce</code>,
<code>sqrt</code> or a transcendental function), the result type is
given by the variable
<STRONG><code>*default-float-format*</code></STRONG>.

<h4>without-floating-point-underflow</h4>

<P>The macro
  <code><STRONG>lisp:without-floating-point-underflow</STRONG></code>:
  <code>(without-floating-point-underflow {<var>form</var>}*)</code>
executes the <var>form</var>s, with errors of type
<code>floating-point-underflow</code> inhibited.  Floating point
operations will silently return zero instead of signalling an error of
type <code>floating-point-underflow</code>.

<a href="CLHSROOT/sec_12-1-5.html">
<H3>12.1.5 Complex Computations</H3></a>

<P>Complex numbers can have a real part and an imaginary part of different
types. For example, <code>(sqrt -9.0)</code> evaluates to the number
<code>#C(0 3.0)</code>, which has a real part of exactly 0, not only 0.0
(which would mean &quot;approximately 0&quot;).

<P>The type specifier for this is <code>(complex integer
single-float)</code>, and <code>(complex <var>type-of-real-part</var>
<var>type-of-imaginary-part</var>)</code> in general.

<P>The type specifier <code>(complex <var>type</var>)</code> is
equivalent to <code>(complex <var>type</var> <var>type</var>)</code>.


<p>Complex numbers can have a real part and an imaginary part of different
types. If the imaginary part is <code>eql</code> to <code>0</code>, the
number is automatically converted to a real number. (Cf. CLtL1 p. 195)

<p>This has the advantage that <code>(let ((x (sqrt -9.0))) (* x
x))</code> - instead of evaluting to <code>#C(-9.0 0.0)</code>, with
<code>x</code> = <code>#C(0.0 3.0)</code> - evaluates to <code>#C(-9.0
0)</code> = <code>-9.0</code>, with <code>x</code> = <code>#C(0
3.0)</code>.

<a href="CLHSROOT/sec_the_numbers_dictionary.html">
<H3>12.2 The Numbers Dictionary</H3></a>

<p><code>(lcm)</code>, called without arguments, returns <code>1</code>,
which is the neutral element of composition with <code>lcm</code>.

<P><code>(lisp:! <var>n</var>)</code> returns the factorial of
<var>n</var>, <var>n</var> a nonnegative integer.

<P><code>(lisp:exquo <var>x</var> <var>y</var>)</code> returns the
quotient <var>x/y</var> of two integers <var>x</var>,<var>y</var>, and
checks that it is an integer. (This is more efficient than
<code>/</code>.)

<P><code>(lisp:xgcd <var>x<SUB>1</SUB></var>
... <var>x<SUB>n</SUB></var>)</code> returns the values <var>g</var>,
<var>c<SUB>1</SUB></var>, ..., <var>c<SUB>n</SUB></var>, where
<var>g</var> is the greatest common divisor of the integers
<var>x<SUB>1</SUB></var>,...,<var>x<SUB>n</SUB></var>, and
<var>c<SUB>1</SUB></var>,...,<var>c<SUB>n</SUB></var> are integer
coefficients such that

<br><code><var>g</var></code> = <code>(gcd <var>x<SUB>1</SUB></var>
... <var>x<SUB>n</SUB></var>)</code> = <code>(+ (*
<var>c<SUB>1</SUB></var> <var>x<SUB>1</SUB></var>) ... (*
<var>c<SUB>n</SUB></var> <var>x<SUB>n</SUB></var>))</code>

<a href="CLHSROOT/fun_expcm_expt.html">
<h4>expt</h4></a>

<p><code>(expt <var>base</var> <var>exponent</var>)</code> is not very
precise if exponent has large absolute value.

<a href="CLHSROOT/fun_log.html">
<h4>log</h4></a>

<P><code>(log <var>number</var> <var>base</var>)</code> signals an error
if <var>base</var> = 1.

<a href="CLHSROOT/convar_pi.html">
<h4>pi</h4></a>

<p>The value of <code>pi</code> is a long float with the precision given
by <code>(long-float-digits)</code>. When this precision is changed, the
value of <code>pi</code> is automatically recomputed. Therefore
<code>pi</code> is a variable, not a constant.

<a href="CLHSROOT/fun_decode-fl_decode-float.html">
<h4>float decoding</h4></a>

<p><code>float-radix</code> always returns <code>2</code>.

<P><code>(float-digits <var>number</var> <var>digits</var>)</code>
coerces <var>number</var> (a real number) to a floating point number
with at least <var>digits</var> mantissa digits. The following holds:
<BR>
<code>(&gt;= (float-digits (float-digits <var>number</var>
<var>digits</var>)) <var>digits</var>)</code>

<a href="CLHSROOT/convar_boole-_cm_boole-xor.html">
<h4>boolean</h4></a>

<TABLE>
  <TR> <TD><code>boole-clr</code>   <TD>= <TD ALIGN=RIGHT> 0
  <TR> <TD><code>boole-set</code>   <TD>= <TD ALIGN=RIGHT>15
  <TR> <TD><code>boole-1</code>     <TD>= <TD ALIGN=RIGHT>10
  <TR> <TD><code>boole-2</code>     <TD>= <TD ALIGN=RIGHT>12
  <TR> <TD><code>boole-c1</code>    <TD>= <TD ALIGN=RIGHT> 5
  <TR> <TD><code>boole-c2</code>    <TD>= <TD ALIGN=RIGHT> 3
  <TR> <TD><code>boole-and</code>   <TD>= <TD ALIGN=RIGHT> 8
  <TR> <TD><code>boole-ior</code>   <TD>= <TD ALIGN=RIGHT>14
  <TR> <TD><code>boole-xor</code>   <TD>= <TD ALIGN=RIGHT> 6
  <TR> <TD><code>boole-eqv</code>   <TD>= <TD ALIGN=RIGHT> 9
  <TR> <TD><code>boole-nand</code>  <TD>= <TD ALIGN=RIGHT> 7
  <TR> <TD><code>boole-nor</code>   <TD>= <TD ALIGN=RIGHT> 1
  <TR> <TD><code>boole-andc1</code> <TD>= <TD ALIGN=RIGHT> 4
  <TR> <TD><code>boole-andc2</code> <TD>= <TD ALIGN=RIGHT> 2
  <TR> <TD><code>boole-orc1</code>  <TD>= <TD ALIGN=RIGHT>13
  <TR> <TD><code>boole-orc2</code>  <TD>= <TD ALIGN=RIGHT>11
</TABLE>

<a href="CLHSROOT/convar_most-p_ative-fixnum.html">
<h4>fixnum limits</h4></a>

<p> <code>most-positive-fixnum</code> =  2<SUP>24</SUP>-1 =  16777215
<BR><code>most-negative-fixnum</code> = -2<SUP>24</SUP>   = -16777216

<a href="CLHSROOT/convar_most-p_d-long-float.html">
<h4>float limits</h4></a>

<p>Together with <code>pi</code>, the other long float constants
<code>most-positive-long-float</code>,
<code>least-positive-long-float</code>,
<code>least-negative-long-float</code>,
<code>most-negative-long-float</code>,
<code>least-positive-normalized-long-float</code>,
<code>least-negative-normalized-long-float</code>,
<code>long-float-epsilon</code>,
<code>long-float-negative-epsilon</code> are recomputed whenever
<code>(long-float-digits)</code> is changed. They are variables, not
constants.


<a name="characters"></a><a href="CLHSROOT/Body/chap-13.html">
<h2>Chapter 13: Characters</h2></a>

<p>The characters are ordered according to the ASCII encoding.

<!-- #ifdef IBMPC_CHS -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2 platforms only.</EM></DT>
<DD>
More precisely, CLISP uses the IBM PC character set (code page 437):
<TABLE BORDER=1>
  <TR>       <TH>    <TH>$0 <TH>$1 <TH>$2 <TH>$3 <TH>$4 <TH>$5 <TH>$6 <TH>$7 <TH>$8 <TH>$9 <TH>$A <TH>$B <TH>$C <TH>$D <TH>$E <TH>$F
  <TR>       <TH>$00 <TD>** <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD> &para; <TD> &sect;
  <TR>       <TH>$10 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>** <TD>** <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$20 <TD> &nbsp; <TD> ! <TD> &quot; <TD> # <TD> $ <TD> % <TD> &amp; <TD> ' <TD> ( <TD> ) <TD> * <TD> + <TD> , <TD> - <TD> . <TD> /
  <TR>       <TH>$30 <TD> 0 <TD> 1 <TD> 2 <TD> 3 <TD> 4 <TD> 5 <TD> 6 <TD> 7 <TD> 8 <TD> 9 <TD> : <TD> ; <TD> &lt; <TD> = <TD> &gt; <TD> ?
  <TR>       <TH>$40 <TD> @ <TD> A <TD> B <TD> C <TD> D <TD> E <TD> F <TD> G <TD> H <TD> I <TD> J <TD> K <TD> L <TD> M <TD> N <TD> O
  <TR>       <TH>$50 <TD> P <TD> Q <TD> R <TD> S <TD> T <TD> U <TD> V <TD> W <TD> X <TD> Y <TD> Z <TD> [ <TD> \ <TD> ] <TD> ^ <TD> _
  <TR>       <TH>$60 <TD> ` <TD> a <TD> b <TD> c <TD> d <TD> e <TD> f <TD> g <TD> h <TD> i <TD> j <TD> k <TD> l <TD> m <TD> n <TD> o
  <TR>       <TH>$70 <TD> p <TD> q <TD> r <TD> s <TD> t <TD> u <TD> v <TD> w <TD> x <TD> y <TD> z <TD> { <TD> | <TD> } <TD> ~ <TD> 
  <TR>       <TH>$80 <TD> &Ccedil; <TD> &uuml; <TD> &eacute; <TD> &acirc; <TD> &auml; <TD> &agrave; <TD> &aring; <TD> &ccedil; <TD> &ecirc; <TD> &euml; <TD> &egrave; <TD> &iuml; <TD> &icirc; <TD> &igrave; <TD> &Auml; <TD> &Aring;
  <TR>       <TH>$90 <TD> &Eacute; <TD> &aelig; <TD> &AElig; <TD> &ocirc; <TD> &ouml; <TD> &ograve; <TD> &ucirc; <TD> &ugrave; <TD> &yuml; <TD> &Ouml; <TD> &Uuml; <TD> &cent; <TD> &pound; <TD> &yen;
  <TR>       <TH>$A0 <TD> &aacute; <TD> &iacute; <TD> &oacute; <TD> &uacute; <TD> &ntilde; <TD> &Ntilde; <TD> &ordf; <TD> &ordm; <TD> &iquest; <TD>   <TD> &not; <TD> &frac12; <TD> &frac14; <TD> &iexcl; <TD> &laquo; <TD> &raquo;
  <TR>       <TH>$B0 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$C0 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$D0 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$E0 <TD>   <TD> &szlig; <TD>   <TD>   <TD>   <TD>   <TD> &micro; <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$F0 <TD>   <TD> &plusmn; <TD>   <TD>   <TD>   <TD>   <TD> &divide; <TD>   <TD> &deg; <TD>   <TD> &middot; <TD>   <TD>   <TD> &sup2; <TD>   <TD>
</TABLE>
Here ** are control characters, not graphic characters. (The characters left
blank here cannot be represented in this character set).

</DD>
</DL>
<!-- #endif -->
<!-- #ifdef ISOLATIN_CHS -->
<DL>
<DT><EM>Platform dependent: UNIX (except NeXTstep), Win32, Amiga, Acorn platforms only.</EM></DT>
<DD>
More precisely, CLISP uses the ISO Latin-1 (ISO 8859-1) character set:
<TABLE BORDER=1>
  <TR>       <TH>    <TH>$0 <TH>$1 <TH>$2 <TH>$3 <TH>$4 <TH>$5 <TH>$6 <TH>$7 <TH>$8 <TH>$9 <TH>$A <TH>$B <TH>$C <TH>$D <TH>$E <TH>$F
  <TR>       <TH>$00 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$10 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$20 <TD> &nbsp; <TD> ! <TD> &quot; <TD> # <TD> $ <TD> % <TD> &amp; <TD> ' <TD> ( <TD> ) <TD> * <TD> + <TD> , <TD> - <TD> . <TD> /
  <TR>       <TH>$30 <TD> 0 <TD> 1 <TD> 2 <TD> 3 <TD> 4 <TD> 5 <TD> 6 <TD> 7 <TD> 8 <TD> 9 <TD> : <TD> ; <TD> &lt; <TD> = <TD> &gt; <TD> ?
  <TR>       <TH>$40 <TD> @ <TD> A <TD> B <TD> C <TD> D <TD> E <TD> F <TD> G <TD> H <TD> I <TD> J <TD> K <TD> L <TD> M <TD> N <TD> O
  <TR>       <TH>$50 <TD> P <TD> Q <TD> R <TD> S <TD> T <TD> U <TD> V <TD> W <TD> X <TD> Y <TD> Z <TD> [ <TD> \ <TD> ] <TD> ^ <TD> _
  <TR>       <TH>$60 <TD> ` <TD> a <TD> b <TD> c <TD> d <TD> e <TD> f <TD> g <TD> h <TD> i <TD> j <TD> k <TD> l <TD> m <TD> n <TD> o
  <TR>       <TH>$70 <TD> p <TD> q <TD> r <TD> s <TD> t <TD> u <TD> v <TD> w <TD> x <TD> y <TD> z <TD> { <TD> | <TD> } <TD> ~ <TD>
  <TR>       <TH>$80 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$90 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$A0 <TD> &nbsp; <TD> &iexcl; <TD> &cent; <TD> &pound; <TD> &curren; <TD> &yen; <TD> &brvbar; <TD> &sect; <TD> &uml; <TD> &copy; <TD> &ordf; <TD> &laquo; <TD> &not; <TD> &shy; <TD> &reg; <TD> &macr;
  <TR>       <TH>$B0 <TD> &deg; <TD> &plusmn; <TD> &sup2; <TD> &sup3; <TD> &acute; <TD> &micro; <TD> &para; <TD> &middot; <TD> &cedil; <TD> &sup1; <TD> &ordm; <TD> &raquo; <TD> &frac14; <TD> &frac12; <TD> &frac34; <TD> &iquest;
  <TR>       <TH>$C0 <TD> &Agrave; <TD> &Aacute; <TD> &Acirc; <TD> &Atilde; <TD> &Auml; <TD> &Aring; <TD> &AElig; <TD> &Ccedil; <TD> &Egrave; <TD> &Eacute; <TD> &Ecirc; <TD> &Euml; <TD> &Igrave; <TD> &Iacute; <TD> &Icirc; <TD> &Iuml;
  <TR>       <TH>$D0 <TD> &ETH; <TD> &Ntilde; <TD> &Ograve; <TD> &Oacute; <TD> &Ocirc; <TD> &Otilde; <TD> &Ouml; <TD> &times; <TD> &Oslash; <TD> &Ugrave; <TD> &Uacute; <TD> &Ucirc; <TD> &Uuml; <TD> &Yacute; <TD> &THORN; <TD> &szlig;
  <TR>       <TH>$E0 <TD> &agrave; <TD> &aacute; <TD> &acirc; <TD> &atilde; <TD> &auml; <TD> &aring; <TD> &aelig; <TD> &ccedil; <TD> &egrave; <TD> &eacute; <TD> &ecirc; <TD> &euml; <TD> &igrave; <TD> &iacute; <TD> &icirc; <TD> &iuml;
  <TR>       <TH>$F0 <TD> &eth; <TD> &ntilde; <TD> &ograve; <TD> &oacute; <TD> &ocirc; <TD> &otilde; <TD> &ouml; <TD> &divide; <TD> &oslash; <TD> &ugrave; <TD> &uacute; <TD> &ucirc; <TD> &uuml; <TD> &yacute; <TD> &thorn; <TD> &yuml;
</TABLE>
Here ** are control characters, not graphic characters. (The characters left
blank here cannot be represented in this character set).

</DD>
</DL>
<!-- #endif -->
<!-- #ifdef NEXTSTEP_CHS -->
<DL>
<DT><EM>Platform dependent: NeXTstep platforms only.</EM></DT>
<DD>
More precisely, CLISP uses the NextStep character set:
<TABLE BORDER=1>
  <TR>       <TH>    <TH>$0 <TH>$1 <TH>$2 <TH>$3 <TH>$4 <TH>$5 <TH>$6 <TH>$7 <TH>$8 <TH>$9 <TH>$A <TH>$B <TH>$C <TH>$D <TH>$E <TH>$F
  <TR>       <TH>$00 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$10 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$20 <TD> &nbsp; <TD> ! <TD> &quot; <TD> # <TD> $ <TD> % <TD> &amp; <TD> ' <TD> ( <TD> ) <TD> * <TD> + <TD> , <TD> - <TD> . <TD> /
  <TR>       <TH>$30 <TD> 0 <TD> 1 <TD> 2 <TD> 3 <TD> 4 <TD> 5 <TD> 6 <TD> 7 <TD> 8 <TD> 9 <TD> : <TD> ; <TD> &lt; <TD> = <TD> &gt; <TD> ?
  <TR>       <TH>$40 <TD> @ <TD> A <TD> B <TD> C <TD> D <TD> E <TD> F <TD> G <TD> H <TD> I <TD> J <TD> K <TD> L <TD> M <TD> N <TD> O
  <TR>       <TH>$50 <TD> P <TD> Q <TD> R <TD> S <TD> T <TD> U <TD> V <TD> W <TD> X <TD> Y <TD> Z <TD> [ <TD> \ <TD> ] <TD> ^ <TD> _
  <TR>       <TH>$60 <TD> ` <TD> a <TD> b <TD> c <TD> d <TD> e <TD> f <TD> g <TD> h <TD> i <TD> j <TD> k <TD> l <TD> m <TD> n <TD> o
  <TR>       <TH>$70 <TD> p <TD> q <TD> r <TD> s <TD> t <TD> u <TD> v <TD> w <TD> x <TD> y <TD> z <TD> { <TD> | <TD> } <TD> ~ <TD>
  <TR>       <TH>$80 <TD> &nbsp; <TD> &Agrave; <TD> &Aacute; <TD> &Acirc; <TD> &Atilde; <TD> &Auml; <TD> &Aring; <TD> &Ccedil; <TD> &Egrave; <TD> &Eacute; <TD> &Ecirc; <TD> &Euml; <TD> &Igrave; <TD> &Iacute; <TD> &Icirc; <TD> &Iuml;
  <TR>       <TH>$90 <TD> &ETH; <TD> &Ntilde; <TD> &Ograve; <TD> &Oacute; <TD> &Ocirc; <TD> &Otilde; <TD> &Ouml; <TD> &Ugrave; <TD> &Uacute; <TD> &Ucirc; <TD> &Uuml; <TD> &Yacute; <TD> &THORN; <TD> &micro; <TD> &times; <TD> &divide;
  <TR>       <TH>$A0 <TD> &copy; <TD> &iexcl; <TD> &cent; <TD> &pound; <TD>   <TD> &yen; <TD>   <TD> &sect; <TD> &curren; <TD>   <TD>   <TD> &laquo; <TD>   <TD>   <TD>   <TD>
  <TR>       <TH>$B0 <TD> &reg; <TD>   <TD>   <TD>   <TD> &middot; <TD> &brvbar; <TD> &para; <TD>   <TD>   <TD>   <TD>   <TD> &raquo; <TD>   <TD>   <TD> &not; <TD> &iquest;
  <TR>       <TH>$C0 <TD> &sup1; <TD>   <TD> &acute; <TD>   <TD>   <TD> &macr; <TD>   <TD>   <TD> &uml; <TD> &sup2; <TD> &deg; <TD> &cedil; <TD> &sup3; <TD>   <TD>   <TD>
  <TR>       <TH>$D0 <TD>   <TD> &plusmn; <TD> &frac14; <TD> &frac12; <TD> &frac34; <TD> &agrave; <TD> &aacute; <TD> &acirc; <TD> &atilde; <TD> &auml; <TD> &aring; <TD> &ccedil; <TD> &egrave; <TD> &eacute; <TD> &ecirc; <TD> &euml;
  <TR>       <TH>$E0 <TD> &igrave; <TD> &AElig; <TD> &iacute; <TD> &ordf; <TD> &icirc; <TD> &iuml; <TD> &eth; <TD> &ntilde; <TD>   <TD> &Oslash; <TD>   <TD> &ordm; <TD> &ograve; <TD> &oacute; <TD> &ocirc; <TD> &otilde;
  <TR>       <TH>$F0 <TD> &ouml; <TD> &aelig; <TD> &ugrave; <TD> &uacute; <TD> &ucirc; <TD>   <TD> &uuml; <TD> &yacute; <TD>   <TD> &oslash; <TD>   <TD> &szlig; <TD> &thorn; <TD> &yuml;
</TABLE>
Here ** are control characters, not graphic characters. (The characters left
blank here cannot be represented in this character set).

</DD>
</DL>
<!-- #endif -->

The following are standard characters:
<TABLE>
  <TR> <TD><code>#\Space</code>              <TD> $20
  <TR> <TD><code>#\Newline</code>            <TD> $0A
</TABLE>
The following are semi-standard characters:
<TABLE>
  <TR> <TD><code>#\Backspace</code>          <TD> $08
  <TR> <TD><code>#\Tab</code>                <TD> $09
  <TR> <TD><code>#\Linefeed</code>           <TD> $0A
  <TR> <TD><code>#\Page</code>               <TD> $0C
  <TR> <TD><code>#\Return</code>             <TD> $0D
</TABLE>
<!-- #if defined(MSDOS_CHARNAMES) || defined(WIN32_CHARNAMES) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
<TABLE>
  <TR> <TD><code>#\Rubout</code>             <TD> $08
</TABLE>
</DD>
</DL>
<!-- #endif -->
<!-- #if defined(UNIX_CHARNAMES) || defined(AMIGA_CHARNAMES) -->
<DL>
<DT><EM>Platform dependent: UNIX, Amiga, Acorn platforms only.</EM></DT>
<DD>
<TABLE>
  <TR> <TD><code>#\Rubout</code>             <TD> $7F
</TABLE>
</DD>
</DL>
<!-- #endif -->

<H3>Newline.</H3>

<code>#\Newline</code> is the delimiter between lines.
<P>
<!-- #if defined(MSDOS) || defined(WIN32) || (defined(UNIX) && (O_BINARY != 0)) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
When writing to a file, <code>#\Newline</code> is converted to
CR/LF. (This is the usual convention on DOS.) For example,
<code>#\Return #\Newline</code> is written as CR/CR/LF.
</DD>
</DL>
<!-- #endif -->
When reading from a file, CR/LF is converted to <code>#\Newline</code>,
and CR not followed by LF is read as <code>#\Return</code>.

<H3>Additional Named Characters</H3>

There are the following additional characters with names:
<TABLE>
  <TR> <TD><code>#\Null</code>               <TD> $00
  <TR> <TD><code>#\Bell</code>               <TD> $07
  <TR> <TD><code>#\Escape</code>             <TD> $1B
</TABLE>

<P> Additionally, the following syntax is defined for characters with code
from $00 to $1F:
<TABLE>
  <TR> <TD><code>#\^@</code>                      <TD> $00
  <TR> <TD><code>#\^A</code> .. <code>#\^Z</code> <TD> $01 .. $1A
  <TR> <TD><code>#\^[</code>                      <TD> $1B
  <TR> <TD><code>#\^\</code>                      <TD> $1C
  <TR> <TD><code>#\^]</code>                      <TD> $1D
  <TR> <TD><code>#\^^</code>                      <TD> $1E
  <TR> <TD><code>#\^_</code>                      <TD> $1F
</TABLE>

<P> See also sec. <A HREF="#chario">character i/o</A>.

<H3>Attributes</H3>

The code of a character is &gt;=0, &lt;256. <code>char-code-limit</code>
= 256.

There are fonts 0 to 15, and <code>lisp:char-font-limit</code> = 16. But
the system itself uses only font 0.

The following bits attributes are implemented: <code>:control</code>,
<code>:meta</code>, <code>:super</code>, <code>:hyper</code>. Therefore
<code>lisp:char-bits-limit</code> = 16.
<!-- #ifdef KEYBOARD -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Acorn platforms only.</EM></DT>
<DD>
The system itself uses these bits only to mention special keys and
Control/Alternate/Shift key status on return from
<code>(read-char *keyboard-input*)</code>.
</DD>
</DL>
<!-- #endif -->

<a href="CLHSROOT/Body/sec_the_chara_s_dictionary.html">
<h3>13.2. The Characters Dictionary</h3></a>

<br><code>char-code-limit</code> = 256
<br><code>lisp:char-bits-limit</code> = 16
<br><code>lisp:char-font-limit</code> = 16

<p>String-chars are those characters with font = 0 and bits = 0.

<p>The graphic characters have been described above.

<p>The standard characters are <code>#\Newline</code> and those graphic
characters with a code between 32 and 126 (inclusive).

<p>The alphabetic characters are these characters:
<pre>
             ABCDEFGHIJKLMNOPQRSTUVWXYZ
             abcdefghijklmnopqrstuvwxyz
</pre>
and the international alphabetic characters from the character set:
<pre>
             &Ccedil;&uuml;&eacute;&acirc;&auml;&agrave;&aring;&ccedil;&ecirc;&euml;&egrave;&iuml;&icirc;&igrave;&Auml;&Aring;&Eacute;&aelig;&AElig;&ocirc;&ouml;&ograve;&ucirc;&ugrave;&yuml;&Ouml;&Uuml;&szlig;&aacute;&iacute;&oacute;&uacute;&ntilde;&Ntilde;&ordf;&ordm;&atilde;&otilde;&Oslash;&oslash;&Agrave;&Atilde;&Otilde; etc.
</pre>

<p>The functions <code>char-equal</code>, <code>char-not-equal</code>,
<code>char-lessp</code>, <code>char-greaterp</code>,
<code>char-not-greaterp</code>, <code>char-not-lessp</code> ignore bits
and font attributes of their arguments.

<h3>13.4.</h3>

<p>The characters that are not graphic chars and the space character have
names:
<!-- #ifdef AMIGA_CHARNAMES -->
<DL>
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD>
      <code>(code-char #x00)</code> = <code>#\Null</code>
  <BR><code>(code-char #x01)</code> = <code>#\Code1</code>
  <BR><code>(code-char #x02)</code> = <code>#\Code2</code>
  <BR><code>(code-char #x03)</code> = <code>#\Code3</code>
  <BR><code>(code-char #x04)</code> = <code>#\Code4</code>
  <BR><code>(code-char #x05)</code> = <code>#\Code5</code>
  <BR><code>(code-char #x06)</code> = <code>#\Code6</code>
  <BR><code>(code-char #x07)</code> = <code>#\Bell</code> = <code>#\Bel</code>
  <BR><code>(code-char #x08)</code> = <code>#\Backspace</code> = <code>#\Bs</code>
  <BR><code>(code-char #x09)</code> = <code>#\Tab</code> = <code>#\Ht</code>
  <BR><code>(code-char #x0A)</code> = <code>#\Newline</code> = <code>#\Linefeed</code> = <code>#\Lf</code>
  <BR><code>(code-char #x0B)</code> = <code>#\Vt</code>
  <BR><code>(code-char #x0C)</code> = <code>#\Page</code> = <code>#\Ff</code>
  <BR><code>(code-char #x0D)</code> = <code>#\Return</code> = <code>#\Cr</code>
  <BR><code>(code-char #x0E)</code> = <code>#\So</code>
  <BR><code>(code-char #x0F)</code> = <code>#\Si</code>
  <BR><code>(code-char #x10)</code> = <code>#\Code16</code>
  <BR><code>(code-char #x11)</code> = <code>#\Code17</code>
  <BR><code>(code-char #x12)</code> = <code>#\Code18</code>
  <BR><code>(code-char #x13)</code> = <code>#\Code19</code>
  <BR><code>(code-char #x14)</code> = <code>#\Code20</code>
  <BR><code>(code-char #x15)</code> = <code>#\Code21</code>
  <BR><code>(code-char #x16)</code> = <code>#\Code22</code>
  <BR><code>(code-char #x17)</code> = <code>#\Code23</code>
  <BR><code>(code-char #x18)</code> = <code>#\Code24</code>
  <BR><code>(code-char #x19)</code> = <code>#\Code25</code>
  <BR><code>(code-char #x1A)</code> = <code>#\Code26</code>
  <BR><code>(code-char #x1B)</code> = <code>#\Escape</code> = <code>#\Esc</code>
  <BR><code>(code-char #x1C)</code> = <code>#\Code28</code>
  <BR><code>(code-char #x1D)</code> = <code>#\Code29</code>
  <BR><code>(code-char #x1E)</code> = <code>#\Code30</code>
  <BR><code>(code-char #x1F)</code> = <code>#\Code31</code>
  <BR><code>(code-char #x20)</code> = <code>#\Space</code>
  <BR><code>(code-char #x7F)</code> = <code>#\Rubout</code>
  <BR><code>(code-char #x9B)</code> = <code>#\Csi</code>
</DD>
</DL>
<!-- #endif -->
<!-- #if defined(MSDOS_CHARNAMES) || defined(WIN32_CHARNAMES) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
      <code>(code-char #x00)</code> = <code>#\Null</code>
  <BR><code>(code-char #x07)</code> = <code>#\Bell</code>
  <BR><code>(code-char #x08)</code> = <code>#\Backspace</code> = <code>#\Rubout</code>
  <BR><code>(code-char #x09)</code> = <code>#\Tab</code>
  <BR><code>(code-char #x0A)</code> = <code>#\Newline</code> = <code>#\Linefeed</code>
  <BR><code>(code-char #x0B)</code> = <code>#\Code11</code>
  <BR><code>(code-char #x0C)</code> = <code>#\Page</code>
  <BR><code>(code-char #x0D)</code> = <code>#\Return</code>
  <BR><code>(code-char #x1A)</code> = <code>#\Code26</code>
  <BR><code>(code-char #x1B)</code> = <code>#\Escape</code>
  <BR><code>(code-char #x20)</code> = <code>#\Space</code>
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef UNIX_CHARNAMES -->
<DL>
<DT><EM>Platform dependent: UNIX, Acorn platforms only.</EM></DT>
<DD>
      <code>(code-char #x00)</code> = <code>#\Null</code> = <code>#\Nul</code>
  <BR><code>(code-char #x01)</code> = <code>#\Soh</code>
  <BR><code>(code-char #x02)</code> = <code>#\Stx</code>
  <BR><code>(code-char #x03)</code> = <code>#\Etx</code>
  <BR><code>(code-char #x04)</code> = <code>#\Eot</code>
  <BR><code>(code-char #x05)</code> = <code>#\Enq</code>
  <BR><code>(code-char #x06)</code> = <code>#\Ack</code>
  <BR><code>(code-char #x07)</code> = <code>#\Bell</code> = <code>#\Bel</code>
  <BR><code>(code-char #x08)</code> = <code>#\Backspace</code> = <code>#\Bs</code>
  <BR><code>(code-char #x09)</code> = <code>#\Tab</code> = <code>#\Ht</code>
  <BR><code>(code-char #x0A)</code> = <code>#\Newline</code> = <code>#\Nl</code> = <code>#\Linefeed</code>
  <BR><code>(code-char #x0B)</code> = <code>#\Vt</code>
  <BR><code>(code-char #x0C)</code> = <code>#\Page</code> = <code>#\Np</code>
  <BR><code>(code-char #x0D)</code> = <code>#\Return</code> = <code>#\Cr</code>
  <BR><code>(code-char #x0E)</code> = <code>#\So</code>
  <BR><code>(code-char #x0F)</code> = <code>#\Si</code>
  <BR><code>(code-char #x10)</code> = <code>#\Dle</code>
  <BR><code>(code-char #x11)</code> = <code>#\Dc1</code>
  <BR><code>(code-char #x12)</code> = <code>#\Dc2</code>
  <BR><code>(code-char #x13)</code> = <code>#\Dc3</code>
  <BR><code>(code-char #x14)</code> = <code>#\Dc4</code>
  <BR><code>(code-char #x15)</code> = <code>#\Nak</code>
  <BR><code>(code-char #x16)</code> = <code>#\Syn</code>
  <BR><code>(code-char #x17)</code> = <code>#\Etb</code>
  <BR><code>(code-char #x18)</code> = <code>#\Can</code>
  <BR><code>(code-char #x19)</code> = <code>#\Em</code>
  <BR><code>(code-char #x1A)</code> = <code>#\Sub</code>
  <BR><code>(code-char #x1B)</code> = <code>#\Escape</code> = <code>#\Esc</code>
  <BR><code>(code-char #x1C)</code> = <code>#\Fs</code>
  <BR><code>(code-char #x1D)</code> = <code>#\Gs</code>
  <BR><code>(code-char #x1E)</code> = <code>#\Rs</code>
  <BR><code>(code-char #x1F)</code> = <code>#\Us</code>
  <BR><code>(code-char #x20)</code> = <code>#\Space</code> = <code>#\Sp</code>
  <BR><code>(code-char #x7F)</code> = <code>#\Rubout</code> = <code>#\Delete</code> = <code>#\Del</code>
</DD>
</DL>
<!-- #endif -->

<h3>13.5.</h3>

<table>
 <tr> <td><code>lisp:char-control-bit</code> <td>= 1
 <tr> <td><code>lisp:char-meta-bit</code>    <td>= 2
 <tr> <td><code>lisp:char-super-bit</code>   <td>= 4
 <tr> <td><code>lisp:char-hyper-bit</code>   <td>= 8
</table>


<a name="conses"></a><a href="CLHSROOT/Body/chap-14.html">
<h2>Chapter 14: Conses</h2></a>

<a href="CLHSROOT/Body/sec_the_conses_dictionary.html">
<h3>14.2 The Conses Dictionary</h3></a>

<p><code>sublis</code> and <code>nsublis</code> apply the
<code>:key</code> argument to the nodes of the cons tree and not to the
keys of the alist.

<p>The function <STRONG><code>lisp:mapcap</code></STRONG> is like
<code>mapcan</code>, except that it concatenates the resulting lists
with <code>append</code> instead of <code>nconc</code>:

<BR><code>(mapcap <var>fun</var> <var>x<SUB>1</SUB></var>
... <var>x<SUB>n</SUB></var>)</code> ==
 <code>(apply #'append (mapcar <var>fun</var> <var>x<SUB>1</SUB></var>
... <var>x<SUB>n</SUB></var>))</code>

<BR>(Actually a bit more efficient that this would be.)

<P>The function <STRONG><code>lisp:maplap</code></STRONG> is like
<code>mapcon</code>, except that it concatenates the resulting lists
with <code>append</code> instead of <code>nconc</code>:

<BR><code>(maplap <var>fun</var> <var>x<SUB>1</SUB></var>
... <var>x<SUB>n</SUB></var>)</code> ==
 <code>(apply #'append (maplist <var>fun</var> <var>x<SUB>1</SUB></var>
... <var>x<SUB>n</SUB></var>))</code>

<BR>(Actually a bit more efficient that this would be.)

<a name="arrays"></a><a href="CLHSROOT/Body/chap-15.html">
<h2>Chapter 15: Arrays</h2></a>

<p><code>make-array</code> can return specialized arrays for the element
types <code>(unsigned-byte 2)</code>, <code>(unsigned-byte 4)</code>,
<code>(unsigned-byte 8)</code>, <code>(unsigned-byte 16)</code>,
<code>(unsigned-byte 32)</code> and of course <code>bit</code> and
<code>character</code>.

<P><code>array-rank-limit</code> is either 65536 or 4294967296.
<P><code>array-dimension-limit</code> = 2<SUP>24</SUP> = 16777216
<p><code>array-total-size-limit</code> = 2<SUP>24</SUP> = 16777216

<H3>adjustment of displaced arrays</H3>

<p>An array to which another array is displaced should not be shrunk
(using <code>adjust-array</code>) in such a way that the other array
points into void space.  This is not checked at the time
<code>adjust-array</code> is called!


<a name="strings"></a><a href="CLHSROOT/Body/chap-16.html">
<h2>Chapter 16: Strings</h2></a>

<p>String comparison is based on the function
<code>char&lt;=</code>. Therefore diphtongs do not obey the usual
national rules. Example: <code>&quot;o&quot;</code> &lt;
<code>&quot;oe&quot;</code> &lt; <code>&quot;z&quot;</code> &lt;
<code>&quot;&ouml;&quot;</code>.

<a name="sequences"></a><a href="CLHSROOT/Body/chap-17.html">
<h2>Chapter 17: Sequences</h2></a>

<p>For iteration through a sequence, a macro
<STRONG><code>lisp:doseq</code></STRONG>, analogous to
<code>dolist</code>, may be used instead of <code>map</code> :

<p><code>(doseq (<var>var</var> <var>seqform</var>
[<var>resultform</var>]) {<var>declaration</var>}*
{<var>tag</var>|<var>statement</var>}* )</code>

<a href="CLHSROOT/sec_the_seque_s_dictionary.html">
<H3>17.3. The Sequences Dictionary</H3></a>

<a href="CLHSROOT/">
<h4></h4></a>

<p>The ANSI CL function <code>map-into</code> is implemented.

<a href="CLHSROOT/fun_reversecm_nreverse.html">
<h4>nreverse</h4></a>

<p>The result of <code>nreverse</code> is always <code>eq</code> to the
argument. <code>nreverse</code> on a vector swaps pairs of
elements. <code>nreverse</code> on a list swaps the first and the last
element and reverses the list chaining between them.

<a href="CLHSROOT/fun_removecm__elete-if-not.html">
<h4>remove/delete</h4></a>

<p><code>remove</code>, <code>remove-if</code>,
<code>remove-if-not</code>, <code>remove-duplicates</code> return their
argument unchanged, if no element has to be removed.

<p><code>delete</code>, <code>delete-if</code>,
<code>delete-if-not</code>, <code>delete-duplicates</code> destructively
modify their argument: If the argument is a list, the <code>cdr</code>
parts are modified. If the argument is a vector with fill pointer, the
fill pointer is lowered and the remaining elements are compacted below
the new fill pointer.

<a href="CLHSROOT/fun_sortcm_stable-sort.html">
<h4>sort</h4></a>

<p><code>sort</code> and <code>stable-sort</code> have two additional
keywords <code>:start</code> and <code>:end</code>:

<p><PRE><code>
  (sort <var>sequence</var> <var>predicate</var> &amp;key :key :start :end)
  (stable-sort <var>sequence</var> <var>predicate</var> &amp;key :key
               :start :end)
</code></PRE>

<P><code>sort</code> and <code>stable-sort</code> are identical. They
implement the mergesort algorithm.

<a name="hash"></a><a href="CLHSROOT/Body/chap-18.html">
<h2>Chapter 18: Hash Tables</h2></a>

<a href="CLHSROOT/Body/sec_the_hash__s_dictionary.html">
<H3>18.2. The Hash Tables Dictionary</H3></a>

<p><code>make-hash-table</code> has an additional keyword
  <code>:initial-contents</code>:

<p><code>(make-hash-table &amp;key :test :initial-contents :size
                          :rehash-size :rehash-threshold)</code>


<p>The <code>:initial-contents</code> argument is an alist that is used
to initialize the new hash table.  The <code>:rehash-threshold</code>
argument is ignored.

<P>For iteration through a hash table, a macro
<STRONG><code>lisp:dohash</code></STRONG>, analogous to
<code>dolist</code>, can be used instead of <code>maphash</code>:

<p><PRE><code>(dohash (<var>key-var</var> <var>value-var</var> <var>hash-table-form</var> [<var>resultform</var>])
  {<var>declaration</var>}* {<var>tag</var>|<var>statement</var>}*
)
</code></PRE>


<a name="filenames"></a><a href="CLHSROOT/Body/chap-19.html">
<h2>Chapter 19: Filenames</h2></a>

<p>For most operations, pathnames denoting files and pathnames denoting
directories can not be used interchangeably.

<DL>
<!-- #if defined(PATHNAME_UNIX) || defined(PATHNAME_AMIGAOS) -->
<DT><EM>Platform dependent: UNIX, Amiga platforms only.</EM></DT>
<DD>
For example, <code>#&quot;FOO/BAR&quot;</code> denotes the file
<code>BAR</code> in the directory <code>FOO</code>, while
<code>#&quot;FOO/BAR/&quot;</code> denotes the subdirectory
<code>BAR</code> of the directory <code>FOO</code>.
</DD>
<!-- #endif -->
<!-- #if defined(PATHNAME_MSDOS) || defined(PATHNAME_OS2) || defined(PATHNAME_WIN32) -->
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
For example, <code>#&quot;FOO\\BAR&quot;</code> denotes the file
<code>BAR</code> in the directory <code>FOO</code>, while
<code>#&quot;FOO\\BAR\\&quot;</code> denotes the subdirectory
<code>BAR</code> of the directory <code>FOO</code>.
</DD>
<!-- #endif -->
<!-- #ifdef PATHNAME_RISCOS -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
For example, <code>#&quot;FOO.BAR&quot;</code> denotes the file
<code>FOO</code> in the directory <code>BAR</code>, while
<code>#&quot;FOO.BAR.&quot;</code> denotes the subdirectory
<code>BAR</code> of the directory <code>FOO</code>.
</DD>
<!-- #endif -->
</DL>
This is especially important for the functions <code>directory</code>,
<code>dir</code>, <code>cd</code>, <code>make-dir</code>,
<code>delete-dir</code>.

<P>The minimum filename syntax that may be used portably is:
<TABLE>
  <TR> <TD><code>&quot;<var>xxx</var>&quot;</code>       <TD>for a file with name <var>xxx</var>,
  <TR> <TD><code>&quot;<var>xxx</var>.<var>yy</var>&quot;</code>    <TD>for a file with name <var>xxx</var> and type <var>yy</var>,
  <TR> <TD><code>&quot;.<var>yy</var>&quot;</code>       <TD>for a pathname with type <var>yy</var> and no name specified.
</TABLE>
Hereby <var>xxx</var> denote 1 to 8 characters, and <var>yy</var> denote
1 to 3 characters, each of which being either alphanumerical or the
underscore <code>#\_</code>.  Other properties of pathname syntax vary
between operating systems.

<a href="CLHSROOT/Body/sec_19-2-1.html">
<h3>19.2.1 Pathname Components</H3></a>

<!-- #ifdef PATHNAME_MSDOS -->
<DL>
<DT><EM>Platform dependent: DOS platforms only.</EM></DT>
<DD>
Pathname components:
<DL>
<DT><code>host</code>          <DD>always <code>nil</code>
<DT><code>device</code>        <DD><code>nil</code> or <code>:wild</code> or <code>&quot;A&quot;</code>|...|<code>&quot;Z&quot;</code>
<DT><code>directory</code>     <DD><code>(<var>startpoint</var> . <var>subdirs</var>)</code> where
               <BR><var>startpoint</var> = <code>:relative</code> | <code>:absolute</code>
               <BR><var>subdirs</var> = <code>()</code> | <code>(<var>subdir</var> . <var>subdirs</var>)</code>
               <BR><var>subdir</var> = <code>:current</code> (means <code>&quot;.&quot;</code>) or
               <BR><var>subdir</var> = <code>:parent</code> (means <code>&quot;..&quot;</code>) or
               <BR><var>subdir</var> = <code>:wild-inferiors</code> (means <code>&quot;...&quot;</code>, all subdirectories) or
               <BR><var>subdir</var> = <code>(<var>name</var> . <var>type</var>)</code>
                <BR><var>name</var> = <code>:wild</code> or a simple string with 8 characters maximum
                <BR><var>type</var> = <code>:wild</code> or a simple string with 3 characters maximum
<DT><code>name</code>          <DD><code>nil</code> or <code>:wild</code> or a simple string with 8 characters maximum
<DT><code>type</code>          <DD><code>nil</code> or <code>:wild</code> or a simple string with 3 characters maximum
<DT><code>version</code>       <DD>always <code>nil</code> (may also be specified as <code>:wild</code> or <code>:newest</code>)
</DL>

<P>When a pathname is to be fully specified (no wildcards), that means
that no <code>:wild</code>, <code>:wild-inferiors</code> is allowed, and
<var>name</var> = <code>nil</code> may not be allowed either.

<P>
<TABLE>
  <TR> <TD>External notation:
   <TD ALIGN=RIGHT><code>A:\sub1.typ\sub2.typ\name.typ</code>
  <TR> <TD>using defaults:
   <TD ALIGN=RIGHT><code>  \sub1.typ\sub2.typ\name.typ</code>
  <TR> <TD>or
   <TD ALIGN=RIGHT><code>                     name.typ</code>
  <TR> <TD>or
   <TD ALIGN=LEFT><code>*:\sub1.typ\*.*\name.*</code>
  <TR> <TD>or similar.
</TABLE>

<P> Instead of <code>'\'</code> one may use <code>'/'</code>, as usual
for DOS calls.

</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_AMIGAOS -->
<DL>
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
 <DD> Pathname components:
 <DL>
  <DT><code>host</code>
   <DD>always <code>nil</code>
  <DT><code>device</code>
   <DD><code>nil</code> or a simple string
  <DT><code>directory</code>
   <DD><code>(<var>startpoint</var> . <var>subdirs</var>)</code> where
    <BR><var>startpoint</var> = <code>:relative</code> | <code>:absolute</code>
   <BR><var>subdirs</var> = <code>()</code> | <code>(<var>subdir</var> . <var>subdirs</var>)</code>
   <BR><var>subdir</var> = <code>:wild-inferiors</code>
    (means <code>&quot;**&quot;</code> or <code>&quot;...&quot;</code>,
    all subdirectories) or
   <BR><var>subdir</var> = <code>:parent</code>
    (means <code>&quot;/&quot;</code> instead of
    <code>&quot;subdir/&quot;</code>) or
   <BR><var>subdir</var> = simple string, may contain wildcard
    characters <code>?</code> and <code>*</code>
  <DT><code>name</code>
   <DD><code>nil</code> or simple string, may contain wildcard
   characters <code>?</code> and <code>*</code> (may also be specified
   as <code>:wild</code>)
  <DT><code>type</code>
   <DD><code>nil</code> or simple string, may contain wildcard
   characters <code>?</code> and <code>*</code> (may also be specified
   as <code>:wild</code>)
  <DT><code>version</code>
   <DD>always <code>nil</code> (may also be specified as
   <code>:wild</code> or <code>:newest</code>)
</DL>

<P>Constraint: <var>startpoint</var> = <code>:relative</code> only if
<var>device</var> = <code>nil</code>. If the device is specified, the
pathname must be absolute!

<P>A filename from AMIGAOS is split into name and type according to the
following rule:
<UL>
 <LI>if there is no <code>'.'</code> in the filename, then the
  <var>name</var> is everything, <var>type</var> = <code>nil</code>;
 <LI>if there is a <code>'.'</code>, then <var>name</var> is the part
  before and <var>type</var> the part after the last dot.
</UL>

<p>Case is ignored in the strings on comparison. No case conversions
are performed.

<P>When a pathname is to be fully specified (no wildcards), that means
that no <code>:wild</code>, <code>:wild-inferiors</code> is allowed, no
wildcard characters are allowed in the strings, and <var>name</var> =
<code>nil</code> may not be allowed either.
<P>
<A NAME="pathnames-externally-amiga"></A>
<TABLE>
  <TR> <TD>External notation:
    <TD ALIGN=RIGHT><code>dev:sub1.typ/sub2.typ/name.typ</code>
  <TR> <TD>using defaults:
    <TD ALIGN=RIGHT><code>    sub1.typ/sub2.typ/name.typ</code>
  <TR> <TD>or
    <TD ALIGN=RIGHT><code>                      name.typ</code>
  <TR> <TD>or
    <TD ALIGN=RIGHT><code>    sub1.typ/**/sub3.typ/x*.lsp</code>
  <TR> <TD>or similar.
</TABLE>

<P> Formal specification of the external notation:
<DL>
  <DT>ch ::= <DD>any character except ':','/' and '*','?'
  <DT>name ::= <DD>{ch}+
  <DT>device ::= <DD>[ &lt;empty&gt; | ':' | name ':' ]
       <BR>; empty = current device, relative to current directory
       <BR>; ':'   = current device, absolute (relative to root for disks)
       <BR>; name ':' = specified device, absolute (relative to root for disks)
  <DT>subdir ::= <DD>[ &lt;empty&gt; | name ]
       <BR>; empty means parent directory
  <DT>pathname ::= <DD>device { subdir '/' }* name
</DL>
<P>
Examples:
<TABLE BORDER=1>
<TR> <TH>String       <TH>Device    <TH>Directory                <TH>our pathname
<TR> <TD><code>'c:foo'</code>      <TD>'C'     <TD>device-&gt;<code>foo</code>               <TD><code>&quot;c&quot; (:absolute &quot;foo&quot;)</code>
<TR> <TD><code>'c:foo/'</code>     <TD>'C'     <TD>device-&gt;<code>foo</code>               <TD><code>&quot;c&quot; (:absolute &quot;foo&quot;)</code>
<TR> <TD><code>'c:foo/bar'</code>  <TD>'C'     <TD>device-&gt;<code>foo</code>-&gt;<code>bar</code>          <TD><code>&quot;c&quot; (:absolute &quot;foo&quot; &quot;bar&quot;)</code>
<TR> <TD><code>'c:/foo'</code>     <TD>'C'     <TD>device-&gt;up-&gt;<code>foo</code>           <TD><code>&quot;c&quot; (:absolute :parent &quot;foo&quot;)</code>
<TR> <TD><code>'c:'</code>         <TD>'C'     <TD>device                    <TD><code>&quot;c&quot; (:absolute)</code>
<TR> <TD><code>':foo'</code>       <TD>current <TD>device-&gt;root-&gt;<code>foo</code>         <TD><code>nil (:absolute &quot;foo&quot;)</code>
<TR> <TD><code>'foo'</code>        <TD>current <TD>device-&gt;<code>foo</code>               <TD><code>nil (:relative &quot;foo&quot;)</code>
<TR> <TD><code>'/foo'</code>       <TD>current <TD>device-&gt;up-&gt;<code>foo</code>           <TD><code>nil (:relative :parent &quot;foo&quot;)</code>
<TR> <TD><code>'//foo/bar'</code>  <TD>current <TD>device-&gt;up-&gt;up-&gt;<code>foo</code>-&gt;<code>bar</code>  <TD><code>nil (:relative :parent :parent &quot;foo&quot; &quot;bar&quot;)</code>
<TR> <TD><code>''</code>           <TD>current <TD>device                    <TD><code>nil (:relative)</code>
</TABLE>

<P>Appending a <code>'/'</code> to a path string that is non-empty and
does not end with <code>':'</code> or <code>'/'</code> does not change
its meaning. This <code>'/'</code> must be appended before another
non-empty component can be appended.  But appending a <code>'/'</code>
to a path string that is empty or ends with <code>':'</code> or
<code>'/'</code> means going up to the parent directory!

<BR>We interpret any path string that is empty or ends with
<code>':'</code> or <code>'/'</code> as pathname of a directory (with
<var>name</var> = <code>nil</code> and <var>type</var> =
<code>nil</code>).

</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_UNIX -->
<DL>
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
Pathname components:
<DL>
<DT><code>host</code>          <DD>always <code>nil</code>
<DT><code>device</code>        <DD>always <code>nil</code>
<DT><code>directory</code>     <DD><code>(<var>startpoint</var> . <var>subdirs</var>)</code> where
               <BR><var>startpoint</var> = <code>:relative</code> | <code>:absolute</code>
               <BR><var>subdirs</var> = <code>()</code> | <code>(<var>subdir</var> . <var>subdirs</var>)</code>
               <BR><var>subdir</var> = <code>:wild-inferiors</code> (means <code>&quot;**&quot;</code> or <code>&quot;...&quot;</code>, all subdirectories) or
               <BR><var>subdir</var> = simple string, may contain wildcard characters <code>?</code> and <code>*</code>
<DT><code>name</code>          <DD><code>nil</code> or
              simple string, may contain wildcard characters <code>?</code> and <code>*</code>
              (may also be specified as <code>:wild</code>)
<DT><code>type</code>          <DD><code>nil</code> or
              simple string, may contain wildcard characters <code>?</code> and <code>*</code>
              (may also be specified as <code>:wild</code>)
<DT><code>version</code>       <DD>always <code>nil</code> (may also be specified as <code>:wild</code> or <code>:newest</code>)
</DL>

<P>A UNIX filename is split into name and type according to the following rule:
<UL>
<LI>if there is no <code>'.'</code> in the filename, then the <var>name</var> is everything, <var>type</var> = <code>nil</code>;
<LI>if there is a <code>'.'</code>, then <var>name</var> is the part before and <var>type</var> the part after
     the last dot.
</UL>

<P>When a pathname is to be fully specified (no wildcards), that means
that no <code>:wild</code>, <code>:wild-inferiors</code> is allowed, no
wildcard characters are allowed in the strings, and <var>name</var> =
<code>nil</code> may not be allowed either.
<P>
<TABLE>
  <TR> <TD>External notation:
   <TD ALIGN=RIGHT><code>server:sub1.typ/sub2.typ/name.typ</code>
  <TR> <TD>using defaults:
   <TD ALIGN=RIGHT><code>       sub1.typ/sub2.typ/name.typ</code>
  <TR> <TD>or
   <TD ALIGN=RIGHT><code>                         name.typ</code>
  <TR> <TD>or
   <TD ALIGN=RIGHT><code>       sub1.typ/**/sub3.typ/x*.lsp</code>
  <TR> <TD>or similar.
</TABLE>
</DD>
</DL>
<!-- #endif -->
<!-- #if defined(PATHNAME_OS2) || defined(PATHNAME_WIN32) -->
<DL>
<DT><EM>Platform dependent: OS/2, Win32 platforms only.</EM></DT>
<DD>
Pathname components:
<DL>
<DT><code>host</code>          <DD>always <code>nil</code>
<DT><code>device</code>        <DD><code>nil</code> or <code>:wild</code> or <code>&quot;A&quot;</code>|...|<code>&quot;Z&quot;</code>
<DT><code>directory</code>     <DD><code>(<var>startpoint</var> . <var>subdirs</var>)</code> where
               <BR><var>startpoint</var> = <code>:relative</code> | <code>:absolute</code>
               <BR><var>subdirs</var> = <code>()</code> | <code>(<var>subdir</var> . <var>subdirs</var>)</code>
               <BR><var>subdir</var> = <code>:wild-inferiors</code> (means <code>&quot;**&quot;</code> or <code>&quot;...&quot;</code>, all subdirectories) or
               <BR><var>subdir</var> = simple string, may contain wildcard characters <code>?</code> and <code>*</code>
<DT><code>name</code>          <DD><code>nil</code> or
              simple string, may contain wildcard characters <code>?</code> and <code>*</code>
              (may also be specified as <code>:wild</code>)
<DT><code>type</code>          <DD><code>nil</code> or
              simple string, may contain wildcard characters <code>?</code> and <code>*</code>
              (may also be specified as <code>:wild</code>)
<DT><code>version</code>       <DD>always <code>nil</code> (may also be specified as <code>:wild</code> or <code>:newest</code>)
</DL>

<P>An OS/2 filename is split into name and type according to the
following rule:
<UL>
 <LI>if there is no <code>'.'</code> in the filename, then the
  <var>name</var> is everything, <var>type</var> = <code>nil</code>;
 <LI>if there is a <code>'.'</code>, then <var>name</var> is the part
  before and <var>type</var> the part after the last dot.
</UL>

<P>When a pathname is to be fully specified (no wildcards), that means
that no <code>:wild</code>, <code>:wild-inferiors</code> is allowed, no
wildcard characters are allowed in the strings, and <var>name</var> =
<code>nil</code> may not be allowed either.
<P>
<TABLE>
  <TR> <TD>External notation:       <TD ALIGN=RIGHT><code>A:\sub1.typ\sub2.typ\name.typ</code>
  <TR> <TD>using defaults:          <TD ALIGN=RIGHT><code>  \sub1.typ\sub2.typ\name.typ</code>
  <TR> <TD>or                       <TD ALIGN=RIGHT><code>                     name.typ</code>
  <TR> <TD>or                       <TD ALIGN=LEFT><code>*:\sub1.typ\**\sub3.typ\x*.lsp</code>
  <TR> <TD>or similar.
</TABLE>
<P>
Instead of '\' one may use '/', as usual for DOS calls.
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_NOEXT -->
<DL>
<DT><EM>Platform dependent: UNIX, OS/2, Win32, Amiga platforms only.</EM></DT>
<DD>
The wildcard characters: <code>'*'</code> matches any sequence of
characters, <code>'?'</code> matches any one character.
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_NOEXT -->
<DL>
<DT><EM>Platform dependent: UNIX, OS/2, Win32, Amiga platforms only.</EM></DT>
<DD>
Due to the name/type splitting rule, there are pathnames that can't
result from <code>parse-namestring</code>. To get a pathname whose type
contains a dot or whose name contains a dot and whose type is
<code>nil</code>, <code>make-pathname</code> must be used.  Example:
<code>(make-pathname :name &quot;.profile&quot;)</code>.
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_RISCOS -->
<DL>
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>

<H4>The Acorn file system and CLISP's interface to it</H4>

<p>RISC OS provides several file systems as standard (ADFS, IDEFS,
NetFS, RamFS, NetPrint) and support for extra file systems (DOSFS,
ResourceFS and DeviceFS).

<p>A module called FileSwitch is at the centre of all file system
operation in RISC OS. FileSwitch provides a common core of functions
used by all file systems. It only provides the parts of these services
that are device independent. The device dependant services that control
the hardware are provided by separate modules, which are the actual
file systems.  FileSwitch keeps track of active file systems and
switches betwen them as necessary.

<p>One of the file system modules that RISC OS provides is
FileCore. It takes the normal calls that FileSwitch sends to a file
system module, and converts them to a simpler set of calls to modules
that control the hardware. Unlike FileSwitch it creates a fresh
instantiation of itself for each module that it supports. Using FileCore
to build file system modules imposes a more rigid structure on it, as
more of the file system is predefined.

<p>As well as standard file systems, FileSwitch supports image file
systems. These provide facilities for RISC OS to handle media in foreign
formats, and to support `image files' (or partitions) in those formats.
Rather than accessing the hardware directly they rely on standard RISC
OS file systems to do so. DOSFS is an example of an image file
system used to handle DOS format discs.

<H5>Terminology</H5>

<p>A pathname may include a file system name, a special field, a media
name (e.g., a disc name), directory name(s), and the name of the object
itself; each of these parts of a pathname is known as an `element' of
the pathname.

<H5>Filenames</H5>

<p>Filename `elements' may be up to ten characters in length on
FileCore-based file systems and on NetFS. These characters may be
digits or letters.  FileSwitch makes no distinction between upper and
lower case, although file systems can do so. As a general rule, you
should not use top-bit-set characters in filenames, although some file
systems (such as FileCore-based ones) support them. Other characters may
be used provided they do not have a special significance. Those that do
are listed below :
<DL>
  <DT> .   <DD>Separates directory specifications, e.g., $.fred
  <DT> :   <DD>Introduces a drive or disc specification, e.g., :0, :bigdisc. It also
       marks the end of a file system name, e.g., adfs:
  <DT> *   <DD>Acts as a `wildcard' to match zero or more characters.
  <DT> #   <DD>Acts as a `wildcard' to match any single character.
  <DT> $   <DD>is the name of the root directory of the disc.
  <DT> &amp;   <DD>is the user root directory (URD)
  <DT> @   <DD>is the currently selected directory (CSD)
  <DT> ^   <DD>is the `parent' directory
  <DT> %   <DD>is the currently selected library (CSL)
  <DT> \   <DD>is the previously selected directory (PSD)
</DL>

<H5>Directories</H5>

<p>The root directory, $, forms the top of the directory hierarchy of
the media which contains the CSD. $ does not have a parent directory,
trying to access its parent will just access $. Each directory name is
separated by a '.' character. For example:
<TABLE>
  <TR> <TD> $.Documents.Memos
  <TR> <TD> %.cc
</TABLE>

<H5>File Systems</H5>

<p>Files may also be accessed on file systems other than the current
one by prefixing the filename with a file system specification. A
file system name may appear between '-' characters, or suffixed by a
':', though the latter is advised since '-' can also be used to
introduce a parameter on a command line, or as part of a file name. For
example:
<TABLE>
  <TR> <TD> -net-$.SystemMesg
  <TR> <TD> adfs:%.aasm
</TABLE>
<P>
<H5>Special Fields</H5>

Special fields are used to supply more information to the file system than
you can using standard path names; for example NetFS and NetPrint use them
to specify server addresses or names. They are introduced by a '#'
character; a variety of syntaxes are possible:
<TABLE>
  <TR> <TD ALIGN=RIGHT>  net#MJHardy::disc1.mike
  <TR> <TD ALIGN=RIGHT>     #MJHardy::disc1.mike
  <TR> <TD ALIGN=RIGHT> -net#MJHardy-:disc1.mike
  <TR> <TD ALIGN=RIGHT>    -#MJHardy-:disc1.mike
</TABLE>
The special fields here are all MJHardy, and give the name of the fileserver
to use. Special fields may use any character except for control characters,
double quote '&quot;', solidus '|' and space. If a special field contains a hypen
you may only use the first two syntaxes given above.
<P>
<H5>File$Path and Run$Path</H5>

These two special variables control exactly where a file will be looked for,
according to the operation being performed on it.
<TABLE>
   <TR> <TD>File$Path   <TD>for read operations
   <TR> <TD>Run$Path    <TD>for execute operations
</TABLE>
The contents of each variable should expand to a list or prefixes, separated
by commas. When a read operation is performed then the prefixes in File$Path
are used in the order in which they are listed. The first object that
matches is used, whether it be a file or directory. Similarly any execute
operation uses the prefixes in Run$Path. These search paths are only used
when the pathname does not contain an explicit file system reference,
e.g., executing adfs:file will not use Run$Path.

<H5>Other path variables</H5>

<p>You can set up other path variables and use them as pseudo file
systems.  For example if you typed:
<TABLE>
  <TR> <TD> *Set Source$Path adfs:$.src.,adfs:$.public.src.
</TABLE>
you could then refer to the pseudo file system as Source: or (less
preferable) as -Source-. These path variables work in the same was as
File$Path and Run$Path.

<p>NOTE: Path variables are not implemented in this version of CLISP. A
workaround for this is to use &quot;&lt;Foo$Path&gt;&quot; instead of
&quot;Foo:&quot; until they are made available.

<P><A NAME="pathnames-externally-acorn"></A>
<H5>from Lisp-string notation to internal representation</H5>
<EM>No</EM> swapping. &quot;foo.lsp&quot; means file type
&quot;lsp&quot; and file name &quot;foo&quot;. This is pseudo-BNF:
<DL>
<DT>legal character ::= <DD>any ISO latin-1 graphic character &gt;= ' ' except
                    '.' ':' '*' '#' '$' '&amp;' '@' '^' '%' '\' '?'

<DT>extended legal character ::= <DD>any ISO latin-1 graphic character &gt;= ' ' except
                             ':' '&quot;' '|'

<DT>legal-wild char ::= <DD>legal char | '*' | '#' | '?'

<DT>host ::=  <DD> '-' { extended legal char except '-' }+ '-'
         | { extended legal char except '-' } { extended legal char }* ':'
         | empty

<DT>device ::=  <DD> ':' { legal char }+ '.'
           | empty

<DT>directory ::=  <DD> { '$' | '&amp;' | '@' | '%' | '\' } '.' { subdirectory }*
              | { subdirectory }+
              | empty
<TABLE>
  <TR> <TD> '$' -&gt; <TD><code>:absolute :root</code>
  <TR> <TD> '&amp;' -&gt; <TD><code>:absolute :home</code>
  <TR> <TD> '@' -&gt; <TD><code>:absolute :current</code>
  <TR> <TD> '%' -&gt; <TD><code>:absolute :library</code>
  <TR> <TD> '\' -&gt; <TD><code>:absolute :previous</code>
  <TR> <TD> else <TD><code>:relative</code>
</TABLE>

<DT>subdirectory ::= <DD>{ '^' | { legal-wild char }+ } '.'
<TABLE>
  <TR> <TD> '^' -&gt; <TD><code>:parent</code>
</TABLE>

<DT>filename ::= <DD>{ { legal-wild char }+ | empty }

<DT>filetype ::= <DD>{ '.' { legal-wild char }+ | empty }

<DT>pathname ::= <DD>host device directory filename filetype
</DL>
Examples:
<TABLE BORDER=1>
  <TR> <TH>String                          <TH>Hostname <TH>Device  <TH>Directory            <TH>Name         <TH>Type
  <TR> <TD><code>-net-$.SystemMesg</code>                <TD><code>&quot;net&quot;</code>   <TD><code>nil</code>     <TD><code>(:absolute :root)</code>    <TD><code>&quot;SystemMesg&quot;</code> <TD><code>nil</code>
  <TR> <TD><code>net#MJHardy::disc1.mike</code>    <TD><code>&quot;net#MJHardy&quot;</code> <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :root)</code>    <TD><code>&quot;mike&quot;</code>       <TD><code>nil</code>
  <TR> <TD><code>#MJHardy::disc1.mike</code>          <TD><code>&quot;#MJHardy&quot;</code> <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :root)</code>    <TD><code>&quot;mike&quot;</code>       <TD><code>nil</code>
  <TR> <TD><code>-net#MJHardy-:disc1.mike</code>   <TD><code>&quot;net#MJHardy&quot;</code> <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :root)</code>    <TD><code>&quot;mike&quot;</code>       <TD><code>nil</code>
  <TR> <TD><code>-#MJHardy-:disc1.mike</code>         <TD><code>&quot;#MJHardy&quot;</code> <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :root)</code>    <TD><code>&quot;mike&quot;</code>       <TD><code>nil</code>
  <TR> <TD><code>@.foo</code>                            <TD><code>nil</code>     <TD><code>nil</code>     <TD><code>(:absolute :current)</code> <TD><code>&quot;foo&quot;</code>        <TD><code>nil</code>
  <TR> <TD><code>foo</code>                              <TD><code>nil</code>     <TD><code>nil</code>     <TD><code>(:relative)</code>          <TD><code>&quot;foo&quot;</code>        <TD><code>nil</code>
  <TR> <TD><code>^.</code>                               <TD><code>nil</code>     <TD><code>nil</code>     <TD><code>(:relative :parent)</code>  <TD><code>nil</code>          <TD><code>nil</code>
  <TR> <TD><code>@.^.</code>                             <TD><code>nil</code>     <TD><code>nil</code>     <TD><code>(:absolute :current :parent)</code> <TD><code>nil</code>  <TD><code>nil</code>
  <TR> <TD><code>foo.bar</code>                          <TD><code>nil</code>     <TD><code>nil</code>     <TD><code>(:relative)</code>          <TD><code>&quot;foo&quot;</code>        <TD><code>&quot;bar&quot;</code>
  <TR> <TD><code>foo.bar.baz</code>                      <TD><code>nil</code>     <TD><code>nil</code>     <TD><code>(:relative &quot;foo&quot;)</code>    <TD><code>&quot;bar&quot;</code>        <TD><code>&quot;baz&quot;</code>
  <TR> <TD><code>foo.bar.</code>                         <TD><code>nil</code>     <TD><code>nil</code>     <TD><code>(:relative &quot;foo&quot; &quot;bar&quot;)</code> <TD><code>nil</code>       <TD><code>nil</code>
  <TR> <TD><code>foo.@.</code>                       <TD COLSPAN=5 ALIGN=CENTER>illegal
</TABLE>
<P>

<H5>from internal representation to RISCOS string</H5>

with swapping <EM>only</EM> of name/type components.
<P>
<TABLE BORDER=1>
  <TR> <TH>Hostname    <TH>Device  <TH>Directory                   <TH>Name    <TH>Type      <TH>RISCOS String
  <TR> <TD><code>&quot;net&quot;</code>       <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :root)</code>           <TD><code>&quot;foo&quot;</code>   <TD><code>nil</code>       <TD><code>&quot;net::disc1.$.foo&quot;</code>
  <TR> <TD><code>&quot;net#MJ&quot;</code>    <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :root &quot;foo&quot;)</code>     <TD><code>&quot;bar&quot;</code>   <TD><code>&quot;baz&quot;</code>     <TD><code>&quot;net#MJ::disc1.$.foo.baz.bar&quot;</code>
  <TR> <TD><code>&quot;adfs&quot;</code>      <TD><code>&quot;4&quot;</code>     <TD><code>(:absolute :root &quot;foo&quot; &quot;bar&quot;)</code> <TD><code>nil</code>   <TD><code>nil</code>       <TD><code>&quot;adfs::4.$.foo.bar&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :root &quot;foo&quot;)</code>     <TD><code>&quot;bar&quot;</code>   <TD><code>nil</code>       <TD><code>&quot;:disc1.$.foo.bar&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>&quot;disc1&quot;</code> <TD><code>(:absolute :current)</code>        <TD><code>nil</code>     <TD><code>nil</code>       <TD>illegal here
  <TR> <TD><code>nil</code>         <TD><code>&quot;disc1&quot;</code> <TD><code>(:relative)</code>                 <TD><code>nil</code>     <TD><code>nil</code>       <TD><code>&quot;:disc1.&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>&quot;disc1&quot;</code> <TD><code>nil</code>                         <TD><code>nil</code>     <TD><code>nil</code>       <TD><code>&quot;:disc1.&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:absolute :root)</code>           <TD><code>&quot;foo&quot;</code>   <TD><code>nil</code>       <TD><code>&quot;$.foo&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:absolute :current)</code>        <TD><code>&quot;foo&quot;</code>   <TD><code>nil</code>       <TD><code>&quot;@.foo&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:relative)</code>                 <TD><code>&quot;foo&quot;</code>   <TD><code>&quot;bar&quot;</code>     <TD><code>&quot;bar.foo&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:relative &quot;foo&quot;)</code>           <TD><code>&quot;bar&quot;</code>   <TD><code>&quot;baz&quot;</code>     <TD><code>&quot;foo.baz.bar&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:absolute :library)</code>        <TD><code>&quot;bar&quot;</code>   <TD><code>nil</code>       <TD><code>&quot;%.bar&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:absolute :library &quot;foo&quot;)</code>  <TD><code>&quot;bar&quot;</code>   <TD><code>nil</code>       <TD><code>&quot;%.foo.bar&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:relative)</code>                 <TD><code>&quot;foo&quot;</code>   <TD><code>&quot;bar&quot;</code>     <TD><code>&quot;bar.foo&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:relative &quot;foo&quot;)</code>           <TD><code>&quot;bar&quot;</code>   <TD><code>nil</code>       <TD><code>&quot;foo.bar&quot;</code>
  <TR> <TD><code>nil</code>         <TD><code>nil</code>     <TD><code>(:relative &quot;foo&quot;)</code>           <TD><code>nil</code>     <TD><code>&quot;bar&quot;</code>     <TD>illegal here
</TABLE>
<P>
That is, the RISCOS string is the flattenation-concatenation of
<PRE><code>
  (append
    (if (null hostname) &quot;&quot; (append hostname &quot;:&quot;))
    (if (null device) &quot;&quot; (append &quot;:&quot; device &quot;.&quot;))
    (case (pop directory)
      (:absolute (case (pop directory)
                         (:root &quot;$.&quot;)
                         (:home &quot;&amp;.&quot;)
                         (:current &quot;@.&quot;)
                         (:library &quot;%.&quot;)
                         (:previous &quot;\\.&quot;)
      )          )
      (:relative &quot;&quot;)
    )
    (mapcar (lambda (subdir) (append subdir &quot;.&quot;)) directory)
    (if (null name)
      (if (null type) &quot;&quot; (error &quot;type with name illegal here&quot;))
      (if (null type)
        name
        (append type &quot;.&quot; name)
  ) ) )
</code></PRE>
<P>
<H5>internal representation</H5>

Pathname components:
<DL>
<DT><code>host</code>          <DD>Simple-String or <code>nil</code>
<DT><code>device</code>        <DD>Simple-String or <code>nil</code>
<DT><code>directory</code>     <DD><code>(<var>Startpoint</var> . <var>Subdirs</var>)</code> where
               <BR><var>Startpoint</var> = <code>:relative</code> | <code>:absolute</code> <var>anchor</var>
               <BR><var>anchor</var> = <code>:root</code> | <code>:home</code> | <code>:current</code> | <code>:library</code> | <code>:previous</code>
               <BR><var>Subdirs</var> = <code>()</code> | <code>(<var>subdir</var> . <var>Subdirs</var>)</code>
               <BR><var>subdir</var> = <code>:parent</code> or
               <BR><var>subdir</var> = simple string, may contain wildcard characters <code>?</code>,<code>#</code> and <code>*</code>
<DT><code>name</code>          <DD><code>nil</code> or
              simple string, may contain wildcard characters <code>?</code>,<code>#</code> and <code>*</code>
              (may also be specified as <code>:wild</code>)
<DT><code>type</code>          <DD><code>nil</code> or
              simple string, may contain wildcard characters <code>?</code>,<code>#</code> and <code>*</code>
              (may also be specified as <code>:wild</code>)
<DT><code>version</code>       <DD>always <code>nil</code> (may also be specified as <code>:wild</code> or <code>:newest</code>)
</DL>

<P>Constraint: startpoint /= <code>:absolute :root</code> only if device
= <code>nil</code>. If the device is specified, the pathname must be
<code>:absolute :root</code>.

<P>The wildcard characters: <code>'*'</code> matches any sequence of
characters, <code>'#'</code> or <code>'?'</code> matches any one
character.

<P>Due to the name/type swapping rule, there are pathnames that can't
result from <code>parse-namestring</code>. To get a pathname whose type
is <code>nil</code>, <code>make-pathname</code> must be used.  Example:
<code>(make-pathname :directory &quot;!Clisp.&quot; :name
&quot;README&quot;)</code>.
</DD>
</DL>
<!-- #endif -->

<h3>External notation.</H3>

<p>External notation of pathnames (cf. <code>parse-namestring</code> and
<code>namestring</code>), of course without spaces, [,],{,}:
<DL>
<!-- #ifdef PATHNAME_MSDOS -->
<DT><EM>Platform dependent: DOS platforms only.</EM></DT>
<DD>
<TABLE>
 <TR><TD>[ [drivespec] : ]     <TD>a letter <code>'*'</code>|<code>'A'</code>|...|<code>'Z'</code>|<code>'a'</code>|...|<code>'z'</code>
 <TR><TD>{ name [. type] \ }   <TD>each one a subdirectory, <code>'\'</code> may be replaced by <code>'/'</code>
 <TR><TD>[ name [. type] ]     <TD>filename with type (extension)
</TABLE>

<P>Name and type may be character sequences of any length (consisting of
alphanumeric characters and <code>'-'</code>, <code>'_'</code>). They
are shortened to 8 resp. 3 characters and converted to upper case. A
single <code>'*'</code> is allowed for <code>:wild</code>.

<!-- #endif -->
<!-- #ifdef PATHNAME_AMIGAOS -->
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD>
see <A HREF="#pathnames-externally-amiga">above</A>.
<!-- #endif -->
<!-- #ifdef PATHNAME_UNIX -->
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
<TABLE>
 <TR><TD>[ / ]                 <TD>/ denotes absolute pathnames
 <TR><TD>{ name / }            <TD>each one a subdirectory
 <TR><TD>[ name [. type] ]     <TD>filename with type (extension)
</TABLE>

<P>Name and type may be character sequences of any length (consisting of
printing ASCII characters, except <code>'/'</code>).

<!-- #endif -->
<!-- #if defined(PATHNAME_OS2) || defined(PATHNAME_WIN32) -->
<DT><EM>Platform dependent: OS/2, Win32 platforms only.</EM></DT>
<DD>
<TABLE>
 <TR><TD>[ [drivespec] : ]     <TD>a letter '*'|'A'|...|'Z'|'a'|...|'z'
 <TR><TD>{ name [. type] \ }   <TD>each one a subdirectory, '\' may be replaced by '/'
 <TR><TD>[ name [. type] ]     <TD>filename with type (extension)
</TABLE>

<P>Name and type may be character sequences of any length (consisting of
printing ASCII characters, except <code>'/'</code>, <code>'\'</code>,
<code>':'</code>).

<!-- #endif -->
<!-- #ifdef PATHNAME_RISCOS -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
see <A HREF="#pathnames-externally-acorn">above</A>.
<!-- #endif -->
</DL>

<P><code>namestring</code> has an optional flag argument:
<code>(namestring <var>pathname</var> t)</code> returns an external
notation suitable for passing to the operating system or other programs.
<!-- #if !defined(USER_HOMEDIR) -->
<P>
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Acorn platforms only.</EM></DT>
<DD>
The function <code>user-homedir-pathname</code> is not implemented.
<!-- #if defined(MSDOS) -->
<DT><EM>Platform dependent: DOS, OS/2 platforms only.</EM></DT>
<DD>
If you really need that function, you might define it like this:
<PRE><code>  (defun user-homedir-pathname (&amp;optional host)
    (declare (ignore host))
    (or (system::getenv &quot;HOME&quot;) &quot;\\&quot;)
  )
</code></PRE>
<!-- #endif -->
</DL>
<!-- #endif -->

<a href="CLHSROOT/Body/sec_19-3.html">
<h3>19.3 Logical Pathnames.</H3></a>

<!-- #ifndef LOGICAL_PATHNAMES -->
<!-- The function COMPILE-FILE-PATHNAME is implemented. -->
<!-- #endif -->
<!-- #ifdef LOGICAL_PATHNAMES -->

<p>The functions <code>logical-pathname</code>,
<code>translate-logical-pathname</code>,
<code>logical-pathname-translations</code>, <code>(setf
logical-pathname-translations)</code>,
<code>load-logical-pathname-translations</code>,
<code>compile-file-pathname</code> are implemented.

<P>When the argument of the function
<code>translate-logical-pathname</code> is a string, it is interpreted
as a logical pathname string.


<a href="CLHSROOT/Body/sec_the_filen_s_dictionary.html">
<h3>19.4 The Filenames Dictionary.</H3></a>

<p>The ANSI CL functions <code>wild-pathname-p</code>,
<code>pathname-match-p</code> and <code>translate-pathname</code> are
implemented.

<a href="CLHSROOT/Body/fun_pathname-match-p.html">
<h4>pathname-match-p</h4></a>

<p><code>pathname-match-p</code> does not interpret missing components
as wild.

<a href="CLHSROOT/Body/fun_translate-pathname.html">
<h4>translate-pathname</h4></a>

<P><code>translate-pathname</code> has two additional keywords:
<BR>  <code>(translate-pathname <var>source</var>
      <var>from-wildname</var> <var>to-wildname</var> &amp;key :all
      :merge)</code>

<BR>If <code>:all</code> is specified and non-<code>nil</code>, a list
of all resulting pathnames, corresponding to all matches of
<code>(pathname-match-p <var>source</var>
<var>from-wildname</var>)</code>, is returned. If <code>:merge</code> is
specified and <code>nil</code>, unspecified pieces of
<var>to-pathname</var> are not replaced by corresponding pieces of
<var>source</var>.

<a href="CLHSROOT/Body/fun_parse-namestring.html">
<h4>parse-namestring</h4></a>

<p><code>(parse-namestring <var>string</var> [<var>host</var>
[<var>defaults</var>]])</code> returns a logical pathname only if host
is a logical host or host is <code>nil</code> and defaults is a logical
pathname.  To construct a logical pathname from a string, the function
<code>logical-pathname</code> can be used.

<a href="CLHSROOT/Body/fun_merge-pathnames.html">
<h4>merge-pathnames</h4></a>

<P><code>(merge-pathnames <var>string</var> [<var>defaults</var>])</code>
returns a logical pathname only if defaults is a logical pathname. To
construct a logical pathname from a string, the function
<code>logical-pathname</code> can be used.

<!-- #endif -->


<a name="files"></a><a href="CLHSROOT/Body/chap-20.html">
<h2>Chapter 20: Files</h2></a>

<a href="CLHSROOT/Body/sec_the_files_dictionary.html">
<h3>20.2 The Files Dictionary.</h3></a>

<a href="CLHSROOT/Body/fun_rename-file.html">
<h4>rename-file</h4></a>

<P><code>rename-file</code> always returns a non-logical pathname as its
first value.

<a href="CLHSROOT/Body/fun_probe-file.html">
<h4>probe-file</h4></a>

<p><code>probe-file</code> can not be used to check whether a directory
exists. Use the function <code>probe-directory</code> or the function
<code>directory</code> for this purpose.

<a href="CLHSROOT/Body/fun_file-author.html">
<h4>file-author</h4></a>

<P><code>file-author</code> always returns <code>nil</code>.

<h4>probe-directory</h4>

<p><code>(<STRONG>lisp:probe-directory</STRONG> <var>pathname</var>)</code>
tests whether <var>pathname</var> exists and is a directory. It will,
unlike <code>probe-file</code> or <code>truename</code>, not signal an
error if the parent directory of <var>pathname</var> doesn't exist.

<a href="CLHSROOT/Body/fun_ensure-di_tories-exist.html">
<h4>ensure-directories-exist</h4></a>

<P>The ANSI CL function <code>ensure-directories-exist</code> is
implemented.

<a href="CLHSROOT/Body/fun_directory.html">
<h4>directory</h4></a>

<P><code>(directory [<var>pathname</var> [:full] [:circle]])</code> can
run in two modes:
<UL>
 <LI>If <var>pathname</var> contains no name or type component, a list
  of all matching directories is produced.
 <LI>Otherwise a list of all matching files is returned. If the
  <code>:full</code> argument is not <code>eq</code> to
  <code>nil</code>, this contains additional information: for each
  matching file you get a list of at least four elements
  <code>(<var>file-pathname</var> <var>file-truename</var>
  <var>file-write-date-as-decoded-time</var>
  <var>file-length</var>)</code>.
</UL>
<!-- #ifdef UNIX -->
<DL>
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
If the <code>:circle</code> argument is not <code>eq</code> to
<code>nil</code>, the function avoids endless loops that may result from
symbolic links.
</DD>
</DL>
<!-- #endif -->

<P><code>(<STRONG>dir</STRONG> [<var>pathname</var>])</code> is like
<code>directory</code>, but displays the pathnames instead of returning
them. <code>(dir)</code> shows the contents of the current directory.

<P>
<DL>
<!-- #if defined(PATHNAME_UNIX) || defined(PATHNAME_AMIGAOS) -->
<DT><EM>Platform dependent: UNIX, Amiga platforms only.</EM></DT>
 <DD><code>(<STRONG>cd</STRONG> [<var>pathname</var>])</code> manages the
  current directory.
<!-- #elif defined(PATHNAME_RISCOS) -->
 <DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
  <DD><code>(<STRONG>cd</STRONG> [<var>pathname</var>])</code> manages
   the current host, current device and the current directory.
<!-- #else -->
 <DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
  <DD><code>(<STRONG>cd</STRONG> [<var>pathname</var>])</code> manages
   the current device and the current directory.
<!-- #endif -->
</DL>

<p><code>(cd <var>pathname</var>)</code> sets it, <code>(cd)</code>
returns it.

<P><code>(<STRONG>lisp:default-directory</STRONG>)</code> is equivalent
to <code>(cd)</code>.  <code>(setf (default-directory)
<var>pathname</var>)</code> is equivalent to <code>(cd
<var>pathname</var>)</code>, except for the return value.

<p><code>(<STRONG>lisp:make-dir</STRONG>
<var>directory-pathname</var>)</code> creates a new subdirectory.

<p><code>(<STRONG>lisp:delete-dir</STRONG>
<var>directory-pathname</var>)</code> removes an (empty) subdirectory.

<DL>
<!-- #if defined(UNIX) || defined(MSDOS) || defined(RISCOS) -->
 <DT><EM>Platform dependent: UNIX, DOS, OS/2, Acorn platforms only.</EM></DT>
  <DD><code>(<STRONG>execute</STRONG> <var>programfile</var>
   <var>arg<SUB>1</SUB></var> <var>arg<SUB>2</SUB></var> ...)</code>
   executes an external program. Its name is <var>programfile</var>. It is
   given the strings <var>arg<SUB>1</SUB></var>,
   <var>arg<SUB>2</SUB></var>, ... as arguments.
<!-- #endif -->
<!-- #ifdef AMIGAOS -->
 <DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
  <DD><code>(<STRONG>execute</STRONG> <var>command</var>)</code>
   executes a given <var>command</var> using the operating system's
   shell.
<!-- #endif -->
</DL>

<a name="streams"></a><a href="CLHSROOT/Body/chap-21.html">
<h2>Chapter 21: Streams</h2></a>

<p>The ANSI CL types <code>broadcast-stream</code>,
<code>concatenated-stream</code>, <code>echo-stream</code>,
<code>synonym-stream</code>, <code>string-stream</code>,
<code>file-stream</code>, <code>two-way-stream</code> are implemented.

<H3>terminal interaction.</H3>

<!-- #ifdef GNU_READLINE -->
<DL>
 <DT><EM>Platform dependent: UNIX, DOS, OS/2 platforms only, and only in
  clisp binaries built without compile-time flag
  <code>NO_READLINE</code>.</EM></DT>
 <DD>Input through <code>*terminal-io*</code> uses the GNU readline
  library. Arrow keys can be used to move within the input history. The
  Tab key completes the symbol's name that is being typed.  See <A
  HREF="newreadline/doc/readline.dvi">readline.dvi</A> for a complete
  description of the key bindings.  The GNU readline library is not used
  if standard input and standard output do not both refer to the same
  terminal.
 </DD>
</DL>
<P>
<!-- #endif -->
<!-- #if defined(KEYBOARD) || defined(AMIGAOS) -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Amiga, Acorn
 platforms only.</EM></DT>
<DD><code>*terminal-io*</code> is not the only stream that communicates
 directly with the user: During execution of the body of a
 <code>(<STRONG>with-keyboard</STRONG> . <var>body</var>)</code> form,
 <STRONG><code>*keyboard-input*</code></STRONG> is the stream that reads
 the keystrokes from the keyboard. It returns every keystroke in detail,
 as character with the following bits:
<DL>
<!-- #if defined(MSDOS) || defined(WIN32) || defined(AMIGAOS) -->
 <DT><code>hyper</code></DT>
  <DD><EM>(Platform dependent: DOS, OS/2, Win32, Amiga platforms
 only.)</EM> if a non-standard key. These are:
<!-- #if defined(MSDOS) || defined(WIN32) -->
     Function keys, cursor keypads, numeric keypad <EM>(Platform
     dependent: DOS, OS/2, Win32 platforms only)</EM>.
<!-- #endif -->
<!-- #ifdef AMIGAOS -->
     Function keys, cursor keypad <EM>(Platform dependent: Amiga
     platforms only)</EM>.
<!-- #endif -->
  </DD>
<!-- #endif -->
  <DT><code>char-code</code>    <DD>the Ascii code for standard keys,
               for non-standard keys:
               <DL>
<!-- #ifdef MSDOS -->
               <DT><EM>Platform dependent: DOS, OS/2 platforms only.</EM></DT>
               <DD>
                 F1 -&gt; <code>#\F1</code>, ..., F10 -&gt; <code>#\F10</code>, F11 -&gt; <code>#\F11</code>, F12 -&gt; <code>#\F12</code>,
                 Insert -&gt; <code>#\Insert</code>, Delete -&gt; <code>#\Delete</code>,
                 Home -&gt; <code>#\Home</code>, End -&gt; <code>#\End</code>, PgUp -&gt; <code>#\PgUp</code>, PgDn -&gt; <code>#\PgDn</code>,
                 Arrow keys -&gt; <code>#\Up</code>, <code>#\Down</code>, <code>#\Left</code>, <code>#\Right</code>.
               </DD>
<!-- #endif -->
<!-- #if defined(UNIX) || defined(WIN32) -->
               <DT><EM>Platform dependent: UNIX, Win32 platforms only.</EM></DT>
               <DD>
                 F1 -&gt; <code>#\F1</code>, ..., F10 -&gt; <code>#\F10</code>, F11 -&gt; <code>#\F11</code>, F12 -&gt; <code>#\F12</code>,
                 Insert -&gt; <code>#\Insert</code>, Delete -&gt; <code>#\Delete</code>, Center -&gt; <code>#\Center</code>,
                 Home -&gt; <code>#\Home</code>, End -&gt; <code>#\End</code>, PgUp -&gt; <code>#\PgUp</code>, PgDn -&gt; <code>#\PgDn</code>,
                 Arrow keys -&gt; <code>#\Up</code>, <code>#\Down</code>, <code>#\Left</code>, <code>#\Right</code>.
               </DD>
<!-- #endif -->
<!-- #ifdef AMIGAOS -->
               <DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
               <DD>
                 F1 -&gt; <code>#\F1</code>, ..., F9 -&gt; <code>#\F9</code>, F10 -&gt; <code>#\F10</code>,
                 Help -&gt; <code>#\Help</code>,
                 Arrow keys -&gt; <code>#\Up</code>, <code>#\Down</code>, <code>#\Left</code>, <code>#\Right</code>.
               </DD>
<!-- #endif -->
               </DL>
  </DD>
<!-- #if defined(MSDOS) || defined(WIN32) || defined(AMIGAOS) -->
  <DT><code>super</code></DT>        <DD><EM>(Platform dependent: DOS, OS/2, Win32, Amiga platforms only.)</EM> if pressed together with Shift key(s) and if the keystroke
               would have been an other without Shift.
  </DD>
<!-- #endif -->
  <DT><code>control</code></DT>      <DD>if pressed together with the Control key.
  </DD>
<!-- #if defined(MSDOS) || defined(WIN32) -->
  <DT><code>meta</code></DT>         <DD><EM>(Platform dependent: DOS, OS/2, Win32 platforms only.)</EM> if pressed together with the Alternate key.
  </DD>
<!-- #endif -->
</DL>
This keyboard input is not echoed on the screen.
During execution of a <code>(with-keyboard . <var>body</var>)</code> form, no input from <code>*terminal-io*</code>
or any synonymous stream should be requested.
<!-- #ifdef TERMINAL_USES_KEYBOARD -->
<!--
The stream <code>*keyboard-input*</code> is used by <code>*terminal-io*</code>.
-->
<!-- #endif -->
</DD>
</DL>
<!-- #endif -->

<H3>printing and OS interface.</H3>

The macro <code><STRONG>with-output-to-printer</STRONG></code>:<BR>
       <code>(lisp:with-output-to-printer (<var>var</var> [:external-format])
         {<var>declaration</var>}* {<var>form</var>}*)</code>
binds the variable <var>var</var> to an output stream that sends its
output to the printer.Possible <code>:external-format</code> values are
encodings and the line terminator keywords <code>:unix</code>,
<code>:mac</code>, <code>:dos</code>.
<!-- #ifdef PIPES -->

<P>
<DL>
<DT><EM>Platform dependent: UNIX, OS/2, Win32 platforms only.</EM></DT>
<DD>
<code>(<STRONG>make-pipe-input-stream</STRONG> <var>command</var>
[:element-type] [:external-format] [:buffered])</code> returns an input
stream that will supply the output from the execution of the given
operating system command.

<br>Possible <code>:element-type</code> values are types equivalent to
<code>character</code> or <code>(unsigned-byte <var>n</var>)</code>,
<code>(signed-byte <var>n</var>)</code>, where <var>n</var> is a
multiple of 8.

<br>Possible <code>:external-format</code> values are encodings and the
line terminator keywords +<code>:unix</code>, <code>:mac</code>,
<code>:dos</code>.

<br>Possible <code>:buffered</code> values are <code>nil</code>,
<code>t</code>, or <code>:default</code>; <code>:default</code> is
equivalent to <code>nil</code>.

<br>See also <A HREF="#shell"><code>(shell <var>command</var>)</code></A>.

<P><code>(<STRONG>make-pipe-output-stream</STRONG> <var>command</var>
[:element-type] [:external-format] [:buffered])</code> returns an output
stream that will pass its output as input to the execution of the given
operating system command.

<br>Possible <code>:element-type</code> values are types equivalent to
<code>character</code> or <code>(unsigned-byte <var>n</var>)</code>,
<code>(signed-byte <var>n</var>)</code>, where <var>n</var> is a
multiple of 8.

<br>Possible <code>:external-format</code> values are encodings and the
line terminator keywords <code>:unix</code>, <code>:mac</code>,
<code>:dos</code>.

<br>Possible <code>:buffered</code> values are <code>nil</code>,
<code>t</code>, or <code>:default</code>; <code>:default</code> is
equivalent to <code>nil</code>.

<br>See also <A HREF="#shell"><code>(shell <var>command</var>)</code></A>.
<!-- #ifdef PIPES2 -->

<P><code>(<STRONG>make-pipe-io-stream</STRONG> <var>command</var>
[:element-type] [:external-format] [:buffered])</code> returns three
values. The first value is a bidirectional stream that will
simultaneously pass its output as input to the execution of the given
operating system command and supply the output from this command as
input. The second and third value will be the input stream and the
output stream that make up the I/O stream, respectively.  Note that they
must be closed individually.

<BR>Possible <code>:element-type</code> values are types equivalent to
<code>character</code> or <code>(unsigned-byte <var>n</var>)</code>,
<code>(signed-byte <var>n</var>)</code>, where <var>n</var> is a
multiple of 8.

<br>Possible <code>:external-format</code> values are encodings and the
line terminator keywords <code>:unix</code>, <code>:mac</code>,
<code>:dos</code>.

<BR>Possible <code>:buffered</code> values are <code>nil</code>,
<code>t</code>, or <code>:default</code>; <code>:default</code> is
equivalent to <code>nil</code>.

<BR>Warning: Improper use of this function can lead to deadlocks. You
use it at your own risk!

<BR>A deadlock occurs if the command and your program either both try to
read from each other at the same time or both try to write to each other
at the same time. To avoid deadlocks, it is recommended that you fix a
protocol between the command and your program and avoid any hidden
buffering: Use <code>read-char</code>, <code>read-char-no-hang</code>,
<code>listen</code> instead of <code>read-line</code> and
<code>read</code> on the input side, and complete every output operation
by a <code>finish-output</code>. The same cautions must apply to the
called command as well.

<br>See also <A HREF="#shell"><code>(shell <var>command</var>)</code></A>.
<!-- #endif -->
</DD>
</DL>
<!-- #endif -->

<!-- #ifdef GENERIC_STREAMS -->
<H4>Generic streams</H4>
Generic streams are user programmable streams. The programmer interface:
<DL>
  <DT><code>(<STRONG>lisp:make-generic-stream</STRONG>
  <var>controller</var>)</code></DT> <DD>returns a generic stream.</DD>

  <DT><code>(<STRONG>lisp:generic-stream-controller</STRONG>
     <var>stream</var>)</code></DT>
     <DD>returns a private object to which generic stream methods dispatch.
     The typical usage is to retrieve the object originally provided by the
     user in <code>make-generic-stream</code>.</DD>

  <DT><code>(<STRONG>lisp:generic-stream-p</STRONG>
    <var>stream</var>)</code></DT> <DD>determines whether a stream is a
    generic stream, returning <code>t</code> if it is, <code>nil</code>
    otherwise.</DD>
</DL>

<p>In order to specify the behaviour of a generic stream, the user must
define CLOS methods on the following CLOS generic functions. The
function <code>generic-stream-<var>xyz</var></code> corresponds to the
Common Lisp function <code><var>xyz</var></code>. They all take a
controller and some number of arguments.

<DL>
  <DT><code>(generic-stream-read-char    <var>controller</var>)</code></DT>
   <DD> Returns and consumes the next character, <code>nil</code> at
    end of file. Takes one argument, the controller object.
  </DD>
  <DT><code>(generic-stream-peek-char    <var>controller</var>)</code></DT>
  <DD> Returns the next character, <code>nil</code> at end of file. A
   second value indicates whether the side effects associated with
   consuming the character were executed: <code>t</code> means that a
   full <code>read-char</code> was done, <code>nil</code> means that no
   side effects were done. Takes one argument, the controller object.
  </DD>
  <DT><code>(generic-stream-read-byte    <var>controller</var>)</code></DT>
  <DD> Returns and consumes the next integer, <code>nil</code> at end of file.
       Takes one argument, the controller object.
  </DD>
  <DT><A name=generic-stream-listen></A>
      <code>(generic-stream-listen       <var>controller</var>)</code></DT>
  <DD>
    <P>
    This generic function is used to query the stream's input status.
    The possible return values are the same as for the
    <A HREF="#real-listen"><code>sys::real-listen</code></A> function.
    </P>
    <DL COMPACT>
      <DT><code>:eof</code></DT>             <DD>means EOF</DD>
      <DT><code>:input-available</code></DT> <DD>means a character (or byte) pending</DD>
      <DT><code>:wait</code></DT>            <DD>means no input available.</DD>
    </DL>
  </DD>
  <DT><code>(generic-stream-write-char   <var>controller</var> <var>ch</var>)</code></DT>
  <DD>   First argument is the controller object.
         Second argument is the character to be written.
  </DD>
  <DT><code>(generic-stream-write-byte   <var>controller</var> <var>by</var>)</code></DT>
  <DD>   First argument is the controller object.
         Second argument is the integer to be written.
  </DD>
  <DT><code>(generic-stream-write-string <var>controller</var> <var>string</var> <var>start</var> <var>len</var>)</code></DT>
  <DD>   Called with argument list <code>(<var>controller</var> <var>string</var> <var>start</var> <var>len</var>)</code>,
         this function shall write
           <code>(subseq (the string <var>string</var>) <var>start</var> (+ <var>start</var> <var>len</var>))</code>
         First argument is the controller object.
  </DD>
  <DT><code>(generic-stream-clear-input   <var>controller</var>)</code></DT>
  <DT><code>(generic-stream-clear-output  <var>controller</var>)</code></DT>
  <DT><code>(generic-stream-finish-output <var>controller</var>)</code></DT>
  <DT><code>(generic-stream-force-output  <var>controller</var>)</code></DT>
  <DT><code>(generic-stream-close         <var>controller</var>)</code></DT>
  <DD>   Takes one argument, the controller object.
  </DD>
</DL>
<!-- #endif -->

<a href="CLHSROOT/Body/sec_the_streams_dictionary.html">
<H3>21.2. The Streams Dictionary</H3></a>

<p>The ANSI CL function <code>open-stream-p</code> is implemented.

<P><code>stream-element-type</code> is <code>setf</code>able. The
element type of streams created by the functions
<code>make-pipe-input-stream</code>,
<code>make-pipe-output-stream</code>, <code>make-pipe-io-stream</code>,
<code>socket-accept</code>, <code>socket-connect</code> can be modified,
if both the old and the new element type are equivalent to
<code>character</code> or <code>(unsigned-byte <var>n</var>)</code>,
<code>(signed-byte <var>n</var>)</code>, where <var>n</var> is a
positive multiple of 8.

<P><code>close</code> ignores its <code>:abort</code> argument.

<P>The ANSI CL functions <code>broadcast-stream-streams</code>,
<code>concatenated-stream-streams</code>,
<code>echo-stream-input-stream</code>,
<code>echo-stream-output-stream</code>,
<code>synonym-stream-symbol</code>,
<code>two-way-stream-input-stream</code>,
<code>two-way-stream-output-stream</code> are implemented.

<!-- #if defined(MSDOS) || defined(WIN32) || (defined(UNIX) && (O_BINARY != 0)) -->
<a href="CLHSROOT/Body/fun_file-position.html">
<h4>file-position</h4></a>

<DL>
 <DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
  <DD><code>file-position</code> works on any buffered file stream. When
  a Newline is output to resp. input from a file stream, its file
  position is increased by 2 since Newline is encoded as CR/LF in the file.
</DD>
</DL>
<!-- #endif -->

<a href="CLHSROOT/Body/fun_open.html">
<h4>open</h4></a>

<p><code>open</code> cannot handle files of size &gt;= 4 GB.

<p>Possible values for the <code>:external-format</code> argument of the
function <code>open</code> are: encodings, the line terminator keywords
<code>:unix</code>, <code>:mac</code>, <code>:dos</code>, and
<code>:default</code>.

<p><code>open</code> has an additional keyword argument
<code>:buffered</code>. It determines whether the file stream returned
is buffered or not. Possible values for it are <code>nil</code>,
<code>t</code>, or <code>:default</code>. If it is
<code>:default</code>, buffered file streams will be returned for
regular files and (on Unix) block-devices, and unbuffered file streams
for special files.

<p>The function <code>(<STRONG>lisp:make-encoding</STRONG> [:charset]
[:line-terminator])</code> returns an encoding.  The
<code>:charset</code> argument may be an encoding, or
<code>:default</code>. Possible values for the
<code>:line-terminator</code> argument are the keywords
<code>:unix</code>, <code>:mac</code>, <code>:dos</code>.


<a name="printer"></a><a href="CLHSROOT/Body/chap-22.html">
<h2>Chapter 22: Printer</h2></a>

<p>The ANSI CL macro <code>formatter</code> is implemented.

<H3>write</H3>

<p>The functions <code>write</code> and <code>write-to-string</code>
have an additional keyword <code>:closure</code> that can be used to
bind <code>*print-closure*</code>.

<P>The ANSI CL macro <code>print-unreadable-object</code> is implemented.

<H3>write-byte-sequence</H3>

<p>The function <STRONG><code>lisp:write-byte-sequence</code></STRONG>
performs multiple <code>write-byte</code> operations:

<p><code>(write-byte-sequence <var>sequence</var> <var>stream</var>
[:start] [:end])</code> outputs the integers of the subsequence of
<var>sequence</var> specified by <var><code>:start</code></var> and
<var><code>:end</code></var> to <var>stream</var>. It returns
<var>sequence</var>.

<p>This function is especially efficient if <var>sequence</var> is a
<code>(vector (unsigned-byte 8))</code> and <var>stream</var> is a file
stream with element type <code>(unsigned-byte 8)</code> or a pipe
stream.

<h3>write-char-sequence</h3>

<p>The function <STRONG><code>lisp:write-char-sequence</code></STRONG>
performs multiple <code>write-char</code> operations:

<p><code>(write-char-sequence <var>sequence</var> <var>stream</var>
[:start] [:end])</code> outputs the characters of the subsequence of
<var>sequence</var> specified by <var><code>:start</code></var> and
<var><code>:end</code></var> to <var>stream</var>.  It returns
<var>sequence</var>.

<p>This function is especially efficient if <var>sequence</var> is a
string and <var>stream</var> is a file stream with element type
<code>character</code> or <code>string-char</code> or a pipe stream.

<H3>format</H3>

<p>The <code>format</code> option <code>~W</code> is analogous to
<code>~A</code> and <code>~S</code>, but avoids binding of
<code>*print-escape*</code>. <code>(format <var>stream</var>
&quot;~W&quot; <var>object</var>)</code> is equivalent to <code>(write
<var>object</var> :stream <var>stream</var>)</code>.

<P>The <code>format</code> option <code>~!</code> is analogous to
<code>~/</code>, but avoids putting a function name into a string.

<p><code>(format <var>stream</var> "~!" <var>function</var>
<var>object</var>)</code> is equivalent to <code>(funcall
<var>function</var> <var>stream</var> <var>colon-modifier-p</var>
<var>atsign-modifier-p</var> <var>object</var>)</code>.

<P><code>format ~R</code> and <code>format ~:R</code> can output only
integers in the range |n| &lt; 10<SUP>66</SUP>.  The output is in
English, according to the American conventions, and these conventions
are identical to the British conventions only in the range |n| &lt;
10<SUP>9</SUP>.

<P><code>format ~:@C</code> does not output the character itself, only
the instruction how to type the character.

<P>For <code>format ~E</code> and <code>format ~G</code>, the value of
<code>*read-default-float-format*</code> doesn't matter if
<code>*print-readably*</code> is true.

<P><code>format ~T</code> can determine the current column of any
stream.

<h3>pathnames</h3>

<P>Pathnames are printed as follows: If <code>*print-escape*</code> is
<code>nil</code>, only the namestring is printed; otherwise it is
printed with <code>#P&quot;&quot;</code> syntax, as per ANSI CL
&lt;PRINT-READABLY-BEHAVIOR:CLARIFY&gt;.  But, if
<code>*print-readably*</code> is true, we are in trouble as
<code>#P&quot;&quot;</code> is ambiguous (which is verboten when
<code>*print-readably*</code> is true), while being mandated by the
ANSI.  Therefore, in this case, we print it like this

<P><code>#-CLISP #P&quot;...&quot; #+CLISP #S(PATHNAME ...)</code>

<p>when the variable <code>lisp:*ansi*</code> is not set, otherwise the
<code>#P&quot;&quot;</code> notation is used as per <a
href="CLHSROOT/Body/sec_1-5-1-4.html">1.5.1.4.1 Resolution of Apparent
Conflicts in Exceptional Situations</a>.

<h3>misc</h3>

<P><code>*print-case*</code> controls the output not only of symbols,
but also of characters and some <code>#&lt;...&gt;</code> objects.

<p>In absence of <code>sys::write-float</code>, floating point numbers
are output in radix 2.

<P>If <code>*print-readably*</code> is true,
<code>*read-default-float-format*</code> has no influence on the way
floating point numbers are printed.

<P>
<DL>
<!-- #ifndef AMIGAOS -->
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Acorn platforms only.</EM></DT>
<DD>
<code>*print-pretty*</code> is initially = <code>nil</code> but set to <code>t</code> in <code>config.lsp</code>. This makes
screen output prettier.
</DD>
<!-- #else -->
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD>
<code>*print-pretty*</code> is initially = <code>nil</code> but set to <code>t</code> in <code>config.lsp</code>. This makes
unbuffered screen output much faster.
</DD>
<!-- #endif -->
</DL>

<P><code>*print-array*</code> is initially set to <code>t</code>.

<P>An additional variable <STRONG><code>*print-closure*</code></STRONG>
controls whether compiled and interpreted functions (closures) are
output in detailed form. If <code>*print-closure*</code> not
<code>eq</code> to <code>nil</code>, compiled closures are output in
<code>#Y</code> syntax the reader
understands. <code>*print-closure*</code> is initially set to
<code>nil</code>.

<P>An additional variable <STRONG><code>*print-rpars*</code></STRONG>
controls the output of right (closing) parentheses. If
<code>*print-rpars*</code> not <code>eq</code> to <code>nil</code>,
closing parentheses which don't fit onto the same line as the the
corresponding opening parenthesis are output just below their
corresponding opening parenthesis, in the same column.
<code>*print-rpars*</code> is initially set to <code>t</code>.

<P>An additional variable
<STRONG><code>*print-indent-lists*</code></STRONG> controls the
indentation of lists that span more than one line. It specifies by how
many characters items within the list will be indented relative to the
beginning of the list.  <code>*print-indent-lists*</code> is initially
set to <code>2</code>.

<P>The ANSI CL macro <code>with-standard-io-syntax</code> is implemented.

<DL>
  <DT>
    <A NAME=real-listen></A>
    <code>(system::<STRONG>real-listen</STRONG> <var>stream</var>)</code>
  </DT>
  <DD>
    <P>
    <code>sys::real-listen</code> is a variant of the standard
    <code>listen</code> function, which returns more detailed information
    about the stream's input status. The return value is one of:
    </P>
    <DL COMPACT>
      <DT><code>:eof</code></DT>             <DD>means EOF</DD>
      <DT><code>:input-available</code></DT> <DD>means a character (or byte) pending</DD>
      <DT><code>:wait</code></DT>            <DD>means no input available.</DD>
    </DL>
    <P>
    The return values are the same as for the
    <code><A HREF="#generic-stream-listen">generic-stream-listen</A></code>
    method, so this function is a good fit to define some generic streams
    based upon other CLISP streams.
    </P>
  </DD>
</DL>

<a name="reader"></a><a href="CLHSROOT/Body/chap-23.html">
<h2>Chapter 23: Reader</h2></a>

This is the list of objects whose external representation can not be
meaningfully read in:
<TABLE>
  <TR> <TD VALIGN=TOP> <code>#&lt;<var>type</var> ...&gt;</code>
       <TD> all structures lacking a keyword constructor
  <TR> <TD VALIGN=TOP> <code>#&lt;ARRAY <var>type</var> <var>dimensions</var>&gt;</code>
       <TD> all arrays except strings, if <code>*print-array*</code> = <code>nil</code>
  <TR> <TD VALIGN=TOP> <code>#&lt;SYSTEM-FUNCTION <var>name</var>&gt;</code>
       <TD> built-in function written in C
  <TR> <TD VALIGN=TOP> <code>#&lt;ADD-ON-SYSTEM-FUNCTION <var>name</var>&gt;</code>
       <TD> other function written in C
  <TR> <TD VALIGN=TOP> <code>#&lt;SPECIAL-OPERATOR-P <var>name</var>&gt;</code>
       <TD> special operator handler
  <TR> <TD VALIGN=TOP> <code>#&lt;COMPILED-CLOSURE <var>name</var>&gt;</code>
       <TD> compiled function, if <code>*print-closure*</code> = <code>nil</code>
  <TR> <TD VALIGN=TOP> <code>#&lt;CLOSURE <var>name</var> ...&gt;</code>
       <TD> interpreted function
  <TR> <TD VALIGN=TOP> <code>#&lt;FRAME-POINTER #x...&gt;</code>
       <TD> pointer to a stack frame
  <TR> <TD VALIGN=TOP> <code>#&lt;DISABLED POINTER&gt;</code>
       <TD> frame pointer which has become invalid on
            exit from the corresponding <code>block</code> or <code>tagbody</code>
  <TR> <TD VALIGN=TOP> <code>#&lt;...-STREAM ...&gt;</code>
       <TD> stream
  <TR> <TD VALIGN=TOP> <code>#&lt;PACKAGE <var>name</var>&gt;</code>
       <TD> package
  <TR> <TD VALIGN=TOP> <code>#&lt;HASH-TABLE #x...&gt;</code>
       <TD> hash table, if <code>*print-array*</code> = <code>nil</code>
  <TR> <TD VALIGN=TOP> <code>#&lt;READTABLE #x...&gt;</code>
       <TD> readtable
  <TR> <TD VALIGN=TOP> <code>#&lt;SYMBOL-MACRO <var>form</var>&gt;</code>
       <TD> symbol-macro handler
<!-- #ifdef FOREIGN -->
  <TR> <TD VALIGN=TOP> <code>#&lt;FOREIGN-POINTER #x...&gt;</code>
       <TD> foreign pointer
            <BR><EM>(Platform dependent: UNIX, Win32, Amiga platforms only.)</EM>
<!-- #endif -->
<!-- #ifdef DYNAMIC_FFI -->
  <TR> <TD VALIGN=TOP> <code>#&lt;FOREIGN-ADDRESS #x...&gt;</code>
       <TD> foreign address
            <BR><EM>(Platform dependent: UNIX, Win32 platforms only.)</EM>
  <TR> <TD VALIGN=TOP> <code>#&lt;FOREIGN-VARIABLE <var>name</var> #x...&gt;</code>
       <TD> foreign variable
            <BR><EM>(Platform dependent: UNIX, Win32 platforms only.)</EM>
  <TR> <TD VALIGN=TOP> <code>#&lt;FOREIGN-FUNCTION <var>name</var> #x...&gt;</code>
       <TD> foreign function
            <BR><EM>(Platform dependent: UNIX, Win32 platforms only.)</EM>
<!-- #endif -->
  <TR> <TD VALIGN=TOP> <code>#&lt;UNBOUND&gt;</code>
       <TD> &quot;value&quot; of a symbol without value, &quot;value&quot;
            of an unsupplied optional or keyword argument
  <TR> <TD VALIGN=TOP> <code>#&lt;SPECIAL REFERENCE&gt;</code>
       <TD> environment marker for variables declared <code>special</code>
  <TR> <TD VALIGN=TOP> <code>#&lt;DOT&gt;</code>
       <TD> internal <code>read</code> result for &quot;.&quot;
  <TR> <TD VALIGN=TOP> <code>#&lt;END OF FILE&gt;</code>
       <TD> internal <code>read</code> result, when the end of file
            is reached
  <TR> <TD VALIGN=TOP> <code>#&lt;READ-LABEL ...&gt;</code>
       <TD> intermediate <code>read</code> result for #n#
  <TR> <TD VALIGN=TOP> <code>#&lt;ADDRESS #x...&gt;</code>
       <TD> machine address, should not occur
  <TR> <TD VALIGN=TOP> <code>#&lt;SYSTEM-POINTER #x...&gt;</code>
       <TD> should not occur
</TABLE>

<a name="chario"></a>
<h3>characters</h3>

<p><code>#\</code> allows inputting characters of arbitrary code:
<code>#\Code231</code> yields the character <code>(code-char
231.)</code>.

<h3>Additional read dispatch macros</h3>

<UL>
<LI><code>#Y</code> is used to read compiled functions.
<LI><code>#&quot;</code> is used to read pathnames:
     <code>#&quot;test.lsp&quot;</code> is the value of <code>(pathname &quot;test.lsp&quot;)</code>
<DL>
<!-- #if defined(MSDOS) -->
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
     As in all strings, backslashes must be written twice here:
     <code>#&quot;A:\\programs\\test.lsp&quot;</code>
</DD>
<!-- #endif -->
<!-- #ifdef RISCOS -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
     As in all strings, backslashes must be written twice here:
     <code>#&quot;\\.test.lsp&quot;</code>
</DD>
<!-- #endif -->
</DL>
</UL>

<H3>readtable-case</H3>

<p>The ANSI CL place <code>readtable-case</code> is implemented. When the
value of <code>(readtable-case <var>readtable</var>)</code> is
<code>:invert</code>, it applies to the package name and the symbol name
of a symbol separately (not to the entire token at once).  An
alternative to the use of <code>readtable-case</code> is the use of the
<code>:case-sensitive</code> option to <code>make-package</code>,
<code>in-package</code> and <code>defpackage</code>.

<H3>read-byte-sequence</H3>

<p>The function <STRONG><code>lisp:read-byte-sequence</code></STRONG>
performs multiple <code>read-byte</code> operations:

<p><code>(read-byte-sequence <var>sequence</var> <var>stream</var>
[:start] [:end])</code> fills the subsequence of <var>sequence</var>
specified by <var><code>:start</code></var> and
<var><code>:end</code></var> with integers consecutively read from
<var>stream</var>. It returns the index of the first element of
<var>sequence</var> that was not updated (= <var>end</var> or &lt;
<var>end</var> if the stream reached its end).

<p>This function is especially efficient if <var>sequence</var> is a
<code>(vector (unsigned-byte 8))</code> and <var>stream</var> is a file
stream with element type <code>(unsigned-byte 8)</code> or a pipe
stream.

<H3>read-char-sequence</H3>

<p>The function <STRONG><code>lisp:read-char-sequence</code></STRONG>
performs multiple <code>read-char</code> operations:

<p><code>(read-char-sequence <var>sequence</var> <var>stream</var>
[:start] [:end])</code> fills the subsequence of <var>sequence</var>
specified by <var><code>:start</code></var> and
<var><code>:end</code></var> with characters consecutively read from
<var>stream</var>. It returns the index of the first element of
<var>sequence</var> that was not updated (= <var>end</var> or &lt;
<var>end</var> if the stream reached its end).

<p>This function is especially efficient if <var>sequence</var> is a
string and <var>stream</var> is a file stream with element type
<code>character</code> or <code>string-char</code>, a pipe stream or a
string input stream.


<a name="system"></a><a href="CLHSROOT/Body/chap-24.html">
<h2>Chapter 24: System Construction</h2></a>

<a name="system"></a><a href="CLHSROOT/Body/sec_the_syste_n_dictionary.html">
<h3>24.2: The System Construction Dictionary</h3></a>

<p>The compiler can be called not only by the functions
<code>compile</code>, <code>compile-file</code> and
<code>disassemble</code>, also by the declaration
<code>(compile)</code>.

<P><code>(compile-file <var>input-file</var> [:output-file] [:listing]
                         [:warnings] [:verbose] [:print])</code>

compiles a file to bytecode.

<DL>
<DT> <var>input-file</var>
 <DD>should be a pathname/string/symbol.
<DT>The <code>:output-file</code> argument
 <DD>should be <code>nil</code> or <code>t</code> or a
 pathname/string/symbol or an output-stream. The default is
 <code>t</code>.
<DT>The <code>:listing</code> argument
 <DD>should be <code>nil</code> or <code>t</code> or a
 pathname/string/symbol or an output-stream. The default is
 <code>nil</code>.
<DT>The <code>:warnings</code> argument
 <DD>specifies whether warnings should also appear on the screen.
<DT>The <code>:verbose</code> argument
 <DD>specifies whether error messages should also appear on the screen.
<DT>The <code>:print</code> argument
 <DD>specifies whether an indication which forms are being compiled
 should appear on the screen.
</DL>

<p>The variables <code><STRONG>lisp:*compile-warnings*</STRONG></code>,
<code>*compile-verbose*</code>, <code>*compile-print*</code> provide
defaults for the <code>:warnings</code>, <code>:verbose</code>,
<code>:print</code> keyword arguments, respectively.  For each input
file (default file type: <code>#&quot;.lsp&quot;</code>) the following
files are generated:

<p><TABLE BORDER=1>
  <TR> <TH>File            <TH>When <TH>Default file type  <TH>Contents
  <TR> <TD>output file              <TD>only if <code>:output-file</code> is not <code>nil</code>
                           <TD><code>#&quot;.fas&quot;</code>
                           <TD>can be loaded using the <code>load</code> function.
  <TR> <TD>auxiliary output file    <TD>only if <code>:output-file</code> is not <code>nil</code>
                           <TD><code>#&quot;.lib&quot;</code>
                           <TD>used by <code>compile-file</code> when compiling
                             a <code>require</code> form referring to the input file.
  <TR> <TD>listing file             <TD>only if <code>:listing</code> is not <code>nil</code>
                           <TD><code>#&quot;.lis&quot;</code>
                           <TD>disassembly of the output file.
  <TR> <TD>C output file            <TD>only if <code>:output-file</code> is not <code>nil</code>
                           <TD><code>#&quot;.c&quot;</code>
                           <TD>foreign function interface;
                           this file is deleted if it is empty.
</TABLE>

<P>The ANSI CL variables <code>*compile-file-pathname*</code> and
<code>*compile-file-truename*</code> are implemented.

<a href="CLHSROOT/fun_providecm_require.html">
<h4>require</h4></a>

<p>The function <code>require</code> receives as optional argument
either a pathname or a list of pathnames: files to be loaded if the
required module is not already in memory.

<a href="CLHSROOT/Body/fun_load.html">
<h4>load</h4></a>

<p><code>load</code> has two additional keywords <code>:echo</code> and
<code>:compiling</code>.

<BR><code>(load <var>filename</var> &amp;key :verbose :print :echo
 :if-does-not-exist :compiling)</code>

<DL>
 <DT><code>:verbose t</code>
  <DD>causes <code>load</code> to emit a short message that a file is
  being loaded. The default is <code>*load-verbose*</code>, which is
  initially = <code>t</code>.
 <DT><code>:print t</code>
  <DD>causes <code>load</code> to print the value of each form. The
  default is <code>*load-print*</code>, which is initially =
  <code>nil</code>.
 <DT><code>:echo t</code>
  <DD>causes the input from the file to be echoed to
  <code>*standard-output*</code> (normally to the screen). Should there
  be an error in the file, you can see at one glance where it is. The
  default is <STRONG><code>*load-echo*</code></STRONG>, which is
  initially = <code>nil</code>.
 <DT><code>:compiling t</code>
  <DD>causes each form read to be compiled on the fly. The compiled code
  is executed at once and - in contrast to <code>compile-file</code> -
  not written to a file. The default is
  <STRONG><code>*load-compiling*</code></STRONG>, which is initially =
  <code>nil</code>.
</DL>

<P>The ANSI CL variables <code>*load-pathname*</code> and
<code>*load-truename*</code> are implemented.

<P>The variable <STRONG><code>*load-paths*</code></STRONG> contains a
list of directories where program files are searched - additionally to
the specified or current directory - by <code>load</code>,
<code>require</code>, <code>compile-file</code>.

<a href="CLHSROOT/var_stfeaturesst.html">
<h4>*features*</h4></a>

<P>The variable <code>*features*</code> initially contains the symbols
<TABLE>
   <TR><TD><code>:CLISP</code>            <TD> this implementation
   <TR><TD><code>:COMMON-LISP</code>
   <TR><TD><code>:CLTL2</code>
   <TR><TD><code>:INTERPRETER</code>
   <TR><TD><code>:COMPILER</code>
<!-- #ifdef LOGICAL_PATHNAMES -->
   <TR><TD><code>:LOGICAL-PATHNAMES</code>
<!-- #endif -->
<!-- #ifdef DYNAMIC_FFI -->
   <TR><TD><code>:FFI</code>
    <TD> if a foreign function interface is supported <EM>(Platform
    dependent: many UNIX, Win32 platforms only)</EM>
<!-- #endif -->
<!-- #ifdef GNU_GETTEXT -->
   <TR><TD><code>:GETTEXT</code>
    <TD> if internationalization using the GNU gettext package is
    supported <EM>(Platform dependent: most UNIX platforms only)</EM>
<!-- #endif -->
<!-- #ifdef UNICODE -->
  <TR><TD><code>:UNICODE</code>
   <TD> if Unicode (ISO 10646) characters are supported
<!-- #endif -->
   <TR><TD><code>:LOOP</code>
   <TR><TD><code>:CLOS</code>
   <TR><TD><code>:AMIGA</code>
    <TD> if <var>hardware</var> = Amiga and
    <var>operating system</var> = Exec/AmigaDOS
   <TR><TD><code>:DOS</code>
    <TD> if <var>hardware</var> = PC (clone) and
    <var>operating system</var> = DOS
   <TR><TD><code>:OS/2</code>
    <TD> if <var>hardware</var> = PC (clone) and
    <var>operating system</var> = OS/2
   <TR><TD><code>:WIN32</code>
    <TD> if <var>hardware</var> = PC (clone) and
    <var>operating system</var> = Win32 (Windows NT or Windows 95)
   <TR><TD><code>:PC386</code>
    <TD> if <var>hardware</var> = PC (clone) with a 386/486/586/686
   <TR><TD><code>:UNIX</code>
    <TD> if <var>operating system</var> = Unix
    (yes, in this case the hardware is irrelevant!)
</TABLE>


<a name="environment"></a><a href="CLHSROOT/Body/chap-25.html">
<h2>Chapter 25: Environment</h2></a>

<a href="CLHSROOT/Body/sec_the_envir_t_dictionary.html">
<h3>25.2 The Environment Dictionary</h3></a>

<!-- #ifdef HAVE_DISASSEMBLER -->
<a href="CLHSROOT/fun_disassemble.html">
<h4>disassemble</h4></a>

<p><DL>
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
<code><STRONG>disassemble</STRONG></code> can disassemble to machine
code, provided that GNU gdb is present.  In that case the argument may
be a <code>system-function</code>, a <code>foreign-function</code>, a
special operator indicator, a symbol denoting one of these, a number, or a
string.
</DD>
</DL>
<!-- #endif -->

<h4>uncompile</h4>

<P>The function <code><STRONG>uncompile</STRONG></code> does the
converse of <code>compile</code>: <code>(uncompile
<var>function-name</var>)</code> reverts an interpreted function that
has been entered or loaded in the same session and then compiled back to
its interpreted form.

<a href="CLHSROOT/Body/stagenfun_doc_umentationcp.html">
<h4>documentation</h4></a>

<p>No on-line documentation is available for the system functions (yet).

<a href="CLHSROOT/mac_tracecm_untrace.html">
<h4>trace</h4></a>

<code>(TRACE <var>fun</var> ...)</code> makes the functions <var>fun</var>, ... traced. Syntax of <var>fun</var>:
Either a symbol:
       <var>symbol</var>
or a list of a symbol and some keywords and arguments (which must come in
pairs!):
       <code>(<var>symbol</var></code>
         <TABLE>
         <TR><TD><code>[:suppress-if <var>form</var>]</code>   <TD> no trace output as long as <var>form</var> is true
         <TR><TD><code>[:step-if <var>form</var>]</code>       <TD> invokes the stepper as soon as <var>form</var> is true
         <TR><TD><code>[:pre <var>form</var>]</code>           <TD> evaluates <var>form</var> before calling the function
         <TR><TD><code>[:post <var>form</var>]</code>          <TD> evaluates <var>form</var> after return from the function
         <TR><TD><code>[:pre-break-if <var>form</var>]</code>  <TD> goes into the break loop before calling the
                                function if <var>form</var> is true
         <TR><TD><code>[:post-break-if <var>form</var>]</code> <TD> goes into the break loop after return from
                                the function if <var>form</var> is true
         <TR><TD><code>[:pre-print <var>form</var>]</code>     <TD> prints the values of <var>form</var> before calling the
                                function
         <TR><TD><code>[:post-print <var>form</var>]</code>    <TD> prints the values of <var>form</var> after return from
                                the function
         <TR><TD><code>[:print <var>form</var>]</code>         <TD> prints the values of <var>form</var> both before
                                calling and after return from the function
         </TABLE>
       <code>)</code>
<BR>
In all these forms you can access
<TABLE>
  <TR><TD>the function itself
   <TD>as <code><STRONG>*trace-function*</STRONG></code>,
  <TR><TD>the arguments to the function
   <TD>as <code><STRONG>*trace-args*</STRONG></code>,
  <TR><TD>the function/macro call as form
   <TD>as <code><STRONG>*trace-form*</STRONG></code>,
  <TR><TD>after return from the function: the list of return values from
    the function call
   <TD>as <code><STRONG>*trace-values*</STRONG></code>,
  </TABLE>
and you can leave the function call with specified values by using
<code>return</code>.

<P><code>trace</code> and <code>untrace</code> are also applicable to
functions <code>(setf <var>symbol</var>)</code> and to macros, but not
to locally defined functions and macros.

<h4>space</h4>

<P>The macro <code><STRONG>space</STRONG></code> is like the macro
<code>time</code>: <code>(space <var>form</var>)</code> evaluates the
<var>form</var>, and, as a side effect, outputs information about the
memory allocations caused by this evaluation.

<a href="CLHSROOT/fun_inspect.html">
<h4>inspect</h4></a>

<P>The function <code><STRONG>inspect</STRONG></code> is not
implemented. (It is available as an add-on from the <a
href="http://ftp.cons.org/pub/lisp/clisp/contrib/">contrib</a>
directory.

<a href="CLHSROOT/fun_room.html">
<h4>room</h4></a>

<P>The function <code><STRONG>room</STRONG></code> returns two values:
the number of bytes currently occupied by Lisp objects, and the number
of bytes that can be allocated before the next regular garbage
collection occurs.

<a href="CLHSROOT/fun_ed.html">
<h4>ed</h4></a>

<P>The function <code><STRONG>ed</STRONG></code> calls the external
editor specified by the variable <code><STRONG>*editor*</STRONG></code>
(see <code>config.lsp</code>).

<!-- #if defined(MSDOS) || defined(UNIX) || defined(AMIGAOS) -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Amiga platforms only.</EM></DT>
<DD>
<DL>
<DT><EM>If using the optional package <code>editor</code>:</EM></DT>
<DD>
  <code>ed</code> behaves like this only if the variable
  <code><STRONG>*use-ed*</STRONG></code> is <code>nil</code>.
  Otherwise <code>ed</code> uses a screen editor with multiple windows.
</DD></DL>
</DD></DL>
<!-- #endif -->

<h4>time</h4>

<!-- #if !(defined(UNIX) || defined(WIN32)) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Amiga, Acorn platforms only.</EM></DT>
<DD>
The variable <code><STRONG>lisp:*default-time-zone*</STRONG></code>
contains the default time zone used by
<code>encode-universal-time</code> and
<code>decode-universal-time</code>. It is initially set to -1 (which
means 1 hour east of Greenwich, i.e. Mid European Time).
</DD>
</DL>
<!-- #endif -->

<P>The timezone in a decoded time must not necessarily be an integer,
but (as float or rational number) it should be a multiple of
<code>1/4</code>.

<P>
<DL>
<!-- #if defined(TIME_MSDOS) || defined(TIME_RISCOS) -->
<DT><EM>Platform dependent: DOS, OS/2, Acorn platforms only.</EM></DT>
<DD><code>internal-time-units-per-second</code> = 100.
<!-- #endif -->
<!-- #ifdef TIME_AMIGAOS -->
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD><code>internal-time-units-per-second</code> = 50.
<!-- #endif -->
<!-- #ifdef TIME_UNIX -->
<DT><EM>Platform dependent: most UNIX platforms only.</EM></DT>
<DD><code>internal-time-units-per-second</code> = 1000000.
<!-- #endif -->
<!-- #ifdef TIME_WIN32 -->
<DT><EM>Platform dependent: Win32 platforms only.</EM></DT>
<DD><code>internal-time-units-per-second</code> = 10000000.
<!-- #endif -->
</DL>

<h4>machine</h4>
<p><DL>
<!-- #ifdef MACHINE_KNOWN -->
 <DT><EM>Platform dependent: UNIX, Win32 platforms only.</EM></DT>
  <DD>The functions <code>short-site-name</code>,
  <code>long-site-name</code> should be defined in a site-specific
  <code>config.lsp</code> file.
<!-- #else -->
 <DT><EM>Platform dependent: DOS, OS/2, Amiga, Acorn platforms only.</EM></DT>
  <DD>The functions <code>machine-type</code>,
  <code>machine-version</code>, <code>machine-instance</code> and
  <code>short-site-name</code>, <code>long-site-name</code> should be
  defined by every user in his site-specific <code>config.lsp</code>
  file.
<!-- #endif -->
</DL>

<a name="glossary"></a><a href="CLHSROOT/Body/chap-26.html">
<h2>Chapter 26: Glossary</h2></a>

<p>No notes.

<!-- ======================================================= -->
<br><hr><br>

<a name="extensions"></a>
<H2>Extensions-1: Platform independent Extensions</H2>

<a name="image"></a>
<H3>Extensions-1.1. Saving an Image</H3>

<p>The function <code>(<STRONG>saveinitmem</STRONG> [<var>filename</var>
[:quiet] [:init-function]])</code> saves the running CLISP's memory to a
file. The <var>filename</var> defaults to
<code>&quot;lispinit.mem&quot;</code>.  If the <code>:quiet</code>
argument is not <code>nil</code>, the startup banner and the good-bye
message will be suppressed. The <code>:init-function</code> argument
specifies a function that will be executed at startup of the saved
image.

<a name="quit"><H3>Extensions-1.2. Quitting Lisp</H3></a>

<p>The functions <code>(<STRONG>exit</STRONG>
[<var>errorp</var>])</code>, <code>(<STRONG>quit</STRONG>
[<var>errorp</var>])</code> and <code>(<STRONG>bye</STRONG>
[<var>errorp</var>])</code> - all synonymous - terminate CLISP. If
<var>errorp</var> is not <code>nil</code>, CLISP aborts with error
status, i.e. the environment is informed that the CLISP session didn't
succeed.

<a name="language"><H3>Extensions-1.3. The Language</H3></a>

<p>The language CLISP uses to communicate with the user can be either
<code>ENGLISH</code> or <code>DEUTSCH</code> (i.e. german) or
<code>FRANCAIS</code> (i.e. french) or <code>ESPA&Ntilde;OL</code> (i.e.
spanish). More languages can be defined through the macro
<code><STRONG>deflanguage</STRONG></code>: <code>(deflanguage
<var>lang</var>)</code> For such an additional language to take effect,
you must install the corresponding message catalog, or translate the
messages yourself, by use of GNU gettext and Emacs po-mode.

<P>The macros <code>ENGLISH</code>, <code>DEUTSCH</code>,
<code>FRANCAIS</code> produce strings that depends on the language:
<code>(ENGLISH <var>english-string</var> DEUTSCH
<var>deutsch-string</var> FRANCAIS <var>francais-string</var>)</code> -
and all permutations of this - evaluates all of
<var>english-string</var>, <var>deutsch-string</var>,
<var>francais-string</var> in no particular order and returns the
evaluation result corresponding to the user language, be it among these
three or not.

<P>This works only for strings. For arbitrary language-dependent Lisp objects,
you define one through the macro
<code><STRONG>definternational</STRONG></code>:

<BR>  <code>(definternational <var>symbol</var>
      [(t <var>default-language</var>)])</code>,
<BR>and add language-dependent values through the macro
      <code><STRONG>deflocalized</STRONG></code>:
<BR>  <code>(deflocalized <var>symbol</var> <var>language</var>
      <var>value-form</var>)</code>

<BR>(One such form for each language. Languages without an assigned
value will be treated like the default-language.) You can then access
the localized value through the function call
  <code>(<STRONG>localized</STRONG> <var>symbol</var>
  [<var>language</var>])</code>.


<a name="weak"><H3>Extensions-1.4. Weak Pointers</H3></a>

<p>A weak pointer is an object holding a reference to a given object,
without keeping the latter from being garbage-collected.

<P><code>(<STRONG>make-weak-pointer</STRONG> <var>value</var>)</code>
returns a fresh weak pointer referring to <var>value</var>.

<P><code>(<STRONG>weak-pointer-p</STRONG> <var>object</var>)</code>
returns true if the <var>object</var> is of type
<code><STRONG>weak-pointer</STRONG></code>.

<P><code>(<STRONG>weak-pointer-value</STRONG>
<var>weak-pointer</var>)</code> returns two values: The original value
and <code>t</code>, if the value has not yet been garbage collected,
else <code>nil</code> and <code>nil</code>.

<a name="final"><H3>Extensions-1.5. Finalization</H3></a>

<p>Calling <code>(<STRONG>finalize</STRONG> <var>object</var>
<var>function</var>)</code> has the effect that when the specified
object is being garbage collected, <code>(funcall <var>function</var>
<var>object</var>)</code> will be executed.

<P>Calling <code>(finalize <var>object</var> <var>function</var>
<var>guardian</var>)</code> has a similar effect, but only as long as
the &quot;guardian&quot; has not been garbage collected: When
<var>object</var> is being garbage collected, <code>(funcall
<var>function</var> <var>object</var> <var>guardian</var>)</code> will
be executed.  If the guardian is garbage collected before
<var>object</var> is, nothing happens.

<P>Note: The time when &quot;<var>object</var> is being garbage
collected&quot; is not defined deterministically. (Actually, it possibly
never occurs.) It denotes a moment at which no references to
<var>object</var> exist from other Lisp objects. When the
<var>function</var> is called, <var>object</var> (and possibly
<var>guardian</var>) enter the &quot;arena of live Lisp objects&quot;
again.

<P>No finalization request will be executed more than once.

<a name="prompt"><H3>Extensions-1.6. The Prompt</H3></a>

<p>The variable <code>sys::*prompt*</code> controls the appearance of
the prompt.  When its value is a function, it is called and it's value
is printed with <code>princ</code>.  Otherwise, the value itself is
printed with <code>princ</code>.  The default value of
<code>sys::*prompt*</code> prints
&quot;<var>package[nn]</var>&gt;&nbsp;&quot; where <var>package</var> is
the shortest (nick)name of the current package <code>*package*</code> if
it is the same as it was in the beginning or if it doesn't contain
symbol <code>t</code> (it is assumed that in the latter case you would
want to keep in mind that your current package is something weird); and
<var>nn</var> is the ordinal number of the current prompt (hopefully, it
will remain finite).  To help you in constructing your own fancy
prompts, 2 functions are provided: <code>sys::prompt-new-package</code>,
returning <code>*package*</code> or <code>nil</code> if the current
package is the same as it was initially; and
<code>sys::package-short-name</code> taking one argument, a package, and
returning its shortest name or nickname.  Also, a variable
<code>sys::*command-index*</code> contains the current prompt number, it
is your responsibility to increment it (you might also want to reset
it).

<a name="debugger"></a>
<H2>Extensions-2: The Debugger and Stepper</H2>

<p>The debugger may be invoked through the functions
<code>invoke-debugger</code>, <code>break</code>, <code>signal</code>,
<code>error</code>, <code>cerror</code>, <code>warn</code>. The stepper
is invoked through the macro <code>step</code>.  Debugger and stepper
execute subordinate <code>read</code> - <code>eval</code> -
<code>print</code> loops (called &quot;break loops&quot;) which are
analogous to the main <code>read</code> - <code>eval</code> -
<code>print</code> loop except for the prompt and the set of available
commands. Commands must be typed literally, without surrounding quotes
or white space.

<P>Commands common to the main loop, the debugger and the stepper:
<TABLE BORDER=1>
 <TR>  <TD WIDTH=100><code>Help</code>
  <TD>prints a list of available commands.
</TABLE>

<P>Commands common to the debugger and the stepper:
<TABLE BORDER=1>
 <TR>  <TD WIDTH=100><code>Abort</code>
  <TD>abort to the next most recent <code>read</code> -
   <code>eval</code> - <code>print</code> loop.
 <TR>  <TD WIDTH=100><code>Unwind</code>
  <TD>abort to the next most recent <code>read</code> -
   <code>eval</code> - <code>print</code> loop.
</TABLE>

<P>The stack is organized into frames and other stack elements. Usually
every invocation of an interpreted function and every evaluation of an
interpreted form corresponds to one stack frame. Special forms such as
<code>let</code>, <code>let*</code>, <code>unwind-protect</code> and
<code>catch</code> produce special kinds of stack frames.

<P>In a break loop there is a current stack frame, which is initially
the most recent stack frame but can be moved using the debugger commands
<code>Up</code> and <code>Down</code>.

<P>Evaluation of forms in a break loop occurs in the lexical environment
of the current stack frame but in the dynamic environment of the
debugger's caller.  This means that to inspect or modify a lexical
variable all you have to do is to move to the current stack frame just
below the frame that corresponds to the form or the function call that
binds that variable.

<P>There is a current &quot;stack mode&quot; which defines in how much
detail the stack is shown by the stack related debugger commands.

<P>Commands common to the debugger and the stepper:
<TABLE BORDER=1>
<TR>  <TD WIDTH=100><code>Mode-1</code>      <TD>sets the current mode to 1: all the stack elements are
              considered. This mode is fine for debugging compiled functions.
<TR>  <TD WIDTH=100><code>Mode-2</code>      <TD>sets the current mode to 2: all the frames are considered.
<TR>  <TD WIDTH=100><code>Mode-3</code>      <TD>sets the current mode to 3: only lexical frames (frames that
              correspond to special forms that modify the lexical environment)
              are considered.
<TR>  <TD WIDTH=100><code>Mode-4</code>      <TD>sets the current mode to 4 (the default): only <code>eval</code> and <code>apply</code>
              frames are considered. Every evaluation of a form in the
              interpreter corresponds to an EVAL frame.
<TR>  <TD WIDTH=100><code>Mode-5</code>      <TD>sets the current mode to 5: only <code>apply</code> frames are considered.
              Every invocation of an interpreted function corresponds to one
              <code>apply</code> frame.
<TR>  <TD WIDTH=100><code>Where</code>       <TD>shows the current stack frame.
<TR>  <TD WIDTH=100><code>Up</code>          <TD>goes up one frame, i.e. to the caller if in mode-5
<TR>  <TD WIDTH=100><code>Down</code>        <TD>does down one frame, i.e. to the callee if in mode-5
<TR>  <TD WIDTH=100><code>Top</code>         <TD>goes to top frame, i.e. to the top-level form if in mode-4
<TR>  <TD WIDTH=100><code>Bottom</code>      <TD>goes to bottom (most recent) frame, i.e. most probably to the
              form or function that caused the debugger to be entered.
<TR>  <TD WIDTH=100><code>Backtrace</code>   <TD>lists the stack in current mode, bottom frame first, top frame
              last.
<TR>  <TD WIDTH=100><code>Backtrace-1</code> <TD>lists the stack in mode 1.
<TR>  <TD WIDTH=100><code>Backtrace-2</code> <TD>lists the stack in mode 2.
<TR>  <TD WIDTH=100><code>Backtrace-3</code> <TD>lists the stack in mode 3.
<TR>  <TD WIDTH=100><code>Backtrace-4</code> <TD>lists the stack in mode 4.
<TR>  <TD WIDTH=100><code>Backtrace-5</code> <TD>lists the stack in mode 5.
</TABLE>

<p>If the current stack frame is an <code>eval</code> or
<code>apply</code> frame, the following commands are available as well:

<TABLE BORDER=1>
<TR>  <TD WIDTH=100><code>Break+</code>      <TD>sets a breakpoint in the current frame. When the corresponding
              form or function will be left, the debugger will be entered
              again, with the variable <code>*trace-values*</code> containing a list of
              its values.
<TR>  <TD WIDTH=100><code>Break-</code>      <TD>removes a breakpoint from the current frame.
<TR>  <TD WIDTH=100><code>Redo</code>        <TD>re-evaluates the corresponding form or function call. This
              command can be used to restart parts of a computation without
              aborting it entirely.
<TR>  <TD WIDTH=100><code>Return</code>      <TD>leaves the current frame. You will be prompted for the
              return values.
</TABLE>
<P>
Commands specific to the debugger:
<TABLE BORDER=1>
<TR>  <TD WIDTH=100><code>Continue</code>    <TD>continues evaluation of the program.
</TABLE>
<P>
Commands specific to the stepper:
<TABLE BORDER=1>
<TR>  <TD WIDTH=100><code>Step</code>        <TD>step into a form: evaluate this form in single step mode
<TR>  <TD WIDTH=100><code>Next</code>        <TD>step over a form: evaluate this form at once
<TR>  <TD WIDTH=100><code>Over</code>        <TD>step over this level: evaluate at once up to the next return
<TR>  <TD WIDTH=100><code>Continue</code>    <TD>switch off single step mode, continue evaluation
</TABLE>

<P>The stepper is usually used like this: If some form returns a strange
value or results in an error, call <code>(step <var>form</var>)</code>
and navigate using the commands <code>Step</code> and <code>Next</code>
until you reach the form you regard as responsible. If you are too fast
(execute <code>Next</code> once and get the error), there is no way
back; you have to restart the entire stepper session. If you are too
slow (stepped into a function or a form which certainly is OK), a couple
of <code>Next</code> commands or one <code>Over</code> command will
help.

<!-- #if defined(SCREEN) || defined(AMIGAOS) || defined(GRAPHICS) || defined(UNIX) || defined(DYNAMIC_FFI) || defined(SOCKET_STREAMS) -->

<a name="platform"></a>
<H2>Extensions-3: Platform specific Extensions</H2>

<!-- #if 0 -->
<a name="edit"><H3>Extensions-3.1. The Editor</H3></a>

<EM>Undocumented.</EM>
<!-- #endif -->
<!-- #if defined(SCREEN) || defined(AMIGAOS) -->
<a name="screen"><H3>Extensions-3.2. Random Screen Access</H3></a>

<EM>Platform dependent: UNIX, DOS, OS/2, Amiga platforms only.</EM>

<DL>
<DT><code>(<STRONG>screen:make-window</STRONG>)</code>
<DD>  returns a &quot;window stream&quot;. As long as this stream is open, the terminal
  is in cbreak/noecho mode. <code>*terminal-io*</code> shouldn't be used for input or
  output during this time. (Use <code>with-keyboard</code> and <code>*keyboard-input*</code> instead.)

<DT><code>(<STRONG>screen:with-window</STRONG> . <var>body</var>)</code>
<DD>  binds <code><STRONG>screen:*window*</STRONG></code> to a window stream and executes <var>body</var>. The stream is
  guaranteed to be closed when the body is left. During its execution,
  <code>*terminal-io*</code> shouldn't be used, as above.

<DT><code>(<STRONG>screen:window-size</STRONG> <var>window-stream</var>)</code>
<DD>  returns the window's size, as two values:
  height (= y<SUB>max</SUB>+1) and width (= x<SUB>max</SUB>+1).

<DT><code>(<STRONG>screen:window-cursor-position</STRONG> <var>window-stream</var>)</code>
<DD>  returns the position of the cursor in the window, as two values:
  line (&gt;=0, &lt;=y<SUB>max</SUB>, 0 means top), column (&gt;=0, &lt;=x<SUB>max</SUB>, 0 means left margin).

<DT><code>(<STRONG>screen:set-window-cursor-position</STRONG> <var>window-stream</var> <var>line</var> <var>column</var>)</code>
<DD>  sets the position of the cursor in the window.

<DT><code>(<STRONG>screen:clear-window</STRONG> <var>window-stream</var>)</code>
<DD>  clears the window's contents and puts the cursor in the upper left corner.

<DT><code>(<STRONG>screen:clear-window-to-eot</STRONG> <var>window-stream</var>)</code>
<DD>  clears the window's contents from the cursor position to the end of window.

<DT><code>(<STRONG>screen:clear-window-to-eol</STRONG> <var>window-stream</var>)</code>
<DD>  clears the window's contents from the cursor position to the end of line.

<DT><code>(<STRONG>screen:delete-window-line</STRONG> <var>window-stream</var>)</code>
<DD>  removes the cursor's line, moves the lines below it up by one line and
  clears the window's last line.

<DT><code>(<STRONG>screen:insert-window-line</STRONG> <var>window-stream</var>)</code>
<DD>  inserts a line at the cursor's line, moving the lines below it down by
  one line.

<DT><code>(<STRONG>screen:highlight-on</STRONG> <var>window-stream</var>)</code>
<DD>  switches highlighted output on.

<DT><code>(<STRONG>screen:highlight-off</STRONG> <var>window-stream</var>)</code>
<DD>  switches highlighted output off.

<DT><code>(<STRONG>screen:window-cursor-on</STRONG> <var>window-stream</var>)</code>
<DD>  makes the cursor visible, a cursor block in most implementations.

<DT><code>(<STRONG>screen:window-cursor-off</STRONG> <var>window-stream</var>)</code>
<DD>  makes the cursor invisible, in implementations where this is possible.
</DL>
<!-- #endif -->
<!-- #ifdef UNIX -->
<a name="modules"><H3>Extensions-3.3. External Modules </H3></a>

<EM>Platform dependent: UNIX platforms only.</EM>

<P>CLISP has a facility for adding external modules (written in C, for
example).  It is invoked through <code>clisp-link</code>.

<P>A module is a piece of external code which defines extra Lisp
objects, symbols and functions. A module name must consist of the
characters A-Z,a-z,_,0-9. The module name <code>&quot;clisp&quot;</code>
is reserved. Normally a module name is derived from the corresponding
file name.

<P><code>clisp-link</code> needs a directory containing:
<TABLE>
  <TR><TD>  <code>modules.d</code>
  <TR><TD>  <code>modules.c</code>
  <TR><TD>  <code>clisp.h</code>
</TABLE>
<code>clisp-link</code> expects to find these files in a subdirectory <code>linkkit/</code> of the
current directory. This can be overridden by the environment variable
<code>CLISP_LINKKIT</code>.

<P><code>clisp-link</code> operates on CLISP linking sets and on module sets.

<P>A <STRONG>linking set</STRONG> is a directory containing:
<DL>
<DT>    <code>makevars</code>          <DD>some <code>/bin/sh</code> commands, setting the variables
                      <DL>
                        <DT><code>CC</code>       <DD>the C compiler
                        <DT><code>CFLAGS</code>   <DD>flags for the C compiler, when compiling
                        <DT><code>CLFLAGS</code>  <DD>flags for the C compiler, when linking
                        <DT><code>LIBS</code>     <DD>libraries to use when linking
                        <DT><code>X_LIBS</code>   <DD>additional X window system libraries to use
                        <DT><code>RANLIB</code>   <DD>the ranlib command
                        <DT><code>FILES</code>    <DD>the list of files needed when linking
                      </DL>
<DT>    <code>modules.h</code>         <DD>the list of modules contained in this linking set
<DT>    all the <code>FILES</code> listed in <code>makevars</code>
<DT>    <code>lisp.run</code>          <DD>the executable
<DT>    <code>lispinit.mem</code>      <DD>the memory image
</DL>
To run a clisp contained in some linking set <var>dir</var>, call
&quot;<code><var>dir</var>/lisp.run -M <var>dir</var>/lispinit.mem</code>&quot;.
<P>
A <STRONG>module set</STRONG> is a directory containing:
<DL>
<DT>    <code>link.sh</code>          <DD>some <code>/bin/sh</code> commands, which prepare the directory
                     before linking, and set the variables <code>NEW_FILES</code>, <code>NEW_LIBS</code>,
                     <code>NEW_MODULES</code>, <code>TO_LOAD</code> and optionally <code>TO_PRELOAD</code>
<DT>
and any other files needed by <code>link.sh</code>.
</DL>
Note that in <code>link.sh</code> the module set directory is referred to as <code>&quot;$modulename&quot;/</code>.
<DL>
<DT>  The <code>NEW_FILES</code> variable <DD>shall contain a space-separated list of files that
  belong to the module set and will belong to every new linking set.

<DT>  The <code>NEW_LIBS</code> variable <DD>shall contain a space-separated list of files or C
  compiler switches that need to be passed to the C compiler when linking the
  lisp.run belonging to a new linking set.

<DT>  The <code>NEW_MODULES</code> variable <DD>shall contain a space-separated list of the module
  names belonging to the module set. Normally, every <code>.c</code> file in the module set
  defines a module of its own. The module name is derived from the file name.

<DT>  The <code>TO_LOAD</code> variable <DD>shall contain a space-separated list of Lisp files to
  load before building the <code>lispinit.mem</code> belonging to a new linking set.

<DT>  The <code>TO_PRELOAD</code> variable, if defined, <DD>shall contain a space-separated list
  of Lisp files to load into an intermediate <code>lispinit.mem</code> file, before
  building the <code>lispinit.mem</code> belonging to a new linking set. This variable
  is usually used for defining Lisp packages which must be present when
  the new <code>.c</code> files are initialized.
</DL>
<P>
The command
&quot;<code>clisp-link create-module-set <var>module-dir</var> <var>file1.c</var> ...</code>&quot;
creates a module set in <var>module-dir</var> which refers (via symbolic links) to
<code><var>file1.c</var></code> etc. The files are expected to be modules of their own.
<P>
The command
&quot;<code>clisp-link add-module-set <var>module-dir</var> <var>source-dir</var> <var>destination-dir</var></code>&quot;
combines a linking set in <var>source-dir</var> and a module in <var>module-dir</var> to a new
linking set, in a directory <var>destination-dir</var> which is newly created.

<P>The command &quot;clisp-link run <var>source-dir</var>
<var>module-dir</var> ...&quot; runs the linking set in
<var>source-dir</var>, with the module in <var>module-dir</var> loaded.
More than one module can be specified. If CLISP has been built with the
configuration option <code>--with-dynamic-modules</code>, the loading
will be performed through dynamic loading. Otherwise -- this is much
slower -- a temporary linking set will be created and deleted
afterwards. Note that dynamic loading does not work on all operating
systems, and that <code>--with-dynamic-modules</code> precludes some
efficiency optimizations which are on by default.

<H4>Example</H4>

To link in the FFI bindings for the Linux operating system, the following
steps are needed. (Step 1 and step 2 need not be executed in this order.)
<OL>
<LI>Create a new module set:
<PRE><code>   $ clisp-link create-module-set linux /<var>somewhere</var>/bindings/linux.c
</code></PRE>
   Modify the newly created <code>linux/link.sh</code> to add &quot;<code>-lm</code>&quot; to the libraries:
<PRE><code>   NEW_LIBS=&quot;$file_list&quot;
   --&gt;
   NEW_LIBS=&quot;$file_list -lm&quot;
</code></PRE>
   Modify the newly created <code>linux/link.sh</code> to load <code>linux.fas</code> before saving
   the memory image:
<PRE><code>   TO_LOAD=''
   --&gt;
   TO_LOAD='/<var>somewhere</var>/bindings/linux.fas'
</code></PRE>
<LI>Compile <code>linux.lsp</code>, creating <code>linux.c</code>:
<PRE><code>   $ clisp -c /<var>somewhere</var>/bindings/linux.lsp
</code></PRE>
<LI>Create a new linking set:
<PRE><code>   $ clisp-link add-module-set linux base base+linux
</code></PRE>
<LI>Run and try it:
<PRE><code>   $ base+linux/lisp.run -M base+linux/lispinit.mem
   &gt; (linux::stat &quot;/tmp&quot;)
</code></PRE>
</OL>
<P>
<!-- #endif -->
<!-- #ifdef DYNAMIC_FFI -->
<a name="dffi"><H3>Extensions-3.4. The Foreign Function Call Facility</H3></a>

<EM>Platform dependent: many UNIX, Win32 platforms only.</EM>

<P>A foreign function description is written as a Lisp file, and when
compiled it produces a <code>.c</code> file which is then compiled by
the C compiler and may be linked together with <code>lisp.a</code>.

<P>All symbols relating to the foreign function interface are exported
from the package FFI. To use them, <code>(use-package
&quot;FFI&quot;)</code>.

<P>Special FFI forms may appear anywhere in the Lisp file.

<H4>Overview</H4>

<p>These are the special FFI forms. We have taken a pragmatic approach:
the only foreign languages we support for now are C and ANSI C.

<P><code>(<STRONG>def-c-type</STRONG> <var>name</var>
<var>c-type</var>)</code>

<P><code>(<STRONG>def-c-var</STRONG> <var>name</var>
{<var>option</var>}*)</code>

<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD> <code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:type <var>c-type</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:read-only <var>boolean</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:alloc <var>allocation</var>)</code>
</TABLE>

<P><code>(<STRONG>def-call-out</STRONG> <var>name</var>
{<var>option</var>}*)</code>

<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD> <code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:arguments {(<var>arg-name</var> <var>c-type</var> [<var>param-mode</var> [<var>allocation</var>]])}*)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:return-type <var>c-type</var> [<var>allocation</var>])</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:language <var>language</var>)</code>
</TABLE>

<P><code>(<STRONG>def-call-in</STRONG> <var>name</var>
{<var>option</var>}*)</code>

<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD> <code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:arguments {(<var>arg-name</var> <var>c-type</var> [<var>param-mode</var> [<var>allocation</var>]])}*)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:return-type <var>c-type</var> [<var>allocation</var>])</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:language <var>language</var>)</code>
</TABLE>

<P><code>(<STRONG>def-c-call-out</STRONG> <var>name</var>
{<var>option</var>}*)</code>

<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD> <code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:arguments {(<var>arg-name</var> <var>c-type</var> [<var>param-mode</var> [<var>allocation</var>]])}*)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:return-type <var>c-type</var> [<var>allocation</var>])</code>
</TABLE>

<P><code>(<STRONG>def-c-call-in</STRONG> <var>name</var>
{<var>option</var>}*)</code>

<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD> <code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:arguments {(<var>arg-name</var> <var>c-type</var> [<var>param-mode</var> [<var>allocation</var>]])}*)</code>
<TR><TD ALIGN=RIGHT>    | <TD> <code>(:return-type <var>c-type</var> [<var>allocation</var>])</code>
</TABLE>

<P><code>(<STRONG>def-c-struct</STRONG> <var>name</var>
(<var>ident</var> <var>c-type</var>)*)</code>

<P><code>(<STRONG>def-c-enum</STRONG> <var>name</var> {<var>ident</var>
| (<var>ident</var> [<var>value</var>])}*)</code>

<P><code>(<STRONG>c-lines</STRONG> <var>format-string</var>
{<var>argument</var>}*)</code>

<P><code>(<STRONG>element</STRONG> <var>c-place</var>
{<var>index</var>}*)</code>

<BR>
<code>(<STRONG>deref</STRONG> <var>c-place</var>)</code>
<BR>
<code>(<STRONG>slot</STRONG> <var>c-place</var> <var>slot-name</var>)</code>
<BR>
<code>(<STRONG>cast</STRONG> <var>c-place</var> <var>c-type</var>)</code>
<P>
<code>(<STRONG>typeof</STRONG> <var>c-place</var>)</code>
<BR>
<code>(<STRONG>sizeof</STRONG> <var>c-place</var>)</code>, <code>(sizeof <var>c-type</var>)</code>
<BR>
<code>(<STRONG>bitsizeof</STRONG> <var>c-place</var>)</code>,
<code>(bitsizeof <var>c-type</var>)</code>

<P><code>(<STRONG>validp</STRONG> <var>foreign-entity</var>)</code>

<P><var>name</var> is any Lisp symbol.

<P><var>c-name</var> is a string.

<H4>(Foreign) C types</H4>

<p>Foreign C types are used in the FFI. They are <EM>not</EM> regular
Common Lisp types or CLOS classes.

<P>A <var>c-type</var> is either a predefined C type or the name of a
type defined by <code>def-c-type</code>.

<P>The simple C types are these:

<TABLE BORDER=1>
<TR> <TH>Lisp name     <TH>Lisp equiv           <TH>C equiv        <TH>ILU equiv <TH>Comment
<TR>  <TD><code>nil</code>           <TD><code>nil</code>                  <TD><code>void</code>           <TD>                  <TD>as a result type only
<TR>  <TD><code>boolean</code>       <TD><code>boolean</code>              <TD><code>int</code>            <TD><code>BOOLEAN</code>
<TR>  <TD><code>character</code>     <TD><code>character</code>            <TD><code>char</code>           <TD><code>SHORT CHARACTER</code>
<TR>  <TD><code>char</code>          <TD><code>integer</code>              <TD><code>signed char</code>
<TR>  <TD><code>uchar</code>         <TD><code>integer</code>              <TD><code>unsigned char</code>
<TR>  <TD><code>short</code>         <TD><code>integer</code>              <TD><code>short</code>
<TR>  <TD><code>ushort</code>        <TD><code>integer</code>              <TD><code>unsigned short</code>
<TR>  <TD><code>int</code>           <TD><code>integer</code>              <TD><code>int</code>
<TR>  <TD><code>uint</code>          <TD><code>integer</code>              <TD><code>unsigned int</code>
<TR>  <TD><code>long</code>          <TD><code>integer</code>              <TD><code>long</code>
<TR>  <TD><code>ulong</code>         <TD><code>integer</code>              <TD><code>unsigned long</code>
<TR>  <TD><code>uint8</code>         <TD><code>(unsigned-byte 8)</code>    <TD><code>uint8</code>          <TD><code>BYTE</code>
<TR>  <TD><code>sint8</code>         <TD><code>(signed-byte 8)</code>      <TD><code>sint8</code>
<TR>  <TD><code>uint16</code>        <TD><code>(unsigned-byte 16)</code>   <TD><code>uint16</code>         <TD><code>SHORT CARDINAL</code>
<TR>  <TD><code>sint16</code>        <TD><code>(signed-byte 16)</code>     <TD><code>sint16</code>         <TD><code>SHORT INTEGER</code>
<TR>  <TD><code>uint32</code>        <TD><code>(unsigned-byte 32)</code>   <TD><code>uint32</code>         <TD><code>CARDINAL</code>
<TR>  <TD><code>sint32</code>        <TD><code>(signed-byte 32)</code>     <TD><code>sint32</code>         <TD><code>INTEGER</code>
<TR>  <TD><code>uint64</code>        <TD><code>(unsigned-byte 64)</code>   <TD><code>uint64</code>         <TD><code>LONG CARDINAL</code>     <TD>does not work on all platforms
<TR>  <TD><code>sint64</code>        <TD><code>(signed-byte 64)</code>     <TD><code>sint64</code>         <TD><code>LONG INTEGER</code>      <TD>does not work on all platforms
<TR>  <TD><code>single-float</code>  <TD><code>single-float</code>         <TD><code>float</code>
<TR>  <TD><code>double-float</code>  <TD><code>double-float</code>         <TD><code>double</code>
</TABLE>

<P>The predefined C types are:

<TABLE>
<TR><TD>  <var>c-type</var> ::=
<TR><TD ALIGN=RIGHT>      <TD><var>simple-c-type</var>
<TR><TD ALIGN=RIGHT>    | <TD><code>c-pointer</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>c-string</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(c-struct <var>class</var> (<var>ident</var> <var>c-type</var>)*)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(c-union (<var>ident</var> <var>c-type</var>)*)</code>
<TR><TD ALIGN=RIGHT VALIGN=TOP>    | <TD><code>(c-array <var>c-type</var> <var>dimensions</var>)</code>
<BR>        <var>dimensions</var> ::= <var>number</var> | <code>({<var>number</var>}*)</code>
<TR><TD ALIGN=RIGHT VALIGN=TOP>    | <TD><code>(c-array-max <var>c-type</var> <var>maxdimension</var>)</code>
<BR>        <var>maxdimension</var> ::= <var>number</var>
<TR><TD ALIGN=RIGHT VALIGN=TOP>    | <TD><code>(c-function {<var>option</var>}*)</code>
<BR>        <var>option</var> ::=
<BR>          &nbsp; <code>(:arguments {(<var>arg-name</var> <var>c-type</var> [<var>param-mode</var> [<var>allocation</var>]])}*)</code>
<BR>          | <code>(:return-type <var>c-type</var> [<var>allocation</var>])</code>
<BR>          | <code>(:language <var>language</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(c-ptr <var>c-type</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(c-ptr-null <var>c-type</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(c-array-ptr <var>c-type</var>)</code>
</TABLE>

<P><code>(<STRONG>def-c-type</STRONG> <var>name</var>
<var>c-type</var>)</code> makes <var>name</var> a shortcut for
<var>c-type</var>. Note that <var>c-type</var> may already refer to
name. Forward declarations of types are not possible, however.

<P>The type <code>c-pointer</code> corresponds to what C calls
&quot;<code>void*</code>&quot;, an opaque pointer.

<P>The type <code>c-string</code> corresponds to what C calls
&quot;<code>char*</code>&quot;, a zero-terminated string. Its Lisp
equivalent is a string, without the trailing zero character.

<P>The type <code>(c-struct <var>class</var>
(<var>ident<SUB>1</SUB></var> <var>type<SUB>1</SUB></var>)
... (<var>ident<SUB>n</SUB></var> <var>type<SUB>n</SUB></var>))</code>
is equivalent to what C calls &quot;<code>struct {
<var>type<SUB>1</SUB></var> <var>ident<SUB>1</SUB></var>; ...;
<var>type<SUB>n</SUB></var> <var>ident<SUB>n</SUB></var>;
}</code>&quot;. Its Lisp equivalent is: if <var>class</var> is
<code>vector</code>, a simple-vector; if <var>class</var> is
<code>list</code>, a list; if <var>class</var> is a symbol naming a
structure or CLOS class: an instance of this class, with slots of names
<var>ident<SUB>1</SUB></var>,...,<var>ident<SUB>n</SUB></var>.

<P>The type <code>(c-union (<var>ident<SUB>1</SUB></var>
<var>type<SUB>1</SUB></var>) ... (<var>ident<SUB>n</SUB></var>
<var>type<SUB>n</SUB></var>))</code> is equivalent to what C calls
&quot;<code>union { <var>type<SUB>1</SUB></var>
<var>ident<SUB>1</SUB></var>; ...; <var>type<SUB>n</SUB></var>
<var>ident<SUB>n</SUB></var>; }</code>&quot;. Conversion to and from
Lisp assumes that a value is to be viewed as being of
<var>type<SUB>1</SUB></var>.

<P>The type <code>(c-array <var>type</var> <var>dim<SUB>1</SUB></var>
... <var>dim<SUB>n</SUB></var>)</code> is equivalent to what C calls
&quot;<code><var>type</var>
[<var>dim<SUB>1</SUB></var>]...[<var>dim<SUB>n</SUB></var>]</code>&quot;. Note
that when an array is passed as an argument to a function in C, it is
actually passed as a pointer; you therefore have to write <code>(c-ptr
(c-array ...))</code> for this argument's type.

<P>The type <code>(c-array-max <var>type</var> <var>maxdim</var>)</code>
is equivalent to what C calls &quot;<code><var>type</var>
[<var>maxdim</var>]</code>&quot;, an array containing up to
<var>maxdim</var> elements. The array is zero-terminated if it contains
less than <var>maxdim</var> elements. Conversion from Lisp of an array
with more than <var>maxdim</var> elements silently ignores the
superfluous elements.

<P>The type <code>(c-ptr <var>type</var>)</code> is equivalent to what C
calls &quot;<code><var>type</var> *</code>&quot;: a pointer to a single
item of the given <var>type</var>.

<P>The type <code>(c-ptr-null <var>type</var>)</code> is also equivalent
to what C calls &quot;<code><var>type</var> *&quot;</code>: a pointer to
a single item of the given <var>type</var>, with the exception that C
<code>NULL</code> corresponds to Lisp <code>nil</code>.

<P>The type <code>(c-array-ptr <var>type</var>)</code> is equivalent to
what C calls &quot;<code><var>type</var> (*)[]</code>&quot;: a pointer
to a zero-terminated array of items of the given <var>type</var>.

<P>The type <code>(c-function (:return-type <var>rtype</var>)
(:arguments (<var>arg<SUB>1</SUB></var> <var>type<SUB>1</SUB></var> ...)
...))</code> designates a C function that can be called according to the
given prototype <code>(<var>rtype</var> (*)
(<var>type<SUB>1</SUB></var>, ...))</code>.  The <var>language</var> is
either <code>:C</code> (denotes K&amp;R C) or <code>:STDC</code>
(denotes ANSI C) or <code>:STDC-STDCALL</code> (denotes ANSI C with
<EM>stdcall</EM> calling convention). It specifies whether the C
function has been compiled by a K&amp;R C compiler or by an ANSI C
compiler, and possibly the calling convention.  Conversion between C
functions and Lisp functions is transparent.

<P><code>(<STRONG>def-c-struct</STRONG> <var>name</var>
(<var>ident</var> <var>c-type</var>)*)</code> defines <var>name</var> to
be both a <code>defstruct</code> structure type and a foreign C type
with the given slots.

<P><code>(<STRONG>def-c-enum</STRONG> <var>name</var> {<var>ident</var>
| (<var>ident</var> [<var>value</var>])}*)</code> defines
<var>ident</var>s as constants, similarly to the C declaration
<code>enum { <var>ident</var> [= <var>value</var>], ... };</code>

<P><code>(<STRONG>c-lines</STRONG> <var>format-string</var>
{<var>argument</var>}*)</code> outputs the string <code>(format nil
<var>format-string</var> {<var>argument</var>}*)</code> to the C output
file. This is a rarely needed low-level facility.

<P>The form <code>(<STRONG>sizeof</STRONG> <var>c-type</var>)</code>
returns the size and alignment of a C type, measured in bytes.

<P>The form <code>(<STRONG>bitsizeof</STRONG> <var>c-type</var>)</code>
returns the size and alignment of a C type, measured in bits.

<P>The predicate <code>(<STRONG>validp</STRONG>
<var>foreign-entity</var>)</code> returns <code>nil</code> if the
<var>foreign-entity</var> (e.g. the Lisp equivalent of a
<code>c-pointer</code>) refers to a pointer which is invalid because it
comes from a previous Lisp session. It returns <code>t</code> if
<var>foreign-entity</var> can be used within the current Lisp process.

<H4>Foreign variables</H4>

<p>Foreign variables are variables whose storage is allocated in the
foreign language module. They can nevertheless be evaluated and modified
through <code>setq</code>, just as normal variables can, except that the
range of allowed values is limited according to the variable's foreign
type. Note that for a foreign variable <var>x</var> the form <code>(eql
<var>x</var> <var>x</var>)</code> is not necessarily true, since every
time <var>x</var> is evaluated its foreign value is converted to a
freshly created Lisp value.

<p><code>(<STRONG>def-c-var</STRONG> <var>name</var>
{<var>option</var>}*)</code>
<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD><code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:type <var>c-type</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:read-only <var>boolean</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:alloc <var>allocation</var>)</code>
</TABLE>
defines a foreign variable. <var>name</var> is the Lisp name, a regular
Lisp symbol.

<P>The <code>:name</code> option specifies the name, as seen from C, as
a string. If not specified, it is derived from the print name of the
Lisp name.

<P>The <code>:type</code> option specifies the variable's foreign type.

<P>If the <code>:read-only</code> option is specified and
non-<code>nil</code>, it will be impossible to change the variable's
value from within Lisp (using <code>setq</code> or similar).

<P>The <code>:alloc</code> option can be either <code>:none</code> or
<code>:malloc-free</code> and defaults to <code>:none</code>.  If it is
<code>:malloc-free</code>, any values of type <code>c-string</code>,
<code>(c-ptr ...)</code>, <code>(c-ptr-null ...)</code>,
<code>(c-array-ptr ...)</code> within the foreign value are assumed to
be pointers to <code>malloc()</code>-allocated storage, and when
<code>setq</code> replaces an old value by a new one, the old storage is
freed using <code>free()</code> and the new storage allocated using
<code>malloc()</code>. If it is <code>:none</code>, <code>setq</code>
assumes that the pointers point to good storage (not <code>NULL</code>!)
and overwrites the old values by the new ones. This is dangerous (just
think of overwriting a string with a longer one or storing some data in
a <code>NULL</code> pointer...) and deprecated.

<H4>Operations on foreign places</H4>

<p>A foreign variable <var>name</var> defined by <code>def-c-var</code>
defines a &quot;place&quot;, i.e.  a form which can also be used as
argument to <code>setf</code>. (An &quot;lvalue&quot; in C terminology.)
The following operations are available on foreign places:

<P><code>(<STRONG>element</STRONG> <var>place</var>
<var>index<SUB>1</SUB></var> ... <var>index<SUB>n</SUB></var>)</code>
<BR>Array element: If <var>place</var> is of foreign type <code>(c-array
<var>c-type</var> <var>dim<SUB>1</SUB></var>
... <var>dim<SUB>n</SUB></var>)</code> and 0 &lt;=
<var>index<SUB>1</SUB></var> &lt; <var>dim<SUB>1</SUB></var>, ..., 0
&lt;= <var>index<SUB>n</SUB></var> &lt; <var>dim<SUB>n</SUB></var>, this
will be the place corresponding to <code>(aref <var>place</var>
<var>index<SUB>1</SUB></var> ... <var>index<SUB>n</SUB></var>)</code> or
<code><var>place</var>[<var>index<SUB>1</SUB></var>]...[<var>index<SUB>n</SUB></var>]</code>.
It is a place of type <var>c-type</var>.  If <var>place</var> is of
foreign type <code>(c-array-max <var>c-type</var> <var>dim</var>)</code>
and 0 &lt;= <var>index</var> &lt; <var>dim</var>, this will be the place
corresponding to <code>(aref <var>place</var> <var>index</var>)</code>
or <code><var>place</var>[<var>index</var>]</code>.  It is a place of
type <var>c-type</var>.

<P><code>(<STRONG>deref</STRONG> <var>place</var>)</code>
<BR>Dereference pointer: If <var>place</var> is of foreign type
<code>(c-ptr <var>c-type</var>)</code> or <code>(c-ptr-null
<var>c-type</var>)</code>, this will be the place the pointer points
to. It is a place of type <var>c-type</var>. For <code>(c-ptr-null
<var>c-type</var>)</code>, the <var>place</var> may not be
<code>NULL</code>.

<P><code>(<STRONG>slot</STRONG> <var>place</var>
<var>slot-name</var>)</code>
 <BR>Struct or union component: If <var>place</var> is of foreign type
 <code>(c-struct <var>class</var> ... (<var>slot-name</var>
 <var>c-type</var>) ...)</code> or of type <code>(c-union
 ... (<var>slot-name</var> <var>c-type</var>) ...)</code>, this will be
 of type <var>c-type</var>.

<P><code>(<STRONG>cast</STRONG> <var>place</var> <var>c-type</var>)</code>
 <BR>Type change: A place denoting the same memory locations as the
 original <var>place</var>, but of type <var>c-type</var>.

<P><code>(<STRONG>typeof</STRONG> <var>place</var>)</code>
 <BR>returns the <var>c-type</var> corresponding to the <var>place</var>.

<P><code>(<STRONG>sizeof</STRONG> <var>place</var>)</code>
 <BR>returns the size and alignment of the C type of <var>place</var>,
measured in bytes.

<P><code>(<STRONG>bitsizeof</STRONG> <var>place</var>)</code>
 <BR>returns the size and alignment of the C type of <var>place</var>,
measured in bits.

<H4>Foreign functions</H4>

<p>Foreign functions are functions which are defined in the foreign
language.  There are <EM>named foreign functions</EM> (imported via
<code>def-call-out</code> or created via <code>def-call-in</code>) and
<EM>anonymous foreign functions</EM>; they arise through conversion of
function pointers.

<P>A <EM>&quot;call-out&quot;</EM> function is a foreign function called
from Lisp: control flow temporarily leaves Lisp.  A
<EM>&quot;call-in&quot;</EM> function is a Lisp function called from the
foreign language: control flow temporary enters Lisp.

<P><code>(<STRONG>def-call-out</STRONG> <var>name</var>
{<var>option</var>}*)</code>
<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD><code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:arguments {(<var>arg-name</var> <var>c-type</var> [<var>param-mode</var> [<var>allocation</var>]])}*)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:return-type <var>c-type</var> [<var>allocation</var>])</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:language <var>language</var>)</code>
</TABLE>
defines a named call-out function. Any Lisp function call to
<code>#'<var>name</var></code> is redirected to call the C function
<var>c-name</var>.

<P><code><STRONG>def-c-call-out</STRONG></code> is equivalent to
<code>def-call-out</code> with <code>:language :c</code>.

<P><code>(<STRONG>def-call-in</STRONG> <var>name</var>
{<var>option</var>}*)</code>

<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD><code>(:name <var>c-name</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:arguments {(<var>arg-name</var> <var>c-type</var> [<var>param-mode</var> [<var>allocation</var>]])}*)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:return-type <var>c-type</var> [<var>allocation</var>])</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:language <var>language</var>)</code>
</TABLE>
defines a named call-in function. Any C function call to the C function
<var>c-name</var> is redirected to call the Lisp function <code>#'<var>name</var></code>.
<P>
<code><STRONG>def-c-call-in</STRONG></code> is equivalent to <code>def-call-in</code> with <code>:language :c</code>.

<H4>Argument and result passing conventions</H4>

<p>When passed to and from functions, allocation of arguments and
results is handled as follows:

<P>Values of <var>simple-c-type</var>, <code>c-pointer</code> are passed
on the stack, with dynamic extent. The <var>allocation</var> is
effectively ignored.

<P>Values of type <code>c-string</code>, <code>(c-ptr</code>
...<code>)</code>, <code>(c-ptr-null</code> ...<code>)</code>,
<code>(c-array-ptr</code> ...<code>)</code> need storage. The
<var>allocation</var> specifies the allocation policy:

<TABLE BORDER=1>
 <TR>  <TD><var>allocation</var> is <code>:none</code>
  <TD>means that no storage is allocated.
 <TR>  <TD><var>allocation</var> is <code>:alloca</code>
  <TD>means allocation of storage on the stack, which has dynamic extent.
 <TR>  <TD><var>allocation</var> is <code>:malloc-free</code>
  <TD>means that storage will be allocated via <code>malloc()</code> and
  freed via <code>free()</code>.
</TABLE>

If no <var>allocation</var> is specified, the default
<var>allocation</var> is <code>:none</code> for most types, but
<code>:alloca</code> for <code>c-string</code> and <code>(c-ptr</code>
...<code>)</code> and <code>(c-ptr-null</code> ...<code>)</code> and
<code>(c-array-ptr</code> ...<code>)</code> and for <code>:out</code>
arguments. [Subject to change!]  The <code>:malloc-free</code> policy
provides the ability to pass arbitrarily nested structs containing
pointers pointing to structs ... within a single conversion.

<P>
<DL>
<DT>For call-out functions:<DD>
  <DL>
  <DT>For arguments passed from Lisp to C:<DD>
    <DL>
    <DT>If <var>allocation</var> is <code>:malloc-free</code>,
       <DD>Lisp allocates the storage using malloc() and never deallocates it.
       The C function is supposed to call free() when done with it.
    <DT>If <var>allocation</var> is <code>:alloca</code>,
       <DD>Lisp allocates the storage on the stack, with dynamic extent. It is
       freed when the C function returns.
    <DT>If <var>allocation</var> is <code>:none</code>,
       <DD>Lisp assumes that the pointer already points to a valid area of the
       proper size and puts the result value there. This is dangerous! and
       deprecated.
    </DL>
  <DT>For results passed from C to Lisp:<DD>
    <DL>
    <DT>If <var>allocation</var> is <code>:malloc-free</code>,
       <DD>Lisp calls free() on it when done.
    <DT>If <var>allocation</var> is <code>:none</code>,
       <DD>Lisp does nothing.
    </DL>
  </DL>
<DT>For call-in functions:<DD>
  <DL>
  <DT>For arguments passed from C to Lisp:<DD>
    <DL>
    <DT>If <var>allocation</var> is <code>:malloc-free</code>,
       <DD>Lisp calls free() on it when done.
    <DT>If <var>allocation</var> is <code>:alloca</code> or <code>:none</code>,
       <DD>Lisp does nothing.
    </DL>
  <DT>For results passed from Lisp to C:<DD>
    <DL>
    <DT>If <var>allocation</var> is <code>:malloc-free</code>,
       <DD>Lisp allocates the storage using malloc() and never deallocates it.
       The C function is supposed to call free() when done with it.
    <DT>If <var>allocation</var> is <code>:none</code>,
       <DD>Lisp assumes that the pointer already points to a valid area of the
       proper size and puts the result value there. This is dangerous! and
       deprecated.
    </DL>
  </DL>
</DL>
<P>
A function parameter's <var>param-mode</var> may be
<DL>
<DT>either <code>:in</code> (means: read-only):
<DD>       The caller passes information to the callee.
<DT>or     <code>:out</code> (means: write-only):
<DD>       The callee passes information back to the caller on return.
       When viewed as a Lisp function, there is no Lisp argument corresponding
       to this, instead it means an additional return value.
<DT>or     <code>:in-out</code> (means: read-write):
<DD>       Information is passed from the caller to the callee and then back to
       the caller. When viewed as a Lisp function, the &quot;<code>:out</code>&quot; value is
       returned as an additional multiple value.
</DL>
The default is <code>:in</code>.

<P>[Currently, only <code>:in</code> is fully
implemented. <code>:out</code> works only with
<var>allocation</var> = <code>:alloca</code>.]
<P>
<DL>
<DT><EM>Platform dependent: Amiga platforms only.
</EM></DT>
<DD>
<var>allocation</var> may not be <code>:malloc-free</code> because there is no commonly
used <code>malloc()/free()</code> library function.

<P>The <var>allocation</var> may be followed by a register
specification, any of the symbols <code>:d0</code>, <code>:d1</code>,
<code>:d2</code>, <code>:d3</code>, <code>:d4</code>, <code>:d5</code>,
<code>:d6</code>, <code>:d7</code>, <code>:a0</code>, <code>:a1</code>,
<code>:a2</code>, <code>:a3</code>, <code>:a4</code>, <code>:a5</code>,
<code>:a6</code>, each representing one 680x0 register. This works only
for integral types: integers, pointers, <code>c-string</code>,
<code>c-function</code>.
</DD>
</DL>
<P>
Passing <code>c-struct</code>, <code>c-union</code>, <code>c-array</code>, <code>c-array-max</code> values as arguments (not via
pointers) is only possible to the extent the C compiler supports it. Most C
compilers do it right, but some C compilers (such as gcc on hppa) have
problems with this.

<H4>Examples</H4>

Ex. 1: The C declaration
<PRE>
<code>       struct foo {
           int a;
           struct foo * b[100];
       };
</code></PRE>
corresponds to
<PRE>
<code>       (def-c-struct foo
         (a int)
         (b (c-array (c-ptr foo) 100))
       )
</code></PRE>
The element access
<PRE>
<code>       struct foo f;
       f.b[7].a
</code></PRE>
corresponds to
<PRE>
<code>       (declare (type foo f))
       (foo-a (aref (foo-b f) 7)) or (slot-value (aref (slot-value f 'b) 7) 'a)
</code></PRE>
Ex. 2: Here is an example of an external C variable and some accesses:
<PRE>
<code>       struct bar {
           short x, y;
           char a, b;
           int z;
           struct bar * n;
       };

       extern struct bar * my_struct;

       my_struct-&gt;x++;
       my_struct-&gt;a = 5;
       my_struct = my_struct-&gt;n;
</code></PRE>
corresponds to
<PRE>
<code>       (def-c-struct bar
         (x short)
         (y short)
         (a char)
         (b char) ; or (b character) if it represents a character, not a number
         (z int)
         (n (c-ptr bar))
       )

       (def-c-var my_struct (:type (c-ptr bar)))

       (setq my_struct (let ((s my_struct)) (incf (slot-value s 'x)) s))
       or (incf (slot my_struct 'x))
       (setq my_struct (let ((s my_struct)) (setf (slot-value s 'a) 5) s))
       or (setf (slot my_struct 'a) 5)
       (setq my_struct (slot-value my_struct 'n))
       or (setq my_struct (deref (slot my_struct 'n)))
</code></PRE>
Ex. 3: An example for calling an external function:
On ANSI C systems, &lt;stdlib.h&gt; contains the declarations
<PRE>
<code>       typedef struct {
         int quot;   /* Quotient */
         int rem;    /* Remainder */
       } div_t;
       extern div_t div (int numer, int denom);
</code></PRE>
This translates to
<PRE>
<code>       (def-c-struct div_t
         (quot int)
         (rem int)
       )
       (def-c-call-out div (:arguments (numer int) (denom int))
                           (:return-type div_t)
       )
</code></PRE>
Sample call from within Lisp:
<PRE>
<code>       &gt; (div 20 3)
       #S(DIV :QUOT 6 :REM 2)
</code></PRE>
Ex. 4: Another example for calling an external function:
<P>
Suppose the following is defined in a file <code>&quot;cfun.c&quot;</code>:
<PRE>
<code>       struct cfunr { int x; char *s; };
       struct cfunr * cfun (i,s,r,a)
           int i;
           char *s;
           struct cfunr * r;
           int a[10];
       {
           int j;
           struct cfunr * r2;
           printf(&quot;i = %d\n&quot;, i);
           printf(&quot;s = %s\n&quot;, s);
           printf(&quot;r-&gt;x = %d\n&quot;, r-&gt;x);
           printf(&quot;r-&gt;s = %s\n&quot;, r-&gt;s);
           for (j = 0; j &lt; 10; j++) printf(&quot;a[%d] = %d.\n&quot;, j, a[j]);
           r2 = (struct cfunr *) malloc (sizeof (struct cfunr));
           r2-&gt;x = i+5;
           r2-&gt;s = &quot;A C string&quot;;
           return r2;
       }
</code></PRE>
It is possible to call this function from Lisp using the file <code>&quot;callcfun.lsp&quot;</code>
(don't call it <code>&quot;cfun.lsp&quot;</code> - <code>compile-file</code> would overwrite <code>&quot;cfun.c&quot;</code>) whose
contents is:
<PRE>
<code>       (in-package &quot;TEST-C-CALL&quot; :use '(&quot;LISP&quot; &quot;FFI&quot;))
       (def-c-struct cfunr (x int) (s c-string))
       (def-c-call-out cfun (:arguments (i int)
                                        (s c-string)
                                        (r (c-ptr cfunr) :in :alloca)
                                        (a (c-ptr (c-array int 10)) :in :alloca)
                            )
                            (:return-type (c-ptr cfunr))
       )
       (defun call-cfun ()
         (cfun 5 &quot;A Lisp string&quot; (make-cfunr :x 10 :s &quot;Another Lisp string&quot;)
               '#(0 1 2 3 4 5 6 7 8 9)
       ) )
</code></PRE>
Use the module facility:
<PRE>
<code>       $ clisp-link create-module-set cfun callcfun.c
       $ cc -O -c cfun.c
       $ cd cfun
       $ ln -s ../cfun.o cfun.o
       Add cfun.o to NEW_LIBS and NEW_FILES in link.sh.
       $ cd ..
       $ base/lisp.run -M base/lispinit.mem -c callcfun.lsp
       $ clisp-link add-module-set cfun base base+cfun
       $ base+cfun/lisp.run -M base+cfun/lispinit.mem -i callcfun
       &gt; (test-c-call::call-cfun)
       i = 5
       s = A Lisp string
       r-&gt;x = 10
       r-&gt;s = Another Lisp string
       a[0] = 0.
       a[1] = 1.
       a[2] = 2.
       a[3] = 3.
       a[4] = 4.
       a[5] = 5.
       a[6] = 6.
       a[7] = 7.
       a[8] = 8.
       a[9] = 9.
       #S(TEST-C-CALL::CFUNR :X 10 :S &quot;A C string&quot;)
       &gt;
       $ rm -r base+cfun
</code></PRE>
Note that there is a memory leak here: The return value <code>r2</code> of <code>cfun()</code> is
<code>malloc()</code>ed but never <code>free()</code>d. Specifying
<PRE>
<code>       (:return-type (c-ptr cfunr) :malloc-free)
</code></PRE>
is not an alternative because this would also <code>free(r2-&gt;x)</code> but <code>r2-&gt;x</code> is a
pointer to static data.
<P>
Ex. 5: To sort an array of double-floats using the Lisp function <code>sort</code>
instead of the C library function <code>qsort()</code>, one can use the following
interface code <code>&quot;sort1.c&quot;</code>. The main problem is to pass a variable-sized array.
<PRE>
<code>       extern void lispsort_begin (int);
       void* lispsort_function;
       void lispsort_double (int n, double * array)
       {
           double * sorted_array;
           int i;
           lispsort_begin(n); /* store #'sort2 in lispsort_function */
           sorted_array = ((double * (*) (double *)) lispsort_function) (array);
           for (i = 0; i &lt; n; i++) array[i] = sorted_array[i];
           free(sorted_array);
       }
</code></PRE>
This is accompanied by <code>&quot;sort2.lsp&quot;</code>:
<PRE>
<code>       (use-package &quot;FFI&quot;)
       (def-call-in lispsort_begin (:arguments (n int))
                                   (:return-type nil)
                                   (:language :stdc)
       )
       (def-c-var lispsort_function (:type c-pointer))
       (defun lispsort_begin (n)
         (setf (cast lispsort_function
                     `(c-function
                        (:arguments (v (c-ptr (c-array double-float ,n))))
                        (:return-type (c-ptr (c-array double-float ,n))
                                      :malloc-free
                      ) )
               )
               #'sort2
       ) )
       (defun sort2 (v)
         (declare (type vector v))
         (sort v #'&lt;)
       )
</code></PRE>
To test this, use the following test file <code>&quot;sorttest.lsp&quot;</code>:
<PRE>
<code>       (def-call-out sort10
                     (:name &quot;lispsort_double&quot;)
                     (:language :stdc)
                     (:arguments (n int)
                                 (array (c-ptr (c-array double-float 10))
                                        :in-out
       )             )           )
</code></PRE>
Now try
<PRE>
<code>       $ clisp-link create-module-set sort sort2.c sorttest.c
       $ cc -O -c sort1.c
       $ cd sort
       $ ln -s ../sort1.o sort1.o
       Add sort1.o to NEW_LIBS and NEW_FILES in link.sh.
       $ cd ..
       $ base/lisp.run -M base/lispinit.mem -c sort2.lsp sorttest.lsp
       $ clisp-link add-module-set sort base base+sort
       $ base+sort/lisp.run -M base+sort/lispinit.mem -i sort2 sorttest
       &gt; (sort10 10 '#(0.501d0 0.528d0 0.615d0 0.550d0 0.711d0
                       0.523d0 0.585d0 0.670d0 0.271d0 0.063d0))
       #(0.063d0 0.271d0 0.501d0 0.523d0 0.528d0 0.55d0 0.585d0 0.615d0 0.67d0 0.711d0)
       $ rm -r base+sort
</code></PRE>
<!-- #endif -->

<!-- #ifdef HAVE_AFFI -->
<a name="affi">
<H3>Extensions-3.5. The Amiga Foreign Function Call Facility</H3></a>

<EM>Platform dependent: Amiga platforms only.</EM>

<H4>Another Foreign Function Interface</H4>

<p>All symbols relating to the simple foreign function interface are
exported from the package <code>AFFI</code>. To use them,
<code>(use-package &quot;AFFI&quot;)</code>.

<H4>Design issues</H4>

<p>AFFI was designed to be small in size but powerful enough to use most
library functions. Lisp files may be compiled to <code>.fas</code> files
without the need to load function definition files at run-time and
without external C or linker support. Memory images can be created,
provided that the function libraries are opened at run-time.

<P>Therefore, AFFI supports only primitive C types (integers 8, 16 and
32 bits wide, signed or unsigned, pointers) and defines no new types or
classes.  Foreign functions are not first-class objects (you can define
a lambda yourself), name spaces are separate.

<P>The AFFI does no tracking of resources. Use <code>finalize</code>.

<H4>Overview</H4>

<p>These are the AFFI forms:

<P><code>(declare-library-base <var>keyword-base</var>
<var>library-name</var>)</code>

<P><code>(require-library-functions <var>library-name</var> [(:import
{<var>string-name</var>}*))</code>

<P><code>(open-library <var>base-symbol</var>)</code>

<P><code>(clos-library <var>base-symbol</var>)</code>

<P><code>(with-open-library (<var>base-symbol</var> |
<var>library-name</var>) {<var>form</var>}*)</code>

<P><code>(defflibfun <var>function-name</var> <var>base-symbol</var>
<var>offset</var> <var>mask</var> <var>result-type</var>
{<var>argument-type</var>}*)</code>

<P><code>(declare-library-function <var>function-name</var>
<var>library-name</var> {<var>option</var>}*)</code>

<P><code>(flibcall <var>function-name</var>
{<var>argument</var>}*)</code>

<P><code>(mlibcall <var>function-name</var>
{<var>argument</var>}*)</code>

<P><code>(mem-read <var>address</var> <var>result-type</var>
[<var>offset</var>])</code>

<P><code>(mem-write <var>address</var> <var>type</var> <var>value</var>
[<var>offset</var>])</code>

<P><code>(mem-write-vector <var>address</var> <var>vector</var>
[<var>offset</var>])</code>

<P><code>(nzero-pointer-p <var>value</var>)</code>

<P>Except for <code>with-open-library</code>,
<code>declare-library-function</code> and <code>mlibcall</code>, all of
the above are functions.

<P>A library contains a collection of functions. The library is referred
to by a symbol referred as library-base at the AFFI level. This symbol
is created in the package <code>AFFI</code>. The link between this
symbol and the OS-level library name is established by
<code>declare-library-base</code>. To avoid multiple package conflicts,
this and only this function requires the symbol-name to be in the
<code>KEYWORD</code> package. The function returns the library-base.

<P>A library may be opened by <code>open-library</code> and closed by
<code>close-library</code>. An opened library must be
closed. <code>with-open-library</code> is provided to automatically
close the library for you, thus it's much safer to use.

<P>A function is contained in a library. Every function is referred to
by a symbol. A function is defined through <code>defflibfun</code> or
<code>declare-library-function</code> by giving the function name, the
library-base, an offset into the library, a mask (or <code>nil</code>)
for register-based library calls, the result type and all
parameter-types.  <code>require-library-functions</code> loads the
complete set of functions defined in a library file. Symbols are created
in the package <code>AFFI</code> and imported into the current package.

<P><code>flibcall</code> and <code>mlibcall</code> call library
functions. <code>mlibcall</code> is a macro that does a few cheks at
macroexpansion time and allows the compiler to inline the call, not
requiring the foreign function to be defined again at load or execution
time. The use of this macro is advertised wherever possible.

<P><code>mem-read</code> reads an arbitrary address (with offset for
structure references) and returns the given type.

<P><code>mem-write</code> writes an arbitrary
address. <code>mem-write-vector</code> copies the content of a Lisp
string or unsigned-byte vector into memory.

<P><code>nzero-pointer-p</code> tests for non-<code>NULL</code> pointers
in all recognized representations (<code>null</code>,
<code>unsigned-byte</code> and <code>foreign-pointer</code>).


<H4>Foreign Libraries</H4>

<p><code>declare-library-base</code> ought to be wrapped in an
<code>eval-when (compile eval load)</code> form and come before any
function is referenced, because the library base symbol must be known.

<P><code>open-library</code> tries to open the library referenced by the
base symbol.  Therefore it must have been preceeded with
<code>declare-library-base</code>. The call returns <code>nil</code> on
failure. <code>open-library</code> calls nest. Every successful call
must be matched by
<code>close-library</code>. <code>with-open-library</code> does this for
you and also allows you to specify the library by name, provided that
its base has been declared. It is recommended to use this macro and to
reference the library by name.

<P>CLISP will not close libraries for you at program exit. [A previous
version did so but now AFFI is a module and there are no module exit
functions.]  Programmers, watch <code>affi::*libraries-alist*</code>.


<H4>(Foreign) C types</H4>

<p>The following foreign C types are used in AFFI. They are <EM>not</EM>
regular Common Lisp types or CLOS classes.

<P>
<TABLE BORDER=1>
<TR> <TH>AFFI name     <TH>Lisp equiv              <TH>C equiv     <TH>Comment
<TR>  <TD><code>nil</code>           <TD><code>nil</code>                     <TD><code>void</code>            <TD>as a result type for functions only
<TR>  <TD><code>4</code>             <TD><code>(unsigned-byte 32)</code>      <TD><code>unsigned long</code>
<TR>  <TD><code>2</code>             <TD><code>(unsigned-byte 16)</code>      <TD><code>unsigned short</code>
<TR>  <TD><code>1</code>             <TD><code>(unsigned-byte 8)</code>       <TD><code>unsigned char</code>
<TR>  <TD><code>-4</code>            <TD><code>(signed-byte 32)</code>        <TD><code>long</code>
<TR>  <TD><code>-2</code>            <TD><code>(signed-byte 16)</code>        <TD><code>short</code>
<TR>  <TD><code>-1</code>            <TD><code>(signed-byte 8)</code>         <TD><code>signed char</code>
<TR>  <TD><code>0</code>             <TD><code>boolean</code>                 <TD><code>BOOL</code>          <TD>as a result type for functions only
<TR>  <TD><code>*</code>             <TD>opaque                  <TD><code>void*</code>
<TR>  <TD><code>:external</code>     <TD>opaque                  <TD><code>void*</code>
<TR>  <TD><code>string</code>        <TD><code>string</code> or <code>vector</code>        <TD><code>char*</code>
<TR>  <TD><code>:io</code>           <TD><code>string</code> or <code>vector</code>        <TD><code>char*</code>
</TABLE>

<P>Objects of type <code>string</code> are copied and passed
NUL-terminated on the execution stack.  On return, a Lisp string is
allocated and filled from the address returned (unless NULL). Functions
with <code>:io</code> parameters are passed the address of the Lisp
string or unsigned byte vector. These are not NUL-terminated!  This is
useful for functions like like <code>read()</code> which do not need an
array at a constant address longer than the dynamic extent of the call
(it is dangerous to define callback functions with <code>:io</code> (or
<code>string</code>) type parameters). Arguments of type
<code>integer</code> and <code>foreign-pointer</code> are always
acceptable where a <code>string</code> or <code>:io</code> type is
specified.

<P>To meet the design goals, predefined types and objects were used. As
such, pointers were represented as integers. Now that there is the
<code>foreign-pointer</code> type, both representations may be used on
input. The pointer type should be therefore considered as opaque. Use
<code>nzero-pointer-p</code> for NULL tests.


<H4>Foreign functions</H4>

<p>Foreign Functions are declared either through <code>defflibfun</code>
or<code>declare-library-function</code>. The former is closer to the
low-level implementation of the interface, the latter is closer to the
other FFI.

<P><code>defflibfun</code> requires the library base symbol and register
mask to be specified, <code>declare-library-function</code> requires the
library name and computes the mask from the declaration of the
arguments.

<P>The value of mask is implementation-dependent. On the Amiga, it's an
integer whose hexadecimal value is the reverse of the function argument
register numbers, where d0 has number <code>1</code> and a6 number
<code>#xF</code>. A <code>nil</code> mask is reserved for stack-based
calls (unimplemented).

<P>The AFFI type <code>0</code> is only acceptable as a function result
type and yields either <code>t</code> or <code>nil</code>. The
difference between <code>*</code> and <code>:external</code> is the
following: <code>*</code> uses integers, <code>:external</code> uses
<code>foreign-pointer</code> as function result-type (except from
<code>nil</code> for a NULL pointer) and refuses objects of type
<code>string</code> or unsigned byte vector as input. Thus
<code>:external</code> provides some security on the input and the
ability to use <code>finalize</code> for resource-tracking on the output
side.

<P><code>(declare-library-function <var>name</var>
<var>library-name</var> {<var>option</var>}*)</code>

<P>
<TABLE>
<TR><TD>  <var>option</var> ::=
<TR><TD ALIGN=RIGHT>      <TD><code>(:offset <var>library-offset</var>)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:arguments {(<var>arg-name</var> <var>AFFI-type</var> <var>register</var>)}*)</code>
<TR><TD ALIGN=RIGHT>    | <TD><code>(:return-type <var>AFFI-type</var>)</code>
</TABLE>
<TABLE>
<TR>  <TD><var>register</var> ::= <TD> <code>:d0</code> | <code>:d1</code> | ... | <code>:d7</code> | <code>:a0</code> | ... | <code>:a6</code>
</TABLE>
declares a named library funtion for further reference through
<code>flibcall</code> and <code>mlibcall</code>.

<P><code>mlibcall</code> should be the preferred way of calling foreign
functions (when they are known at compile-time) as macroexpansion-time
checks may be performed and the call can be sort of inlined.


<H4>Memory access</H4>

<p><code>(mem-read <var>address</var> <var>type</var>
<var>offset</var>)</code> can read 8, 16 and 32 bit signed or
unsignedintegers (AFFI types <code>-4</code>, <code>-2</code>,
<code>-1</code>, <code>1</code>, <code>2</code>, <code>4</code>), a
pointer (<code>*</code>), a NUL-terminated string (<code>string</code>)
or, if the type argument is of type <code>string</code> or unsigned byte
vector, it can fill this vector. <code>:external</code> is not an
acceptable type as no object can be created by using
<code>mem-read</code>.

<P><code>(mem-write <var>address</var> <var>type</var> <var>value</var>
[<var>offset</var>])</code> writes integers (AFFI type <code>-4</code>,
<code>-2</code>, <code>-1</code>, <code>1</code>, <code>2</code> and
<code>4</code>) or pointer values (type <code>*</code>), but not vectors
to the specified memory address.

<P><code>(mem-write-vector <var>address</var> <var>vector</var>
[<var>offset</var>])</code> can write memory from the given vector (of
type <code>string</code> or unsigned byte vector).


<H4>Function Definition Files</H4>

<p><code>require-library-functions</code> will <code>require</code> a
file of name derived from thelibrary name and with type
<code>&quot;affi&quot;</code>. It may be used to import all names into
the current package or only a given subset identified by string names,
using the <code>:import</code> keword (recommended use). Some definition
files for standard Amiga libraries are provided. See example 1 below.

<P>As <code>require-library-functions</code> loads a global file which
you, the programmer, may have not defined, you may consider declaring
every function yourself to be certain what the return and argument types
are. See example 4 below.

<P>The file <code>read-fd.lsp</code> defines the function
<code>make-partial-fd-file</code> with which the provided
<code>&quot;.affi&quot;</code> files have been prepared from the
original Amiga FD files (located in the directory
<code>FD:</code>). They must still be edited as the function cannot know
whether a function accepts a <code>*</code>, <code>:io</code>,
<code>string</code> or <code>:external</code> argument and because files
in <code>FD:</code> only contain a register specification, not the width
of integer arguments (<code>-4</code>, <code>-2</code>, <code>-1</code>,
<code>1</code>, <code>2</code>, or <code>4</code>).


<H4>Hints</H4>

<p>By using appropriate <code>eval-when</code> forms for
<code>declare-library-base</code>
and<code>require-library-functions</code> and not using
<code>flibcall</code>, it is possible to write code that only loads
library function definition files at compile-time. See example 1 below.

<P>Do not rely on <code>finalize</code> to free resources for you, as
CLISP does not call finalizers when it exits, use
<code>unwind-protect</code>.


<H4>Caveats</H4>

<p>You can consider the library bases being symbols in need of being
importedfrom the package AFFI originating from a brain-damage, causing
the usual symbol headaches when using foreign functions calls within
macros. Luckily, even if the high-level interface (or its implementation
in <code>affi1.lsp</code>) were to change, the low-level part
(<code>affi.d</code>) should remain untouched as all it knows are
integers and foreign-pointers, no symbols. The difficulty is just to get
the library base value at run-time. Feel free to suggest enhancements to
this facility!


<H4>Examples</H4>

<p>NB: These examples are somewhat specific to the Amiga.

<P>1. Using a predefined library function file
<PRE>
<code>(use-package &quot;AFFI&quot;)

;; SysBase is the conventional name for exec.library
;; It is only enforced by the file loaded by REQUIRE-LIBRARY-FUNCTIONS
(eval-when (compile eval load)
  (declare-library-base :SysBase &quot;exec.library&quot;)) ;keyword avoids name conflicts

;; using only MLIBCALL allows not to load definitions at load-time
(eval-when (compile eval)
  (require-library-functions &quot;exec.library&quot;
    :import '(&quot;FindTask&quot;)))

(with-open-library (&quot;exec.library&quot;)
  (print (mlibcall FindTask 0)))
</code></PRE>
This file can be used in interpreted and compiled mode. Compiled, it will
have inlined the library function calls.
<P>

2. Using flibcall
<PRE>
<code>(use-package &quot;AFFI&quot;)

(eval-when (compile eval load)
  (declare-library-base :SysBase &quot;exec.library&quot;)) ;keyword avoids name conflicts

;; The load situation permits the use of flibcall
(eval-when (eval compile load)
  (require-library-functions &quot;exec.library&quot;))

(unless (open-library 'SysBase) (error &quot;No library for SysBase&quot;))
(flibcall (if t 'FindTask 'Debug) 0)
(close-library 'SysBase)
</code></PRE>
<P>

3. Be fully dynamic, defining library bases ourselves
<PRE>
<code>(use-package &quot;AFFI&quot;)

(eval-when (compile eval load)
  (defvar mylib (declare-library-base :foobase &quot;foo.library&quot;)))
(eval-when (eval compile load)          ;eval allows mlibcall, load flibcall
  (defflibfun 'foo1 mylib -30 '#xA '* 'string)
  (defflibfun 'foo2 mylib -36 '#x21 0 * 4))

(defun foo (name)
  (when (open-library mylib)
    (list (mlibcall foo1 name) (flibcall 'foo2 name 123213))
    (close-library mylib)))
</code></PRE>
<P>
4. Some sample function definitions
<PRE>
<code>(defflibfun 'FindTask 'SysBase -294 #xA '* 'string)
(declare-library-function FindTask &quot;exec.library&quot;
  (:offset -294)
  (:return-type *)
  (:arguments
   (name   string   :A1)))
(declare-library-function NameFromLock &quot;dos.library&quot;
  (:offset -402)
  (:return-type 0)
  (:arguments
   (lock   4   :D1)
   (buffer :io :D2)
   (len    4   :D3)))

(eval-when (compile eval)
  (defconstant GVF_LOCAL_ONLY (ash 1 9))
  (defflibfun 'SetVar 'DosBase -900 #x5432 0 'string 'string -4 4))
(defun setvar (name value)
  (with-open-library (DosBase)
    ;; length of -1 means find length of NUL-terminated-string
    (mlibcall SetVar name value -1 GVF_LOCAL_ONLY)))
</code></PRE>
<!-- #endif -->

<!-- #ifdef AMIGAOS -->
<a name="rexx"><H3>Extensions-3.6. ARexx</H3></a>

<EM>Platform dependent: Amiga platforms only.</EM>

<P>CLISP comes with a small yet extensible and powerful ARexx interface.

<P><code>(rexx-do-command &quot;return address()&quot; :string t :result
t)</code> <BR>tells you the name of the CLISP ARexx port. The default
extension for CLISP ARexx scripts is <code>&quot;cl&quot;</code>.

<P><code>(REXX-DO-COMMAND <var>command</var> &amp;key :string :result
:token :io :host)</code> <BR> -&gt; <code>(RC &amp;optional
<var>result</var>)</code>, or <code>nil</code> on failure

<P><code>(REXX-RUN-COMMAND <var>command</var> &amp;KEY :string
:token)</code> <BR> -&gt; <code>t</code>, or <code>nil</code> on failure

<P><code>(REXX-SEND-COMMAND <var>command</var> &amp;KEY :string :result
:token :io :host)</code> <BR> -&gt; <var>arexx-msg-handle</var>, or
<code>nil</code> on failure

<P><code>(REXX-WAIT-SENT-COMMAND <var>arexx-msg-handle</var>)</code>
<BR> -&gt; <code>(RC &amp;optional <var>result</var>)</code>, or
<code>nil</code> on failure

<P><code>(REXX-LOOP)</code> <BR> -&gt; no return, use the
<code>exit-loop.cl</code> ARexx script to abort the loop

<P><var>command</var> may be a string denoting a command with optional
arguments or a vector of strings thus denoting an ARexx function
call. The first element in the vector is the function name, the others
are the up to 15 arguments.

<P>Messages may be sent to an arbitrary ARexx host, special cases are
<code>nil</code> (meaning <code>&quot;REXX&quot;</code>, the default)
and <code>t</code> (<code>&quot;AREXX&quot;</code> for asynchronouns
execution).

<P>ARexx server mode: Like Ispell, Csh and SKsh, you can run it in
server mode by calling <code>(rexx-loop)</code>. You can then only exit
with the ARexx <code>exit-loop.cl</code> script.

<P>Restrictions: Currently CLISP is not able to wait for input from
several sources, e.g. both a console and ARexx, at the same time.
<!-- #endif -->

<!-- #ifdef GRAPHICS -->
<a name="graphics"><H3>Extensions-3.7. Graphics Primitives</H3></a>

<EM>Platform dependent: Linux/x86, DOS, OS/2 platforms only.</EM>

<P>In CLISP 1994-01-07 or newer,

<UL>
<LI>DOS version,
<LI>Linux version, installed setuid root,
</UL>
there are some pixel graphics primitives in the <code>SYSTEM</code>
package.  They operate on a VGA card.

<P>Similar pixel graphics primitives can be used in the
<UL>
<LI>Unix version running under X11
</UL>
by use of the small <code>xterm</code> package available on
<code>ftp2.cons.org</code>.
<P>
This is the description of the PC/VGA graphics primitives:
<P>
<DL>
<DT>
<code>(system::<STRONG>graph-init</STRONG> [<var>width</var>
       [<var>height</var> [<var>colors</var>]]])</code>
<DD>
initializes the graphics system. The <var>width</var>, <var>height</var>
parameters are hints for the size of the desired graphics screen
(positive integers). The <var>colors</var> parameter is a hint for the
number of colors. The actual width, height is implementation dependent,
currently up to 640x480 on VGA cards and up to 1024x768 on ET4000 SVGA
cards.  Returns an alist <code>((<var>color-value</var>
<var>color-keyword</var>) ...)</code> which lists the available colors
and their numerical equivalents.
<DT>
<code>(system::<STRONG>graph-show</STRONG>)</code>
<DD>
switches the graphics hardware so that the graphics screen is
visible. The text screen is activated on any text output.
<DT>
<code>(system::<STRONG>graph-clear</STRONG> [<var>color</var>])</code>
<DD>
fills the entire graphics screen with a single color.
<DT>
<code>(system::<STRONG>graph-dims</STRONG>)</code>
<DD>
returns two values: the actual width and the actual height of the graphics
screen (in pixels).
<BR>
If <code>(system::graph-dims)</code> returns the values <var>w</var> and
<var>h</var>, then valid screen coordinates are pairs <var>(x,y)</var>
with 0 &lt;= <var>x</var> &lt; <var>w</var> and 0 &lt;= <var>y</var>
&lt; <var>h</var>. <var>x</var>=0 denotes the left edge, <var>y</var>=0
the top edge.
<DT>
<code>(system::<STRONG>graph-dot</STRONG> <var>x</var> <var>y</var>)</code>
<DD>
returns the color of the pixel <var>(x,y)</var>.
<DT>
<code>(system::<STRONG>graph-dot</STRONG> <var>x</var> <var>y</var>
       <var>color</var>)</code>
<DD>
sets the color of the pixel <var>(x,y)</var> to <var>color</var>.
<DT>
<code>(system::<STRONG>graph-box</STRONG> <var>x<SUB>1</SUB></var>
       <var>y<SUB>1</SUB></var> <var>x<SUB>2</SUB></var>
       <var>y<SUB>2</SUB></var> <var>color</var>)</code>
<DD>
draws a box (= filled rectangle) in color <var>color</var>, the vertices
being the pixels
<TABLE>
<TR> <TD><var>(x<SUB>1</SUB>,y<SUB>1</SUB>)</var>
     <TD><var>(x<SUB>2</SUB>,y<SUB>1</SUB>)</var>
<TR> <TD><var>(x<SUB>1</SUB>,y<SUB>2</SUB>)</var>
     <TD><var>(x<SUB>2</SUB>,y<SUB>2</SUB>)</var>
</TABLE>
<DT>
<code>(system::<STRONG>graph-line</STRONG> <var>x<SUB>1</SUB></var>
       <var>y<SUB>1</SUB></var> <var>x<SUB>2</SUB></var>
       <var>y<SUB>2</SUB></var> <var>color</var>)</code>
<DD>
Draws a line in color <var>color</var> from pixel
<var>(x<SUB>1</SUB>,y<SUB>1</SUB>)</var> to pixel
<var>(x<SUB>2</SUB>,y<SUB>2</SUB>)</var>.
<DT>
<code>(system::<STRONG>graph-text</STRONG> <var>x</var> <var>y</var>
       <var>dir</var> <var>string</var> <var>color</var>)</code>
<DD>
Paints the text contained in <var>string</var>, starting at
<var>(x,y)</var>, in color <var>color</var>, and returns as values the
end coordinates <var>(x,y)</var>. <var>dir</var> is the direction: 0
goes to the right, 90 vertically up, 180 to the left, 270 vertically
down.
</DL>
<P>
This specification is subject to change.

<!-- #endif -->

<!-- #ifdef SOCKET_STREAMS -->
<a name="socket"><H3>Extensions-3.8. Socket Streams</H3></a>

<EM>Platform dependent: UNIX, Win32 platforms only.</EM>

<DL>
<DT>
<code>(<STRONG>socket-server</STRONG> [<var>port-or-socket</var>])</code>
<DD>
This function creates a socket, and binds a port the socket, and then
listens for connect attempts.  The server exists to watch for client
connect attempts.  The optional argument is either a port (positive
fixnum) or a socket-stream (from whose peer the connections will be
made).
<DT>
<code>(<STRONG>socket-server-close</STRONG> <var>socket-server</var>)</code>
<DD>
Closes down the server socket.
<DT>
<code>(<STRONG>socket-server-port</STRONG> <var>socket-server</var>)</code>
<DD>
Returns the port which was bound using <code>socket-server</code>.
<DT>
<code>(<STRONG>socket-wait</STRONG> <var>socket-server</var>
       [<var>seconds</var> [<var>microseconds</var>]])</code>
<DD>
Given time argument(s), waits for (possibly zero) fixed duration for a
connect on the socket-server.  Without an argument,
<code>socket-wait</code> blocks indefinitely.
<DT>
<code>(<STRONG>socket-accept</STRONG> <var>socket-server</var>
       [:element-type] [:external-format] [:buffered])</code>
<DD>
Creates the server-side two-way stream for the connection.
<DT>
<code>(<STRONG>socket-connect</STRONG> <var>port</var> [<var>host</var>]
       [:element-type] [:external-format] [:buffered])</code>
<DD>
Attempts to create a client-side two-way stream.  Blocks until
the server accepts the connections.
<DT>
<code>(<STRONG>socket-stream-host</STRONG> <var>socket-stream</var>)</code>
<DT>
<code>(<STRONG>socket-stream-port</STRONG> <var>socket-stream</var>)</code>
<DD>
These two functions return information about the
socket stream.  For a server, <code>socket-stream-host</code>
returns <code>nil</code>.
<DT>
<code>(<STRONG>socket-service-port</STRONG>
       &quot;<var>service-name</var>&quot;)</code>
<DD>
A convenience function for looking up a port given the service name.
<DT>
<code>(<STRONG>socket-stream-peer</STRONG> <var>socket-stream</var>)</code>
<DD>
Given a stream, this function returns the name of the host on the
opposite side of the connection and its port number; the server-side can
use this to see who connected.
</DL>
<DT>
<code>(<STRONG>socket-stream-local</STRONG> <var>socket-stream</var>)</code>
<DD>
The dual to <code>socket-stream-peer</code> - same information, host
name and port number, but for the local host.
</DL>
<!-- #endif -->

<!-- #ifdef UNIX -->
<a name="script"><H3>Extensions-3.9. CLISP as a script interpreter</H3></a>

<EM>Platform dependent: UNIX platforms only.</EM>
<P>
On Unix, a script can be made executable by adding a first line of the form
<PRE>
<code>#!<var>interpreter</var> [<var>interpreter-args</var>]
</code></PRE>
and <code>chmod</code>ing the script to be executable. CLISP can be used
as a script interpreter under the following circumstances:
<OL>
<LI>The <var>interpreter</var> must be a full pathname of CLISP. I
   recommend using <code>/usr/local/bin/clisp</code>, and if CLISP is
   actually installed elsewhere, letting
   <code>/usr/local/bin/clisp</code> be a symbolic link to the real
   CLISP.
<P>
<LI>The CLISP <var>interpreter</var> must be a real executable, not a
   script.  Unfortunately, in the binary distributions of CLISP on
   Solaris, <code>clisp</code> is a shell script because a C compiler
   cannot be assumed to be installed on this platform. If you have a C
   compiler installed, build CLISP from source yourself;
   &quot;<code>make install</code>&quot; will install <code>clisp</code>
   as a real executable.
<P>
<LI>On some platforms, the first line
   &quot;<code>#!<var>interpreter</var>
   [<var>interpreter-args</var>]</code>&quot; is limited in length:
   <UL>
         <LI>max. 32 characters on SunOS 4,
         <LI>max. 80 characters on HP-UX,
         <LI>max. 127 characters on Linux.
   </UL>
   Characters exceeding this limit are simply cut off by the system.
   At least 128 characters are accepted on Solaris, IRIX, AIX, OSF/1.
   There is no workaround: You have to keep the interpreter pathname
   and arguments short.
<P>
<LI>On Solaris and HP-UX, only the first <var>interpreter-arg</var> is
   passed to the <var>interpreter</var>. In order to pass more than one
   option (for example, &quot;<code>-Msomewhere.mem</code>&quot; and
   &quot;<code>-C</code>&quot;) to <code>clisp</code>, separate them by
   hard spaces (ISO Latin-1 character 160) instead of normal
   spaces. (But the separator between <var>interpreter</var> and
   <var>interpreter-args</var> must still be a normal space!) CLISP will
   split the <var>interpreter-args</var> at hard spaces and at normal
   spaces.
</OL>
<P>The script should contain Lisp forms, except in the #! line. The file
is normally loaded, through the function <code>load</code>. Before it is
loaded, the variable <code>*args*</code> is bound to a list of strings,
representing the arguments given to the Lisp
script. <code>*standard-input*</code> and <code>*standard-output*</code>
are bound, as usual, to the Unix standard input and
output. <code>*error-output*</code> is bound to the Unix error
output. Continuable errors will be turned to warnings. Non-continuable
errors and Ctrl-C interrupts will terminate the execution of the Lisp
script with error status.

<!-- #endif -->

<a name="shell"><H3>Extensions-3.10. Shell</H3></a>

<!-- #ifdef HAVE_SHELL -->
<DL>
 <DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Amiga, Acorn
 platforms only.</EM></DT>
  <DD><code>(<STRONG>shell</STRONG> [<var>command</var>])</code>  calls
   the operating system's shell. <code>(shell)</code> calls the shell
   for interactive use. <code>(shell <var>command</var>)</code> calls the
   shell only for execution of the one given <var>command</var>.
</DL>
<!-- #endif -->
<!-- #ifdef PIPES2 -->
<DL>
 <DT><EM>Platform dependent: UNIX, OS/2, Win32 platforms only.</EM></DT>
  <DD>The functions <code><STRONG>run-shell-command</STRONG></code> and
   <code><STRONG>run-program</STRONG></code> are a general interface to
   <code>shell</code> and the above:
   <P><code>(run-shell-command <var>command</var> [:input] [:output]
   [:if-output-exists])</code> runs a shell command.
   <P><code>(run-program <var>program</var> [:arguments] [:input]
   [:output] [:if-output-exists])</code> runs an external program.
<DL>
<DT>The <var>command</var> argument     <DD>specifies the shell command.
<!-- #ifdef UNIX -->
 <DL>
  <DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
  <DD>The shell the command is passed to is the value of the environment
   variable <code>SHELL</code>, which normally is
   <code>/bin/sh</code>. The command should be a ``simple command''; a
   ``command list'' should be enclosed in &quot;{ ... ; }&quot; (for
   <code>/bin/sh</code>) or &quot;( ... )&quot; (for
   <code>/bin/csh</code>).
  </DD>
 </DL>
<!-- #endif -->
 <DT>The <var>program</var> argument
  <DD>specifies the program. The directories listed in the
   <code>PATH</code> environment variable will be searched for it.
 <DT>The <code>:arguments</code> argument
  <DD>specifies a list of arguments (strings) that are given to the program.
 <DT>The <code>:input</code> argument
  <DD>specifies where the program's input is to come from: either
   <code>:terminal</code> (the standard input) or <code>:stream</code>
   (a Lisp stream to be created) or a pathname (an input file) or
   <code>nil</code> (no input at all).
 <DT>The <code>:output</code> argument
  <DD>specifies where the program's output is to be sent to: either
   <code>:terminal</code> (the standard output) or <code>:stream</code>
   (a Lisp stream to be created) or a pathname (an output file) or
   <code>nil</code> (ignore the output).
 <DT>The <code>:if-output-exists</code> argument
  <DD>specifies what to do if the <code>:output</code> file already
   exists. The possible values are <code>:overwrite</code>,
   <code>:append</code>, <code>:error</code>, with the same meaning as for
   <code>open</code>.
 </DL>
If <code>:stream</code> was specified for <code>:input</code> or
<code>:output</code>, a Lisp stream is returned.  If
<code>:stream</code> was specified for <code>:input</code> and
<code>:output</code>, three Lisp streams are returned, as for the
function <code>make-pipe-io-stream</code>. This use of
<code>run-program</code> can cause deadlocks, see
<code>make-pipe-io-stream</code>.
</DL>
<!-- #endif -->


<!-- #ifdef AMIGAOS -->
<a name="other"><H3>Extensions-3.11. Other</H3></a>

<DL>
<DT><EM>Platform dependent: Amiga platforms only.
</EM></DT>
<DD>
To have <code>*debug-io*</code> and <code>*error-output*</code> point to
separate console windows (thus keeping your standard console window
clean from error messages) you can use
<PRE>
<code>  (setq *error-output*
    (setq *debug-io*
      (open &quot;CON:0/0/500/300/CLISP-Debugger/AUTO/CLOSE&quot; :direction :io)
  ) )
</code></PRE>
at startup.

</DD>
</DL>
<!-- #endif -->
<!-- #endif -->

<H2>Authors</H2>

<TABLE>
<TR> <TD> <TD>Bruno Haible                  <TD> <TD> <TD>Michael Stoll
<TR> <TD> <TD>17, rue Danton                <TD> <TD> <TD>Westerwaldweg 22
<TR> <TD>F - <TD>94270 Le Kremlin-Bic&ecirc;tre<TD WIDTH=50>  <TD>D - <TD>53424 Remagen-Oberwinter
<TR> <TD> <TD>France                        <TD> <TD> <TD>Germany
</TABLE>

<H2>Maintainers</H2>
<UL>
  <LI><address>haible@clisp.cons.org</address>
  <LI><address>sds@gnu.org</address>
</UL>

<HR>

<h3>CLISP implementation notes</h3>
<a href="mailto:haible@clisp.cons.org">Bruno Haible</a><br>
<a href="mailto:sds@gnu.org">Sam Steingold</a>
<p>

</body>
</html>
