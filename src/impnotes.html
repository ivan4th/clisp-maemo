<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 //EN">
<HTML>
<HEAD>
<TITLE>CLISP implementation notes</TITLE>
<META NAME="author" CONTENT="Bruno Haible">
<META NAME="keywords" CONTENT="Lisp, Common Lisp, CLISP">
</HEAD>

<!-- TODO: Add table of contents -->
<!-- TODO: Add symbol index -->
<!-- TODO: Add references to CLHS -->

<!-- Rules for this file:
  * All HTML commands appear in uppercase.
  * Use only HTML 3.2 commands which work in a large range of browsers.
  * Literal symbols are written in <CODE>...</CODE> font, in lowercase.
  * At the definition point of a symbol, this symbol is written in
    <STRONG>...</STRONG> face.
  * Platform depencencies are emphasized like this:
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Amiga, Acorn platforms only.
</EM></DT>
<DD>
...
</DD>
</DL>
-->

<BODY>
<H1 ALIGN=CENTER>Implementation Notes for CLISP</H1>

<H4 ALIGN=CENTER>Last modified: 15 September 1997.</H4>
<CENTER>
<IMG SRC="clisp.gif">
</CENTER>
<P>

This implementation is mostly compatible to the standard reference
<P>
<BLOCKQUOTE>
<CITE>
       Guy L. Steele Jr.: Common Lisp - The Language (1st ed.).<BR>
       Digital Press 1984, 465 pages.<BR>
       (&quot;CLtL1&quot; for short)
</CITE>
</BLOCKQUOTE>
<P>
and to the older parts of
<P>
<BLOCKQUOTE>
<CITE>
       Guy L. Steele Jr.: Common Lisp - The Language (2nd ed.).<BR>
       Digital Press 1990, 1032 pages.<BR>
       (&quot;CLtL2&quot; for short)
</CITE>
       <A HREF="http://www.cs.cmu.edu/afs/cs.cmu.edu/project/ai-repository/ai/html/cltl/cltl2.html">http://www.cs.cmu.edu/afs/cs.cmu.edu/project/ai-repository/ai/html/cltl/cltl2.html</A>
</BLOCKQUOTE>
<P>

These notes document the differences of the CLISP implementation of Common
Lisp to the standard CLtL1, and some implementation details.

The differences between CLtL1 and CLtL2 are made up of X3J13 votes. CLISP's
position with respect to these votes is listed in <A HREF="../doc/cltl2.txt">cltl2.txt</A>.


<H2>Chapter 1: Introduction</H2>

No notes.


<H2>Chapter 2: Data Types</H2>

All the data types are implemented: numbers, characters, symbols, lists,
arrays, hash tables, readtables, packages, pathnames, streams, random
states, structures and functions.

<H3>2.1.3.</H3>

There are four floating point types: short-float, single-float, double-float
and long-float:
<TABLE BORDER>
  <TR> <TH>               <TH>sign    <TH>mantissa   <TH>exponent  <TH>comment
  <TR> <TH>short-float    <TD>1 bit   <TD ALIGN=CENTER>16+1 bits   <TD ALIGN=CENTER>8 bits   <TD>&nbsp;
  <TR> <TH>single-float   <TD>1 bit   <TD ALIGN=CENTER>23+1 bits   <TD ALIGN=CENTER>8 bits   <TD>CLISP uses IEEE format
  <TR> <TH>double-float   <TD>1 bit   <TD ALIGN=CENTER>52+1 bits  <TD ALIGN=CENTER>11 bits   <TD>CLISP uses IEEE format
  <TR> <TH>long-float     <TD>1 bit   <TD ALIGN=CENTER>&gt;=64 bits  <TD ALIGN=CENTER>32 bits   <TD>&nbsp;
</TABLE>
<P>
The single and double float formats are those of the IEEE standard (1981),
except that CLISP does not support features like +0, -0, +inf, -inf, gradual
underflow, NaN, etc. (Common Lisp does not make use of these features.)
<P>
Long floats have variable mantissa length, which is a multiple of 16 (or 32,
depending on the word size of the processor). The default length used when
long floats are read is given by the place <STRONG><CODE>(long-float-digits)</CODE></STRONG>. It can be
set by <CODE>(setf (long-float-digits) <VAR>nnn</VAR>)</CODE>, where <VAR>nnn</VAR> is a positive integer.

<H3>2.1.4.</H3>

Complex numbers can have a real part and an imaginary part of different
types. For example, <CODE>(sqrt -9.0)</CODE> evaluates to the number <CODE>#C(0 3.0)</CODE>, which has
a real part of exactly 0, not only 0.0 (which would mean &quot;approximately 0&quot;).
The type specifier for this is <CODE>(complex integer single-float)</CODE>, and

           <CODE>(complex <VAR>type-of-real-part</VAR> <VAR>type-of-imaginary-part</VAR>)</CODE>

in general.
The type specifier <CODE>(complex <VAR>type</VAR>)</CODE> is equivalent to <CODE>(complex <VAR>type</VAR> <VAR>type</VAR>)</CODE>.

<A NAME="2.2.">
<H3>2.2.1.</H3>

The characters are ordered according to the ASCII encoding.

<!-- #ifdef IBMPC_CHS -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2 platforms only.</EM></DT>
<DD>
More precisely, CLISP uses the IBM PC character set (code page 437):
<TABLE BORDER>
  <TR>       <TH>    <TH>$0 <TH>$1 <TH>$2 <TH>$3 <TH>$4 <TH>$5 <TH>$6 <TH>$7 <TH>$8 <TH>$9 <TH>$A <TH>$B <TH>$C <TH>$D <TH>$E <TH>$F
  <TR>       <TH>$00 <TD>** <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD> &para; <TD> &sect;
  <TR>       <TH>$10 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>** <TD>** <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$20 <TD> &nbsp; <TD> ! <TD> &quot; <TD> # <TD> $ <TD> % <TD> &amp; <TD> ' <TD> ( <TD> ) <TD> * <TD> + <TD> , <TD> - <TD> . <TD> /
  <TR>       <TH>$30 <TD> 0 <TD> 1 <TD> 2 <TD> 3 <TD> 4 <TD> 5 <TD> 6 <TD> 7 <TD> 8 <TD> 9 <TD> : <TD> ; <TD> &lt; <TD> = <TD> &gt; <TD> ?
  <TR>       <TH>$40 <TD> @ <TD> A <TD> B <TD> C <TD> D <TD> E <TD> F <TD> G <TD> H <TD> I <TD> J <TD> K <TD> L <TD> M <TD> N <TD> O
  <TR>       <TH>$50 <TD> P <TD> Q <TD> R <TD> S <TD> T <TD> U <TD> V <TD> W <TD> X <TD> Y <TD> Z <TD> [ <TD> \ <TD> ] <TD> ^ <TD> _
  <TR>       <TH>$60 <TD> ` <TD> a <TD> b <TD> c <TD> d <TD> e <TD> f <TD> g <TD> h <TD> i <TD> j <TD> k <TD> l <TD> m <TD> n <TD> o
  <TR>       <TH>$70 <TD> p <TD> q <TD> r <TD> s <TD> t <TD> u <TD> v <TD> w <TD> x <TD> y <TD> z <TD> { <TD> | <TD> } <TD> ~ <TD> 
  <TR>       <TH>$80 <TD> &Ccedil; <TD> &uuml; <TD> &eacute; <TD> &acirc; <TD> &auml; <TD> &agrave; <TD> &aring; <TD> &ccedil; <TD> &ecirc; <TD> &euml; <TD> &egrave; <TD> &iuml; <TD> &icirc; <TD> &igrave; <TD> &Auml; <TD> &Aring;
  <TR>       <TH>$90 <TD> &Eacute; <TD> &aelig; <TD> &AElig; <TD> &ocirc; <TD> &ouml; <TD> &ograve; <TD> &ucirc; <TD> &ugrave; <TD> &yuml; <TD> &Ouml; <TD> &Uuml; <TD> &cent; <TD> &pound; <TD> &yen;      
  <TR>       <TH>$A0 <TD> &aacute; <TD> &iacute; <TD> &oacute; <TD> &uacute; <TD> &ntilde; <TD> &Ntilde; <TD> &ordf; <TD> &ordm; <TD> &iquest; <TD>   <TD> &not; <TD> &frac12; <TD> &frac14; <TD> &iexcl; <TD> &laquo; <TD> &raquo;
  <TR>       <TH>$B0 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$C0 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$D0 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$E0 <TD>   <TD> &szlig; <TD>   <TD>   <TD>   <TD>   <TD> &micro; <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$F0 <TD>   <TD> &plusmn; <TD>   <TD>   <TD>   <TD>   <TD> &divide; <TD>   <TD> &deg; <TD>   <TD> &middot; <TD>   <TD>   <TD> &sup2; <TD>   <TD>  
</TABLE>
Here ** are control characters, not graphic characters. (The characters left
blank here cannot be represented in this character set).

</DD>
</DL>
<!-- #endif -->
<!-- #ifdef ISOLATIN_CHS -->
<DL>
<DT><EM>Platform dependent: UNIX (except NeXTstep), Win32, Amiga, Acorn platforms only.</EM></DT>
<DD>
<TABLE BORDER>
More precisely, CLISP uses the ISO Latin-1 (ISO 8859-1) character set:
  <TR>       <TH>    <TH>$0 <TH>$1 <TH>$2 <TH>$3 <TH>$4 <TH>$5 <TH>$6 <TH>$7 <TH>$8 <TH>$9 <TH>$A <TH>$B <TH>$C <TH>$D <TH>$E <TH>$F
  <TR>       <TH>$00 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$10 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$20 <TD> &nbsp; <TD> ! <TD> &quot; <TD> # <TD> $ <TD> % <TD> &amp; <TD> ' <TD> ( <TD> ) <TD> * <TD> + <TD> , <TD> - <TD> . <TD> /
  <TR>       <TH>$30 <TD> 0 <TD> 1 <TD> 2 <TD> 3 <TD> 4 <TD> 5 <TD> 6 <TD> 7 <TD> 8 <TD> 9 <TD> : <TD> ; <TD> &lt; <TD> = <TD> &gt; <TD> ?
  <TR>       <TH>$40 <TD> @ <TD> A <TD> B <TD> C <TD> D <TD> E <TD> F <TD> G <TD> H <TD> I <TD> J <TD> K <TD> L <TD> M <TD> N <TD> O
  <TR>       <TH>$50 <TD> P <TD> Q <TD> R <TD> S <TD> T <TD> U <TD> V <TD> W <TD> X <TD> Y <TD> Z <TD> [ <TD> \ <TD> ] <TD> ^ <TD> _
  <TR>       <TH>$60 <TD> ` <TD> a <TD> b <TD> c <TD> d <TD> e <TD> f <TD> g <TD> h <TD> i <TD> j <TD> k <TD> l <TD> m <TD> n <TD> o
  <TR>       <TH>$70 <TD> p <TD> q <TD> r <TD> s <TD> t <TD> u <TD> v <TD> w <TD> x <TD> y <TD> z <TD> { <TD> | <TD> } <TD> ~ <TD>  
  <TR>       <TH>$80 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$90 <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$A0 <TD> &nbsp; <TD> &iexcl; <TD> &cent; <TD> &pound; <TD> &curren; <TD> &yen; <TD> &brvbar; <TD> &sect; <TD> &uml; <TD> &copy; <TD> &ordf; <TD> &laquo; <TD> &not; <TD> &shy; <TD> &reg; <TD> &macr;
  <TR>       <TH>$B0 <TD> &deg; <TD> &plusmn; <TD> &sup2; <TD> &sup3; <TD> &acute; <TD> &micro; <TD> &para; <TD> &middot; <TD> &cedil; <TD> &sup1; <TD> &ordm; <TD> &raquo; <TD> &frac14; <TD> &frac12; <TD> &frac34; <TD> &iquest;
  <TR>       <TH>$C0 <TD> &Agrave; <TD> &Aacute; <TD> &Acirc; <TD> &Atilde; <TD> &Auml; <TD> &Aring; <TD> &AElig; <TD> &Ccedil; <TD> &Egrave; <TD> &Eacute; <TD> &Ecirc; <TD> &Euml; <TD> &Igrave; <TD> &Iacute; <TD> &Icirc; <TD> &Iuml;
  <TR>       <TH>$D0 <TD> &ETH; <TD> &Ntilde; <TD> &Ograve; <TD> &Oacute; <TD> &Ocirc; <TD> &Otilde; <TD> &Ouml; <TD> &times; <TD> &Oslash; <TD> &Ugrave; <TD> &Uacute; <TD> &Ucirc; <TD> &Uuml; <TD> &Yacute; <TD> &THORN; <TD> &szlig;
  <TR>       <TH>$E0 <TD> &agrave; <TD> &aacute; <TD> &acirc; <TD> &atilde; <TD> &auml; <TD> &aring; <TD> &aelig; <TD> &ccedil; <TD> &egrave; <TD> &eacute; <TD> &ecirc; <TD> &euml; <TD> &igrave; <TD> &iacute; <TD> &icirc; <TD> &iuml;
  <TR>       <TH>$F0 <TD> &eth; <TD> &ntilde; <TD> &ograve; <TD> &oacute; <TD> &ocirc; <TD> &otilde; <TD> &ouml; <TD> &divide; <TD> &oslash; <TD> &ugrave; <TD> &uacute; <TD> &ucirc; <TD> &uuml; <TD> &yacute; <TD> &thorn; <TD> &yuml;
</TABLE>
Here ** are control characters, not graphic characters. (The characters left
blank here cannot be represented in this character set).

</DD>
</DL>
<!-- #endif -->
<!-- #ifdef NEXTSTEP_CHS -->
<DL>
<DT><EM>Platform dependent: NeXTstep platforms only.</EM></DT>
<DD>
<TABLE BORDER>
More precisely, CLISP uses the NextStep character set:
  <TR>       <TH>    <TH>$0 <TH>$1 <TH>$2 <TH>$3 <TH>$4 <TH>$5 <TH>$6 <TH>$7 <TH>$8 <TH>$9 <TH>$A <TH>$B <TH>$C <TH>$D <TH>$E <TH>$F
  <TR>       <TH>$00 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$10 <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>** <TD>**
  <TR>       <TH>$20 <TD> &nbsp; <TD> ! <TD> &quot; <TD> # <TD> $ <TD> % <TD> &amp; <TD> ' <TD> ( <TD> ) <TD> * <TD> + <TD> , <TD> - <TD> . <TD> /
  <TR>       <TH>$30 <TD> 0 <TD> 1 <TD> 2 <TD> 3 <TD> 4 <TD> 5 <TD> 6 <TD> 7 <TD> 8 <TD> 9 <TD> : <TD> ; <TD> &lt; <TD> = <TD> &gt; <TD> ?
  <TR>       <TH>$40 <TD> @ <TD> A <TD> B <TD> C <TD> D <TD> E <TD> F <TD> G <TD> H <TD> I <TD> J <TD> K <TD> L <TD> M <TD> N <TD> O
  <TR>       <TH>$50 <TD> P <TD> Q <TD> R <TD> S <TD> T <TD> U <TD> V <TD> W <TD> X <TD> Y <TD> Z <TD> [ <TD> \ <TD> ] <TD> ^ <TD> _
  <TR>       <TH>$60 <TD> ` <TD> a <TD> b <TD> c <TD> d <TD> e <TD> f <TD> g <TD> h <TD> i <TD> j <TD> k <TD> l <TD> m <TD> n <TD> o
  <TR>       <TH>$70 <TD> p <TD> q <TD> r <TD> s <TD> t <TD> u <TD> v <TD> w <TD> x <TD> y <TD> z <TD> { <TD> | <TD> } <TD> ~ <TD>  
  <TR>       <TH>$80 <TD> &nbsp; <TD> &Agrave; <TD> &Aacute; <TD> &Acirc; <TD> &Atilde; <TD> &Auml; <TD> &Aring; <TD> &Ccedil; <TD> &Egrave; <TD> &Eacute; <TD> &Ecirc; <TD> &Euml; <TD> &Igrave; <TD> &Iacute; <TD> &Icirc; <TD> &Iuml;
  <TR>       <TH>$90 <TD> &ETH; <TD> &Ntilde; <TD> &Ograve; <TD> &Oacute; <TD> &Ocirc; <TD> &Otilde; <TD> &Ouml; <TD> &Ugrave; <TD> &Uacute; <TD> &Ucirc; <TD> &Uuml; <TD> &Yacute; <TD> &THORN; <TD> &micro; <TD> &times; <TD> &divide;
  <TR>       <TH>$A0 <TD> &copy; <TD> &iexcl; <TD> &cent; <TD> &pound; <TD>   <TD> &yen; <TD>   <TD> &sect; <TD> &curren; <TD>   <TD>   <TD> &laquo; <TD>   <TD>   <TD>   <TD>  
  <TR>       <TH>$B0 <TD> &reg; <TD>   <TD>   <TD>   <TD> &middot; <TD> &brvbar; <TD> &para; <TD>   <TD>   <TD>   <TD>   <TD> &raquo; <TD>   <TD>   <TD> &not; <TD> &iquest;
  <TR>       <TH>$C0 <TD> &sup1; <TD>   <TD> &acute; <TD>   <TD>   <TD> &macr; <TD>   <TD>   <TD> &uml; <TD> &sup2; <TD> &deg; <TD> &cedil; <TD> &sup3; <TD>   <TD>   <TD>  
  <TR>       <TH>$D0 <TD>   <TD> &plusmn; <TD> &frac14; <TD> &frac12; <TD> &frac34; <TD> &agrave; <TD> &aacute; <TD> &acirc; <TD> &atilde; <TD> &auml; <TD> &aring; <TD> &ccedil; <TD> &egrave; <TD> &eacute; <TD> &ecirc; <TD> &euml;
  <TR>       <TH>$E0 <TD> &igrave; <TD> &AElig; <TD> &iacute; <TD> &ordf; <TD> &icirc; <TD> &iuml; <TD> &eth; <TD> &ntilde; <TD>   <TD> &Oslash; <TD>   <TD> &ordm; <TD> &ograve; <TD> &oacute; <TD> &ocirc; <TD> &otilde;
  <TR>       <TH>$F0 <TD> &ouml; <TD> &aelig; <TD> &ugrave; <TD> &uacute; <TD> &ucirc; <TD>   <TD> &uuml; <TD> &yacute; <TD>   <TD> &oslash; <TD>   <TD> &szlig; <TD> &thorn; <TD> &yuml;      
</TABLE>
Here ** are control characters, not graphic characters. (The characters left
blank here cannot be represented in this character set).

</DD>
</DL>
<!-- #endif -->

The following are standard characters:
<TABLE>
  <TR> <TD><CODE>#\Space</CODE>              <TD> $20
  <TR> <TD><CODE>#\Newline</CODE>            <TD> $0A
</TABLE>
The following are semi-standard characters:
<TABLE>
  <TR> <TD><CODE>#\Backspace</CODE>          <TD> $08
  <TR> <TD><CODE>#\Tab</CODE>                <TD> $09
  <TR> <TD><CODE>#\Linefeed</CODE>           <TD> $0A
  <TR> <TD><CODE>#\Page</CODE>               <TD> $0C
  <TR> <TD><CODE>#\Return</CODE>             <TD> $0D
</TABLE>
<!-- #if defined(MSDOS_CHARNAMES) || defined(WIN32_CHARNAMES) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
<TABLE>
  <TR> <TD><CODE>#\Rubout</CODE>             <TD> $08
</TABLE>
</DD>
</DL>
<!-- #endif -->
<!-- #if defined(UNIX_CHARNAMES) || defined(AMIGA_CHARNAMES) -->
<DL>
<DT><EM>Platform dependent: UNIX, Amiga, Acorn platforms only.</EM></DT>
<DD>
<TABLE>
  <TR> <TD><CODE>#\Rubout</CODE>             <TD> $7F
</TABLE>
</DD>
</DL>
<!-- #endif -->

<H3>2.2.2.</H3>

<CODE>#\Newline</CODE> is the delimiter between lines.
<P>
<!-- #if defined(MSDOS) || defined(WIN32) || (defined(UNIX) && (O_BINARY != 0)) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
When writing to a file, <CODE>#\Newline</CODE> is converted to CR/LF. (This is the usual
convention on DOS.) For example, <CODE>#\Return #\Newline</CODE> is written as CR/CR/LF.
</DD>
</DL>
<!-- #endif -->
When reading from a file, CR/LF is converted to <CODE>#\Newline</CODE>, and CR not
followed by LF is read as <CODE>#\Return</CODE>.

<H3>2.2.3.</H3>

There are the following additional characters with names:
<TABLE>
  <TR> <TD><CODE>#\Null</CODE>               <TD> $00
  <TR> <TD><CODE>#\Bell</CODE>               <TD> $07
  <TR> <TD><CODE>#\Escape</CODE>             <TD> $1B
</TABLE>

<P> Additionally, the following syntax is defined for characters with code
from $00 to $1F: 
<TABLE>
  <TR> <TD><CODE>#\^@</CODE>                     <TD> $00
  <TR> <TD><CODE>#\^A</CODE> .. <CODE>#\^Z<CODE> <TD> $01 .. $1A
  <TR> <TD><CODE>#\^[</CODE>                     <TD> $1B
  <TR> <TD><CODE>#\^\</CODE>                     <TD> $1C
  <TR> <TD><CODE>#\^]</CODE>                     <TD> $1D
  <TR> <TD><CODE>#\^^</CODE>                     <TD> $1E
  <TR> <TD><CODE>#\^_</CODE>                     <TD> $1F
</TABLE>

<P> See also sec. <A HREF="#22.1.4.">22.1.4</A>.

<H3>2.2.4.</H3>

The code of a character is &gt;=0, &lt;256. <CODE>char-code-limit</CODE> = 256.

There are fonts 0 to 15, and <CODE>char-font-limit</CODE> = 16. But the system itself
uses only font 0.

The following bits attributes are implemented: <CODE>:control</CODE>, <CODE>:meta</CODE>, <CODE>:super</CODE>,
<CODE>:hyper</CODE>. Therefore <CODE>char-bits-limit</CODE> = 16.
<!-- #ifdef KEYBOARD -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Acorn platforms only.</EM></DT>
<DD>
The system itself uses these bits only to mention special keys and
Control/Alternate/Shift key status on return from
<CODE>(read-char *keyboard-input*)</CODE>.
</DD>
</DL>
<!-- #endif -->

<H3>2.5.</H3>

The maximum rank (number of dimensions) of an array is either 65535 or
4294967295.

<H3>2.10.</H3>

The CLtL2 types <CODE>broadcast-stream</CODE>, <CODE>concatenated-stream</CODE>, <CODE>echo-stream</CODE>,
<CODE>synonym-stream</CODE>, <CODE>string-stream</CODE>, <CODE>file-stream</CODE>, <CODE>two-way-stream</CODE> are implemented.

<H3>2.13.</H3>

All the functions built by <CODE>function</CODE>, <CODE>compile</CODE> and the like are atoms. There
are built-in functions written in C, compiled functions (both of type
<CODE>compiled-function</CODE>) and interpreted functions (of type <CODE>function</CODE>).
The possible function names (CLtL1 p. 59) are symbols and lambda expressions.

<H3>2.14.</H3>

This is the list of objects whose external representation can not be
meaningfully read in:
<TABLE>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;<VAR>type</VAR> ...&gt;</CODE>
       <TD> all structures lacking a keyword constructor
  <TR> <TD VALIGN=TOP> <CODE>#&lt;ARRAY <VAR>type</VAR> <VAR>dimensions</VAR>&gt;</CODE>
       <TD> all arrays except strings, if <CODE>*print-array*</CODE> = <CODE>nil</CODE>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;SYSTEM-FUNCTION <VAR>name</VAR>&gt;</CODE>
       <TD> built-in function written in C
  <TR> <TD VALIGN=TOP> <CODE>#&lt;ADD-ON-SYSTEM-FUNCTION <VAR>name</VAR>&gt;</CODE>
       <TD> other function written in C
  <TR> <TD VALIGN=TOP> <CODE>#&lt;SPECIAL-FORM <VAR>name</VAR>&gt;</CODE>
       <TD> special form handler
  <TR> <TD VALIGN=TOP> <CODE>#&lt;COMPILED-CLOSURE <VAR>name</VAR>&gt;</CODE>
       <TD> compiled function, if <CODE>*print-closure*</CODE> = <CODE>nil</CODE>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;CLOSURE <VAR>name</VAR> ...&gt;</CODE>
       <TD> interpreted function
  <TR> <TD VALIGN=TOP> <CODE>#&lt;FRAME-POINTER #x...&gt;</CODE>
       <TD> pointer to a stack frame
  <TR> <TD VALIGN=TOP> <CODE>#&lt;DISABLED POINTER&gt;</CODE>
       <TD> frame pointer which has become invalid on
            exit from the corresponding <CODE>block</CODE> or <CODE>tagbody</CODE>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;...-STREAM ...&gt;</CODE>
       <TD> stream
  <TR> <TD VALIGN=TOP> <CODE>#&lt;PACKAGE <VAR>name</VAR>&gt;</CODE>
       <TD> package
  <TR> <TD VALIGN=TOP> <CODE>#&lt;HASH-TABLE #x...&gt;</CODE>
       <TD> hash table, if <CODE>*print-array*</CODE> = <CODE>nil</CODE>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;READTABLE #x...&gt;</CODE>
       <TD> readtable
  <TR> <TD VALIGN=TOP> <CODE>#&lt;SYMBOL-MACRO <VAR>form</VAR>&gt;</CODE>
       <TD> symbol-macro handler
<!-- #ifdef FOREIGN -->
  <TR> <TD VALIGN=TOP> <CODE>#&lt;FOREIGN-POINTER #x...&gt;</CODE>
       <TD> foreign pointer
            <BR><EM>(Platform dependent: UNIX, Win32, Amiga platforms only.)</EM>
<!-- #endif -->
<!-- #ifdef DYNAMIC_FFI -->
  <TR> <TD VALIGN=TOP> <CODE>#&lt;FOREIGN-ADDRESS #x...&gt;</CODE>
       <TD> foreign address
            <BR><EM>(Platform dependent: UNIX, Win32 platforms only.)</EM>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;FOREIGN-VARIABLE <VAR>name</VAR> #x...&gt;</CODE>
       <TD> foreign variable
            <BR><EM>(Platform dependent: UNIX, Win32 platforms only.)</EM>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;FOREIGN-FUNCTION <VAR>name</VAR> #x...&gt;</CODE>
       <TD> foreign function
            <BR><EM>(Platform dependent: UNIX, Win32 platforms only.)</EM>
<!-- #endif -->
  <TR> <TD VALIGN=TOP> <CODE>#&lt;UNBOUND&gt;</CODE>
       <TD> &quot;value&quot; of a symbol without value, &quot;value&quot;
            of an unsupplied optional or keyword argument
  <TR> <TD VALIGN=TOP> <CODE>#&lt;SPECIAL REFERENCE&gt;</CODE>
       <TD> environment marker for variables declared <CODE>special</CODE>
  <TR> <TD VALIGN=TOP> <CODE>#&lt;DOT&gt;</CODE>
       <TD> internal <CODE>read</CODE> result for &quot;.&quot;
  <TR> <TD VALIGN=TOP> <CODE>#&lt;END OF FILE&gt;</CODE>
       <TD> internal <CODE>read</CODE> result, when the end of file
            is reached
  <TR> <TD VALIGN=TOP> <CODE>#&lt;READ-LABEL ...&gt;</CODE>
       <TD> intermediate <CODE>read</CODE> result for #n#
  <TR> <TD VALIGN=TOP> <CODE>#&lt;ADDRESS #x...&gt;</CODE>
       <TD> machine address, should not occur
  <TR> <TD VALIGN=TOP> <CODE>#&lt;SYSTEM-POINTER #x...&gt;</CODE>
       <TD> should not occur
</TABLE>

<H3>2.15.</H3>

The type <CODE>number</CODE> is the disjoint union of the types <CODE>real</CODE> and <CODE>complex</CODE>. (CLtL
wording: &quot;exhaustive partition&quot;)
<BR>
The type <CODE>real</CODE> is the disjoint union of the types <CODE>rational</CODE> and <CODE>float</CODE>.
<BR>
The type <CODE>rational</CODE> is the disjoint union of the types <CODE>integer</CODE> and <CODE>ratio</CODE>.
<BR>
The type <CODE>integer</CODE> is the disjoint union of the types <CODE>fixnum</CODE> and <CODE>bignum</CODE>.
<BR>
The type <CODE>float</CODE> is the disjoint union of the types <CODE>short-float</CODE>, <CODE>single-float</CODE>,
<CODE>double-float</CODE> and <CODE>long-float</CODE>.


<H2>Chapter 3: Scope and Extent</H2>

is implemented as described.


<H2>Chapter 4: Type Specifiers</H2>

<H3>4.4.</H3>

The CLtL2 type specifier <CODE>(eql <VAR>object</VAR>)</CODE> denotes the singleton set {<VAR>object</VAR>}.

<H3>4.5.</H3>

The general form of the <CODE>complex</CODE> type specifier is
<CODE>(complex <VAR>type-of-real-part</VAR> <VAR>type-of-imaginary-part</VAR>)</CODE>.
The type specifier <CODE>(complex <VAR>type</VAR>)</CODE> is equivalent to <CODE>(complex <VAR>type</VAR> <VAR>type</VAR>)</CODE>.

<H3>4.6.</H3>

The CLtL2 type specifier <CODE>(real <VAR>low</VAR> <VAR>high</VAR>)</CODE> denotes the real numbers between <VAR>low</VAR>
and <VAR>high</VAR>.

<H3>4.7.</H3>

<CODE>deftype</CODE> lambda lists are subject to destructuring (nested lambda lists are
allowed, as in <CODE>defmacro</CODE>) and may contain a <CODE>&amp;whole</CODE> marker, but no
<CODE>&amp;environment</CODE> marker.
<P>
<CODE>(<STRONG>type-expand-1</STRONG> <VAR>typespec</VAR>)</CODE>: If <VAR>typespec</VAR> is a user-defined type, <CODE>type-expand-1</CODE>
will expand it once and return two values: the expansion and <CODE>t</CODE>. If <VAR>typespec</VAR>
is not a user-defined type, then the two values <VAR>typespec</VAR> and <CODE>nil</CODE> are returned.
<P>
<CODE>(<STRONG>type-expand</STRONG> <VAR>typespec</VAR>)</CODE>: This is similar to <CODE>(type-expand-1 <VAR>typespec</VAR>)</CODE>, but
repeatedly expands <VAR>typespec</VAR> until it is no longer a user-defined type. A second
value of <CODE>t</CODE> or <CODE>nil</CODE> is returned as for <CODE>type-expand-1</CODE>, indicating whether the
original <VAR>typespec</VAR> was a user-defined type.

<H3>4.9.</H3>

The possible results of <CODE>type-of</CODE> are:
<TABLE>
 <TR> <TD>
 <CODE>cons</CODE>
 <TR> <TD>
 <CODE>symbol</CODE> <CODE>null</CODE> <CODE>boolean</CODE>
 <TR> <TD>
 <CODE>fixnum</CODE> <CODE>bignum</CODE> <CODE>ratio</CODE> <CODE>short-float</CODE> <CODE>single-float</CODE> <CODE>double-float</CODE> <CODE>long-float</CODE> <CODE>complex</CODE>
 <TR> <TD>
 <CODE>character</CODE>
 <TR> <TD>
 <CODE>(array <VAR>element-type</VAR> <VAR>dimensions</VAR>)</CODE>, <CODE>(simple-array <VAR>element-type</VAR> <VAR>dimensions</VAR>)</CODE>
 <TR> <TD>
 <CODE>(vector t <VAR>size</VAR>)</CODE>, <CODE>(simple-vector <VAR>size</VAR>)</CODE>
 <TR> <TD>
 <CODE>(string <VAR>size</VAR>)</CODE>, <CODE>(simple-string <VAR>size</VAR>)</CODE>
 <TR> <TD>
 <CODE>(bit-vector <VAR>size</VAR>)</CODE>, <CODE>(simple-bit-vector <VAR>size</VAR>)</CODE>
 <TR> <TD>
 <CODE>function</CODE> <CODE>compiled-function</CODE>
 <TR> <TD>
 <CODE>stream</CODE> <CODE>file-stream</CODE> <CODE>synonym-stream</CODE> <CODE>broadcast-stream</CODE> <CODE>concatenated-stream</CODE>
 <CODE>two-way-stream</CODE> <CODE>echo-stream</CODE> <CODE>string-stream</CODE>
 <TR> <TD>
 <CODE>package</CODE> <CODE>hash-table</CODE> <CODE>readtable</CODE> <CODE>pathname</CODE> <CODE>logical-pathname</CODE> <CODE>random-state</CODE> <CODE>byte</CODE>
 <TR> <TD>
 <CODE>load-time-eval</CODE> <CODE>symbol-macro</CODE> <CODE>foreign-variable</CODE> <CODE>foreign-function</CODE> <CODE>read-label</CODE>
 <TR> <TD>
 <CODE>frame-pointer</CODE> <CODE>system-internal</CODE>
 <TR> <TD>
 <CODE>address</CODE> (should not occur)
 <TR> <TD>
 any other symbol (structure types or CLOS classes)
 <TR> <TD>
 a class (CLOS classes without proper name)
</TABLE>


<H2>Chapter 5: Program Structure</H2>

<H3>5.1.3.</H3>

In addition to the 24 special forms listed on p. 57 (CLtL2: p. 73), the
CLtL2 special forms <CODE>locally</CODE>, <CODE>symbol-macrolet</CODE>, <CODE>load-time-value</CODE> are implemented,
and the macros
<CODE>psetq</CODE>, <CODE>prog1</CODE>, <CODE>prog2</CODE>, <CODE>when</CODE>, <CODE>unless</CODE>, <CODE>cond</CODE>, <CODE>case</CODE>, <CODE>multiple-value-list</CODE>,
<CODE>multiple-value-bind</CODE>, <CODE>multiple-value-setq</CODE>, <CODE>and</CODE>, <CODE>or</CODE>
are implemented as special forms.
<P>
Constants may not be bound dynamically or lexically.

<H3>5.2.2.</H3>

<CODE>lambda-list-keywords</CODE> =
    <CODE>(&amp;optional &amp;rest &amp;key &amp;allow-other-keys &amp;aux &amp;body &amp;whole &amp;environment)</CODE>
<P>
<CODE>lambda-parameters-limit</CODE> is 65536 on 16-bit processors, 4294967296 on 32-bit
processors.

<H3>5.3.</H3>

<CODE>defun</CODE> and <CODE>defmacro</CODE> are allowed in non-toplevel positions.
As an example, consider the old (CLtL1) definition of <CODE>gensym</CODE>:
<PRE><CODE>(let ((gensym-prefix &quot;G&quot;)
      (gensym-count 1))
  (defun gensym (&amp;optional (x nil s))
    (when s
      (cond ((stringp x) (setq gensym-prefix x))
            ((integerp x)
             (if (minusp x)
               (error &quot;~S: index ~S is negative&quot; 'gensym x)
               (setq gensym-count x)
            ))
            (t (error &quot;~S: argument ~S of wrong type&quot; 'gensym x))
    ) )
    (prog1
      (make-symbol
        (concatenate 'string
          gensym-prefix
          (write-to-string gensym-count :base 10 :radix nil)
      ) )
      (incf gensym-count)
) ) )
</CODE></PRE>

<H3>5.3.2.</H3>

<CODE>(proclaim '(special <VAR>var</VAR>))</CODE> declarations may not be undone. The same holds
for <CODE>defvar</CODE>, <CODE>defparameter</CODE> and <CODE>defconstant</CODE> declarations.
<P>
It is an error if a <CODE>defconstant</CODE> variable is bound at the moment the
<CODE>defconstant</CODE> is executed, but <CODE>defconstant</CODE> does not check this.
<P>
Constants may not be bound dynamically or lexically.

<H3>5.3.3.</H3>

<CODE>eval-when</CODE> also accepts the situations <CODE>(not eval)</CODE> and <CODE>(not compile)</CODE>.


<H2>Chapter 6: Predicates</H2>

<H3>6.2.2.</H3>

<CODE>realp</CODE> returns <CODE>t</CODE> is its argument is a real number, <CODE>nil</CODE> otherwise.

<CODE>compiled-function-p</CODE> returns <CODE>t</CODE> on built-in functions written in C, compiled
functions and special form handlers. Therefore <CODE>compiled-function</CODE> is not a
subtype of <CODE>function</CODE>.

<H3>6.3.</H3>

<CODE>eq</CODE> compares characters and fixnums as <CODE>eql</CODE> does. No unnecessary copies are
made of characters and numbers. Nevertheless, one should use <CODE>eql</CODE>.
<P>
<CODE>(let ((x y)) (eq x x))</CODE> always returns <CODE>t</CODE>, regardless of <CODE>y</CODE>.

<H3>6.4.</H3>

<CODE>and</CODE> and <CODE>or</CODE> are implemented as special forms and, as such, rather efficient.


<H2>Chapter 7: Control Structure</H2>

<H3>7.1.1.</H3>

<!-- #ifdef IMMUTABLE -->
<DL>
<DT><EM>Platform dependent: UNIX platforms only, and only in clisp binaries built with compile-time flag <CODE>IMMUTABLE</CODE>.</EM></DT>
<DD>
Attempts to modify read-only data will signal an error. Program text and
quoted constants loaded from files are considered read-only data. This check
is only performed for conses and arrays, not for user-defined data types.
</DD>
</DL>
<!-- #endif -->
<P>
<CODE>(function <VAR>symbol</VAR>)</CODE> returns the local function definition established by <CODE>flet</CODE>
or <CODE>labels</CODE>, if it exists, otherwise the global function definition.
<P>
The CLtL2 place <CODE>(fdefinition <VAR>function-name</VAR>)</CODE> is implemented.
<P>
<CODE>(special-form-p <VAR>symbol</VAR>)</CODE> returns <CODE>nil</CODE> or <CODE>t</CODE>. If it returns <CODE>t</CODE>, then
<CODE>(symbol-function <VAR>symbol</VAR>)</CODE> returns the (useless) special form handler.

<H3>7.1.2.</H3>

<CODE>psetq</CODE> is implemented as a special form and, as such, rather efficient.

<H3>7.2.</H3>

<CODE>(setf (symbol-function <VAR>symbol</VAR>) <VAR>object</VAR>)</CODE> requires <VAR>object</VAR> to be either a
function, a <CODE>symbol-function</CODE> return value or a lambda expression. A lambda
expression is thereby immediately converted to a function.
<P>
<CODE>setf</CODE> also accepts places yielding multiple values.
<P>
Additional places:
<DL>

<DT><CODE>funcall</CODE>:
<DD>
  <CODE>(setf (funcall #'<VAR>symbol</VAR> ...) <VAR>object</VAR>)</CODE> and
  <CODE>(setf (funcall '<VAR>symbol</VAR> ...) <VAR>object</VAR>)</CODE>
  are equivalent to <CODE>(setf (<VAR>symbol</VAR> ...) <VAR>object</VAR>)</CODE>.

<DT><CODE>get-dispatch-macro-character</CODE>:
<DD>
  <CODE>(setf (get-dispatch-macro-character ...) ...)</CODE>
  performs a <CODE>set-dispatch-macro-character</CODE>.

<DT><CODE>long-float-digits</CODE>:
<DD>
  <CODE>(setf (long-float-digits) <VAR>digits</VAR>)</CODE> sets the default mantissa length of long
  floats to <VAR>digits</VAR> bits.

<DT><CODE>values</CODE>:
<DD>
  <CODE>(setf (values <VAR>place<SUB>1</SUB></VAR> ... <VAR>place<SUB>k</SUB></VAR>) <VAR>form</VAR>)</CODE>
  is approximately equivalent to
<PRE><CODE>     (multiple-value-bind (dummy1 ... dummyk) <VAR>form</VAR>
       (setf <VAR>place<SUB>1</SUB></VAR> dummy1 ... <VAR>place<SUB>k</SUB></VAR> dummyk)
       (values dummy1 ... dummyk)
     )
</CODE></PRE>
  Example:
    <CODE>(setf (values a b) (values b a))</CODE> interchanges the values of <CODE>a</CODE> and <CODE>b</CODE>.

<DT><CODE>values-list</CODE>:
<DD>
  <CODE>(setf (values-list <VAR>list</VAR>) <VAR>form</VAR>)</CODE>  is equivalent to
  <CODE>(values-list (setf <VAR>list</VAR> (multiple-value-list <VAR>form</VAR>)))</CODE>
</DL>
<P>
<CODE>&amp;key</CODE> markers in <CODE>defsetf</CODE> lambda lists are supported, but the corresponding
keywords must appear literally in the program text.
<P>
<CODE>(get-setf-method <VAR>form</VAR> &amp;optional <VAR>env</VAR>)</CODE> and
<CODE>(get-setf-method-multiple-value <VAR>form</VAR> &amp;optional <VAR>env</VAR>)</CODE>
receives as optional argument the environment necessary for macro expansions.
In <CODE>define-setf-method</CODE> lambda lists, one can specify <CODE>&amp;environment</CODE> and a
variable, which will be bound to the environment. This environment should be
passed to all calls of <CODE>get-setf-method</CODE> and <CODE>get-setf-method-multiple-value</CODE>.
If this is done, even local macros will be interpreted as places correctly.

<H3>7.3.</H3>

<CODE>call-arguments-limit</CODE> is 65536 on 16-bit processors, 4294967296 on 32-bit
processors.

<H3>7.4.</H3>

<CODE>prog1</CODE> and <CODE>prog2</CODE> are implemented as special forms and, as such, rather
efficient.

<H3>7.5.</H3>

The CLtL2 special form <CODE>symbol-macrolet</CODE> is implemented.
<P>
The macro <STRONG><CODE>define-symbol-macro</CODE></STRONG> establishes symbol macros with global scope
(as opposed to symbol macros defined with <CODE>symbol-macrolet</CODE>, which have local
scope): <CODE>(define-symbol-macro <VAR>symbol</VAR> <VAR>expansion</VAR>)</CODE>.
<BR>
The function <STRONG><CODE>symbol-macro-expand</CODE></STRONG> tests for a symbol macro: If <VAR>symbol</VAR> is
defined as symbol macro, <CODE>(symbol-macro-expand <VAR>symbol</VAR>)</CODE> returns two values,
<CODE>t</CODE> and the expansion, else it returns <CODE>nil</CODE>.
<BR>
Calling <CODE>boundp</CODE> on a symbol defined as symbol macro returns <CODE>t</CODE>.
<BR>
Calling <CODE>symbol-value</CODE> on a symbol defined as symbol macro returns the value
of the expansion. Calling <CODE>set</CODE> on a symbol defined as symbol macro calls
<CODE>setf</CODE> on the expansion.
<BR>
Calling <CODE>makunbound</CODE> on a symbol defined as symbol macro removes the symbol
macro definition.
<P>
<DL>
<DT><EM>If using the optional package <CODE>macros3</CODE>:</EM></DT>
<DD>
  The macros <STRONG><CODE>letf</CODE></STRONG> and <STRONG><CODE>letf*</CODE></STRONG> are like <CODE>let</CODE> and <CODE>let*</CODE>, resp., except that they
  can bind places, even places with multiple values.
  Example:
  <DL>
  <DT><CODE>(letf (((values a b) <VAR>form</VAR>)) ...)</CODE></DT>
  <DD>is equivalent to
      <CODE>(multiple-value-bind (a b) <VAR>form</VAR> ...)</CODE>
  </DD>
  <DT><CODE>(letf (((first l) 7)) ...)</CODE></DT>
  <DD>is approximately equivalent to
    <PRE><CODE>    (let* ((#:g1 l) (#:g2 (first #:g1)))
      (unwind-protect (progn (setf (first #:g1) 7) ...)
                      (setf (first #:g1) #:g2)
    ) )
    </CODE></PRE>
  </DD>
  </DL>
</DD>
</DL>

<H3>7.6.</H3>

<CODE>when</CODE>, <CODE>unless</CODE>, <CODE>cond</CODE>, <CODE>case</CODE> are implemented as special forms and, as such, rather
efficient.

<H3>7.8.4.</H3>

The function <STRONG><CODE>mapcap</CODE></STRONG> is like <CODE>mapcan</CODE>, except that it concatenates the
resulting lists with <CODE>append</CODE> instead of <CODE>nconc</CODE>:
<BR>
<CODE>(mapcap <VAR>fun</VAR> <VAR>x<SUB>1</SUB></VAR> ... <VAR>x<SUB>n</SUB></VAR>)</CODE> == <CODE>(apply #'append (mapcar <VAR>fun</VAR> <VAR>x<SUB>1</SUB></VAR> ... <VAR>x<SUB>n</SUB></VAR>))</CODE>
<BR>
(Actually a bit more efficient that this would be.)
<P>
The function <STRONG><CODE>maplap</CODE></STRONG> is like <CODE>mapcon</CODE>, except that it concatenates the
resulting lists with <CODE>append</CODE> instead of <CODE>nconc</CODE>:
<BR>
<CODE>(maplap <VAR>fun</VAR> <VAR>x<SUB>1</SUB></VAR> ... <VAR>x<SUB>n</SUB></VAR>)</CODE> == <CODE>(apply #'append (maplist <VAR>fun</VAR> <VAR>x<SUB>1</SUB></VAR> ... <VAR>x<SUB>n</SUB></VAR>))</CODE>
<BR>
(Actually a bit more efficient that this would be.)

<H3>7.9.1.</H3>

<CODE>multiple-values-limit</CODE> = 128
<P>
<CODE>multiple-value-list</CODE>, <CODE>multiple-value-bind</CODE>, <CODE>multiple-value-setq</CODE> are
implemented as special forms and, as such, rather efficient.
<P>
The macro <CODE>nth-value</CODE>:
<CODE>(nth-value <VAR>n</VAR> <VAR>form</VAR>)</CODE> returns the (n+1)st value (n&gt;=0) of <VAR>form</VAR>.


<H2>Chapter 8: Macros</H2>

<H3>8.3.</H3>

The CLtL2 macro <CODE>destructuring-bind</CODE> is implemented. It does not perform full
error checking.


<H2>Chapter 9: Declarations</H2>

<H3>9.1.</H3>

The CLtL2 macro <CODE>declaim</CODE> is implemented.

<H3>9.2.</H3>

The declarations <CODE>(type <VAR>type</VAR> <VAR>var</VAR> ...)</CODE>, <CODE>(ftype <VAR>type</VAR> <VAR>fun</VAR> ...)</CODE>,
<CODE>(function <VAR>name</VAR> <VAR>arglist</VAR> <VAR>result-type</VAR>)</CODE>, <CODE>(optimize (<VAR>quality</VAR> <VAR>value</VAR>) ...)</CODE>
are ignored by the interpreter and the compiler.
<P>
The CLtL2 declaration <CODE>(optimize (debug ...))</CODE> is legal.
<P>
Additional declarations:
<UL>
<LI>
  The ANSI CL declaration <CODE>(ignorable <VAR>var</VAR> ...)</CODE> affects the variable binding for
  the variable <VAR>var</VAR>. The compiler will not warn about the variable, regardless
  whether it is used or not.
<LI>
  The declaration <CODE>(compile)</CODE> has the effect that the current form is compiled
  prior to execution.
  Examples:
  <P>
  <CODE>(locally (declare (compile)) <VAR>form</VAR>)</CODE></DT>
  executes a compiled version of form.
  <P>
  <PRE><CODE>(let ((x 0))
  (flet ((inc () (declare (compile)) (incf x))
         (dec () (decf x)))
    (values #'inc #'dec)
) )
</CODE></PRE>
  returns two functions. The first is compiled and increments <CODE>x</CODE>, the second
  is interpreted (slower) and decrements the same <CODE>x</CODE>.
</UL>

<H3>9.3.</H3>

The type assertion <CODE>(the <VAR>value-type</VAR> <VAR>form</VAR>)</CODE> enforces a type check in
interpreted code. No type check is done in compiled code.
<P>
<DL>
<DT><EM>If using the optional package <CODE>macros3</CODE>:</EM></DT>
<DD>
The macro <STRONG><CODE>ethe</CODE></STRONG>:
<CODE>(ethe <VAR>value-type</VAR> <VAR>form</VAR>)</CODE> enforces a type check in both interpreted and
compiled code.
</DD>
</DL>


<H2>Chapter 10: Symbols</H2>

No notes.


<H2>Chapter 11: Packages</H2>

<H3>11.6.</H3>

The package <CODE>SYSTEM</CODE> has the nicknames <CODE>&quot;SYS&quot;</CODE> and, additionally, <CODE>&quot;COMPILER&quot;</CODE>.
<P>
The CLtL2 packages
<UL>
<LI> <CODE>COMMON-LISP</CODE> with nickname <CODE>&quot;CL&quot;</CODE> and
<LI> <CODE>COMMON-LISP-USER</CODE> with nickname <CODE>&quot;CL-USER&quot;</CODE>
</UL>
are implemented. The package <CODE>COMMON-LISP</CODE> exports only those symbols
from the ANSI CL standard that are actually implemented.

<H3>11.7.</H3>

For <CODE>make-package</CODE>, the default value of the <CODE>:use</CODE> argument is <CODE>(&quot;LISP&quot; &quot;CLOS&quot;)</CODE>.
<P>
The CLtL2 macro <CODE>defpackage</CODE> is implemented.
<P>
<CODE>make-package</CODE> and <CODE>in-package</CODE> accept a keyword argument <CODE>:case-sensitive</CODE>.
Similarly, <CODE>defpackage</CODE> accepts an option <CODE>:case-sensitive</CODE>. When its value is
non-<CODE>nil</CODE>, the package will be case sensitive, i.e. the reader will not
case-convert symbol names before looking them up or creating them in this
package. The package names are still subject to <CODE>(readtable-case *readtable*)</CODE>,
though.

<H3>11.8.</H3>

The function <CODE>require</CODE> receives as optional argument either a pathname or a
list of pathnames: files to be loaded if the required module is not already
in memory.


<H2>Chapter 12: Numbers</H2>

The single and double float formats are those of the IEEE standard (1981),
except that CLISP does not support features like +0, -0, +inf, -inf, gradual
underflow, NaN, etc. (Common Lisp does not make use of these features.)
<P>
The default number of mantissa bits in long floats is given by the place
<CODE>(long-float-digits)</CODE>.
Example: <CODE>(setf (long-float-digits) 3322)</CODE> sets the default precision of long
floats to 1000 decimal digits.

<H3>12.1.</H3>

Complex numbers can have a real part and an imaginary part of different
types. If the imaginary part is <CODE>eql</CODE> to <CODE>0</CODE>, the number is automatically
converted to a real number. (Cf. CLtL1 p. 195)
This has the advantage that  <CODE>(let ((x (sqrt -9.0))) (* x x))</CODE>
- instead of evaluting to <CODE>#C(-9.0 0.0)</CODE>, with <CODE>x</CODE> = <CODE>#C(0.0 3.0)</CODE> -
evaluates to <CODE>#C(-9.0 0)</CODE> = <CODE>-9.0</CODE>, with <CODE>x</CODE> = <CODE>#C(0 3.0)</CODE>.
<P>
<H4>Coercions on operations involving different types:</H4>
The floating point contagion is controlled by the variable
<STRONG><CODE>*FLOATING-POINT-CONTAGION-ANSI*</CODE></STRONG>.  When it
is non-nil, contagion is done as per the ANSI CL standard:
short-&gt;single-&gt;double-&gt;long.
<DL><DT>Rationale:</DT>
<DD>See it pragmatically: save what you can and let others worry about
the rest.</DD>
<DT>Short:</DT>
<DD>CL knows the number's precision, not accuracy, so preserving
the precision can be accomplished reliably, while anything relating to
the accuracy is just a speculation - only the user (programmer) knows
what it is in each case.</DD>
<DT>Long:</DT>
<DD>A float is an approximation of a real number.  One can think of it
as a random variable with the mean equal to itself and standard
deviation equal to half the last significant digit.  E.g.,
<CODE>1.5</CODE> is actually <CODE>1.5+-0.05</CODE>.  Consider adding
<CODE>1.5</CODE> and <CODE>1.75</CODE>.  ANSI requires that <CODE>(+ 1.5
1.75)</CODE> return <CODE>3.25</CODE>, while traditional CLISP would
return <CODE>3.3</CODE>.  The implied random variables are:
<CODE>3.25+-0.005</CODE> and <CODE>3.3+-0.05</CODE>.  Note that the
CLISP's way <b>DOES</b> lies about the mean: the mean <b>IS</b>
<CODE>3.25</CODE> and nothing else, while the ANSI's way <b>COULD</b> be
lying about the deviation (accuracy): if the implied accuracy of
<CODE>1.5 (0.05)</CODE> is its actual accuracy, then the accuracy of the
result cannot be smaller that that.  Therefore, since CL has no way of
knowing the actual accuracy, ANSI CL (and all the other standard
engineering programming languages, like C, FORTRAN etc) decides that
keeping the accuracy correct is the business of the programmer, while
the language should preserve what it can - the precision.</DD>
<DT>Experience:</DT>
<DD> Rounding errors accumulate, and if a computation is conducted with
insufficient precision, an outright incorrect result can be returned.
(E.g., <CODE>E(x^2)-E(x)^2</CODE> can be negative!)  The user should not
mix floats of different precision (that's what
<CODE>*WARN-ON-FLOATING-POINT-CONTAGION*</CODE> is for), but s/he should
not be penalized for this too harshly.</DD></DL>
<P>When <CODE>*FLOATING-POINT-CONTAGION-ANSI*</CODE> is nil, the
traditional CLISP method is used, namely:
<P>The result of an arithmetic operation whose arguments are of different float
types is rounded to the float format of the shortest (least precise) of the
arguments.
    rational -&gt; long float -&gt; double float -&gt; single float -&gt; short float
(in contrast to CLtL1 p. 195!)
<DL>
<DT>Rationale:</DT>
<DD>
  See it mathematically. Add intervals:
  {1.0 &plusmn; 1e-8} + {1.0 &plusmn; 1e-16} = {2.0 &plusmn; 1e-8}
  So, if we add <CODE>1.0s0</CODE> and <CODE>1.0d0</CODE>, we should get <CODE>2.0s0</CODE>.
</DD>
<DT>Shortly:</DT>
<DD>
  Do not suggest accuracy of a result by giving it a precision that is
  greater than its accuracy.
</DD>
<DT>Example:</DT>
<DD>
  <CODE>(- (+ 1.7 pi) pi)</CODE>  should not return  <CODE>1.700000726342836417234L0</CODE>,
  it should return <CODE>1.7f0</CODE> (or <CODE>1.700001f0</CODE> if there were rounding errors).
</DD>
<DT>Experience:</DT>
<DD>
  If in a computation using thousands of short floats, a long float (like pi)
  happens to be used, the long precision should not propagate throughout all
  the intermediate values. Otherwise, the long result would look precise,
  but its accuracy is only that of a short float; furthermore much
  computation time would be lost by calculating with long floats when only
  short floats would be needed.
</DD>
</DL>
<p>If the variable
<STRONG><CODE>*warn-on-floating-point-contagion*</CODE></STRONG> is
true, a warning is emitted for every coercion involving different
floating-point types.
<p>When rational numbers are to be converted to floats (due to
<CODE>float</CODE>, <CODE>coerce</CODE>, <CODE>sqrt</CODE> or a
transcendental function), the result type is given by the variable
<STRONG><CODE>*default-float-format*</CODE></STRONG>.
<P>
The macro <STRONG><CODE>without-floating-point-underflow</CODE></STRONG>:
  <CODE>(without-floating-point-underflow {<VAR>form</VAR>}*)</CODE>
executes the <VAR>form</VAR>s, with errors of type <CODE>floating-point-underflow</CODE> inhibited.
Floating point operations will silently return zero instead of signalling
an error of type <CODE>floating-point-underflow</CODE>.

<H3>12.4.</H3>

<CODE>(lcm)</CODE>, called without arguments, returns <CODE>1</CODE>, which is the neutral element of
composition with <CODE>lcm</CODE>.
<P>
<CODE>(! <VAR>n</VAR>)</CODE> returns the factorial of <VAR>n</VAR>, <VAR>n</VAR> a nonnegative integer.
<P>
<CODE>(exquo <VAR>x</VAR> <VAR>y</VAR>)</CODE> returns the quotient <VAR>x/y</VAR> of two integers <VAR>x</VAR>,<VAR>y</VAR>, and checks that it
is an integer. (This is more efficient than <CODE>/</CODE>.)
<P>
<CODE>(xgcd <VAR>x<SUB>1</SUB></VAR> ... <VAR>x<SUB>n</SUB></VAR>)</CODE> returns the values <VAR>g</VAR>, <VAR>c<SUB>1</SUB></VAR>, ..., <VAR>c<SUB>n</SUB></VAR>, where
<VAR>g</VAR> is the greatest common divisor of the integers <VAR>x<SUB>1</SUB></VAR>,...,<VAR>x<SUB>n</SUB></VAR>,
and <VAR>c<SUB>1</SUB></VAR>,...,<VAR>c<SUB>n</SUB></VAR> are integer coefficients such that
  <CODE><VAR>g</VAR></CODE> = <CODE>(gcd <VAR>x<SUB>1</SUB></VAR> ... <VAR>x<SUB>n</SUB></VAR>)</CODE> = <CODE>(+ (* <VAR>c<SUB>1</SUB></VAR> <VAR>x<SUB>1</SUB></VAR>) ... (* <VAR>c<SUB>n</SUB></VAR> <VAR>x<SUB>n</SUB></VAR>))</CODE>

<H3>12.5.1.</H3>

<CODE>(expt <VAR>base</VAR> <VAR>exponent</VAR>)</CODE> is not very precise if exponent has large absolute
value.
<P>
<CODE>(log <VAR>number</VAR> <VAR>base</VAR>)</CODE> signals an error if <VAR>base</VAR> = 1.

<H3>12.5.2.</H3>

The value of <CODE>pi</CODE> is a long float with the precision given by
<CODE>(long-float-digits)</CODE>. When this precision is changed, the value of <CODE>pi</CODE> is
automatically recomputed. Therefore <CODE>pi</CODE> is a variable, not a constant.

<H3>12.6.</H3>

<CODE>float-radix</CODE> always returns <CODE>2</CODE>.
<P>
<CODE>(float-digits <VAR>number</VAR> <VAR>digits</VAR>)</CODE> coerces <VAR>number</VAR> (a real number) to a floating
point number with at least <VAR>digits</VAR> mantissa digits. The following holds:
<BR>
<CODE>(&gt;= (float-digits (float-digits <VAR>number</VAR> <VAR>digits</VAR>)) <VAR>digits</VAR>)</CODE>

<H3>12.7.</H3>

<TABLE>
  <TR> <TD><CODE>boole-clr</CODE>   <TD>= <TD ALIGN=RIGHT> 0
  <TR> <TD><CODE>boole-set</CODE>   <TD>= <TD ALIGN=RIGHT>15
  <TR> <TD><CODE>boole-1</CODE>     <TD>= <TD ALIGN=RIGHT>10
  <TR> <TD><CODE>boole-2</CODE>     <TD>= <TD ALIGN=RIGHT>12
  <TR> <TD><CODE>boole-c1</CODE>    <TD>= <TD ALIGN=RIGHT> 5
  <TR> <TD><CODE>boole-c2</CODE>    <TD>= <TD ALIGN=RIGHT> 3
  <TR> <TD><CODE>boole-and</CODE>   <TD>= <TD ALIGN=RIGHT> 8
  <TR> <TD><CODE>boole-ior</CODE>   <TD>= <TD ALIGN=RIGHT>14
  <TR> <TD><CODE>boole-xor</CODE>   <TD>= <TD ALIGN=RIGHT> 6
  <TR> <TD><CODE>boole-eqv</CODE>   <TD>= <TD ALIGN=RIGHT> 9
  <TR> <TD><CODE>boole-nand</CODE>  <TD>= <TD ALIGN=RIGHT> 7
  <TR> <TD><CODE>boole-nor</CODE>   <TD>= <TD ALIGN=RIGHT> 1
  <TR> <TD><CODE>boole-andc1</CODE> <TD>= <TD ALIGN=RIGHT> 4
  <TR> <TD><CODE>boole-andc2</CODE> <TD>= <TD ALIGN=RIGHT> 2
  <TR> <TD><CODE>boole-orc1</CODE>  <TD>= <TD ALIGN=RIGHT>13
  <TR> <TD><CODE>boole-orc2</CODE>  <TD>= <TD ALIGN=RIGHT>11
</TABLE>

<H3>12.10.</H3>

<CODE>most-positive-fixnum</CODE> = 2<SUP>24</SUP>-1 = 16777215
<BR>
<CODE>most-negative-fixnum</CODE> = -2<SUP>24</SUP> = -16777216
<P>
Together with <CODE>pi</CODE>, the other long float constants
  <CODE>most-positive-long-float</CODE>,
  <CODE>least-positive-long-float</CODE>, <CODE>least-negative-long-float</CODE>,
  <CODE>most-negative-long-float</CODE>,
  <CODE>least-positive-normalized-long-float</CODE>, <CODE>least-negative-normalized-long-float</CODE>,
  <CODE>long-float-epsilon</CODE>, <CODE>long-float-negative-epsilon</CODE>
are recomputed whenever <CODE>(long-float-digits)</CODE> is changed. They are variables,
not constants.


<H2>Chapter 13: Characters</H2>

See first above: <A HREF="#2.2.">2.2.</A>

<H3>13.1.</H3>

<CODE>char-code-limit</CODE> = 256
<BR>
<CODE>char-font-limit</CODE> = 16
<BR>
<CODE>char-bits-limit</CODE> = 16

<H3>13.2.</H3>

String-chars are those characters with font = 0 and bits = 0.
<P>
The graphic characters have been described above.
<P>
The standard characters are <CODE>#\Newline</CODE> and those graphic characters with a
code between 32 and 126 (inclusive).
<P>
The alphabetic characters are these string-chars:<PRE>
             ABCDEFGHIJKLMNOPQRSTUVWXYZ
             abcdefghijklmnopqrstuvwxyz
</PRE>and the international alphabetic characters from the character set:<PRE>
             &Ccedil;&uuml;&eacute;&acirc;&auml;&agrave;&aring;&ccedil;&ecirc;&euml;&egrave;&iuml;&icirc;&igrave;&Auml;&Aring;&Eacute;&aelig;&AElig;&ocirc;&ouml;&ograve;&ucirc;&ugrave;&yuml;&Ouml;&Uuml;&szlig;&aacute;&iacute;&oacute;&uacute;&ntilde;&Ntilde;&ordf;&ordm;&atilde;&otilde;&Oslash;&oslash;&Agrave;&Atilde;&Otilde; etc.</PRE>
<P>
The functions <CODE>char-equal</CODE>, <CODE>char-not-equal</CODE>, <CODE>char-lessp</CODE>, <CODE>char-greaterp</CODE>,
<CODE>char-not-greaterp</CODE>, <CODE>char-not-lessp</CODE> ignore bits and font attributes of their
arguments.

<H3>13.4.</H3>

The string chars that are not graphic chars and the space character have
names:
<!-- #ifdef AMIGA_CHARNAMES -->
<DL>
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD>
      <CODE>(code-char #x00)</CODE> = <CODE>#\Null</CODE>
  <BR><CODE>(code-char #x01)</CODE> = <CODE>#\Code1</CODE>
  <BR><CODE>(code-char #x02)</CODE> = <CODE>#\Code2</CODE>
  <BR><CODE>(code-char #x03)</CODE> = <CODE>#\Code3</CODE>
  <BR><CODE>(code-char #x04)</CODE> = <CODE>#\Code4</CODE>
  <BR><CODE>(code-char #x05)</CODE> = <CODE>#\Code5</CODE>
  <BR><CODE>(code-char #x06)</CODE> = <CODE>#\Code6</CODE>
  <BR><CODE>(code-char #x07)</CODE> = <CODE>#\Bell</CODE> = <CODE>#\Bel</CODE>
  <BR><CODE>(code-char #x08)</CODE> = <CODE>#\Backspace</CODE> = <CODE>#\Bs</CODE>
  <BR><CODE>(code-char #x09)</CODE> = <CODE>#\Tab</CODE> = <CODE>#\Ht</CODE>
  <BR><CODE>(code-char #x0A)</CODE> = <CODE>#\Newline</CODE> = <CODE>#\Linefeed</CODE> = <CODE>#\Lf</CODE>
  <BR><CODE>(code-char #x0B)</CODE> = <CODE>#\Vt</CODE>
  <BR><CODE>(code-char #x0C)</CODE> = <CODE>#\Page</CODE> = <CODE>#\Ff</CODE>
  <BR><CODE>(code-char #x0D)</CODE> = <CODE>#\Return</CODE> = <CODE>#\Cr</CODE>
  <BR><CODE>(code-char #x0E)</CODE> = <CODE>#\So</CODE>
  <BR><CODE>(code-char #x0F)</CODE> = <CODE>#\Si</CODE>
  <BR><CODE>(code-char #x10)</CODE> = <CODE>#\Code16</CODE>
  <BR><CODE>(code-char #x11)</CODE> = <CODE>#\Code17</CODE>
  <BR><CODE>(code-char #x12)</CODE> = <CODE>#\Code18</CODE>
  <BR><CODE>(code-char #x13)</CODE> = <CODE>#\Code19</CODE>
  <BR><CODE>(code-char #x14)</CODE> = <CODE>#\Code20</CODE>
  <BR><CODE>(code-char #x15)</CODE> = <CODE>#\Code21</CODE>
  <BR><CODE>(code-char #x16)</CODE> = <CODE>#\Code22</CODE>
  <BR><CODE>(code-char #x17)</CODE> = <CODE>#\Code23</CODE>
  <BR><CODE>(code-char #x18)</CODE> = <CODE>#\Code24</CODE>
  <BR><CODE>(code-char #x19)</CODE> = <CODE>#\Code25</CODE>
  <BR><CODE>(code-char #x1A)</CODE> = <CODE>#\Code26</CODE>
  <BR><CODE>(code-char #x1B)</CODE> = <CODE>#\Escape</CODE> = <CODE>#\Esc</CODE>
  <BR><CODE>(code-char #x1C)</CODE> = <CODE>#\Code28</CODE>
  <BR><CODE>(code-char #x1D)</CODE> = <CODE>#\Code29</CODE>
  <BR><CODE>(code-char #x1E)</CODE> = <CODE>#\Code30</CODE>
  <BR><CODE>(code-char #x1F)</CODE> = <CODE>#\Code31</CODE>
  <BR><CODE>(code-char #x20)</CODE> = <CODE>#\Space</CODE>
  <BR><CODE>(code-char #x7F)</CODE> = <CODE>#\Rubout</CODE>
  <BR><CODE>(code-char #x9B)</CODE> = <CODE>#\Csi</CODE>
</DD>
</DL>
<!-- #endif -->
<!-- #if defined(MSDOS_CHARNAMES) || defined(WIN32_CHARNAMES) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
      <CODE>(code-char #x00)</CODE> = <CODE>#\Null</CODE>
  <BR><CODE>(code-char #x07)</CODE> = <CODE>#\Bell</CODE>
  <BR><CODE>(code-char #x08)</CODE> = <CODE>#\Backspace</CODE> = <CODE>#\Rubout</CODE>
  <BR><CODE>(code-char #x09)</CODE> = <CODE>#\Tab</CODE>
  <BR><CODE>(code-char #x0A)</CODE> = <CODE>#\Newline</CODE> = <CODE>#\Linefeed</CODE>
  <BR><CODE>(code-char #x0B)</CODE> = <CODE>#\Code11</CODE>
  <BR><CODE>(code-char #x0C)</CODE> = <CODE>#\Page</CODE>
  <BR><CODE>(code-char #x0D)</CODE> = <CODE>#\Return</CODE>
  <BR><CODE>(code-char #x1A)</CODE> = <CODE>#\Code26</CODE>
  <BR><CODE>(code-char #x1B)</CODE> = <CODE>#\Escape</CODE>
  <BR><CODE>(code-char #x20)</CODE> = <CODE>#\Space</CODE>
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef UNIX_CHARNAMES -->
<DL>
<DT><EM>Platform dependent: UNIX, Acorn platforms only.</EM></DT>
<DD>
      <CODE>(code-char #x00)</CODE> = <CODE>#\Null</CODE> = <CODE>#\Nul</CODE>
  <BR><CODE>(code-char #x01)</CODE> = <CODE>#\Soh</CODE>
  <BR><CODE>(code-char #x02)</CODE> = <CODE>#\Stx</CODE>
  <BR><CODE>(code-char #x03)</CODE> = <CODE>#\Etx</CODE>
  <BR><CODE>(code-char #x04)</CODE> = <CODE>#\Eot</CODE>
  <BR><CODE>(code-char #x05)</CODE> = <CODE>#\Enq</CODE>
  <BR><CODE>(code-char #x06)</CODE> = <CODE>#\Ack</CODE>
  <BR><CODE>(code-char #x07)</CODE> = <CODE>#\Bell</CODE> = <CODE>#\Bel</CODE>
  <BR><CODE>(code-char #x08)</CODE> = <CODE>#\Backspace</CODE> = <CODE>#\Bs</CODE>
  <BR><CODE>(code-char #x09)</CODE> = <CODE>#\Tab</CODE> = <CODE>#\Ht</CODE>
  <BR><CODE>(code-char #x0A)</CODE> = <CODE>#\Newline</CODE> = <CODE>#\Nl</CODE> = <CODE>#\Linefeed</CODE>
  <BR><CODE>(code-char #x0B)</CODE> = <CODE>#\Vt</CODE>
  <BR><CODE>(code-char #x0C)</CODE> = <CODE>#\Page</CODE> = <CODE>#\Np</CODE>
  <BR><CODE>(code-char #x0D)</CODE> = <CODE>#\Return</CODE> = <CODE>#\Cr</CODE>
  <BR><CODE>(code-char #x0E)</CODE> = <CODE>#\So</CODE>
  <BR><CODE>(code-char #x0F)</CODE> = <CODE>#\Si</CODE>
  <BR><CODE>(code-char #x10)</CODE> = <CODE>#\Dle</CODE>
  <BR><CODE>(code-char #x11)</CODE> = <CODE>#\Dc1</CODE>
  <BR><CODE>(code-char #x12)</CODE> = <CODE>#\Dc2</CODE>
  <BR><CODE>(code-char #x13)</CODE> = <CODE>#\Dc3</CODE>
  <BR><CODE>(code-char #x14)</CODE> = <CODE>#\Dc4</CODE>
  <BR><CODE>(code-char #x15)</CODE> = <CODE>#\Nak</CODE>
  <BR><CODE>(code-char #x16)</CODE> = <CODE>#\Syn</CODE>
  <BR><CODE>(code-char #x17)</CODE> = <CODE>#\Etb</CODE>
  <BR><CODE>(code-char #x18)</CODE> = <CODE>#\Can</CODE>
  <BR><CODE>(code-char #x19)</CODE> = <CODE>#\Em</CODE>
  <BR><CODE>(code-char #x1A)</CODE> = <CODE>#\Sub</CODE>
  <BR><CODE>(code-char #x1B)</CODE> = <CODE>#\Escape</CODE> = <CODE>#\Esc</CODE>
  <BR><CODE>(code-char #x1C)</CODE> = <CODE>#\Fs</CODE>
  <BR><CODE>(code-char #x1D)</CODE> = <CODE>#\Gs</CODE>
  <BR><CODE>(code-char #x1E)</CODE> = <CODE>#\Rs</CODE>
  <BR><CODE>(code-char #x1F)</CODE> = <CODE>#\Us</CODE>
  <BR><CODE>(code-char #x20)</CODE> = <CODE>#\Space</CODE> = <CODE>#\Sp</CODE>
  <BR><CODE>(code-char #x7F)</CODE> = <CODE>#\Rubout</CODE> = <CODE>#\Delete</CODE> = <CODE>#\Del</CODE>
</DD>
</DL>
<!-- #endif -->

<H3>13.5.</H3>

<TABLE>
 <TR> <TD><CODE>char-control-bit</CODE> <TD>= 1
 <TR> <TD><CODE>char-meta-bit</CODE>    <TD>= 2
 <TR> <TD><CODE>char-super-bit</CODE>   <TD>= 4
 <TR> <TD><CODE>char-hyper-bit</CODE>   <TD>= 8
</TABLE>


<H2>Chapter 14: Sequences</H2>

The CLtL2 function <CODE>complement</CODE> is implemented.

<H3>14.1.</H3>

The result of <CODE>nreverse</CODE> is always <CODE>eq</CODE> to the argument. <CODE>nreverse</CODE> on a vector
swaps pairs of elements. <CODE>nreverse</CODE> on a list swaps the first and the last
element and reverses the list chaining between them.

<H3>14.2.</H3>

For iteration through a sequence, a macro <STRONG><CODE>doseq</CODE></STRONG>, analogous to <CODE>dolist</CODE>, may be
used instead of <CODE>map</CODE> :
  <CODE>(doseq (<VAR>var</VAR> <VAR>seqform</VAR> [<VAR>resultform</VAR>]) {<VAR>declaration</VAR>}* {<VAR>tag</VAR>|<VAR>statement</VAR>}* )</CODE>
<P>
The CLtL2 function <CODE>map-into</CODE> is implemented.

<H3>14.3.</H3>

<CODE>remove</CODE>, <CODE>remove-if</CODE>, <CODE>remove-if-not</CODE>, <CODE>remove-duplicates</CODE> return their argument
unchanged, if no element has to be removed.

<CODE>delete</CODE>, <CODE>delete-if</CODE>, <CODE>delete-if-not</CODE>, <CODE>delete-duplicates</CODE> destructively modify
their argument: If the argument is a list, the <CODE>cdr</CODE> parts are modified. If
the argument is a vector with fill pointer, the fill pointer is lowered and
the remaining elements are compacted below the new fill pointer.

<H3>14.5.</H3>

<CODE>sort</CODE> and <CODE>stable-sort</CODE> have two additional keywords <CODE>:start</CODE> and <CODE>:end</CODE> :<PRE><CODE>
  (sort <VAR>sequence</VAR> <VAR>predicate</VAR> &amp;key :key :start :end)
  (stable-sort <VAR>sequence</VAR> <VAR>predicate</VAR> &amp;key :key :start :end)
</CODE></PRE>
<P>
<CODE>sort</CODE> and <CODE>stable-sort</CODE> are identical. They implement the mergesort algorithm.


<H2>Chapter 15: Lists</H2>

<H3>15.4.</H3>

<CODE>sublis</CODE> and <CODE>nsublis</CODE> apply the <CODE>:key</CODE> argument to the nodes of the cons tree and
not to the keys of the alist.


<H2>Chapter 16: Hash Tables</H2>

<H3>16.1.</H3>

<CODE>make-hash-table</CODE> has an additional keyword <CODE>:initial-contents</CODE> :
  <CODE>(make-hash-table &amp;key :test :initial-contents :size :rehash-size
                        :rehash-threshold)</CODE>
The <CODE>:initial-contents</CODE> argument is an alist that is used to initialize the
new hash table.
The <CODE>:rehash-threshold</CODE> argument is ignored.
<P>
For iteration through a hash table, a macro <STRONG><CODE>dohash</CODE></STRONG>, analogous to <CODE>dolist</CODE>, can
be used instead of <CODE>maphash</CODE> :
<PRE><CODE>(dohash (<VAR>key-var</VAR> <VAR>value-var</VAR> <VAR>hash-table-form</VAR> [<VAR>resultform</VAR>])
  {<VAR>declaration</VAR>}* {<VAR>tag</VAR>|<VAR>statement</VAR>}*
)
</CODE></PRE>


<H2>Chapter 17: Arrays</H2>

<H3>17.1.</H3>

<CODE>make-array</CODE> can return specialized arrays for the element types
<CODE>(unsigned-byte 2)</CODE>, <CODE>(unsigned-byte 4)</CODE>, <CODE>(unsigned-byte 8)</CODE>, <CODE>(unsigned-byte 16)</CODE>,
<CODE>(unsigned-byte 32)</CODE> and of course <CODE>bit</CODE> and <CODE>string-char</CODE>.
<P>
<CODE>array-rank-limit</CODE> is either 65536 or 4294967296.
<P>
<CODE>array-dimension-limit</CODE> = 2<SUP>24</SUP> = 16777216
<BR>
<CODE>array-total-size-limit</CODE> = 2<SUP>24</SUP> = 16777216

<H3>17.6.</H3>

An array to which another array is displaced should not be shrunk (using
<CODE>adjust-array</CODE>) in such a way that the other array points into void space.
This is not checked at the time <CODE>adjust-array</CODE> is called!


<H2>Chapter 18: Strings</H2>

<H3>18.2.</H3>

String comparison is based on the function <CODE>char&lt;=</CODE>. Therefore diphtongs do
not obey the usual national rules. Example: <CODE>&quot;o&quot;</CODE> &lt; <CODE>&quot;oe&quot;</CODE> &lt; <CODE>&quot;z&quot;</CODE> &lt; <CODE>&quot;&ouml;&quot;</CODE>.


<H2>Chapter 19: Structures</H2>

<H3>19.5.</H3>

The <CODE>:print-function</CODE> option should contain a lambda expression
  <CODE>(lambda (structure stream depth) (declare (ignore depth)) ...)</CODE>
This lambda expression names a function whose task is to output the external
representation of structure onto the stream. This may be done by outputting
text onto the stream using <CODE>write-char</CODE>, <CODE>write-string</CODE>, <CODE>write</CODE>, <CODE>prin1</CODE>, <CODE>princ</CODE>,
<CODE>print</CODE>, <CODE>pprint</CODE>, <CODE>format</CODE> and the like. The following rules must be obeyed:
<UL>
<LI>The value of <CODE>*print-escape*</CODE> must be respected.
<LI>The value of <CODE>*print-pretty*</CODE> should not and cannot be respected, since the
  pretty-print mechanism is not accessible from outside.
<LI>The value of <CODE>*print-circle*</CODE> need not to be respected. This is managed by
  the system. (But the print-circle mechanism handles only those objects that
  are (direct or indirect) components of structure.)
<LI>The value of <CODE>*print-level*</CODE> is respected by
  <CODE>write</CODE>, <CODE>prin1</CODE>, <CODE>princ</CODE>, <CODE>print</CODE>, <CODE>pprint</CODE>, <CODE>format ~A</CODE>, <CODE>format ~S</CODE>, <CODE>format ~W</CODE> and
  <CODE>format ~D,~B,~O,~X,~R,~F,~E,~G,~$</CODE> with not-numerical arguments.
  Therefore the print-level mechanism works automatically if only these
  functions are used for outputting objects and if they are not called on
  objects with nesting level &gt; 1. (The print-level mechanism does not
  recognize how many parentheses you have output. It only counts how many
  times it was called recursively.)
<LI>The value of <CODE>*print-length*</CODE> must be respected, especially if you are
  outputting an arbitrary number of components.
<LI>The value of <CODE>*print-readably*</CODE> must be respected. Remember that the values
  of <CODE>*print-escape*</CODE>, <CODE>*print-level*</CODE>, <CODE>*print-length*</CODE> don't matter if
  <CODE>*print-readably*</CODE> is true.
  The value of <CODE>*print-readably*</CODE> is respected by <CODE>print-unreadable-object</CODE>,
  <CODE>write</CODE>, <CODE>prin1</CODE>, <CODE>princ</CODE>, <CODE>print</CODE>, <CODE>pprint</CODE>, <CODE>format ~A</CODE>, <CODE>format ~S</CODE>, <CODE>format ~W</CODE> and
  <CODE>format ~D,~B,~O,~X,~R,~F,~E,~G,~$</CODE> with not-numerical arguments.
  Therefore <CODE>*print-readably*</CODE> will be respected automatically if only these
  functions are used for outputting objects.
<LI>You need not bother about the values of <CODE>*print-base*</CODE>, <CODE>*print-radix*</CODE>,
  <CODE>*print-case*</CODE>, <CODE>*print-gensym*</CODE>, <CODE>*print-array*</CODE>, <CODE>*print-closure*</CODE>, <CODE>*print-rpars*</CODE>,
  <CODE>*print-indent-lists*</CODE>.
</UL>
<P>
The <CODE>:inherit</CODE> option is exactly like <CODE>:include</CODE> except that it doesn't create
new accessors for the inherited slots. Use this option to avoid the problems
that occur when using the same <CODE>:conc-name</CODE> for the new and the inherited
structure.


<H2>Chapter 20: The Evaluator</H2>

As in Scheme, the Macro <CODE>(the-environment)</CODE> returns the current lexical
environment. This works only in interpreted code and is not compilable!
<P>
<CODE>(eval-env <VAR>form</VAR> [<VAR>env</VAR>])</CODE> evaluates a form in a given lexical environment, just
if the form had been part of the program text that environment came from.


<H2>Chapter 21: Streams</H2>

<H3>21.1.</H3>

<!-- #ifdef GNU_READLINE -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2 platforms only, and only in clisp binaries built without compile-time flag <CODE>NO_READLINE</CODE>.</EM></DT>
<DD>
Input through <CODE>*terminal-io*</CODE> uses the GNU readline library. Arrow keys can be
used to move within the input history. The Tab key completes the symbol's
name that is being typed.
See <A HREF="newreadline/doc/readline.dvi">readline.dvi</A> for a complete description of the key bindings.
The GNU readline library is not used if standard input and standard output do
not both refer to the same terminal.
</DD>
</DL>
<P>
<!-- #endif -->
<!-- #if defined(KEYBOARD) || defined(AMIGAOS) -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Amiga, Acorn platforms only.</EM></DT>
<DD>
<CODE>*terminal-io*</CODE> is not the only stream that communicates directly with the
user: During execution of the body of a <CODE>(<STRONG>with-keyboard</STRONG> . <VAR>body</VAR>)</CODE> form,
<STRONG><CODE>*keyboard-input*</CODE></STRONG> is the stream that reads the keystrokes from the keyboard.
It returns every keystroke in detail, as character with the following bits:
<DL>
<!-- #if defined(MSDOS) || defined(WIN32) || defined(AMIGAOS) -->
  <DT><CODE>hyper</CODE></DT>        <DD><EM>(Platform dependent: DOS, OS/2, Win32, Amiga platforms only.)</EM> if a non-standard key. These are:
<!-- #if defined(MSDOS) || defined(WIN32) -->
                 Function keys, cursor keypads, numeric keypad <EM>(Platform dependent: DOS, OS/2, Win32 platforms only)</EM>.
<!-- #endif -->
<!-- #ifdef AMIGAOS -->
                 Function keys, cursor keypad <EM>(Platform dependent: Amiga platforms only)</EM>.
<!-- #endif -->
  </DD>
<!-- #endif -->
  <DT><CODE>char-code</CODE>    <DD>the Ascii code for standard keys,
               for non-standard keys:
               <DL>
<!-- #ifdef MSDOS -->
               <DT><EM>Platform dependent: DOS, OS/2 platforms only.</EM></DT>
               <DD>
                 F1 -&gt; <CODE>#\F1</CODE>, ..., F10 -&gt; <CODE>#\F10</CODE>, F11 -&gt; <CODE>#\F11</CODE>, F12 -&gt; <CODE>#\F12</CODE>,
                 Insert -&gt; <CODE>#\Insert</CODE>, Delete -&gt; <CODE>#\Delete</CODE>,
                 Home -&gt; <CODE>#\Home</CODE>, End -&gt; <CODE>#\End</CODE>, PgUp -&gt; <CODE>#\PgUp</CODE>, PgDn -&gt; <CODE>#\PgDn</CODE>,
                 Arrow keys -&gt; <CODE>#\Up</CODE>, <CODE>#\Down</CODE>, <CODE>#\Left</CODE>, <CODE>#\Right</CODE>.
               </DD>
<!-- #endif -->
<!-- #if defined(UNIX) || defined(WIN32) -->
               <DT><EM>Platform dependent: UNIX, Win32 platforms only.</EM></DT>
               <DD>
                 F1 -&gt; <CODE>#\F1</CODE>, ..., F10 -&gt; <CODE>#\F10</CODE>, F11 -&gt; <CODE>#\F11</CODE>, F12 -&gt; <CODE>#\F12</CODE>,
                 Insert -&gt; <CODE>#\Insert</CODE>, Delete -&gt; <CODE>#\Delete</CODE>, Center -&gt; <CODE>#\Center</CODE>,
                 Home -&gt; <CODE>#\Home</CODE>, End -&gt; <CODE>#\End</CODE>, PgUp -&gt; <CODE>#\PgUp</CODE>, PgDn -&gt; <CODE>#\PgDn</CODE>,
                 Arrow keys -&gt; <CODE>#\Up</CODE>, <CODE>#\Down</CODE>, <CODE>#\Left</CODE>, <CODE>#\Right</CODE>.
               </DD>
<!-- #endif -->
<!-- #ifdef AMIGAOS -->
               <DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
               <DD>
                 F1 -&gt; <CODE>#\F1</CODE>, ..., F9 -&gt; <CODE>#\F9</CODE>, F10 -&gt; <CODE>#\F10</CODE>,
                 Help -&gt; <CODE>#\Help</CODE>,
                 Arrow keys -&gt; <CODE>#\Up</CODE>, <CODE>#\Down</CODE>, <CODE>#\Left</CODE>, <CODE>#\Right</CODE>.
               </DD>
<!-- #endif -->
               </DL>
  </DD>
<!-- #if defined(MSDOS) || defined(WIN32) || defined(AMIGAOS) -->
  <DT><CODE>super</CODE></DT>        <DD><EM>(Platform dependent: DOS, OS/2, Win32, Amiga platforms only.)</EM> if pressed together with Shift key(s) and if the keystroke
               would have been an other without Shift.
  </DD>
<!-- #endif -->
  <DT><CODE>control</CODE></DT>      <DD>if pressed together with the Control key.
  </DD>
<!-- #if defined(MSDOS) || defined(WIN32) -->
  <DT><CODE>meta</CODE></DT>         <DD><EM>(Platform dependent: DOS, OS/2, Win32 platforms only.)</EM> if pressed together with the Alternate key.
  </DD>
<!-- #endif -->
</DL>
This keyboard input is not echoed on the screen.
During execution of a <CODE>(with-keyboard . <VAR>body</VAR>)</CODE> form, no input from <CODE>*terminal-io*</CODE>
or any synonymous stream should be requested.
<!-- #ifdef TERMINAL_USES_KEYBOARD -->
<!--
The stream <CODE>*keyboard-input*</CODE> is used by <CODE>*terminal-io*</CODE>.
-->
<!-- #endif -->
</DD>
</DL>
<!-- #endif -->

<H3>21.2.</H3>

The macro <STRONG><CODE>with-output-to-printer</CODE></STRONG>:<BR>
       <CODE>(with-output-to-printer (</VAR>var</VAR>) {<VAR>declaration</VAR>}* {<VAR>form</VAR>}*)</CODE>
binds the variable <VAR>var</VAR> to an output stream that sends its output to the
printer.
<!-- #ifdef PIPES -->
<P>
<DL>
<DT><EM>Platform dependent: UNIX, OS/2, Win32 platforms only.</EM></DT>
<DD>
<CODE>(<STRONG>make-pipe-input-stream</STRONG> <VAR>command</VAR>)</CODE> returns an input stream that will supply the
output from the execution of the given operating system command.
See also <A HREF="#shell"><CODE>(shell <VAR>command</VAR>)</CODE></A>.
<P>
<CODE>(<STRONG>make-pipe-output-stream</STRONG> <VAR>command</VAR>)</CODE> returns an output stream that will pass its
output as input to the execution of the given operating system command.
See also <A HREF="#shell"><CODE>(shell <VAR>command</VAR>)</CODE></A>.
<!-- #ifdef PIPES2 -->
<P>
<CODE>(<STRONG>make-pipe-io-stream</STRONG> <VAR>command</VAR>)</CODE> returns three values. The first value is a
bidirectional stream that will simultaneously pass its output as input to
the execution of the given operating system command and supply the output
from this command as input. The second and third value will be the input
stream and the output stream that make up the I/O stream, respectively.
Note that they must be closed individually.
<BR>
Warning: Improper use of this function can lead to deadlocks. You use it at
your own risk!
<BR>
A deadlock occurs if the command and your program either both try to read
from each other at the same time or both try to write to each other at
the same time. To avoid deadlocks, it is recommended that you fix a protocol
between the command and your program and avoid any hidden buffering: Use
<CODE>read-char</CODE>, <CODE>read-char-no-hang</CODE>, <CODE>listen</CODE> instead of <CODE>read-line</CODE> and <CODE>read</CODE> on the
input side, and complete every output operation by a <CODE>finish-output</CODE>. The same
cautions must apply to the called command as well.
See also <A HREF="#shell"><CODE>(shell <VAR>command</VAR>)</CODE></A>.
<!-- #endif -->
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef GENERIC_STREAMS -->
<H4>Generic streams</H4>
Generic streams are user programmable streams. The programmer interface:
<DL>
  <DT><CODE>(<STRONG>make-generic-stream</STRONG> <VAR>controller</VAR>)</CODE></DT> <DD>returns a generic stream.</DD>

  <DT><CODE>(<STRONG>generic-stream-controller</STRONG> <VAR>stream</VAR>)</CODE></DT>
     <DD>returns a private object to which generic stream methods dispatch.
     The typical usage is to retrieve the object originally provided by the
     user in <CODE>make-generic-stream</CODE>.</DD>

  <DT><CODE>(<STRONG>generic-stream-p</STRONG> <VAR>stream</VAR>)</CODE></DT>
    <DD>determines whether a stream is a generic stream, returning <CODE>t</CODE> if it is,
    <CODE>nil</CODE> otherwise.</DD>
</DL>
In order to specify the behaviour of a generic stream, the user must define
CLOS methods on the following CLOS generic functions. The function
<CODE>generic-stream-<VAR>xyz</VAR></CODE> corresponds to the Common Lisp function <CODE><VAR>xyz</VAR></CODE>. They all
take a controller and some number of arguments.
<DL>
  <DT><CODE>(generic-stream-read-char    <VAR>controller</VAR>)</CODE></DT>
  <DD>   Returns and consumes the next character, <CODE>nil</CODE> at end of file.
         Takes one argument, the controller object.
  </DD>
  <DT><CODE>(generic-stream-peek-char    <VAR>controller</VAR>)</CODE></DT>
  <DD>   Returns the next character, <CODE>nil</CODE> at end of file. A second value
         indicates whether the side effects associated with consuming the
         character were executed: <CODE>t</CODE> means that a full <CODE>read-char</CODE> was done,
         <CODE>nil</CODE> means that no side effects were done.
         Takes one argument, the controller object.
  </DD>
  <DT><CODE>(generic-stream-read-byte    <VAR>controller</VAR>)</CODE></DT>
  <DD>   Returns and consumes the next integer, <CODE>nil</CODE> at end of file.
         Takes one argument, the controller object.
  </DD>
  <DT><A name=generic-stream-listen></A>
      <CODE>(generic-stream-listen       <VAR>controller</VAR>)</CODE></DT>
  <DD>
    <P>
    This generic function is used to query the stream's input status.
    The possible return values are the same as for the
    <CODE><A HREF="#real-listen">sys::real-listen</CODE></A> function.
    </P>
    <DL COMPACT>
      <DT><CODE>:eof</CODE></DT>             <DD>means EOF</DD>
      <DT><CODE>:input-available</CODE></DT> <DD>means a character (or byte) pending</DD>
      <DT><CODE>:wait</CODE></DT>            <DD>means no input available.</DD>
    </DL>
  </DD>
  <DT><CODE>(generic-stream-write-char   <VAR>controller</VAR> <VAR>ch</VAR>)</CODE></DT>
  <DD>   First argument is the controller object.
         Second argument is the character to be written.
  </DD>
  <DT><CODE>(generic-stream-write-byte   <VAR>controller</VAR> <VAR>by</VAR>)</CODE></DT>
  <DD>   First argument is the controller object.
         Second argument is the integer to be written.
  </DD>
  <DT><CODE>(generic-stream-write-string <VAR>controller</VAR> <VAR>string</VAR> <VAR>start</VAR> <VAR>len</VAR>)</CODE></DT>
  <DD>   Called with argument list <CODE>(<VAR>controller</VAR> <VAR>string</VAR> <VAR>start</VAR> <VAR>len</VAR>)</CODE>,
         this function shall write
           <CODE>(subseq (the string <VAR>string</VAR>) <VAR>start</VAR> (+ <VAR>start</VAR> <VAR>len</VAR>))</CODE>
         First argument is the controller object.
  </DD>
  <DT><CODE>(generic-stream-clear-input   <VAR>controller</VAR>)</CODE></DT>
  <DT><CODE>(generic-stream-clear-output  <VAR>controller</VAR>)</CODE></DT>
  <DT><CODE>(generic-stream-finish-output <VAR>controller</VAR>)</CODE></DT>
  <DT><CODE>(generic-stream-force-output  <VAR>controller</VAR>)</CODE></DT>
  <DT><CODE>(generic-stream-close         <VAR>controller</VAR>)</CODE></DT>
  <DD>   Takes one argument, the controller object.
  </DD>
</DL>
<!-- #endif -->

<H3>21.3.</H3>

The CLtL2 function <CODE>open-stream-p</CODE> is implemented.
<P>
<CODE>close</CODE> ignores its <CODE>:abort</CODE> argument.
<P>
The CLtL2 functions <CODE>broadcast-stream-streams</CODE>, <CODE>concatenated-stream-streams</CODE>,
<CODE>echo-stream-input-stream</CODE>, <CODE>echo-stream-output-stream</CODE>, <CODE>synonym-stream-symbol</CODE>,
<CODE>two-way-stream-input-stream</CODE>, <CODE>two-way-stream-output-stream</CODE> are implemented.


<H2>Chapter 22: Input/Output</H2>

<H3>22.1.2.</H3>

A &quot;reserved token&quot;, i.e. a token that has potential number syntax but cannot
be interpreted as a number, is interpreted as symbol when being read. (CLtL1
p. 341)
<P>
When a token with package markers is read, then (CLtL1 p. 343/344) no
checking is done whether the package part and the symbol-name part do not
have number syntax. (What's the purpose of this check?) So we consider
tokens like <CODE>USER::</CODE> or <CODE>:1</CODE> or <CODE>LISP::4711</CODE> or <CODE>21:3</CODE> as symbols.

<H3>22.1.3.</H3>

The backquote read macro also works when nested. Example:
<PRE>
   <CODE>(eval ``(,#'(lambda () ',a) ,#'(lambda () ',b)))</CODE>
 = <CODE>(eval `(list #'(lambda () ',a) #'(lambda () ',b)))</CODE>
 = <CODE>(eval (list 'list (list 'function (list 'lambda nil (list 'quote a)))
                     (list 'function (list 'lambda nil (list 'quote b)))
   )     )</CODE>
</PRE>
<P>
Multiple backquote combinations like <CODE>,,@</CODE> or <CODE>,@,@</CODE> are not implemented. Their
use would be confusing anyway.

<A NAME="22.1.4.">
<H3>22.1.4.</H3>

<CODE>#\</CODE> allows inputting characters of arbitrary code: <CODE>#\Code231</CODE> yields the
character <CODE>(code-char 231.)</CODE>.
<P>
Additional read dispatch macros:
<UL>
<LI><CODE>#Y</CODE> is used to read compiled functions.
<LI><CODE>#&quot;</CODE> is used to read pathnames:
     <CODE>#&quot;test.lsp&quot;</CODE> is the value of <CODE>(pathname &quot;test.lsp&quot;)</CODE>
<DL>
<!-- #if defined(MSDOS) -->
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
     As in all strings, backslashes must be written twice here:
     <CODE>#&quot;A:\\programs\\test.lsp&quot;</CODE>
</DD>
<!-- #endif -->
<!-- #ifdef RISCOS -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
     As in all strings, backslashes must be written twice here:
     <CODE>#&quot;\\.test.lsp&quot;</CODE>
</DD>
<!-- #endif -->
</DL>
</UL>

<H3>22.1.5.</H3>

The CLtL2 place <CODE>readtable-case</CODE> is implemented. When the value of
<CODE>(readtable-case <VAR>readtable</VAR>)</CODE> is <CODE>:invert</CODE>, it applies to the package name and
the symbol name of a symbol separately (not to the entire token at once).
An alternative to the use of <CODE>readtable-case</CODE> is the use of the
<CODE>:case-sensitive</CODE> option to <CODE>make-package</CODE>, <CODE>in-package</CODE> and <CODE>defpackage</CODE>.

<H3>22.1.6.</H3>

In absence of <CODE>sys::write-float</CODE>, floating point numbers are output in radix 2.
<P>
If <CODE>*print-readably*</CODE> is true, <CODE>*read-default-float-format*</CODE> has no influence on
the way floating point numbers are printed.
<P>
Pathnames are printed as follows: If <CODE>*print-escape*</CODE> is <CODE>nil</CODE>, only the
namestring is printed; otherwise it is printed with <CODE>#P&quot;&quot;</CODE> syntax, as per
ANSI CL &lt;PRINT-READABLY-BEHAVIOR:CLARIFY&gt;.  But, if <CODE>*print-readably*</CODE> is true,
we are in trouble as <CODE>#P&quot;&quot;</CODE> is ambiguous (which is verboten when
<CODE>*print-readably*</CODE> is true), while being mandated by the ANSI.  Therefore, in
this case, we print it like this:
<P> <CODE>#-CLISP #P&quot;...&quot; #+CLISP #S(PATHNAME ...)</CODE>
<P>
<CODE>*print-case*</CODE> controls the output not only of symbols, but also of characters
and some <CODE>#&lt;...&gt;</CODE> objects.
<P>
<DL>
<!-- #ifndef AMIGAOS -->
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Acorn platforms only.</EM></DT>
<DD>
<CODE>*print-pretty*</CODE> is initially = <CODE>nil</CODE> but set to <CODE>t</CODE> in <CODE>config.lsp</CODE>. This makes
screen output prettier.
</DD>
<!-- #else -->
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD>
<CODE>*print-pretty*</CODE> is initially = <CODE>nil</CODE> but set to <CODE>t</CODE> in <CODE>config.lsp</CODE>. This makes
unbuffered screen output much faster.
</DD>
<!-- #endif -->
</DL>
<P>
<CODE>*print-array*</CODE> is initially = <CODE>t</CODE>.
<P>
An additional variable <STRONG><CODE>*print-closure*</CODE></STRONG> controls whether compiled and
interpreted functions (closures) are output in detailed form. If
<CODE>*print-closure*</CODE> /= <CODE>nil</CODE>, compiled closures are output in <CODE>#Y</CODE> syntax the reader
understands. <CODE>*print-closure*</CODE> is initially = <CODE>nil</CODE>.
<P>
An additional variable <STRONG><CODE>*print-rpars*</CODE></STRONG> controls the output of right (closing)
parentheses. If <CODE>*print-rpars*</CODE> /= <CODE>nil</CODE>, closing parentheses which don't fit
onto the same line as the the corresponding opening parenthesis are output
just below their corresponding opening parenthesis, in the same column.
<CODE>*print-rpars*</CODE> is initially = <CODE>t</CODE>.
<P>
An additional variable <STRONG><CODE>*print-indent-lists*</CODE></STRONG> controls the indentation of lists
that span more than one line. It specifies by how many characters items
within the list will be indented relative to the beginning of the list.
<CODE>*print-indent-lists*</CODE> is initially = <CODE>2</CODE>.
<P>
The CLtL2 macro <CODE>with-standard-io-syntax</CODE> is implemented.

<H3>22.2.1.</H3>

The function <STRONG><CODE>read-char-sequence</CODE></STRONG> performs multiple <CODE>read-char</CODE> operations:
<CODE>(read-char-sequence <VAR>sequence</VAR> <VAR>stream</VAR> [:start] [:end])</CODE> fills the
subsequence of <VAR>sequence</VAR> specified by <VAR><CODE>:start</CODE></VAR> and <VAR><CODE>:end</CODE></VAR> with characters
consecutively read from <VAR>stream</VAR>. It returns the index of the first element
of <VAR>sequence</VAR> that was not updated (= <VAR>end</VAR> or &lt; <VAR>end</VAR> if the stream reached its
end).
This function is especially efficient if <VAR>sequence</VAR> is a string and <VAR>stream</VAR> is
a file stream with element type <VAR>string-char</VAR>, a pipe stream or a string input
stream.

<DL>
  <DT>
    <A NAME=real-listen></A>
    <CODE>(system::<STRONG>real-listen</STRONG> <VAR>stream</VAR>)</CODE>
  </DT>
  <DD>
    <P>
    <CODE>sys::real-listen</CODE> is a variant of the standard
    <CODE>listen</CODE> function, which returns more detailed information 
    about the stream's input status. The return value is one of:
    </P>
    <DL COMPACT>
      <DT><CODE>:eof</CODE></DT>             <DD>means EOF</DD>
      <DT><CODE>:input-available</CODE></DT> <DD>means a character (or byte) pending</DD>
      <DT><CODE>:wait</CODE></DT>            <DD>means no input available.</DD>
    </DL>
    <P>
    The return values are the same as for the 
    <CODE><A HREF="#generic-stream-listen">generic-stream-listen</A></CODE> 
    method, so this function is a good fit to define some generic streams
    based upon other CLISP streams.
    </P>
  </DD>
</DL>

<H3>22.2.2.</H3>

The function <STRONG><CODE>read-byte-sequence</CODE></STRONG> performs multiple <CODE>read-byte</CODE> operations:
<CODE>(read-byte-sequence <VAR>sequence</VAR> <VAR>stream</VAR> [:start] [:end])</CODE> fills the
subsequence of <VAR>sequence</VAR> specified by <VAR><CODE>:start</CODE></VAR> and <VAR><CODE>:end</CODE></VAR> with integers
consecutively read from <VAR>stream</VAR>. It returns the index of the first element
of <VAR>sequence</VAR> that was not updated (= <VAR>end</VAR> or &lt; <VAR>end</VAR> if the stream reached its
end).
This function is especially efficient if <VAR>sequence</VAR> is a
<CODE>(vector (unsigned-byte 8))</CODE> and <VAR>stream</VAR> is a file stream with element type
<CODE>(unsigned-byte 8)</CODE> or a pipe stream.

<H3>22.3.1.</H3>

The functions <CODE>write</CODE> and <CODE>write-to-string</CODE> have an additional keyword <CODE>:closure</CODE>
that can be used to bind <CODE>*print-closure*</CODE>.
<P>
The CLtL2 macro <CODE>print-unreadable-object</CODE> is implemented.
<P>
The function <STRONG><CODE>write-char-sequence</CODE></STRONG> performs multiple <CODE>write-char</CODE> operations:
<CODE>(write-char-sequence <VAR>sequence</VAR> <VAR>stream</VAR> [:start] [:end])</CODE> outputs the characters
of the subsequence of <VAR>sequence</VAR> specified by <VAR><CODE>:start</CODE></VAR> and <VAR><CODE>:end</CODE></VAR> to <VAR>stream</VAR>.
It returns <VAR>sequence</VAR>.
This function is especially efficient if <VAR>sequence</VAR> is a string and <VAR>stream</VAR> is
a file stream with element type <CODE>string-char</CODE> or a pipe stream.

<H3>22.3.2.</H3>

The function <STRONG><CODE>write-byte-sequence</CODE></STRONG> performs multiple <CODE>write-byte</CODE> operations:
<CODE>(write-byte-sequence <VAR>sequence</VAR> <VAR>stream</VAR> [:start] [:end])</CODE> outputs the integers
of the subsequence of <VAR>sequence</VAR> specified by <VAR><CODE>:start</CODE></VAR> and <VAR><CODE>:end</CODE></VAR> to <VAR>stream</VAR>.
It returns <VAR>sequence</VAR>.
This function is especially efficient if <VAR>sequence</VAR> is a
<CODE>(vector (unsigned-byte 8))</CODE> and <VAR>stream</VAR> is a file stream with element type
<CODE>(unsigned-byte 8)</CODE> or a pipe stream.

<H3>22.3.3.</H3>

The <CODE>format</CODE> option <CODE>~W</CODE> is analogous to <CODE>~A</CODE> and <CODE>~S</CODE>, but avoids binding of
<CODE>*print-escape*</CODE>. <CODE>(format <VAR>stream</VAR> &quot;~W&quot; <VAR>object</VAR>)</CODE> is equivalent to
<CODE>(write <VAR>object</VAR> :stream <VAR>stream</VAR>)</CODE>.
<P>
The <CODE>format</CODE> option <CODE>~!</CODE> is analogous to <CODE>~/</CODE>,
but avoids putting a function name into a string.
<CODE>(format <VAR>stream</VAR> "~!" <VAR>function</VAR> <VAR>object</VAR>)</CODE>
is equivalent to
<CODE>(funcall <VAR>function</VAR> <VAR>stream</VAR> <VAR>colon-modifier-p</VAR> <VAR>atsign-modifier-p</VAR> <VAR>object</VAR>)</CODE>.
<P>
<CODE>format ~R</CODE> and <CODE>format ~:R</CODE> can output only integers in the range |n| &lt; 10<SUP>66</SUP>.
The output is in English, according to the American conventions, and these
conventions are identical to the British conventions only in the range
|n| &lt; 10<SUP>9</SUP>.
<P>
<CODE>format ~:@C</CODE> does not output the character itself, only the instruction how
to type the character.
<P>
For <CODE>format ~E</CODE> and <CODE>format ~G</CODE>, the value of <CODE>*read-default-float-format*</CODE> doesn't
matter if <CODE>*print-readably*</CODE> is true.
<P>
<CODE>format ~T</CODE> can determine the current column of any stream.


<H2>Chapter 23: File System Interface</H2>

<H3>23.1.</H3>

For most operations, pathnames denoting files and pathnames denoting
directories can not be used interchangeably.
<DL>
<!-- #if defined(PATHNAME_UNIX) || defined(PATHNAME_AMIGAOS) -->
<DT><EM>Platform dependent: UNIX, Amiga platforms only.</EM></DT>
<DD>
For example, <CODE>#&quot;FOO/BAR&quot;</CODE> denotes the file <CODE>BAR</CODE> in the directory <CODE>FOO</CODE>, while
<CODE>#&quot;FOO/BAR/&quot;</CODE> denotes the subdirectory <CODE>BAR</CODE> of the directory <CODE>FOO</CODE>.
</DD>
<!-- #endif -->
<!-- #if defined(PATHNAME_MSDOS) || defined(PATHNAME_OS2) || defined(PATHNAME_WIN32) -->
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
For example, <CODE>#&quot;FOO\\BAR&quot;</CODE> denotes the file <CODE>BAR</CODE> in the directory <CODE>FOO</CODE>, while
<CODE>#&quot;FOO\\BAR\\&quot;</CODE> denotes the subdirectory <CODE>BAR</CODE> of the directory <CODE>FOO</CODE>.
</DD>
<!-- #endif -->
<!-- #ifdef PATHNAME_RISCOS -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
For example, <CODE>#&quot;FOO.BAR&quot;</CODE> denotes the file <CODE>FOO</CODE> in the directory <CODE>BAR</CODE>, while
<CODE>#&quot;FOO.BAR.&quot;</CODE> denotes the subdirectory <CODE>BAR</CODE> of the directory <CODE>FOO</CODE>.
</DD>
<!-- #endif -->
</DL>
This is especially important for the functions <CODE>directory</CODE>, <CODE>dir</CODE>, <CODE>cd</CODE>, <CODE>make-dir</CODE>,
<CODE>delete-dir</CODE>.
<P>
The minimum filename syntax that may be used portably is:
<TABLE>
  <TR> <TD><CODE>&quot;<VAR>xxx</VAR>&quot;</CODE>       <TD>for a file with name <VAR>xxx</VAR>,
  <TR> <TD><CODE>&quot;<VAR>xxx</VAR>.<VAR>yy</VAR>&quot;</CODE>    <TD>for a file with name <VAR>xxx</VAR> and type <VAR>yy</VAR>,
  <TR> <TD><CODE>&quot;.<VAR>yy</VAR>&quot;</CODE>       <TD>for a pathname with type <VAR>yy</VAR> and no name specified.
</TABLE>
Hereby <VAR>xxx</VAR> denote 1 to 8 characters, and <VAR>yy</VAR> denote 1 to 3 characters, each of
which being either alphanumerical or the underscore <CODE>#\_</CODE>.
Other properties of pathname syntax vary between operating systems.

<H3>23.1.1.</H3>

<!-- #ifdef PATHNAME_MSDOS -->
<DL>
<DT><EM>Platform dependent: DOS platforms only.</EM></DT>
<DD>
Pathname components:
<DL>
<DT><CODE>host</CODE>          <DD>always <CODE>nil</CODE>
<DT><CODE>device</CODE>        <DD><CODE>nil</CODE> or <CODE>:wild</CODE> or <CODE>&quot;A&quot;</CODE>|...|<CODE>&quot;Z&quot;</CODE>
<DT><CODE>directory</CODE>     <DD><CODE>(<VAR>startpoint</VAR> . <VAR>subdirs</VAR>)</CODE> where
               <BR><VAR>startpoint</VAR> = <CODE>:relative</CODE> | <CODE>:absolute</CODE>
               <BR><VAR>subdirs</VAR> = <CODE>()</CODE> | <CODE>(<VAR>subdir</VAR> . <VAR>subdirs</VAR>)</CODE>
               <BR><VAR>subdir</VAR> = <CODE>:current</CODE> (means <CODE>&quot;.&quot;</CODE>) or
               <BR><VAR>subdir</VAR> = <CODE>:parent</CODE> (means <CODE>&quot;..&quot;</CODE>) or
               <BR><VAR>subdir</VAR> = <CODE>:wild-inferiors</CODE> (means <CODE>&quot;...&quot;</CODE>, all subdirectories) or
               <BR><VAR>subdir</VAR> = <CODE>(<VAR>name</VAR> . <VAR>type</VAR>)</CODE>
                <BR><VAR>name</VAR> = <CODE>:wild</CODE> or a simple string with 8 characters maximum
                <BR><VAR>type</VAR> = <CODE>:wild</CODE> or a simple string with 3 characters maximum
<DT><CODE>name</CODE>          <DD><CODE>nil</CODE> or <CODE>:wild</CODE> or a simple string with 8 characters maximum
<DT><CODE>type</CODE>          <DD><CODE>nil</CODE> or <CODE>:wild</CODE> or a simple string with 3 characters maximum
<DT><CODE>version</CODE>       <DD>always <CODE>nil</CODE> (may also be specified as <CODE>:wild</CODE> or <CODE>:newest</CODE>)
</DL>
<P>
When a pathname is to be fully specified (no wildcards), that means that
no <CODE>:wild</CODE>, <CODE>:wild-inferiors</CODE> is allowed, and <VAR>name</VAR> = <CODE>nil</CODE> may not be allowed either.
<P>
<TABLE>
  <TR> <TD>External notation:        <TD ALIGN=RIGHT><CODE>A:\sub1.typ\sub2.typ\name.typ</CODE>
  <TR> <TD>using defaults:           <TD ALIGN=RIGHT><CODE>  \sub1.typ\sub2.typ\name.typ</CODE>
  <TR> <TD>or                        <TD ALIGN=RIGHT><CODE>                     name.typ</CODE>
  <TR> <TD>or                        <TD ALIGN=LEFT><CODE>*:\sub1.typ\*.*\name.*</CODE>
  <TR> <TD>or similar.
</TABLE>
<P>
Instead of <CODE>'\'</CODE> one may use <CODE>'/'</CODE>, as usual for DOS calls.
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_AMIGAOS -->
<DL>
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD>
Pathname components:
<DL>
<DT><CODE>host</CODE>          <DD>always <CODE>nil</CODE>
<DT><CODE>device</CODE>        <DD><CODE>nil</CODE> or a simple string
<DT><CODE>directory</CODE>     <DD><CODE>(<VAR>startpoint</VAR> . <VAR>subdirs</VAR>)</CODE> where
               <BR><VAR>startpoint</VAR> = <CODE>:relative</CODE> | <CODE>:absolute</CODE>
               <BR><VAR>subdirs</VAR> = <CODE>()</CODE> | <CODE>(<VAR>subdir</VAR> . <VAR>subdirs</VAR>)</CODE>
               <BR><VAR>subdir</VAR> = <CODE>:wild-inferiors</CODE> (means <CODE>&quot;**&quot;</CODE> or <CODE>&quot;...&quot;</CODE>, all subdirectories) or
               <BR><VAR>subdir</VAR> = <CODE>:parent</CODE> (means <CODE>&quot;/&quot;</CODE> instead of <CODE>&quot;subdir/&quot;</CODE>) or
               <BR><VAR>subdir</VAR> = simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
<DT><CODE>name</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>type</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>version</CODE>       <DD>always <CODE>nil</CODE> (may also be specified as <CODE>:wild</CODE> or <CODE>:newest</CODE>)
</DL>
<P>
Constraint: <VAR>startpoint</VAR> = <CODE>:relative</CODE> only if <VAR>device</VAR> = <CODE>nil</CODE>. If the device is
specified, the pathname must be absolute!
<P>
A filename from AMIGAOS is split into name and type according to the
following rule:
<UL>
<LI>if there is no <CODE>'.'</CODE> in the filename, then the <VAR>name</VAR> is everything, <VAR>type</VAR> = <CODE>nil</CODE>;
<LI>if there is a <CODE>'.'</CODE>, then <VAR>name</VAR> is the part before and <VAR>type</VAR> the part after
     the last dot.
</UL>
<P>
Case is ignored in the strings on comparison. No case conversions are
performed.
<P>
When a pathname is to be fully specified (no wildcards), that means that
no <CODE>:wild</CODE>, <CODE>:wild-inferiors</CODE> is allowed, no wildcard characters are allowed in
the strings, and <VAR>name</VAR> = <CODE>nil</CODE> may not be allowed either.
<P>
<A NAME="pathnames-externally-amiga">
<TABLE>
  <TR> <TD>External notation:      <TD ALIGN=RIGHT><CODE>dev:sub1.typ/sub2.typ/name.typ</CODE>
  <TR> <TD>using defaults:         <TD ALIGN=RIGHT><CODE>    sub1.typ/sub2.typ/name.typ</CODE>
  <TR> <TD>or                      <TD ALIGN=RIGHT><CODE>                      name.typ</CODE>
  <TR> <TD>or                      <TD ALIGN=RIGHT><CODE>    sub1.typ/**/sub3.typ/x*.lsp</CODE>
  <TR> <TD>or similar.
</TABLE>
<P>
Formal specification of the external notation:
<DL>
  <DT>ch ::= <DD>any character except ':','/' and '*','?'
  <DT>name ::= <DD>{ch}+
  <DT>device ::= <DD>[ &lt;empty&gt; | ':' | name ':' ]
             <BR>; empty = current device, relative to current directory
             <BR>; ':'   = current device, absolute (relative to root for disks)
             <BR>; name ':' = specified device, absolute (relative to root for disks)
  <DT>subdir ::= <DD>[ &lt;empty&gt; | name ]                <BR>; empty means parent directory
  <DT>pathname ::= <DD>device { subdir '/' }* name
</DL>
<P>
Examples:
<TABLE BORDER>
<TR> <TH>String       <TH>Device    <TH>Directory                <TH>our pathname
<TR> <TD><CODE>'c:foo'</CODE>      <TD>'C'     <TD>device-&gt;<CODE>foo</CODE>               <TD><CODE>&quot;c&quot; (:absolute &quot;foo&quot;)</CODE>
<TR> <TD><CODE>'c:foo/'</CODE>     <TD>'C'     <TD>device-&gt;<CODE>foo</CODE>               <TD><CODE>&quot;c&quot; (:absolute &quot;foo&quot;)</CODE>
<TR> <TD><CODE>'c:foo/bar'</CODE>  <TD>'C'     <TD>device-&gt;<CODE>foo</CODE>-&gt;<CODE>bar</CODE>          <TD><CODE>&quot;c&quot; (:absolute &quot;foo&quot; &quot;bar&quot;)</CODE>
<TR> <TD><CODE>'c:/foo'</CODE>     <TD>'C'     <TD>device-&gt;up-&gt;<CODE>foo</CODE>           <TD><CODE>&quot;c&quot; (:absolute :parent &quot;foo&quot;)</CODE>
<TR> <TD><CODE>'c:'</CODE>         <TD>'C'     <TD>device                    <TD><CODE>&quot;c&quot; (:absolute)</CODE>
<TR> <TD><CODE>':foo'</CODE>       <TD>current <TD>device-&gt;root-&gt;<CODE>foo</CODE>         <TD><CODE>nil (:absolute &quot;foo&quot;)</CODE>
<TR> <TD><CODE>'foo'</CODE>        <TD>current <TD>device-&gt;<CODE>foo</CODE>               <TD><CODE>nil (:relative &quot;foo&quot;)</CODE>
<TR> <TD><CODE>'/foo'</CODE>       <TD>current <TD>device-&gt;up-&gt;<CODE>foo</CODE>           <TD><CODE>nil (:relative :parent &quot;foo&quot;)</CODE>
<TR> <TD><CODE>'//foo/bar'</CODE>  <TD>current <TD>device-&gt;up-&gt;up-&gt;<CODE>foo</CODE>-&gt;<CODE>bar</CODE>  <TD><CODE>nil (:relative :parent :parent &quot;foo&quot; &quot;bar&quot;)</CODE>
<TR> <TD><CODE>''</CODE>           <TD>current <TD>device                    <TD><CODE>nil (:relative)</CODE>
</TABLE>
<P>
Appending a <CODE>'/'</CODE> to a path string that is non-empty and does not end with <CODE>':'</CODE>
or <CODE>'/'</CODE> does not change its meaning. This <CODE>'/'</CODE> must be appended before another
non-empty component can be appended.
But appending a <CODE>'/'</CODE> to a path string that is empty or ends with <CODE>':'</CODE> or <CODE>'/'</CODE>
means going up to the parent directory!
<BR>
We interpret any path string that is empty or ends with <CODE>':'</CODE> or <CODE>'/'</CODE> as
pathname of a directory (with <VAR>name</VAR> = <CODE>nil</CODE> and <VAR>type</VAR> = <CODE>nil</CODE>).
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_UNIX -->
<DL>
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
Pathname components:
<DL>
<DT><CODE>host</CODE>          <DD>always <CODE>nil</CODE>
<DT><CODE>device</CODE>        <DD>always <CODE>nil</CODE>
<DT><CODE>directory</CODE>     <DD><CODE>(<VAR>startpoint</VAR> . <VAR>subdirs</VAR>)</CODE> where
               <BR><VAR>startpoint</VAR> = <CODE>:relative</CODE> | <CODE>:absolute</CODE>
               <BR><VAR>subdirs</VAR> = <CODE>()</CODE> | <CODE>(<VAR>subdir</VAR> . <VAR>subdirs</VAR>)</CODE>
               <BR><VAR>subdir</VAR> = <CODE>:wild-inferiors</CODE> (means <CODE>&quot;**&quot;</CODE> or <CODE>&quot;...&quot;</CODE>, all subdirectories) or
               <BR><VAR>subdir</VAR> = simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
<DT><CODE>name</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>type</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>version</CODE>       <DD>always <CODE>nil</CODE> (may also be specified as <CODE>:wild</CODE> or <CODE>:newest</CODE>)
</DL>
<P>
A UNIX filename is split into name and type according to the following rule:
<UL>
<LI>if there is no <CODE>'.'</CODE> in the filename, then the <VAR>name</VAR> is everything, <VAR>type</VAR> = <CODE>nil</CODE>;
<LI>if there is a <CODE>'.'</CODE>, then <VAR>name</VAR> is the part before and <VAR>type</VAR> the part after
     the last dot.
</UL>
<P>
When a pathname is to be fully specified (no wildcards), that means that
no <CODE>:wild</CODE>, <CODE>:wild-inferiors</CODE> is allowed, no wildcard characters are allowed in
the strings, and <VAR>name</VAR> = <CODE>nil</CODE> may not be allowed either.
<P>
<TABLE>
  <TR> <TD>External notation:   <TD ALIGN=RIGHT><CODE>server:sub1.typ/sub2.typ/name.typ</CODE>
  <TR> <TD>using defaults:      <TD ALIGN=RIGHT><CODE>       sub1.typ/sub2.typ/name.typ</CODE>
  <TR> <TD>or                   <TD ALIGN=RIGHT><CODE>                         name.typ</CODE>
  <TR> <TD>or                   <TD ALIGN=RIGHT><CODE>       sub1.typ/**/sub3.typ/x*.lsp</CODE>
  <TR> <TD>or similar.
</TABLE>
</DD>
</DL>
<!-- #endif -->
<!-- #if defined(PATHNAME_OS2) || defined(PATHNAME_WIN32) -->
<DL>
<DT><EM>Platform dependent: OS/2, Win32 platforms only.</EM></DT>
<DD>
Pathname components:
<DL>
<DT><CODE>host</CODE>          <DD>always <CODE>nil</CODE>
<DT><CODE>device</CODE>        <DD><CODE>nil</CODE> or <CODE>:wild</CODE> or <CODE>&quot;A&quot;</CODE>|...|<CODE>&quot;Z&quot;</CODE>
<DT><CODE>directory</CODE>     <DD><CODE>(<VAR>startpoint</VAR> . <VAR>subdirs</VAR>)</CODE> where
               <BR><VAR>startpoint</VAR> = <CODE>:relative</CODE> | <CODE>:absolute</CODE>
               <BR><VAR>subdirs</VAR> = <CODE>()</CODE> | <CODE>(<VAR>subdir</VAR> . <VAR>subdirs</VAR>)</CODE>
               <BR><VAR>subdir</VAR> = <CODE>:wild-inferiors</CODE> (means <CODE>&quot;**&quot;</CODE> or <CODE>&quot;...&quot;</CODE>, all subdirectories) or
               <BR><VAR>subdir</VAR> = simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
<DT><CODE>name</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>type</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>version</CODE>       <DD>always <CODE>nil</CODE> (may also be specified as <CODE>:wild</CODE> or <CODE>:newest</CODE>)
</DL>
<P>
An OS/2 filename is split into name and type according to the following rule:
<UL>
<LI>if there is no <CODE>'.'</CODE> in the filename, then the <VAR>name</VAR> is everything, <VAR>type</VAR> = <CODE>nil</CODE>;
<LI>if there is a <CODE>'.'</CODE>, then <VAR>name</VAR> is the part before and <VAR>type</VAR> the part after
     the last dot.
</UL>
<P>
When a pathname is to be fully specified (no wildcards), that means that
no <CODE>:wild</CODE>, <CODE>:wild-inferiors</CODE> is allowed, no wildcard characters are allowed in
the strings, and <VAR>name</VAR> = <CODE>nil</CODE> may not be allowed either.
<P>
<TABLE>
  <TR> <TD>External notation:       <TD ALIGN=RIGHT><CODE>A:\sub1.typ\sub2.typ\name.typ</CODE>
  <TR> <TD>using defaults:          <TD ALIGN=RIGHT><CODE>  \sub1.typ\sub2.typ\name.typ</CODE>
  <TR> <TD>or                       <TD ALIGN=RIGHT><CODE>                     name.typ</CODE>
  <TR> <TD>or                       <TD ALIGN=LEFT><CODE>*:\sub1.typ\**\sub3.typ\x*.lsp</CODE>
  <TR> <TD>or similar.
</TABLE>
<P>
Instead of '\' one may use '/', as usual for DOS calls.
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_NOEXT -->
<DL>
<DT><EM>Platform dependent: UNIX, OS/2, Win32, Amiga platforms only.</EM></DT>
<DD>
The wildcard characters: <CODE>'*'</CODE> matches any sequence of characters, <CODE>'?'</CODE> matches
any one character.
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_NOEXT -->
<DL>
<DT><EM>Platform dependent: UNIX, OS/2, Win32, Amiga platforms only.</EM></DT>
<DD>
Due to the name/type splitting rule, there are pathnames that can't result
from <CODE>parse-namestring</CODE>. To get a pathname whose type contains a dot or whose
name contains a dot and whose type is <CODE>nil</CODE>, <CODE>make-pathname</CODE> must be used.
Example: <CODE>(make-pathname :name &quot;.profile&quot;)</CODE>.
</DD>
</DL>
<!-- #endif -->
<!-- #ifdef PATHNAME_RISCOS -->
<DL>
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
<H4>The Acorn file system and CLISP's interface to it</H4>
RISC OS provides several filing systems as standard (ADFS, IDEFS, NetFS,
RamFS, NetPrint) and support for extra filing systems (DOSFS, ResourceFS and
DeviceFS).
<P>
A module called FileSwitch is at the centre of all filing system operation
in RISC OS. FileSwitch provides a common core of functions used by all
filing systems. It only provides the parts of these services that are device
independent. The device dependant services that control the hardware are
provided by separate modules, which are the actual filing systems.
FileSwitch keeps track of active filing systems and switches betwen them as
necessary.
<P>
One of the filing system modules that RISC OS provides is FileCore. It takes
the normal calls that FileSwitch sends to a filing system module, and
converts them to a simpler set of calls to modules that control the
hardware. Unlike FileSwitch it creates a fresh instantiation of itself for
each module that it supports. Using FileCore to build filing system modules
imposes a more rigid structure on it, as more of the filing system is
predefined.
<P>
As well as standard filing systems, FileSwitch supports image filing
systems. These provide facilities for RISC OS to handle media in foreign
formats, and to support `image files' (or partitions) in those formats.
Rather than accessing the hardware directly they rely on standard RISC OS
filing systems to do so. DOSFS is an example of an image filing system used
to handle DOS format discs.
<P>
<H5>Terminology</H5>

A pathname may include a filing system name, a special field, a media name
(e.g., a disc name), directory name(s), and the name of the object itself;
each of these parts of a pathname is known as an `element' of the pathname.
<P>
<H5>Filenames</H5>

Filename `elements' may be up to ten characters in length on FileCore-based
filing systems and on NetFS. These characters may be digits or letters.
FileSwitch makes no distinction between upper and lower case, although
filing systems can do so. As a general rule, you should not use top-bit-set
characters in filenames, although some filing systems (such as
FileCore-based ones) support them. Other characters may be used provided
they do not have a special significance. Those that do are listed below :
<DL>
  <DT> .   <DD>Separates directory specifications, e.g., $.fred
  <DT> :   <DD>Introduces a drive or disc specification, e.g., :0, :bigdisc. It also
       marks the end of a filing system name, e.g., adfs:
  <DT> *   <DD>Acts as a `wildcard' to match zero or more characters.
  <DT> #   <DD>Acts as a `wildcard' to match any single character.
  <DT> $   <DD>is the name of the root directory of the disc.
  <DT> &amp;   <DD>is the user root directory (URD)
  <DT> @   <DD>is the currently selected directory (CSD)
  <DT> ^   <DD>is the `parent' directory
  <DT> %   <DD>is the currently selected library (CSL)
  <DT> \   <DD>is the previously selected directory (PSD)
</DL>
<P>
<H5>Directories</H5>

The root directory, $, forms the top of the directory hierarchy
of the media which contains the CSD. $ does not have a parent directory,
trying to access its parent will just access $. Each directory name is
separated by a '.' character. For example:
<TABLE>
  <TR> <TD> $.Documents.Memos
  <TR> <TD> %.cc
</TABLE>
<P>
<H5>Filing Systems</H5>

Files may also be accessed on filing systems other than the current one by
prefixing the filename with a filing system specification. A filing system
name may appear between '-' characters, or suffixed by a ':', though the
latter is advised since '-' can also be used to introduce a parameter on a
command line, or as part of a file name. For example:
<TABLE>
  <TR> <TD> -net-$.SystemMesg
  <TR> <TD> adfs:%.aasm
</TABLE>
<P>
<H5>Special Fields</H5>

Special fields are used to supply more information to the filing system than
you can using standard path names; for example NetFS and NetPrint use them
to specify server addresses or names. They are introduced by a '#'
character; a variety of syntaxes are possible:
<TABLE>
  <TR> <TD ALIGN=RIGHT>  net#MJHardy::disc1.mike
  <TR> <TD ALIGN=RIGHT>     #MJHardy::disc1.mike
  <TR> <TD ALIGN=RIGHT> -net#MJHardy-:disc1.mike
  <TR> <TD ALIGN=RIGHT>    -#MJHardy-:disc1.mike
</TABLE>
The special fields here are all MJHardy, and give the name of the fileserver
to use. Special fields may use any character except for control characters,
double quote '&quot;', solidus '|' and space. If a special field contains a hypen
you may only use the first two syntaxes given above.
<P>
<H5>File$Path and Run$Path</H5>

These two special variables control exactly where a file will be looked for,
according to the operation being performed on it.
<TABLE>
   <TR> <TD>File$Path   <TD>for read operations
   <TR> <TD>Run$Path    <TD>for execute operations
</TABLE>
The contents of each variable should expand to a list or prefixes, separated
by commas. When a read operation is performed then the prefixes in File$Path
are used in the order in which they are listed. The first object that
matches is used, whether it be a file or directory. Similarly any execute
operation uses the prefixes in Run$Path. These search paths are only used
when the pathname does not contain an explicit filing system reference,
e.g., executing adfs:file will not use Run$Path.
<P>
<H5>Other path variables</H5>

You can set up other path variables and use them as pseudo filing systems.
For example if you typed:
<TABLE>
  <TR> <TD> *Set Source$Path adfs:$.src.,adfs:$.public.src.
</TABLE>
you could then refer to the pseudo filing system as Source: or (less
preferable) as -Source-. These path variables work in the same was as
File$Path and Run$Path.
<P>
NOTE: Path variables are not implemented in this version of CLISP. A
workaround for this is to use &quot;&lt;Foo$Path&gt;&quot; instead of &quot;Foo:&quot; until they are
made available.
<P>
<A NAME="pathnames-externally-acorn">
<H5>from Lisp-string notation to internal representation</H5>
<EM>No</EM> swapping. &quot;foo.lsp&quot; means file type &quot;lsp&quot; and file name &quot;foo&quot;.
This is pseudo-BNF:
<DL>
<DT>legal character ::= <DD>any ISO latin-1 graphic character &gt;= ' ' except
                    '.' ':' '*' '#' '$' '&amp;' '@' '^' '%' '\' '?'

<DT>extended legal character ::= <DD>any ISO latin-1 graphic character &gt;= ' ' except
                             ':' '&quot;' '|'

<DT>legal-wild char ::= <DD>legal char | '*' | '#' | '?'

<DT>host ::=  <DD> '-' { extended legal char except '-' }+ '-'
         | { extended legal char except '-' } { extended legal char }* ':'
         | empty

<DT>device ::=  <DD> ':' { legal char }+ '.'
           | empty

<DT>directory ::=  <DD> { '$' | '&amp;' | '@' | '%' | '\' } '.' { subdirectory }*
              | { subdirectory }+
              | empty
<TABLE>
  <TR> <TD> '$' -&gt; <TD><CODE>:absolute :root</CODE>
  <TR> <TD> '&amp;' -&gt; <TD><CODE>:absolute :home</CODE>
  <TR> <TD> '@' -&gt; <TD><CODE>:absolute :current</CODE>
  <TR> <TD> '%' -&gt; <TD><CODE>:absolute :library</CODE>
  <TR> <TD> '\' -&gt; <TD><CODE>:absolute :previous</CODE>
  <TR> <TD> else <TD><CODE>:relative</CODE>
</TABLE>

<DT>subdirectory ::= <DD>{ '^' | { legal-wild char }+ } '.'
<TABLE>
  <TR> <TD> '^' -&gt; <TD><CODE>:parent</CODE>
</TABLE>

<DT>filename ::= <DD>{ { legal-wild char }+ | empty }

<DT>filetype ::= <DD>{ '.' { legal-wild char }+ | empty }

<DT>pathname ::= <DD>host device directory filename filetype
</DL>
Examples:
<TABLE BORDER>
  <TR> <TH>String                          <TH>Hostname <TH>Device  <TH>Directory            <TH>Name         <TH>Type
  <TR> <TD><CODE>-net-$.SystemMesg</CODE>                <TD><CODE>&quot;net&quot;</CODE>   <TD><CODE>nil</CODE>     <TD><CODE>(:absolute :root)</CODE>    <TD><CODE>&quot;SystemMesg&quot;</CODE> <TD><CODE>nil</CODE>
  <TR> <TD><CODE>net#MJHardy::disc1.mike</CODE>    <TD><CODE>&quot;net#MJHardy&quot;</CODE> <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :root)</CODE>    <TD><CODE>&quot;mike&quot;</CODE>       <TD><CODE>nil</CODE>
  <TR> <TD><CODE>#MJHardy::disc1.mike</CODE>          <TD><CODE>&quot;#MJHardy&quot;</CODE> <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :root)</CODE>    <TD><CODE>&quot;mike&quot;</CODE>       <TD><CODE>nil</CODE>
  <TR> <TD><CODE>-net#MJHardy-:disc1.mike</CODE>   <TD><CODE>&quot;net#MJHardy&quot;</CODE> <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :root)</CODE>    <TD><CODE>&quot;mike&quot;</CODE>       <TD><CODE>nil</CODE>
  <TR> <TD><CODE>-#MJHardy-:disc1.mike</CODE>         <TD><CODE>&quot;#MJHardy&quot;</CODE> <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :root)</CODE>    <TD><CODE>&quot;mike&quot;</CODE>       <TD><CODE>nil</CODE>
  <TR> <TD><CODE>@.foo</CODE>                            <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>     <TD><CODE>(:absolute :current)</CODE> <TD><CODE>&quot;foo&quot;</CODE>        <TD><CODE>nil</CODE>
  <TR> <TD><CODE>foo</CODE>                              <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>     <TD><CODE>(:relative)</CODE>          <TD><CODE>&quot;foo&quot;</CODE>        <TD><CODE>nil</CODE>
  <TR> <TD><CODE>^.</CODE>                               <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>     <TD><CODE>(:relative :parent)</CODE>  <TD><CODE>nil</CODE>          <TD><CODE>nil</CODE>
  <TR> <TD><CODE>@.^.</CODE>                             <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>     <TD><CODE>(:absolute :current :parent)</CODE> <TD><CODE>nil</CODE>  <TD><CODE>nil</CODE>
  <TR> <TD><CODE>foo.bar</CODE>                          <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>     <TD><CODE>(:relative)</CODE>          <TD><CODE>&quot;foo&quot;</CODE>        <TD><CODE>&quot;bar&quot;</CODE>
  <TR> <TD><CODE>foo.bar.baz</CODE>                      <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>     <TD><CODE>(:relative &quot;foo&quot;)</CODE>    <TD><CODE>&quot;bar&quot;</CODE>        <TD><CODE>&quot;baz&quot;</CODE>
  <TR> <TD><CODE>foo.bar.</CODE>                         <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>     <TD><CODE>(:relative &quot;foo&quot; &quot;bar&quot;)</CODE> <TD><CODE>nil</CODE>       <TD><CODE>nil</CODE>
  <TR> <TD><CODE>foo.@.</CODE>                       <TD COLSPAN=5 ALIGN=CENTER>illegal
</TABLE>
<P>

<H5>from internal representation to RISCOS string</H5>

with swapping <EM>only</EM> of name/type components.
<P>
<TABLE BORDER>
  <TR> <TH>Hostname    <TH>Device  <TH>Directory                   <TH>Name    <TH>Type      <TH>RISCOS String
  <TR> <TD><CODE>&quot;net&quot;</CODE>       <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :root)</CODE>           <TD><CODE>&quot;foo&quot;</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;net::disc1.$.foo&quot;</CODE>
  <TR> <TD><CODE>&quot;net#MJ&quot;</CODE>    <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :root &quot;foo&quot;)</CODE>     <TD><CODE>&quot;bar&quot;</CODE>   <TD><CODE>&quot;baz&quot;</CODE>     <TD><CODE>&quot;net#MJ::disc1.$.foo.baz.bar&quot;</CODE>
  <TR> <TD><CODE>&quot;adfs&quot;</CODE>      <TD><CODE>&quot;4&quot;</CODE>     <TD><CODE>(:absolute :root &quot;foo&quot; &quot;bar&quot;)</CODE> <TD><CODE>nil</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;adfs::4.$.foo.bar&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :root &quot;foo&quot;)</CODE>     <TD><CODE>&quot;bar&quot;</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;:disc1.$.foo.bar&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:absolute :current)</CODE>        <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>       <TD>illegal here
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>(:relative)</CODE>                 <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>       <TD><CODE>&quot;:disc1.&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>&quot;disc1&quot;</CODE> <TD><CODE>nil</CODE>                         <TD><CODE>nil</CODE>     <TD><CODE>nil</CODE>       <TD><CODE>&quot;:disc1.&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:absolute :root)</CODE>           <TD><CODE>&quot;foo&quot;</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;$.foo&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:absolute :current)</CODE>        <TD><CODE>&quot;foo&quot;</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;@.foo&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:relative)</CODE>                 <TD><CODE>&quot;foo&quot;</CODE>   <TD><CODE>&quot;bar&quot;</CODE>     <TD><CODE>&quot;bar.foo&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:relative &quot;foo&quot;)</CODE>           <TD><CODE>&quot;bar&quot;</CODE>   <TD><CODE>&quot;baz&quot;</CODE>     <TD><CODE>&quot;foo.baz.bar&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:absolute :library)</CODE>        <TD><CODE>&quot;bar&quot;</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;%.bar&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:absolute :library &quot;foo&quot;)</CODE>  <TD><CODE>&quot;bar&quot;</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;%.foo.bar&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:relative)</CODE>                 <TD><CODE>&quot;foo&quot;</CODE>   <TD><CODE>&quot;bar&quot;</CODE>     <TD><CODE>&quot;bar.foo&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:relative &quot;foo&quot;)</CODE>           <TD><CODE>&quot;bar&quot;</CODE>   <TD><CODE>nil</CODE>       <TD><CODE>&quot;foo.bar&quot;</CODE>
  <TR> <TD><CODE>nil</CODE>         <TD><CODE>nil</CODE>     <TD><CODE>(:relative &quot;foo&quot;)</CODE>           <TD><CODE>nil</CODE>     <TD><CODE>&quot;bar&quot;</CODE>     <TD>illegal here
</TABLE>
<P>
That is, the RISCOS string is the flattenation-concatenation of
<PRE><CODE>
  (append
    (if (null hostname) &quot;&quot; (append hostname &quot;:&quot;))
    (if (null device) &quot;&quot; (append &quot;:&quot; device &quot;.&quot;))
    (case (pop directory)
      (:absolute (case (pop directory)
                         (:root &quot;$.&quot;)
                         (:home &quot;&amp;.&quot;)
                         (:current &quot;@.&quot;)
                         (:library &quot;%.&quot;)
                         (:previous &quot;\\.&quot;)
      )          )
      (:relative &quot;&quot;)
    )
    (mapcar (lambda (subdir) (append subdir &quot;.&quot;)) directory)
    (if (null name)
      (if (null type) &quot;&quot; (error &quot;type with name illegal here&quot;))
      (if (null type)
        name
        (append type &quot;.&quot; name)
  ) ) )
</CODE></PRE>
<P>
<H5>internal representation</H5>

Pathname components:
<DL>
<DT><CODE>host</CODE>          <DD>Simple-String or <CODE>nil</CODE>
<DT><CODE>device</CODE>        <DD>Simple-String or <CODE>nil</CODE>
<DT><CODE>directory</CODE>     <DD><CODE>(<VAR>Startpoint</VAR> . <VAR>Subdirs</VAR>)</CODE> where
               <BR><VAR>Startpoint</VAR> = <CODE>:relative</CODE> | <CODE>:absolute</CODE> <VAR>anchor</VAR>
               <BR><VAR>anchor</VAR> = <CODE>:root</CODE> | <CODE>:home</CODE> | <CODE>:current</CODE> | <CODE>:library</CODE> | <CODE>:previous</CODE>
               <BR><VAR>Subdirs</VAR> = <CODE>()</CODE> | <CODE>(<VAR>subdir</VAR> . <VAR>Subdirs</VAR>)</CODE>
               <BR><VAR>subdir</VAR> = <CODE>:parent</CODE> or
               <BR><VAR>subdir</VAR> = simple string, may contain wildcard characters <CODE>?</CODE>,<CODE>#</CODE> and <CODE>*</CODE>
<DT><CODE>name</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE>,<CODE>#</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>type</CODE>          <DD><CODE>nil</CODE> or
              simple string, may contain wildcard characters <CODE>?</CODE>,<CODE>#</CODE> and <CODE>*</CODE>
              (may also be specified as <CODE>:wild</CODE>)
<DT><CODE>version</CODE>       <DD>always <CODE>nil</CODE> (may also be specified as <CODE>:wild</CODE> or <CODE>:newest</CODE>)
</DL>
<P>
Constraint: startpoint /= <CODE>:absolute :root</CODE> only if device = <CODE>nil</CODE>. If the device
is specified, the pathname must be <CODE>:absolute :root</CODE>.
<P>
The wildcard characters: <CODE>'*'</CODE> matches any sequence of characters, <CODE>'#'</CODE> or <CODE>'?'</CODE>
matches any one character.
<P>
Due to the name/type swapping rule, there are pathnames that can't result
from <CODE>parse-namestring</CODE>. To get a pathname whose type is <CODE>nil</CODE>, <CODE>make-pathname</CODE>
must be used.
Example: <CODE>(make-pathname :directory &quot;!Clisp.&quot; :name &quot;README&quot;)</CODE>.
</DD>
</DL>
<!-- #endif -->

<H3>23.1.2.</H3>

External notation of pathnames (cf. <CODE>parse-namestring</CODE> and <CODE>namestring</CODE>),
of course without spaces, [,],{,}:
<DL>
<!-- #ifdef PATHNAME_MSDOS -->
<DT><EM>Platform dependent: DOS platforms only.</EM></DT>
<DD>
<TABLE>
 <TR><TD>[ [drivespec] : ]     <TD>a letter <CODE>'*'</CODE>|<CODE>'A'</CODE>|...|<CODE>'Z'</CODE>|<CODE>'a'</CODE>|...|<CODE>'z'</CODE>
 <TR><TD>{ name [. type] \ }   <TD>each one a subdirectory, <CODE>'\'</CODE> may be replaced by <CODE>'/'</CODE>
 <TR><TD>[ name [. type] ]     <TD>filename with type (extension)
</TABLE>
<P>
Name and type may be character sequences of any length (consisting of
alphanumeric characters and <CODE>'-'</CODE>, <CODE>'_'</CODE>). They are shortened to 8 resp. 3
characters and converted to upper case. A single <CODE>'*'</CODE> is allowed for <CODE>:wild</CODE>.
<!-- #endif -->
<!-- #ifdef PATHNAME_AMIGAOS -->
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD>
see <A HREF="#pathnames-externally-amiga">above</A>.
<!-- #endif -->
<!-- #ifdef PATHNAME_UNIX -->
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
<TABLE>
 <TR><TD>[ / ]                 <TD>/ denotes absolute pathnames
 <TR><TD>{ name / }            <TD>each one a subdirectory
 <TR><TD>[ name [. type] ]     <TD>filename with type (extension)
</TABLE>
<P>
Name and type may be character sequences of any length (consisting of
printing ASCII characters, except <CODE>'/'</CODE>).
<!-- #endif -->
<!-- #if defined(PATHNAME_OS2) || defined(PATHNAME_WIN32) -->
<DT><EM>Platform dependent: OS/2, Win32 platforms only.</EM></DT>
<DD>
 <TR><TD>[ [drivespec] : ]     <TD>a letter '*'|'A'|...|'Z'|'a'|...|'z'
 <TR><TD>{ name [. type] \ }   <TD>each one a subdirectory, '\' may be replaced by '/'
 <TR><TD>[ name [. type] ]     <TD>filename with type (extension)
</TABLE>
<P>
Name and type may be character sequences of any length (consisting of
printing ASCII characters, except <CODE>'/'</CODE>, <CODE>'\'</CODE>, <CODE>':'</CODE>).
<!-- #endif -->
<!-- #ifdef PATHNAME_RISCOS -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
see <A HREF="#pathnames-externally-acorn">above</A>.
<!-- #endif -->
</DL>
<P>
<CODE>namestring</CODE> has an optional flag argument: <CODE>(namestring <VAR>pathname</VAR> t)</CODE> returns an
external notation suitable for passing to the operating system or other
programs.
<!-- #if !defined(USER_HOMEDIR) -->
<P>
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Acorn platforms only.</EM></DT>
<DD>
The function <CODE>user-homedir-pathname</CODE> is not implemented.
<!-- #if defined(MSDOS) -->
<DT><EM>Platform dependent: DOS, OS/2 platforms only.</EM></DT>
<DD>
If you really need that function, you might define it like this:
<PRE><CODE>  (defun user-homedir-pathname (&amp;optional host)
    (declare (ignore host))
    (or (system::getenv &quot;HOME&quot;) &quot;\\&quot;)
  )
</CODE></PRE>
<!-- #endif -->
</DL>
<!-- #endif -->

<H3>23.1.4.</H3>

The CLtL2 functions <CODE>wild-pathname-p</CODE>, <CODE>pathname-match-p</CODE> and <CODE>translate-pathname</CODE>
are implemented.
<P>
<CODE>pathname-match-p</CODE> does not interpret missing components as wild.
<P>
<CODE>translate-pathname</CODE> has two additional keywords:
<BR>  <CODE>(translate-pathname <VAR>source</VAR> <VAR>from-wildname</VAR> <VAR>to-wildname</VAR> &amp;key :all :merge)</CODE>
<BR>If <CODE>:all</CODE> is specified and non-<CODE>nil</CODE>, a list of all resulting pathnames,
corresponding to all matches of <CODE>(pathname-match-p <VAR>source</VAR> <VAR>from-wildname</VAR>)</CODE>,
is returned. If <CODE>:merge</CODE> is specified and <CODE>nil</CODE>, unspecified pieces of <VAR>to-pathname</VAR>
are not replaced by corresponding pieces of <VAR>source</VAR>.

<H3>23.1.5.</H3>

<!-- #ifndef LOGICAL_PATHNAMES -->
<!--
The function COMPILE-FILE-PATHNAME is implemented.
-->
<!-- #endif -->
<!-- #ifdef LOGICAL_PATHNAMES -->
The functions <CODE>logical-pathname</CODE>, <CODE>translate-logical-pathname</CODE>,
<CODE>logical-pathname-translations</CODE>, <CODE>(setf logical-pathname-translations)</CODE>,
<CODE>load-logical-pathname-translations</CODE>, <CODE>compile-file-pathname</CODE> are implemented.
<P>
When the argument of the function <CODE>translate-logical-pathname</CODE> is a string, it
is interpreted as a logical pathname string.
<P>
<CODE>rename-file</CODE> always returns a non-logical pathname as its first value.

<H3>23.1.6.</H3>

<CODE>(parse-namestring <VAR>string</VAR> [<VAR>host</VAR> [<VAR>defaults</VAR>]])</CODE> returns a logical pathname only
if host is a logical host or host is <CODE>nil</CODE> and defaults is a logical pathname.
To construct a logical pathname from a string, the function <CODE>logical-pathname</CODE>
can be used.
<P>
<CODE>(merge-pathnames <VAR>string</VAR> [<VAR>defaults</VAR>])</CODE> returns a logical pathname only if
defaults is a logical pathname. To construct a logical pathname from a string,
the function <CODE>logical-pathname</CODE> can be used.
<!-- #endif -->

<H3>23.2.</H3>

<CODE>open</CODE> cannot handle files of size &gt;= 16 MB.

<DL>
<!-- #ifdef HANDLES -->
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Amiga platforms only.</EM></DT>
<DD>
The file streams returned by <CODE>open</CODE> are buffered for regular files and
unbuffered for special files.
<!-- #else -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD>
The file streams returned by <CODE>open</CODE> are always buffered.
<!-- #endif -->
</DL>

<H3>23.3.</H3>

<CODE>probe-file</CODE> can not be used to check whether a directory exists. Use the
function <CODE>probe-directory</CODE> or the function <CODE>directory</CODE> for this purpose.
<P>
<CODE>file-author</CODE> always returns <CODE>nil</CODE>.
<!-- #if defined(MSDOS) || defined(WIN32) || (defined(UNIX) && (O_BINARY != 0)) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD>
<CODE>file-position</CODE> works on any file stream. When a Newline is output to resp.
input from a file stream, its file position is increased by 2 since Newline
is encoded as CR/LF in the file.
</DD>
</DL>
<!-- #endif -->

<H3>23.4.</H3>

<CODE>load</CODE> has two additional keywords <CODE>:echo</CODE> and <CODE>:compiling</CODE>.
<BR><CODE>(load <VAR>filename</VAR> &amp;key :verbose :print :echo :if-does-not-exist :compiling)</CODE>
<DL>
<DT><CODE>:verbose t</CODE>   <DD>causes <CODE>load</CODE> to emit a short message that a file is being loaded.
             The default is <CODE>*load-verbose*</CODE>, which is initially = <CODE>t</CODE>.
<DT><CODE>:print t</CODE>     <DD>causes <CODE>load</CODE> to print the value of each form.
             The default is <CODE>*load-print*</CODE>, which is initially = <CODE>nil</CODE>.
<DT><CODE>:echo t</CODE>      <DD>causes the input from the file to be echoed to <CODE>*standard-output*</CODE>
             (normally to the screen). Should there be an error in the file,
             you can see at one glance where it is.
             The default is <STRONG><CODE>*load-echo*</CODE></STRONG>, which is initially = <CODE>nil</CODE>.
<DT><CODE>:compiling t</CODE> <DD>causes each form read to be compiled on the fly. The compiled
             code is executed at once and - in contrast to <CODE>compile-file</CODE> -
             not written to a file.
             The default is <STRONG><CODE>*load-compiling*</CODE></STRONG>, which is initially = <CODE>nil</CODE>.
</DL>
<P>
The CLtL2 variables <CODE>*load-pathname*</CODE> and <CODE>*load-truename*</CODE> are implemented.
<P>
The variable <STRONG><CODE>*load-paths*</CODE></STRONG> contains a list of directories where program files
are searched - additionally to the specified or current directory - by <CODE>load</CODE>,
<CODE>require</CODE>, <CODE>compile-file</CODE>.

<H3>23.5.</H3>

<CODE>(<STRONG>probe-directory</STRONG> <VAR>pathname</VAR>) tests whether
<VAR>pathname</VAR> exists and is a directory. It will, unlike
<CODE>probe-file</CODE> or <CODE>truename</CODE>, not signal an error if
the parent directory of <VAR>pathname</VAR> doesn't exist.
<P>
The ANSI CL function <CODE>ensure-directories-exist</CODE> is implemented.
<P>
<CODE>(directory [<VAR>pathname</VAR> [:full] [:circle]])</CODE> can run in two modes:
<UL>
<LI>If <VAR>pathname</VAR> contains no name or type component, a list of all matching
  directories is produced.
<LI>Otherwise a list of all matching files is returned. If the <CODE>:full</CODE> argument
  is /= <CODE>nil</CODE>, this contains additional information: for each matching file
  you get a list of at least four elements
  <CODE>(<VAR>file-pathname</VAR> <VAR>file-truename</VAR> <VAR>file-write-date-as-decoded-time</VAR> <VAR>file-length</VAR>)</CODE>.
</UL>
<!-- #ifdef UNIX -->
<DL>
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
If the <CODE>:circle</CODE> argument is /= <CODE>nil</CODE>, the function avoids endless loops that
may result from symbolic links.
</DD>
</DL>
<!-- #endif -->
<P>
<CODE>(<STRONG>dir</STRONG> [<VAR>pathname</VAR>])</CODE> is like <CODE>directory</CODE>, but displays the pathnames instead of
returning them. <CODE>(dir)</CODE> shows the contents of the current directory.
<P>
<DL>
<!-- #if defined(PATHNAME_UNIX) || defined(PATHNAME_AMIGAOS) -->
<DT><EM>Platform dependent: UNIX, Amiga platforms only.</EM></DT>
<DD><CODE>(<STRONG>cd</STRONG> [<VAR>pathname</VAR>])</CODE> manages the current directory.
<!-- #elif defined(PATHNAME_RISCOS) -->
<DT><EM>Platform dependent: Acorn platforms only.</EM></DT>
<DD><CODE>(<STRONG>cd</STRONG> [<VAR>pathname</VAR>])</CODE> manages the current host, current device and the current directory.
<!-- #else -->
<DT><EM>Platform dependent: DOS, OS/2, Win32 platforms only.</EM></DT>
<DD><CODE>(<STRONG>cd</STRONG> [<VAR>pathname</VAR>])</CODE> manages the current device and the current directory.
<!-- #endif -->
</DL>
<CODE>(cd <VAR>pathname</VAR>)</CODE> sets it, <CODE>(cd)</CODE> returns it.
<P>
<CODE>(<STRONG>default-directory</STRONG>)</CODE> is equivalent to <CODE>(cd)</CODE>, <CODE>(setf (default-directory) <VAR>pathname</VAR>)</CODE>
is equivalent to <CODE>(cd <VAR>pathname</VAR>)</CODE>.
<P>
<CODE>(<STRONG>make-dir</STRONG> <VAR>directory-pathname</VAR>)</CODE> creates a new subdirectory.
<P>
<CODE>(<STRONG>delete-dir</STRONG> <VAR>directory-pathname</VAR>)</CODE> removes an (empty) subdirectory.
<DL>
<!-- #if defined(UNIX) || defined(MSDOS) || defined(RISCOS) -->
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Acorn platforms only.</EM></DT>
<DD><CODE>(<STRONG>execute</STRONG> <VAR>programfile</VAR> <VAR>arg<SUB>1</SUB></VAR> <VAR>arg<SUB>2</SUB></VAR> ...)</CODE>  executes an external program. Its name
is <VAR>programfile</VAR>. It is given the strings <VAR>arg<SUB>1</SUB></VAR>, <VAR>arg<SUB>2</SUB></VAR>, ... as arguments.
<!-- #endif -->
<!-- #ifdef AMIGAOS -->
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD><CODE>(<STRONG>execute</STRONG> <VAR>command</VAR>)</CODE>  executes a given </VAR>command</VAR> using the operating system's shell.
<!-- #endif -->
</DL>
<A NAME="shell">
<!-- #ifdef HAVE_SHELL -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Win32, Amiga, Acorn platforms only.</EM></DT>
<DD>
<CODE>(<STRONG>shell</STRONG> [<VAR>command</VAR>])</CODE>  calls the operating system's shell.
<CODE>(shell)</CODE> calls the shell for interactive use. <CODE>(shell <VAR>command</VAR>)</CODE> calls the shell
only for execution of the one given <VAR>command</VAR>.
</DL>
<!-- #endif -->
<!-- #ifdef PIPES2 -->
<DL>
<DT><EM>Platform dependent: UNIX, OS/2, Win32 platforms only.</EM></DT>
<DD>The functions <CODE><STRONG>run-shell-command</STRONG></CODE> and <CODE><STRONG>run-program</STRONG></CODE> are a general interface to
<CODE>shell</CODE> and the above:
<P>
<CODE>(run-shell-command <VAR>command</VAR> [:input] [:output] [:if-output-exists])</CODE>
    runs a shell command.
<P>
<CODE>(run-program <VAR>program</VAR> [:arguments] [:input] [:output] [:if-output-exists])</CODE>
    runs an external program.
<DL>
<DT>The <VAR>command</VAR> argument     <DD>specifies the shell command.
<!-- #ifdef UNIX -->
  <DL>
  <DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
  <DD>
                         The shell the command is passed to is the value of the
                         environment variable <CODE>SHELL</CODE>, which normally is <CODE>/bin/sh</CODE>.
                         The command should be a ``simple command''; a
                         ``command list'' should be enclosed in &quot;{ ... ; }&quot;
                         (for <CODE>/bin/sh</CODE>) or &quot;( ... )&quot; (for <CODE>/bin/csh</CODE>).
  </DD>
  </DL>
<!-- #endif -->
<DT>The <VAR>program</VAR> argument     <DD>specifies the program. The directories listed in the
                         <CODE>PATH</CODE> environment variable will be searched for it.
<DT>The <CODE>:arguments</CODE> argument  <DD>specifies a list of arguments (strings) that are
                         given to the program.
<DT>The <CODE>:input</CODE> argument      <DD>specifies where the program's input is to come from:
                         either <CODE>:terminal</CODE> (the standard input) or <CODE>:stream</CODE>
                         (a Lisp stream to be created) or a pathname (an
                         input file) or <CODE>nil</CODE> (no input at all).
<DT>The <CODE>:output</CODE> argument     <DD>specifies where the program's output is to be sent
                         to: either <CODE>:terminal</CODE> (the standard output) or <CODE>:stream</CODE>
                         (a Lisp stream to be created) or a pathname (an
                         output file) or <CODE>nil</CODE> (ignore the output).
<DT>The <CODE>:if-output-exists</CODE> argument <DD>specifies what to do if the <CODE>:output</CODE> file
                         already exists. The possible values are <CODE>:overwrite</CODE>,
                         <CODE>:append</CODE>, <CODE>:error</CODE>, with the same meaning as for <CODE>open</CODE>.
</DL>
If <CODE>:stream</CODE> was specified for <CODE>:input</CODE> or <CODE>:output</CODE>, a Lisp stream is returned.
If <CODE>:stream</CODE> was specified for <CODE>:input</CODE> and <CODE>:output</CODE>, three Lisp streams are
returned, as for the function <CODE>make-pipe-io-stream</CODE>. This use of <CODE>run-program</CODE>
can cause deadlocks, see <CODE>make-pipe-io-stream</CODE>.
</DL>
<!-- #endif -->


<H2>Chapter 24: Errors</H2>

<H3>24.1.</H3>

When an error occurred, you are in a break loop. You can evaluate forms as
usual. The <CODE>help</CODE> command (or help key if there is one) lists the available
debugging commands.


<H2>Chapter 25: Miscellaneous Features</H2>

<H3>25.1.</H3>

The compiler can be called not only by the functions <CODE>compile</CODE>, <CODE>compile-file</CODE>
and <CODE>disassemble</CODE>, also by the declaration <CODE>(compile)</CODE>.
<P>
<CODE>(compile-file <VAR>input-file</VAR> [:output-file] [:listing]
                         [:warnings] [:verbose] [:print])</CODE>
compiles a file to bytecode.
<DL>
<DT>    <VAR>input-file</VAR>                <DD>should be a pathname/string/symbol.
<DT>The <CODE>:output-file</CODE> argument     <DD>should be <CODE>nil</CODE> or <CODE>t</CODE> or a pathname/string/symbol
                              or an output-stream. The default is <CODE>t</CODE>.
<DT>The <CODE>:listing</CODE> argument         <DD>should be <CODE>nil</CODE> or <CODE>t</CODE> or a pathname/string/symbol
                              or an output-stream. The default is <CODE>nil</CODE>.
<DT>The <CODE>:warnings</CODE> argument        <DD>specifies whether warnings should also appear
                              on the screen.
<DT>The <CODE>:verbose</CODE> argument         <DD>specifies whether error messages should also
                              appear on the screen.
<DT>The <CODE>:print</CODE> argument           <DD>specifies whether an indication which forms are
                              being compiled should appear on the screen.
</DL>
The variables <CODE><STRONG>*compile-warnings*</STRONG></CODE>, <CODE>*compile-verbose*</CODE>, <CODE>*compile-print*</CODE> provide
defaults for the <CODE>:warnings</CODE>, <CODE>:verbose</CODE>, <CODE>:print</CODE> keyword arguments, respectively.
For each input file (default file type: <CODE>#&quot;.lsp&quot;</CODE>) the following files are
generated:
<TABLE BORDER>
  <TR> <TH>File            <TH>When <TH>Default file type  <TH>Contents
  <TR> <TD>output file              <TD>only if <CODE>:output-file</CODE> is not <CODE>nil</CODE>
                           <TD><CODE>#&quot;.fas&quot;</CODE>
                           <TD>can be loaded using the <CODE>load</CODE> function.
  <TR> <TD>auxiliary output file    <TD>only if <CODE>:output-file</CODE> is not <CODE>nil</CODE>
                           <TD><CODE>#&quot;.lib&quot;</CODE>
                           <TD>used by <CODE>compile-file</CODE> when compiling
                             a <CODE>require</CODE> form referring to the input file.
  <TR> <TD>listing file             <TD>only if <CODE>:listing</CODE> is not <CODE>nil</CODE>
                           <TD><CODE>#&quot;.lis&quot;</CODE>
                           <TD>disassembly of the output file.
  <TR> <TD>C output file            <TD>only if <CODE>:output-file</CODE> is not <CODE>nil</CODE>
                           <TD><CODE>#&quot;.c&quot;</CODE>
                           <TD>foreign function interface;
                           this file is deleted if it is empty.
</TABLE>
<P>
The CLtL2 variables <CODE>*compile-file-pathname*</CODE> and <CODE>*compile-file-truename*</CODE> are
implemented.
<P>
The CLtL2 special form <CODE>load-time-value</CODE> is implemented. <CODE>(load-time-value <VAR>form</VAR>)</CODE>
is like <CODE>(quote #,<VAR>form</VAR>)</CODE> except that the former can be generated by macros.
<P>
<!-- #ifdef HAVE_DISASSEMBLER -->
<DL>
<DT><EM>Platform dependent: UNIX platforms only.</EM></DT>
<DD>
<CODE>disassemble</CODE> can disassemble to machine code, provided that GNU gdb is present.
In that case the argument may be a <CODE>system-function</CODE>, a <CODE>foreign-function</CODE>, a
special form indicator, a symbol denoting one of these, a number, or a string.
</DD>
</DL>
<!-- #endif -->
<P>
The CLtL2 function <CODE>function-lambda-expression</CODE> is implemented.
<CODE>(function-lambda-expression <VAR>function</VAR>)</CODE> returns information about the source
of an interpreted function: lambda-expression, lexical environment, name.

<H3>25.2.</H3>

No on-line documentation is available for the system functions (yet).

<H3>25.3.</H3>

<CODE>(TRACE <VAR>fun</VAR> ...)</CODE> makes the functions <VAR>fun</VAR>, ... traced. Syntax of <VAR>fun</VAR>:
Either a symbol:
       <VAR>symbol</VAR>
or a list of a symbol and some keywords and arguments (which must come in
pairs!):
       <CODE>(<VAR>symbol</VAR></CODE>
         <TABLE>
         <TR><TD><CODE>[:suppress-if <VAR>form</VAR>]</CODE>   <TD> no trace output as long as <VAR>form</VAR> is true
         <TR><TD><CODE>[:step-if <VAR>form</VAR>]</CODE>       <TD> invokes the stepper as soon as <VAR>form</VAR> is true
         <TR><TD><CODE>[:pre <VAR>form</VAR>]</CODE>           <TD> evaluates <VAR>form</VAR> before calling the function
         <TR><TD><CODE>[:post <VAR>form</VAR>]</CODE>          <TD> evaluates <VAR>form</VAR> after return from the function
         <TR><TD><CODE>[:pre-break-if <VAR>form</VAR>]</CODE>  <TD> goes into the break loop before calling the
                                function if <VAR>form</VAR> is true
         <TR><TD><CODE>[:post-break-if <VAR>form</VAR>]</CODE> <TD> goes into the break loop after return from
                                the function if <VAR>form</VAR> is true
         <TR><TD><CODE>[:pre-print <VAR>form</VAR>]</CODE>     <TD> prints the values of <VAR>form</VAR> before calling the
                                function
         <TR><TD><CODE>[:post-print <VAR>form</VAR>]</CODE>    <TD> prints the values of <VAR>form</VAR> after return from
                                the function
         <TR><TD><CODE>[:print <VAR>form</VAR>]</CODE>         <TD> prints the values of <VAR>form</VAR> both before
                                calling and after return from the function
         </TABLE>
       <CODE>)</CODE>
<BR>
In all these forms you can access
<TABLE>
  <TR><TD>the function itself               <TD>as <CODE><STRONG>*trace-function*</STRONG></CODE>,
  <TR><TD>the arguments to the function     <TD>as <CODE><STRONG>*trace-args*</STRONG></CODE>,
  <TR><TD>the function/macro call as form   <TD>as <CODE><STRONG>*trace-form*</STRONG></CODE>,
  <TR><TD>
  after return from the function:
  the list of return values from the function call  <TD>as <CODE><STRONG>*trace-values*</STRONG></CODE>,
  </TABLE>
and you can leave the function call with specified values by using <CODE>return</CODE>.
<P>
<CODE>trace</CODE> and <CODE>untrace</CODE> are also applicable to functions <CODE>(setf <VAR>symbol</VAR>)</CODE> and to macros,
but not to locally defined functions and macros.
<P>
The macro <CODE><STRONG>space</STRONG></CODE> is like the macro <CODE>time</CODE>: <CODE>(space <VAR>form</VAR>)</CODE> evaluates the <VAR>form</VAR>, and,
as a side effect, outputs information about the memory allocations caused by
this evaluation.
<P>
The function <CODE>inspect</CODE> is not implemented.
<P>
The function <CODE>room</CODE> returns two values: the number of bytes currently occupied
by Lisp objects, and the number of bytes that can be allocated before the next
regular garbage collection occurs.
<P>
The function <CODE>ed</CODE> calls the external editor specified by the variable <CODE><STRONG>*editor*</STRONG></CODE>
(see <CODE>config.lsp</CODE>).
<!-- #if defined(MSDOS) || defined(UNIX) || defined(AMIGAOS) -->
<DL>
<DT><EM>Platform dependent: UNIX, DOS, OS/2, Amiga platforms only.</EM></DT>
<DD>
<DL>
<DT><EM>If using the optional package <CODE>editor</CODE>:</EM></DT>
<DD>
  <CODE>ed</CODE> behaves like this only if the variable <CODE><STRONG>*use-ed*</STRONG></CODE> is <CODE>nil</CODE>.
  Otherwise <CODE>ed</CODE> uses a screen editor with multiple windows.
</DD></DL>
</DD></DL>
<!-- #endif -->
<P>
The function <CODE><STRONG>uncompile</STRONG></CODE> does the converse of <CODE>compile</CODE>: <CODE>(uncompile <VAR>function-name</VAR>)</CODE>
reverts an interpreted function that has been entered or loaded in the same
session and then compiled back to its interpreted form.

<H3>25.4.1.</H3>

<!-- #if !(defined(UNIX) || defined(WIN32)) -->
<DL>
<DT><EM>Platform dependent: DOS, OS/2, Amiga, Acorn platforms only.</EM></DT>
<DD>
The variable <CODE><STRONG>*default-time-zone*</STRONG></CODE> contains the default time zone used by
<CODE>encode-universal-time</CODE> and <CODE>decode-universal-time</CODE>. It is initially set to -1
(which means 1 hour east of Greenwich, i.e. Mid European Time).
</DD>
</DL>
<!-- #endif -->
<P>
The timezone in a decoded time must not necessarily be an integer, but (as
float or rational number) it should be a multiple of <CODE>1/4</CODE>.
<P>
<DL>
<!-- #if defined(TIME_MSDOS) || defined(TIME_RISCOS) -->
<DT><EM>Platform dependent: DOS, OS/2, Acorn platforms only.</EM></DT>
<DD><CODE>internal-time-units-per-second</CODE> = 100.
<!-- #endif -->
<!-- #ifdef TIME_AMIGAOS -->
<DT><EM>Platform dependent: Amiga platforms only.</EM></DT>
<DD><CODE>internal-time-units-per-second</CODE> = 50.
<!-- #endif -->
<!-- #ifdef TIME_UNIX -->
<DT><EM>Platform dependent: most UNIX platforms only.</EM></DT>
<DD><CODE>internal-time-units-per-second</CODE> = 1000000.
<!-- #endif -->
<!-- #ifdef TIME_WIN32 -->
<DT><EM>Platform dependent: Win32 platforms only.</EM></DT>
<DD><CODE>internal-time-units-per-second</CODE> = 10000000.
<!-- #endif -->
</DL>

<H3>25.4.2.</H3>

<DL>
<!-- #ifdef MACHINE_KNOWN -->
<DT><EM>Platform dependent: UNIX, Win32 platforms only.</EM></DT>
<DD>The functions <CODE>short-site-name</CODE>, <CODE>long-site-name</CODE> should be defined in a site-specific <CODE>config.lsp</CODE> file.
<!-- #else -->
<DT><EM>Platform dependent: DOS, OS/2, Amiga, Acorn platforms only.</EM></DT>
<DD>The functions <CODE>machine-type</CODE>, <CODE>machine-version</CODE>, <CODE>machine-instance</CODE> and
<CODE>short-site-name</CODE>, <CODE>long-site-name</CODE> should be defined by every user in his
site-specific <CODE>config.lsp</CODE> file.
<!-- #endif -->
</DL>
<P>
The variable <CODE>*features*</CODE> initially contains the symbols
<TABLE>
   <TR><TD><CODE>CLISP</CODE>            <TD> this implementation
   <TR><TD><CODE>COMMON-LISP</CODE>
   <TR><TD><CODE>CLTL1</CODE>
   <TR><TD><CODE>INTERPRETER</CODE>
   <TR><TD><CODE>COMPILER</CODE>
<!-- #ifdef LOGICAL_PATHNAMES -->
   <TR><TD><CODE>LOGICAL-PATHNAMES</CODE>
<!-- #endif -->
<!-- #ifdef DYNAMIC_FFI -->
   <TR><TD><CODE>FFI</CODE>              <TD> if a foreign function interface is supported <EM>(Platform dependent: many UNIX, Win32 platforms only)</EM>
<!-- #endif -->
<!-- #ifdef GNU_GETTEXT -->
   <TR><TD><CODE>GETTEXT</CODE>          <TD> if internationalization using the GNU gettext package is supported <EM>(Platform dependent: most UNIX platforms only)</EM>
<!-- #endif -->
   <TR><TD><CODE>LOOP</CODE>
   <TR><TD><CODE>CLOS</CODE>
   <TR><TD><CODE>AMIGA</CODE>            <TD> if <VAR>hardware</VAR> = Amiga and <VAR>operating system</VAR> = Exec/AmigaDOS
   <TR><TD><CODE>DOS</CODE>              <TD> if <VAR>hardware</VAR> = PC (clone) and <VAR>operating system</VAR> = DOS
   <TR><TD><CODE>OS/2</CODE>             <TD> if <VAR>hardware</VAR> = PC (clone) and <VAR>operating system</VAR> = OS/2
   <TR><TD><CODE>WIN32</CODE>            <TD> if <VAR>hardware</VAR> = PC (clone) and <VAR>operating system</VAR> = Win32
                                                   (Windows NT or Windows 95)
   <TR><TD><CODE>PC386</CODE>            <TD> if <VAR>hardware</VAR> = PC (clone) with a 386/486/586/686
   <TR><TD><CODE>UNIX</CODE>             <TD> if                            <VAR>operating system</VAR> = Unix
                                                   (yes, in this case the
                                                   hardware is irrelevant!)
</TABLE>


<H2>Chapter 26: Loop</H2>

The CLtL2 macros <CODE>loop</CODE> and <CODE>loop-finish</CODE> are implemented.


<H2>Chapter 27: Pretty Printing</H2>

The CLtL2 macro <CODE>formatter</CODE> is implemented.


<H2>Chapter 28: Common Lisp Object System</H2>

The CLOS symbols are exported from the package <CODE>&quot;CLOS&quot;</CODE> and thus normally
visible in all user packages. If you don't want them (for example, if you
want to use PCL instead of CLOS), do <CODE>(unuse-package &quot;CLOS&quot;)</CODE>.
<P>
<DL>
<DT>The functions<DD>
  <CODE>slot-value</CODE>, <CODE>slot-boundp</CODE>, <CODE>slot-makunbound</CODE>, <CODE>slot-exists-p</CODE>,
  <CODE>find-class</CODE>, <CODE>(setf find-class)</CODE>, <CODE>class-of</CODE>, <CODE>call-next-method</CODE>, <CODE>next-method-p</CODE>,
  <CODE>class-name</CODE>, <CODE>(setf class-name)</CODE>, <CODE>no-applicable-method</CODE>, <CODE>no-next-method</CODE>,
  <CODE>find-method</CODE>, <CODE>add-method</CODE>, <CODE>remove-method</CODE>, <CODE>compute-applicable-methods</CODE>,
  <CODE>method-qualifiers</CODE>, <CODE>function-keywords</CODE>, <CODE>slot-missing</CODE>, <CODE>slot-unbound</CODE>,
  <CODE>print-object</CODE>, <CODE>describe-object</CODE>, <CODE>make-instance</CODE>, <CODE>initialize-instance</CODE>,
  <CODE>reinitialize-instance</CODE>, <CODE>shared-initialize</CODE>,
<DT>the macros<DD>
  <CODE>with-slots</CODE>, <CODE>with-accessors</CODE>, <CODE>defclass</CODE>, <CODE>defmethod</CODE>, <CODE>defgeneric</CODE>,
  <CODE>generic-function</CODE>, <CODE>generic-flet</CODE>, <CODE>generic-labels</CODE>,
<DT>the classes<DD>
  <CODE>standard-class</CODE>, <CODE>structure-class</CODE>, <CODE>built-in-class</CODE>, <CODE>standard-object</CODE>,
  <CODE>standard-generic-function</CODE>, <CODE>standard-method</CODE> and all predefined classes,
<DT>and the method combination<DD>
  <CODE>standard</CODE>
</DL>
are implemented.
<P>
<H4>Deviations from CLtL2 chapter 28:</H4>

<CODE>defclass</CODE> : It <EM>is</EM> required that the superclasses of a class be defined before
the <CODE>defclass</CODE> form for the class is evaluated.
<P>
<CODE>defclass</CODE> supports the option <CODE>:metaclass structure-class</CODE>. This option is
necessary in order to define a subclass of a <CODE>defstruct</CODE>-defined structure type
using <CODE>defclass</CODE> instead of <CODE>defstruct</CODE>.
<P>
The <CODE>real</CODE> type is added to the predefined classes listed in table 28-1.
<P>
Only <CODE>standard</CODE> method combination is implemented.
<P>
When <CODE>call-next-method</CODE> is called with arguments, the rule that the ordered
set of applicable methods must be the same as for the original arguments
is enforced by the implementation only in interpreted code.
<P>
<CODE>call-next-method</CODE> and <CODE>next-method-p</CODE> are local macros, not local functions.
Use <CODE>#'(lambda () (call-next-method))</CODE> instead of <CODE>#'call-next-method</CODE> if you
really need it as a function.
<P>
There is a generic function <CODE><STRONG>no-primary-method</STRONG></CODE> (analogous to
<CODE>no-applicable-method</CODE>) which is called when a generic function of the class
<CODE>standard-generic-function</CODE> is invoked and no primary method on that generic
function is applicable.
<P>
<CODE>generic-flet</CODE> and <CODE>generic-labels</CODE> are implemented as macros, not as special
forms.
<P>
The function <CODE>ensure-generic-function</CODE> is not implemented.
<P>
<CODE>add-method</CODE> can put methods into other generic functions than the one the method
came from.
<P>
<CODE>print-object</CODE> and <CODE>describe-object</CODE> are only called on objects of type
<CODE>standard-object</CODE>.
<P>
<CODE>describe-object</CODE> should not call <CODE>describe</CODE> recursively as this would produce
more information than is likely to be useful to a human reader.
<P>
<CODE>documentation</CODE> still has the CLtL1 implementation.
<P>
User-defined method combination is not supported.
The sections 28.1.7.3., 28.1.7.4., the macros <CODE>define-method-combination</CODE>,
<CODE>call-method</CODE> and the functions <CODE>invalid-method-error</CODE>, <CODE>method-combination-error</CODE>,
<CODE>method-qualifiers</CODE> are not implemented.
<P>
The special form <CODE>with-added-methods</CODE> is not implemented.
<P>
Redefining classes is not supported.
The sections 28.1.10., 28.1.10.1., 28.1.10.2., 28.1.10.3., 28.1.10.4. and the
function <CODE>update-instance-for-redefined-class</CODE> are not implemented.
<P>
Changing the class of a given instance is not supported.
The sections 28.1.11., 28.1.11.1., 28.1.11.2., 28.1.11.3. and the functions
<CODE>change-class</CODE>, <CODE>update-instance-for-different-class</CODE>, <CODE>make-instances-obsolete</CODE> are
not implemented.


<H2>Chapter 29: Conditions</H2>

<H3>29.4.1.</H3>

The default condition type for conditions created by <CODE>signal</CODE> is
<CODE>simple-condition</CODE>, not <CODE>simple-error</CODE>.

<H3>29.4.4.</H3>

The macro <CODE>(<STRONG>muffle-cerrors</STRONG> {<VAR>form</VAR>}*)</CODE> executes the <VAR>form</VAR>s. When a continuable
error occurs, no message is printed. Instead, the <CODE>continue</CODE> restart is invoked.
<P>
The macro <CODE>(<STRONG>appease-cerrors</STRONG> {<VAR>form</VAR>}*)</CODE> executes the <VAR>form</VAR>s. When a continuable
error occurs, the error is printed as a warning and the <CODE>continue</CODE> restart is
invoked.
<P>
The macro <CODE>(<STRONG>exit-on-error</STRONG> {<VAR>form</VAR>}*)</CODE> executes the <VAR>form</VAR>s. When a non-continuable
error or a Ctrl-C interrupt occurs, the error is printed and CLISP terminates
with error status.

<H3>29.4.7.</H3>

In <CODE>restart-case</CODE> clauses the argument list can also be specified after the
keyword/value pairs instead of before them. The syntax therefore is
  <CODE>(restart-case <VAR>form</VAR> {<VAR>restart-clause</VAR>}*)</CODE>
with
<TABLE>
  <TR><TD><VAR>restart-clause</VAR> ::= <TD>  <CODE>(<VAR>restart-name</VAR></CODE> <VAR>arglist</VAR> {<VAR>keyword value</VAR>}* {<VAR>form</VAR>}*<CODE>)</CODE>
  <TR><TD>                   <TD>| <CODE>(<VAR>restart-name</VAR></CODE> {<VAR>keyword value</VAR>}* <VAR>arglist</VAR> {<VAR>form</VAR>}*<CODE>)</CODE>
</TABLE>
<P>
The macro <CODE><STRONG>with-restarts</STRONG></CODE> is like <CODE>restart-case</CODE>, except that the forms are
specified after the restart clauses instead of before them, and the
restarts created are not implicitly associated to any condition.
  <CODE>(with-restarts (</CODE>{<VAR>restart-clause</VAR>}*<CODE>)</CODE> {<VAR>form</VAR>}*<CODE>)</CODE>
is therefore equivalent to <CODE>(restart-case (progn </CODE>{<VAR>form</VAR>}*<CODE>)</CODE> {<VAR>restart-clause</VAR>}*<CODE>)</CODE>.

<H3>29.4.8.</H3>

<CODE>compute-restarts</CODE> and <CODE>find-restart</CODE> behave as specified in ANSI CL: If the
optional condition argument is not <CODE>nil</CODE>, only restarts associated with that
condition and restarts associated to no condition at all are considered.
Therefore the effect of associating a restart to a condition is not to
activate it, but to hide it from other conditions. This makes the syntax
dependent implicit association performed by <CODE>restart-case</CODE> nearly obsolete.

<H3>29.4.9.</H3>

The default condition type for conditions created by <CODE>warn</CODE> is <CODE>simple-warning</CODE>,
not <CODE>simple-error</CODE>.


<H2>Chapter 90: Platform independent Extensions</H2>

<H3>90.1. Saving an Image</H3>

The function <CODE>(<STRONG>saveinitmem</STRONG> [<VAR>filename</VAR> [:quiet] [:init-function]])</CODE> saves the
running CLISP's memory to a file. The <VAR>filename</VAR> defaults to <CODE>&quot;lispinit.mem&quot;</CODE>.
If the <CODE>:quiet</CODE> argument is not <CODE>nil</CODE>, the startup banner and the good-bye
message will be suppressed. The <CODE>:init-function</CODE> argument specifies a function
that will be executed at startup of the saved image.

<H3>90.2. Quitting Lisp</H3>

The functions <CODE>(<STRONG>exit</STRONG> [<VAR>errorp</VAR>])</CODE>, <CODE>(<STRONG>quit</STRONG> [<VAR>errorp</VAR>])</CODE> and <CODE>(<STRONG>bye</STRONG> [<VAR>errorp</VAR>])</CODE>
- all synonymous - terminate CLISP. If <VAR>errorp</VAR> is not <CODE>nil</CODE>, CLISP aborts with
error status, i.e. the environment is informed that the CLISP session didn't
succeed.

<H3>90.3. The Language</H3>

The language CLISP uses to communicate with the user can be either
<CODE>ENGLISH</CODE> or <CODE>DEUTSCH</CODE> (i.e. german) or <CODE>FRANCAIS</CODE> (i.e. french) or <CODE>ESPA&Ntilde;OL</CODE> (i.e.
spanish). More languages can be defined through the macro <CODE><STRONG>deflanguage</STRONG></CODE>:
  <CODE>(deflanguage <VAR>lang</VAR>)</CODE>
For such an additional language to take effect, you must install the
corresponding message catalog, or translate the messages yourself, by use
of GNU gettext and Emacs po-mode.
<P>
The macros <CODE>ENGLISH</CODE>, <CODE>DEUTSCH</CODE>, <CODE>FRANCAIS</CODE> produce strings that depends on the
language:
<CODE>(ENGLISH <VAR>english-string</VAR> DEUTSCH <VAR>deutsch-string</VAR> FRANCAIS <VAR>francais-string</VAR>)</CODE>
- and all permutations of this - evaluates all of <VAR>english-string</VAR>,
<VAR>deutsch-string</VAR>, <VAR>francais-string</VAR> in no particular order and returns the
evaluation result corresponding to the user language, be it among these
three or not.
<P>
This works only for strings. For arbitrary language-dependent Lisp objects,
you define one through the macro <CODE><STRONG>definternational</STRONG></CODE>:
<BR>  <CODE>(definternational <VAR>symbol</VAR> [(t <VAR>default-language</VAR>)])</CODE>,
<BR>and add language-dependent values through the macro <CODE><STRONG>deflocalized</STRONG></CODE>:
<BR>  <CODE>(deflocalized <VAR>symbol</VAR> <VAR>language</VAR> <VAR>value-form</VAR>)</CODE>
<BR>(One such form for each language. Languages without an assigned value will
be treated like the default-language.) You can then access the localized value
through the function call
  <CODE>(<STRONG>localized</STRONG> <VAR>symbol</VAR> [<VAR>language</VAR>])</CODE>.

<H3>90.4. Finalization</H3>

Calling <CODE>(<STRONG>finalize</STRONG> <VAR>object</VAR> <VAR>function</VAR>)</CODE> has the effect that when the specified
object is being garbage collected, <CODE>(funcall <VAR>function</VAR> <VAR>object</VAR>)</CODE> will be executed.
<P>
Calling <CODE>(finalize <VAR>object</VAR> <VAR>function</VAR> <VAR>guardian</VAR>)</CODE> has a similar effect, but only
as long as the &quot;guardian&quot; has not been garbage collected: When <VAR>object</VAR> is
being garbage collected, <CODE>(funcall <VAR>function</VAR> <VAR>object</VAR> <VAR>guardian</VAR>)</CODE> will be executed.
If the guardian is garbage collected before <VAR>object</VAR> is, nothing happens.
<P>
Note: The time when &quot;<VAR>object</VAR> is being garbage collected&quot; is not defined
deterministically. (Actually, it possibly never occurs.) It denotes a moment
at which no references to <VAR>object</VAR> exist from other Lisp objects. When the
<VAR>function</VAR> is called, <VAR>object</VAR> (and possibly <VAR>guardian</VAR>) enter the &quot;arena of live
Lisp objects&quot; again.
<P>
No finalization request will be executed more than once.

<H3>90.5. The Prompt</H3>

The variable <CODE>*prompt-with-package*</CODE> controls the
appearance of the prompt.  When <CODE>*prompt-with-package*</CODE> is
<CODE>nil</CODE> the prompt consists of the string
&quot;&gt;&nbsp;&quot;. When
<CODE>*prompt-with-package*</CODE> is not <CODE>nil</CODE> the prompt
consists of a string like: &quot;[<VAR>package</VAR>]&gt;&nbsp;&quot;, where
<VAR>package</VAR> is the name of the package which is the value of
the <CODE>*package*</CODE> variable.


<H2>Chapter 91: The Debugger and Stepper</H2>

The debugger may be invoked through the functions <CODE>invoke-debugger</CODE>, <CODE>break</CODE>,
<CODE>signal</CODE>, <CODE>error</CODE>, <CODE>cerror</CODE>, <CODE>warn</CODE>. The stepper is invoked through the macro <CODE>step</CODE>.
Debugger and stepper execute subordinate <CODE>read</CODE> - <CODE>eval</CODE> - <CODE>print</CODE> loops (called
&quot;break loops&quot;) which are analogous to the main <CODE>read</CODE> - <CODE>eval</CODE> - <CODE>print</CODE> loop except
for the prompt and the set of available commands. Commands must be typed
literally, without surrounding quotes or white space.
<P>
Commands common to the main loop, the debugger and the stepper:
<TABLE BORDER>
<TR>  <TD WIDTH=100><CODE>Help</CODE>       <TD>prints a list of available commands.
</TABLE>
<P>
Commands common to the debugger and the stepper:
<TABLE BORDER>
<TR>  <TD WIDTH=100><CODE>Abort</CODE>      <TD>abort to the next most recent <CODE>read</CODE> - <CODE>eval</CODE> - <CODE>print</CODE> loop.
<TR>  <TD WIDTH=100><CODE>Unwind</CODE>     <TD>abort to the next most recent <CODE>read</CODE> - <CODE>eval</CODE> - <CODE>print</CODE> loop.
</TABLE>
<P>
The stack is organized into frames and other stack elements. Usually every
invocation of an interpreted function and every evaluation of an interpreted
form corresponds to one stack frame. Special forms such as <CODE>let</CODE>, <CODE>let*</CODE>,
<CODE>unwind-protect</CODE> and <CODE>catch</CODE> produce special kinds of stack frames.
<P>
In a break loop there is a current stack frame, which is initially the most
recent stack frame but can be moved using the debugger commands <CODE>Up</CODE> and <CODE>Down</CODE>.
<P>
Evaluation of forms in a break loop occurs in the lexical environment of the
current stack frame but in the dynamic environment of the debugger's caller.
This means that to inspect or modify a lexical variable all you have to do
is to move to the current stack frame just below the frame that corresponds
to the form or the function call that binds that variable.
<P>
There is a current &quot;stack mode&quot; which defines in how much detail the stack
is shown by the stack related debugger commands.
<P>
Commands common to the debugger and the stepper:
<TABLE BORDER>
<TR>  <TD WIDTH=100><CODE>Mode-1</CODE>      <TD>sets the current mode to 1: all the stack elements are
              considered. This mode is fine for debugging compiled functions.
<TR>  <TD WIDTH=100><CODE>Mode-2</CODE>      <TD>sets the current mode to 2: all the frames are considered.
<TR>  <TD WIDTH=100><CODE>Mode-3</CODE>      <TD>sets the current mode to 3: only lexical frames (frames that
              correspond to special forms that modify the lexical environment)
              are considered.
<TR>  <TD WIDTH=100><CODE>Mode-4</CODE>      <TD>sets the current mode to 4 (the default): only <CODE>eval</CODE> and <CODE>apply</CODE>
              frames are considered. Every evaluation of a form in the
              interpreter corresponds to an EVAL frame.
<TR>  <TD WIDTH=100><CODE>Mode-5</CODE>      <TD>sets the current mode to 5: only <CODE>apply</CODE> frames are considered.
              Every invocation of an interpreted function corresponds to one
              <CODE>apply</CODE> frame.
<TR>  <TD WIDTH=100><CODE>Where</CODE>       <TD>shows the current stack frame.
<TR>  <TD WIDTH=100><CODE>Up</CODE>          <TD>goes up one frame, i.e. to the caller if in mode-5
<TR>  <TD WIDTH=100><CODE>Down</CODE>        <TD>does down one frame, i.e. to the callee if in mode-5
<TR>  <TD WIDTH=100><CODE>Top</CODE>         <TD>goes to top frame, i.e. to the top-level form if in mode-4
<TR>  <TD WIDTH=100><CODE>Bottom</CODE>      <TD>goes to bottom (most recent) frame, i.e. most probably to the
              form or function that caused the debugger to be entered.
<TR>  <TD WIDTH=100><CODE>Backtrace</CODE>   <TD>lists the stack in current mode, bottom frame first, top frame
              last.
<TR>  <TD WIDTH=100><CODE>Backtrace-1</CODE> <TD>lists the stack in mode 1.
<TR>  <TD WIDTH=100><CODE>Backtrace-2</CODE> <TD>lists the stack in mode 2.
<TR>  <TD WIDTH=100><CODE>Backtrace-3</CODE> <TD>lists the stack in mode 3.
<TR>  <TD WIDTH=100><CODE>Backtrace-4</CODE> <TD>lists the stack in mode 4.
<TR>  <TD WIDTH=100><CODE>Backtrace-5</CODE> <TD>lists the stack in mode 5.
</TABLE>
If the current stack frame is an <CODE>eval</CODE> or <CODE>apply</CODE> frame, the following commands
are available as well:
<TABLE BORDER>
<TR>  <TD WIDTH=100><CODE>Break+</CODE>      <TD>sets a breakpoint in the current frame. When the corresponding
              form or function will be left, the debugger will be entered
              again, with the variable <CODE>*trace-values*</CODE> containing a list of
              its values.
<TR>  <TD WIDTH=100><CODE>Break-</CODE>      <TD>removes a breakpoint from the current frame.
<TR>  <TD WIDTH=100><CODE>Redo</CODE>        <TD>re-evaluates the corresponding form or function call. This
              command can be used to restart parts of a computation without
              aborting it entirely.
<TR>  <TD WIDTH=100><CODE>Return</CODE>      <TD>leaves the current frame. You will be prompted for the
              return values.
</TABLE>
<P>
Commands specific to the debugger:
<TABLE BORDER>
<TR>  <TD WIDTH=100><CODE>Continue</CODE>    <TD>continues evaluation of the program.
</TABLE>
<P>
Commands specific to the stepper:
<TABLE BORDER>
<TR>  <TD WIDTH=100><CODE>Step</CODE>        <TD>step into a form: evaluate this form in single step mode
<TR>  <TD WIDTH=100><CODE>Next</CODE>        <TD>step over a form: evaluate this form at once
<TR>  <TD WIDTH=100><CODE>Over</CODE>        <TD>step over this level: evaluate at once up to the next return
<TR>  <TD WIDTH=100><CODE>Continue</CODE>    <TD>switch off single step mode, continue evaluation
</TABLE>
<P>
The stepper is usually used like this: If some form returns a strange value
or results in an error, call  <CODE>(step <VAR>form</VAR>)</CODE>  and navigate using the commands
<CODE>Step</CODE>  and  <CODE>Next</CODE>  until you reach the form you regard as responsible. If you
are too fast (execute <CODE>Next</CODE> once and get the error), there is no way back; you
have to restart the entire stepper session. If you are too slow (stepped into
a function or a form which certainly is OK), a couple of <CODE>Next</CODE> commands or one
<CODE>Over</CODE> command will help.

<!-- #if defined(SCREEN) || defined(AMIGAOS) || defined(GRAPHICS) || defined(UNIX) || defined(DYNAMIC_FFI) || defined(SOCKET_STREAMS) -->

<H2>Chapter 99: Platform specific Extensions</H2>

<!-- #if 0 -->
<H3>99.1. The Editor</H3>

<EM>Undocumented.</EM>
<!-- #endif -->
<!-- #if defined(SCREEN) || defined(AMIGAOS) -->
<H3>99.2. Random Screen Access</H3>

<EM>Platform dependent: UNIX, DOS, OS/2, Amiga platforms only.</EM>

<DL>
<DT><CODE>(<STRONG>screen:make-window</STRONG>)</CODE>
<DD>  returns a &quot;window stream&quot;. As long as this stream is open, the terminal
  is in cbreak/noecho mode. <CODE>*terminal-io*</CODE> shouldn't be used for input or
  output during this time. (Use <CODE>with-keyboard</CODE> and <CODE>*keyboard-input*</CODE> instead.)

<DT><CODE>(<STRONG>screen:with-window</STRONG> . <VAR>body</VAR>)</CODE>
<DD>  binds <CODE><STRONG>screen:*window*</STRONG></CODE> to a window stream and executes <VAR>body</VAR>. The stream is
  guaranteed to be closed when the body is left. During its execution,
  <CODE>*terminal-io*</CODE> shouldn't be used, as above.

<DT><CODE>(<STRONG>screen:window-size</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  returns the window's size, as two values:
  height (= y<SUB>max</SUB>+1) and width (= x<SUB>max</SUB>+1).

<DT><CODE>(<STRONG>screen:window-cursor-position</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  returns the position of the cursor in the window, as two values:
  line (&gt;=0, &lt;=y<SUB>max</SUB>, 0 means top), column (&gt;=0, &lt;=x<SUB>max</SUB>, 0 means left margin).

<DT><CODE>(<STRONG>screen:set-window-cursor-position</STRONG> <VAR>window-stream</VAR> <VAR>line</VAR> <VAR>column</VAR>)</CODE>
<DD>  sets the position of the cursor in the window.

<DT><CODE>(<STRONG>screen:clear-window</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  clears the window's contents and puts the cursor in the upper left corner.

<DT><CODE>(<STRONG>screen:clear-window-to-eot</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  clears the window's contents from the cursor position to the end of window.

<DT><CODE>(<STRONG>screen:clear-window-to-eol</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  clears the window's contents from the cursor position to the end of line.

<DT><CODE>(<STRONG>screen:delete-window-line</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  removes the cursor's line, moves the lines below it up by one line and
  clears the window's last line.

<DT><CODE>(<STRONG>screen:insert-window-line</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  inserts a line at the cursor's line, moving the lines below it down by
  one line.

<DT><CODE>(<STRONG>screen:highlight-on</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  switches highlighted output on.

<DT><CODE>(<STRONG>screen:highlight-off</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  switches highlighted output off.

<DT><CODE>(<STRONG>screen:window-cursor-on</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  makes the cursor visible, a cursor block in most implementations.

<DT><CODE>(<STRONG>screen:window-cursor-off</STRONG> <VAR>window-stream</VAR>)</CODE>
<DD>  makes the cursor invisible, in implementations where this is possible.
</DL>
<!-- #endif -->
<!-- #ifdef UNIX -->
<H3>99.3. External Modules</H3>

<EM>Platform dependent: UNIX platforms only.</EM>
<P>
CLISP has a facility for adding external modules (written in C, for example).
It is invoked through <CODE>clisp-link</CODE>.
<P>
A module is a piece of external code which defines extra Lisp objects, symbols
and functions. A module name must consist of the characters A-Z,a-z,_,0-9. The
module name <CODE>&quot;clisp&quot;</CODE> is reserved. Normally a module name is derived from the
corresponding file name.
<P>
<CODE>clisp-link</CODE> needs a directory containing:
<TABLE>
  <TR><TD>  <CODE>modules.d</CODE>
  <TR><TD>  <CODE>modules.c</CODE>
  <TR><TD>  <CODE>clisp.h</CODE>
</TABLE>
<CODE>clisp-link</CODE> expects to find these files in a subdirectory <CODE>linkkit/</CODE> of the
current directory. This can be overridden by the environment variable
<CODE>CLISP_LINKKIT</CODE>.
<P>
<CODE>clisp-link</CODE> operates on CLISP linking sets and on module sets.
<P>
A <STRONG>linking set</STRONG> is a directory containing:
<DL>
<DT>    <CODE>makevars</CODE>          <DD>some <CODE>/bin/sh</CODE> commands, setting the variables
                      <DL>
                        <DT><CODE>CC</CODE>       <DD>the C compiler
                        <DT><CODE>CFLAGS</CODE>   <DD>flags for the C compiler, when compiling
                        <DT><CODE>CLFLAGS</CODE>  <DD>flags for the C compiler, when linking
                        <DT><CODE>LIBS</CODE>     <DD>libraries to use when linking
                        <DT><CODE>X_LIBS</CODE>   <DD>additional X window system libraries to use
                        <DT><CODE>RANLIB</CODE>   <DD>the ranlib command
                        <DT><CODE>FILES</CODE>    <DD>the list of files needed when linking
                      </DL>
<DT>    <CODE>modules.h</CODE>         <DD>the list of modules contained in this linking set
<DT>    all the <CODE>FILES</CODE> listed in <CODE>makevars</CODE>
<DT>    <CODE>lisp.run</CODE>          <DD>the executable
<DT>    <CODE>lispinit.mem</CODE>      <DD>the memory image
</DL>
To run a clisp contained in some linking set <VAR>dir</VAR>, call
&quot;<CODE><VAR>dir</VAR>/lisp.run -M <VAR>dir</VAR>/lispinit.mem</VAR>&quot;.
<P>
A <STRONG>module set</STRONG> is a directory containing:
<DL>
<DT>    <CODE>link.sh</CODE>          <DD>some <CODE>/bin/sh</CODE> commands, which prepare the directory
                     before linking, and set the variables <CODE>NEW_FILES</CODE>, <CODE>NEW_LIBS</CODE>,
                     <CODE>NEW_MODULES</CODE>, <CODE>TO_LOAD</CODE< and optionally <CODE>TO_PRELOAD</CODE>
<DT>
and any other files needed by <CODE>link.sh</CODE>.
</DL>
Note that in <CODE>link.sh</CODE> the module set directory is referred to as <CODE>&quot;$modulename&quot;/</CODE>.
<DL>
<DT>  The <CODE>NEW_FILES</CODE> variable <DD>shall contain a space-separated list of files that
  belong to the module set and will belong to every new linking set.

<DT>  The <CODE>NEW_LIBS</CODE> variable <DD>shall contain a space-separated list of files or C
  compiler switches that need to be passed to the C compiler when linking the
  lisp.run belonging to a new linking set.

<DT>  The <CODE>NEW_MODULES</CODE> variable <DD>shall contain a space-separated list of the module
  names belonging to the module set. Normally, every <CODE>.c</CODE> file in the module set
  defines a module of its own. The module name is derived from the file name.

<DT>  The <CODE>TO_LOAD</CODE> variable <DD>shall contain a space-separated list of Lisp files to
  load before building the <CODE>lispinit.mem</CODE> belonging to a new linking set.

<DT>  The <CODE>TO_PRELOAD</CODE> variable, if defined, <DD>shall contain a space-separated list
  of Lisp files to load into an intermediate <CODE>lispinit.mem</CODE> file, before
  building the <CODE>lispinit.mem</CODE> belonging to a new linking set. This variable
  is usually used for defining Lisp packages which must be present when
  the new <CODE>.c</CODE> files are initialized.
</DL>
<P>
The command
&quot;<CODE>clisp-link create-module-set <VAR>module-dir</VAR> <VAR>file1.c</VAR> ...</CODE>&quot;
creates a module set in <VAR>module-dir</VAR> which refers (via symbolic links) to
<CODE><VAR>file1.c</VAR></CODE> etc. The files are expected to be modules of their own.
<P>
The command
&quot;<CODE>clisp-link add-module-set <VAR>module-dir</VAR> <VAR>source-dir</VAR> <VAR>destination-dir</VAR></CODE>&quot;
combines a linking set in <VAR>source-dir</VAR> and a module in <VAR>module-dir</VAR> to a new
linking set, in a directory <VAR>destination-dir</VAR> which is newly created.
<P>
The command
&quot;clisp-link run <VAR>source-dir</VAR> <VAR>module-dir</VAR> ...&quot;
runs the linking set in <VAR>source-dir</VAR>, with the module in <VAR>module-dir</VAR> loaded.
More than one module can be specified. If CLISP has been built with the
configuration option <CODE>--with-dynamic-modules</CODE>, the loading will be performed
through dynamic loading. Otherwise -- this is much slower -- a temporary
linking set will be created and deleted afterwards. Note that dynamic loading
does not work on all operating systems, and that <CODE>--with-dynamic-modules</CODE>
precludes some efficiency optimizations which are on by default.
<P>
<H4>Example</H4>

To link in the FFI bindings for the Linux operating system, the following
steps are needed. (Step 1 and step 2 need not be executed in this order.)
<OL>
<LI>Create a new module set:
<PRE><CODE>   $ clisp-link create-module-set linux /<VAR>somewhere</VAR>/bindings/linux.c
</CODE></PRE>
   Modify the newly created <CODE>linux/link.sh</CODE> to add &quot;<CODE>-lm</CODE>&quot; to the libraries:
<PRE><CODE>   NEW_LIBS=&quot;$file_list&quot;
   --&gt;
   NEW_LIBS=&quot;$file_list -lm&quot;
</CODE></PRE>
   Modify the newly created <CODE>linux/link.sh</CODE> to load <CODE>linux.fas</CODE> before saving
   the memory image:
<PRE><CODE>   TO_LOAD=''
   --&gt;
   TO_LOAD='/<VAR>somewhere</VAR>/bindings/linux.fas'
</CODE></PRE>
<LI>Compile <CODE>linux.lsp</CODE>, creating <CODE>linux.c</CODE>:
<PRE><CODE>   $ clisp -c /<VAR>somewhere</VAR>/bindings/linux.lsp
</CODE></PRE>
<LI>Create a new linking set:
<PRE><CODE>   $ clisp-link add-module-set linux base base+linux
</CODE></PRE>
<LI>Run and try it:
<PRE><CODE>   $ base+linux/lisp.run -M base+linux/lispinit.mem
   &gt; (linux::stat &quot;/tmp&quot;)
</CODE></PRE>
</OL>
<P>
<!-- #endif -->
<!-- #ifdef DYNAMIC_FFI -->
<H3>99.4. The Foreign Function Call Facility</H3>

<EM>Platform dependent: many UNIX, Win32 platforms only.</EM>
<P>
A foreign function description is written as a Lisp file,
and when compiled it produces a <CODE>.c</CODE> file which is then compiled
by the C compiler and may be linked together with <CODE>lisp.a</CODE>.
<P>
All symbols relating to the foreign function interface are exported from
the package FFI. To use them, <CODE>(use-package &quot;FFI&quot;)</CODE>.
<P>
Special FFI forms may appear anywhere in the Lisp file.

<H4>Overview</H4>

These are the special FFI forms. We have taken a pragmatic approach:
the only foreign languages we support for now are C and ANSI C.
<P>
<CODE>(<STRONG>def-c-type</STRONG> <VAR>name</VAR> <VAR>c-type</VAR>)</CODE>
<P>
<CODE>(<STRONG>def-c-var</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR><TD>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD> <CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:type <VAR>c-type</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:read-only <VAR>boolean</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:alloc <VAR>allocation</VAR>)</CODE>
</TABLE>
<P>
<CODE>(<STRONG>def-call-out</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR><TD>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD> <CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>c-type</VAR> [<VAR>param-mode</VAR> [<VAR>allocation</VAR>]])}*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:return-type <VAR>c-type</VAR> [<VAR>allocation</VAR>])</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:language <VAR>language</VAR>)</CODE>
</TABLE>
<P>
<CODE>(<STRONG>def-call-in</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR><TD>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD> <CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>c-type</VAR> [<VAR>param-mode</VAR> [<VAR>allocation</VAR>]])}*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:return-type <VAR>c-type</VAR> [<VAR>allocation</VAR>])</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:language <VAR>language</VAR>)</CODE>
</TABLE>
<P>
<CODE>(<STRONG>def-c-call-out</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR><TD>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD> <CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>c-type</VAR> [<VAR>param-mode</VAR> [<VAR>allocation</VAR>]])}*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:return-type <VAR>c-type</VAR> [<VAR>allocation</VAR>])</CODE>
</TABLE>
<P>
<CODE>(<STRONG>def-c-call-in</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR><TD>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD> <CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>c-type</VAR> [<VAR>param-mode</VAR> [<VAR>allocation</VAR>]])}*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD> <CODE>(:return-type <VAR>c-type</VAR> [<VAR>allocation</VAR>])</CODE>
</TABLE>
<P>
<CODE>(<STRONG>def-c-struct</STRONG> <VAR>name</VAR> (<VAR>ident</VAR> <VAR>c-type</VAR>)*)</CODE>
<P>
<CODE>(<STRONG>def-c-enum</STRONG> <VAR>name</VAR> {<VAR>ident</VAR> | (<VAR>ident</VAR> [<VAR>value</VAR>])}*)</CODE>
<P>
<CODE>(<STRONG>c-lines</STRONG> <VAR>format-string</VAR> {<VAR>argument</VAR>}*)</CODE>
<P>
<CODE>(<STRONG>element</STRONG> <VAR>c-place</VAR> {<VAR>index</VAR>}*)</CODE>
<BR>
<CODE>(<STRONG>deref</STRONG> <VAR>c-place</VAR>)</CODE>
<BR>
<CODE>(<STRONG>slot</STRONG> <VAR>c-place</VAR> <VAR>slot-name</VAR>)</CODE>
<BR>
<CODE>(<STRONG>cast</STRONG> <VAR>c-place</VAR> <VAR>c-type</VAR>)</CODE>
<P>
<CODE>(<STRONG>typeof</STRONG> <VAR>c-place</VAR>)</CODE>
<BR>
<CODE>(<STRONG>sizeof</STRONG> <VAR>c-place</VAR>)</CODE>, <CODE>(sizeof <VAR>c-type</VAR>)</CODE>
<BR>
<CODE>(<STRONG>bitsizeof</STRONG> <VAR>c-place</VAR>)</CODE>, <CODE>(bitsizeof <VAR>c-type</VAR>)</CODE>
<P>
<CODE>(<STRONG>validp</STRONG> <VAR>foreign-entity</VAR>)</CODE>
<P>
<VAR>name</VAR> is any Lisp symbol.
<P>
<VAR>c-name</VAR> is a string.
<P>
<H4>(Foreign) C types</H4>

Foreign C types are used in the FFI. They are <EM>not</EM> regular Common Lisp
types or CLOS classes.
<P>
A <VAR>c-type</VAR> is either a predefined C type or the name of a type defined by
<CODE>def-c-type</CODE>.
<P>
The simple C types are these:
<TABLE BORDER>
<TR> <TH>Lisp name     <TH>Lisp equiv           <TH>C equiv        <TH>ILU equiv <TH>Comment
<TR>  <TD><CODE>nil</CODE>           <TD><CODE>nil</CODE>                  <TD><CODE>void</CODE>           <TD>                  <TD>as a result type only
<TR>  <TD><CODE>boolean</CODE>       <TD><CODE>boolean</CODE>              <TD><CODE>int</CODE>            <TD><CODE>BOOLEAN</CODE>
<TR>  <TD><CODE>character</CODE>     <TD><CODE>string-char</CODE>          <TD><CODE>char</CODE>           <TD><CODE>SHORT CHARACTER</CODE>
<TR>  <TD><CODE>char</CODE>          <TD><CODE>integer</CODE>              <TD><CODE>signed char</CODE>
<TR>  <TD><CODE>uchar</CODE>         <TD><CODE>integer</CODE>              <TD><CODE>unsigned char</CODE>
<TR>  <TD><CODE>short</CODE>         <TD><CODE>integer</CODE>              <TD><CODE>short</CODE>
<TR>  <TD><CODE>ushort</CODE>        <TD><CODE>integer</CODE>              <TD><CODE>unsigned short</CODE>
<TR>  <TD><CODE>int</CODE>           <TD><CODE>integer</CODE>              <TD><CODE>int</CODE>
<TR>  <TD><CODE>uint</CODE>          <TD><CODE>integer</CODE>              <TD><CODE>unsigned int</CODE>
<TR>  <TD><CODE>long</CODE>          <TD><CODE>integer</CODE>              <TD><CODE>long</CODE>
<TR>  <TD><CODE>ulong</CODE>         <TD><CODE>integer</CODE>              <TD><CODE>unsigned long</CODE>
<TR>  <TD><CODE>uint8</CODE>         <TD><CODE>(unsigned-byte 8)</CODE>    <TD><CODE>uint8</CODE>          <TD><CODE>BYTE</CODE>
<TR>  <TD><CODE>sint8</CODE>         <TD><CODE>(signed-byte 8)</CODE>      <TD><CODE>sint8</CODE>
<TR>  <TD><CODE>uint16</CODE>        <TD><CODE>(unsigned-byte 16)</CODE>   <TD><CODE>uint16</CODE>         <TD><CODE>SHORT CARDINAL</CODE>
<TR>  <TD><CODE>sint16</CODE>        <TD><CODE>(signed-byte 16)</CODE>     <TD><CODE>sint16</CODE>         <TD><CODE>SHORT INTEGER</CODE>
<TR>  <TD><CODE>uint32</CODE>        <TD><CODE>(unsigned-byte 32)</CODE>   <TD><CODE>uint32</CODE>         <TD><CODE>CARDINAL</CODE>
<TR>  <TD><CODE>sint32</CODE>        <TD><CODE>(signed-byte 32)</CODE>     <TD><CODE>sint32</CODE>         <TD><CODE>INTEGER</CODE>
<TR>  <TD><CODE>uint64</CODE>        <TD><CODE>(unsigned-byte 64)</CODE>   <TD><CODE>uint64</CODE>         <TD><CODE>LONG CARDINAL</CODE>     <TD>does not work on all platforms
<TR>  <TD><CODE>sint64</CODE>        <TD><CODE>(signed-byte 64)</CODE>     <TD><CODE>sint64</CODE>         <TD><CODE>LONG INTEGER</CODE>      <TD>does not work on all platforms
<TR>  <TD><CODE>single-float</CODE>  <TD><CODE>single-float</CODE>         <TD><CODE>float</CODE>
<TR>  <TD><CODE>double-float</CODE>  <TD><CODE>double-float</CODE>         <TD><CODE>double</CODE>
</TABLE>
<P>
The predefined C types are:
<TABLE>
<TR><TD>  <VAR>c-type</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD><VAR>simple-c-type</VAR>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>c-pointer</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>c-string</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(c-struct <VAR>class</VAR> (<VAR>ident</VAR> <VAR>c-type</VAR>)*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(c-union (<VAR>ident</VAR> <VAR>c-type</VAR>)*)</CODE>
<TR><TD ALIGN=RIGHT VALIGN=TOP>    | <TD><CODE>(c-array <VAR>c-type</VAR> <VAR>dimensions</VAR>)</CODE>
<BR>        <VAR>dimensions</VAR> ::= <VAR>number</VAR> | <CODE>({<VAR>number</VAR>}*)</CODE>
<TR><TD ALIGN=RIGHT VALIGN=TOP>    | <TD><CODE>(c-array-max <VAR>c-type</VAR> <VAR>maxdimension</VAR>)</CODE>
<BR>        <VAR>maxdimension</VAR> ::= <VAR>number</VAR>
<TR><TD ALIGN=RIGHT VALIGN=TOP>    | <TD><CODE>(c-function {<VAR>option</VAR>}*)</VAR>
<BR>        <VAR>option</VAR> ::=
<BR>          &nbsp; <CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>c-type</VAR> [<VAR>param-mode</VAR> [<VAR>allocation</VAR>]])}*)</CODE>
<BR>          | <CODE>(:return-type <VAR>c-type</VAR> [<VAR>allocation</VAR>])</CODE>
<BR>          | <CODE>(:language <VAR>language</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(c-ptr <VAR>c-type</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(c-ptr-null <VAR>c-type</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(c-array-ptr <VAR>c-type</VAR>)</CODE>
</TABLE>
<P>
<CODE>(<STRONG>def-c-type</STRONG> <VAR>name</VAR> <VAR>c-type</VAR>)</CODE>
makes <VAR>name</VAR> a shortcut for <VAR>c-type</VAR>. Note that <VAR>c-type</VAR> may already refer
to name. Forward declarations of types are not possible, however.
<P>
The type <CODE>c-pointer</CODE> corresponds to what C calls &quot;<CODE>void*</CODE>&quot;, an opaque pointer.
<P>
The type <CODE>c-string</CODE> corresponds to what C calls &quot;<CODE>char*</CODE>&quot;, a zero-terminated
string. Its Lisp equivalent is a string, without the trailing zero character.
<P>
The type <CODE>(c-struct <VAR>class</VAR> (<VAR>ident<SUB>1</SUB></VAR> <VAR>type<SUB>1</SUB></VAR>) ... (<VAR>ident<SUB>n</SUB></VAR> <VAR>type<SUB>n</SUB></VAR>))</CODE> is equivalent to
what C calls &quot;<CODE>struct { <VAR>type<SUB>1</SUB></VAR> <VAR>ident<SUB>1</SUB></VAR>; ...; <VAR>type<SUB>n</SUB></VAR> <VAR>ident<SUB>n</SUB></VAR>; }</CODE>&quot;. Its Lisp
equivalent is: if <VAR>class</VAR> is <CODE>vector</CODE>, a simple-vector; if <VAR>class</VAR> is <CODE>list</CODE>, a list;
if <VAR>class</VAR> is a symbol naming a structure or CLOS class: an instance of this
class, with slots of names <VAR>ident<SUB>1</SUB></VAR>,...,<VAR>ident<SUB>n</SUB></VAR>.
<P>
The type <CODE>(c-union (<VAR>ident<SUB>1</SUB></VAR> <VAR>type<SUB>1</SUB></VAR>) ... (<VAR>ident<SUB>n</SUB></VAR> <VAR>type<SUB>n</SUB></VAR>))</CODE> is equivalent to what C
calls &quot;<CODE>union { <VAR>type<SUB>1</SUB></VAR> <VAR>ident<SUB>1</SUB></VAR>; ...; <VAR>type<SUB>n</SUB></VAR> <VAR>ident<SUB>n</SUB></VAR>; }</CODE>&quot;. Conversion to and from
Lisp assumes that a value is to be viewed as being of <VAR>type<SUB>1</SUB></VAR>.
<P>
The type <CODE>(c-array <VAR>type</VAR> <VAR>dim<SUB>1</SUB></VAR> ... <VAR>dim<SUB>n</SUB></VAR>)</CODE> is equivalent to what C calls
&quot;<CODE><VAR>type</VAR> [<VAR>dim<SUB>1</SUB></VAR>]...[<VAR>dim<SUB>n</SUB></VAR>]</CODE>&quot;. Note that when an array is passed as an argument to
a function in C, it is actually passed as a pointer; you therefore have to
write <CODE>(c-ptr (c-array ...))</CODE> for this argument's type.
<P>
The type <CODE>(c-array-max <VAR>type</VAR> <VAR>maxdim</VAR>)</CODE> is equivalent to what C calls
&quot;<CODE><VAR>type</VAR> [<VAR>maxdim</VAR>]</CODE>&quot;, an array containing up to <VAR>maxdim</VAR> elements. The array is
zero-terminated if it contains less than <VAR>maxdim</VAR> elements. Conversion from Lisp
of an array with more than <VAR>maxdim</VAR> elements silently ignores the superfluous
elements.
<P>
The type <CODE>(c-ptr <VAR>type</VAR>)</CODE> is equivalent to what C calls &quot;<CODE><VAR>type</VAR> *</CODE>&quot;: a pointer to
a single item of the given <VAR>type</VAR>.
<P>
The type <CODE>(c-ptr-null <VAR>type</VAR>)</CODE> is also equivalent to what C calls &quot;<CODE><VAR>type</VAR> *&quot</CODE>;: a
pointer to a single item of the given <VAR>type</VAR>, with the exception that C <CODE>NULL</CODE>
corresponds to Lisp <CODE>nil</CODE>.
<P>
The type <CODE>(c-array-ptr <VAR>type</VAR>)</CODE> is equivalent to what C calls &quot;<CODE><VAR>type</VAR> (*)[]</CODE>&quot;:
a pointer to a zero-terminated array of items of the given <VAR>type</VAR>.
<P>
The type <CODE>(c-function (:return-type <VAR>rtype</VAR>) (:arguments (<VAR>arg<SUB>1</SUB></VAR> <VAR>type<SUB>1</SUB></VAR> ...) ...))</CODE>
designates a C function that can be called according to the given prototype
<CODE>(<VAR>rtype</VAR> (*) (<VAR>type<SUB>1</SUB></VAR>, ...))</CODE>.
The <VAR>language</VAR> is either <CODE>:C</CODE> (denotes K&amp;R C) or <CODE>:STDC</CODE> (denotes ANSI C) or
<CODE>:STDC-STDCALL</CODE> (denotes ANSI C with <EM>stdcall</EM> calling convention). It
specifies whether the C function has been compiled by a K&amp;R C compiler or by
an ANSI C compiler, and possibly the calling convention.
Conversion between C functions and Lisp functions is transparent.
<P>
<CODE>(<STRONG>def-c-struct</STRONG> <VAR>name</VAR> (<VAR>ident</VAR> <VAR>c-type</VAR>)*)</CODE> defines <VAR>name</VAR> to be both a
<CODE>defstruct</CODE> structure type and a foreign C type with the given slots.
<P>
<CODE>(<STRONG>def-c-enum</STRONG> <VAR>name</VAR> {<VAR>ident</VAR> | (<VAR>ident</VAR> [<VAR>value</VAR>])}*)</CODE> defines <VAR>ident</VAR>s as
constants, similarly to the C declaration  <CODE>enum { <VAR>ident</VAR> [= <VAR>value</VAR>], ... };</CODE>
<P>
<CODE>(<STRONG>c-lines</STRONG> <VAR>format-string</VAR> {<VAR>argument</VAR>}*)</CODE>
outputs the string <CODE>(format nil <VAR>format-string</VAR> {<VAR>argument</VAR>}*)</CODE> to the C output
file. This is a rarely needed low-level facility.
<P>
The form <CODE>(<STRONG>sizeof</STRONG> <VAR>c-type</VAR>)</CODE> returns the size and alignment of a C type,
measured in bytes.
<P>
The form <CODE>(<STRONG>bitsizeof</STRONG> <VAR>c-type</VAR>)</CODE> returns the size and alignment of a C type,
measured in bits.
<P>
The predicate <CODE>(<STRONG>validp</STRONG> <VAR>foreign-entity</VAR>)</CODE> returns <CODE>nil</CODE> if the <VAR>foreign-entity</VAR>
(e.g. the Lisp equivalent of a <CODE>c-pointer</CODE>) refers to a pointer which is
invalid because it comes from a previous Lisp session. It returns <CODE>t</CODE> if
<VAR>foreign-entity</VAR> can be used within the current Lisp process.

<H4>Foreign variables</H4>

Foreign variables are variables whose storage is allocated in the foreign
language module. They can nevertheless be evaluated and modified through <CODE>setq</CODE>,
just as normal variables can, except that the range of allowed values is
limited according to the variable's foreign type. Note that for a foreign
variable <VAR>x</VAR> the form <CODE>(eql <VAR>x</VAR> <VAR>x</VAR>)</CODE> is not necessarily true, since every time <VAR>x</VAR> is
evaluated its foreign value is converted to a freshly created Lisp value.
<P>
<CODE>(<STRONG>def-c-var</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD><CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:type <VAR>c-type</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:read-only <VAR>boolean</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:alloc <VAR>allocation</VAR>)</CODE>
</TABLE>
defines a foreign variable. <VAR>name</VAR> is the Lisp name, a regular Lisp symbol.
<P>
The <CODE>:name</CODE> option specifies the name, as seen from C, as a string. If not
specified, it is derived from the print name of the Lisp name.
<P>
The <CODE>:type</CODE> option specifies the variable's foreign type.
<P>
If the <CODE>:read-only</CODE> option is specified and non-<CODE>nil</CODE>, it will be impossible
to change the variable's value from within Lisp (using <CODE>setq</CODE> or similar).
<P>
The <CODE>:alloc</CODE> option can be either <CODE>:none</CODE> or <CODE>:malloc-free</CODE> and defaults to <CODE>:none</CODE>.
If it is <CODE>:malloc-free</CODE>, any values of type <CODE>c-string</CODE>, <CODE>(c-ptr ...)</CODE>,
<CODE>(c-ptr-null ...)</CODE>, <CODE>(c-array-ptr ...)</CODE> within the foreign value are assumed to
be pointers to <CODE>malloc()</CODE>-allocated storage, and when <CODE>setq</CODE> replaces an old
value by a new one, the old storage is freed using <CODE>free()</CODE> and the new storage
allocated using <CODE>malloc()</CODE>. If it is <CODE>:none</CODE>, <CODE>setq</CODE> assumes that the pointers
point to good storage (not <CODE>NULL</CODE>!) and overwrites the old values by the new
ones. This is dangerous (just think of overwriting a string with a longer one
or storing some data in a <CODE>NULL</CODE> pointer...) and deprecated.

<H4>Operations on foreign places</H4>

A foreign variable <VAR>name</VAR> defined by <CODE>def-c-var</CODE> defines a &quot;place&quot;, i.e.
a form which can also be used as argument to <CODE>setf</CODE>. (An &quot;lvalue&quot; in C
terminology.) The following operations are available on foreign places:
<P>
<CODE>(<STRONG>element</STRONG> <VAR>place</VAR> <VAR>index<SUB>1</SUB></VAR> ... <VAR>index<SUB>n</SUB></VAR>)</CODE>
<BR>Array element: If <VAR>place</VAR> is of foreign type <CODE>(c-array <VAR>c-type</VAR> <VAR>dim<SUB>1</SUB></VAR> ... <VAR>dim<SUB>n</SUB></VAR>)</CODE>
and 0 &lt;= <VAR>index<SUB>1</SUB></VAR> &lt; <VAR>dim<SUB>1</SUB></VAR>, ..., 0 &lt;= <VAR>index<SUB>n</SUB></VAR> &lt; <VAR>dim<SUB>n</SUB></VAR>, this will be the place
corresponding to <CODE>(aref <VAR>place</VAR> <VAR>index<SUB>1</SUB></VAR> ... <VAR>index<SUB>n</SUB></VAR>)</CODE> or <CODE><VAR>place</VAR>[<VAR>index<SUB>1</SUB></VAR>]...[<VAR>index<SUB>n</SUB></VAR>]</CODE>.
It is a place of type <VAR>c-type</VAR>.
If <VAR>place</VAR> is of foreign type <CODE>(c-array-max <VAR>c-type</VAR> <VAR>dim</VAR>)</CODE> and 0 &lt;= <VAR>index</VAR> &lt; <VAR>dim</VAR>,
this will be the place corresponding to <CODE>(aref <VAR>place</VAR> <VAR>index</VAR>)</CODE> or <CODE><VAR>place</VAR>[<VAR>index</VAR>]</CODE>.
It is a place of type <VAR>c-type</VAR>.
<P>
<CODE>(<STRONG>deref</STRONG> <VAR>place</VAR>)</CODE>
<BR>Dereference pointer: If <VAR>place</VAR> is of foreign type <CODE>(c-ptr <VAR>c-type</VAR>)</CODE> or
<CODE>(c-ptr-null <VAR>c-type</VAR>)</CODE>, this will be the place the pointer points to. It is a
place of type <VAR>c-type</VAR>. For <CODE>(c-ptr-null <VAR>c-type</VAR>)</CODE>, the <VAR>place</VAR> may not be <CODE>NULL</CODE>.
<P>
<CODE>(<STRONG>slot</STRONG> <VAR>place</VAR> <VAR>slot-name</VAR>)</CODE>
<BR>Struct or union component: If <VAR>place</VAR> is of foreign type
<CODE>(c-struct <VAR>class</VAR> ... (<VAR>slot-name</VAR> <VAR>c-type</VAR>) ...)</CODE> or of type
<CODE>(c-union ... (<VAR>slot-name</VAR> <VAR>c-type</VAR>) ...)</CODE>, this will be of type <VAR>c-type</VAR>.
<P>
<CODE>(<STRONG>cast</STRONG> <VAR>place</VAR> <VAR>c-type</VAR>)</CODE>
<BR>Type change: A place denoting the same memory locations as the original <VAR>place</VAR>,
but of type <VAR>c-type</VAR>.
<P>
<CODE>(<STRONG>typeof</STRONG> <VAR>place</VAR>)</CODE>
<BR>returns the <VAR>c-type</VAR> corresponding to the <VAR>place</VAR>.
<P>
<CODE>(<STRONG>sizeof</STRONG> <VAR>place</VAR>)</CODE> <BR>returns the size and alignment of the C type of <VAR>place</VAR>,
measured in bytes.
<P>
<CODE>(<STRONG>bitsizeof</STRONG> <VAR>place</VAR>)</CODE> <BR>returns the size and alignment of the C type of <VAR>place</VAR>,
measured in bits.

<H4>Foreign functions</H4>

Foreign functions are functions which are defined in the foreign language.
There are <EM>named foreign functions</EM> (imported via <CODE>def-call-out</CODE> or created via
<CODE>def-call-in</CODE>) and <EM>anonymous foreign functions</EM>; they arise through conversion
of function pointers.
<P>
A <EM>&quot;call-out&quot;</EM> function is a foreign function called from Lisp: control flow
temporarily leaves Lisp.
A <EM>&quot;call-in&quot;</EM> function is a Lisp function called from the foreign language:
control flow temporary enters Lisp.
<P>
<CODE>(<STRONG>def-call-out</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD><CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>c-type</VAR> [<VAR>param-mode</VAR> [<VAR>allocation</VAR>]])}*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:return-type <VAR>c-type</VAR> [<VAR>allocation</VAR>])</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:language <VAR>language</VAR>)</CODE>
</TABLE>
defines a named call-out function. Any Lisp function call to <CODE>#'<VAR>name</VAR></CODE> is
redirected to call the C function <VAR>c-name</VAR>.
<P>
<CODE><STRONG>def-c-call-out</STRONG></CODE> is equivalent to <CODE>def-call-out</CODE> with <CODE>:language :c</CODE>.
<P>
<CODE>(<STRONG>def-call-in</STRONG> <VAR>name</VAR> {<VAR>option</VAR>}*)</CODE>
<TABLE>
<TR>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD><CODE>(:name <VAR>c-name</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>c-type</VAR> [<VAR>param-mode</VAR> [<VAR>allocation</VAR>]])}*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:return-type <VAR>c-type</VAR> [<VAR>allocation</VAR>])</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:language <VAR>language</VAR>)</CODE>
</TABLE>
defines a named call-in function. Any C function call to the C function
<VAR>c-name</VAR> is redirected to call the Lisp function <CODE>#'<VAR>name</VAR></CODE>.
<P>
<CODE><STRONG>def-c-call-in</STRONG></CODE> is equivalent to <CODE>def-call-in</CODE> with <CODE>:language :c</CODE>.

<H4>Argument and result passing conventions</H4>

When passed to and from functions, allocation of arguments and results is
handled as follows:
<P>
Values of <VAR>simple-c-type</VAR>, <CODE>c-pointer</CODE> are passed on the stack, with dynamic
extent. The <VAR>allocation</VAR> is effectively ignored.
<P>
Values of type <CODE>c-string</CODE>, <CODE>(c-ptr</CODE> ...<CODE>)</CODE>, <CODE>(c-ptr-null</CODE> ...<CODE>)</CODE>, <CODE>(c-array-ptr</CODE> ...<CODE>)</CODE> need
storage. The <VAR>allocation</VAR> specifies the allocation policy:
<TABLE BORDER>
<TR>  <TD><VAR>allocation</VAR> is <CODE>:none</CODE>          <TD>means that no storage is allocated.
<TR>  <TD><VAR>allocation</VAR> is <CODE>:alloca</CODE>        <TD>means allocation of storage on the stack,
                                       which has dynamic extent.
<TR>  <TD><VAR>allocation</VAR> is <CODE>:malloc-free</CODE>   <TD>means that storage will be allocated
                                       via <CODE>malloc()</CODE> and freed via <CODE>free()</CODE>.
</TABLE>
If no <VAR>allocation</VAR> is specified, the default <VAR>allocation</VAR> is <CODE>:none</CODE> for most
types, but <CODE>:alloca</CODE> for <CODE>c-string</CODE> and <CODE>(c-ptr</CODE> ...<CODE>)</CODE> and <CODE>(c-ptr-null</CODE> ...<CODE>)</CODE> and
<CODE>(c-array-ptr</CODE> ...<CODE>)</CODE> and for <CODE>:out</CODE> arguments. [Subject to change!]
The <CODE>:malloc-free</CODE> policy provides the ability to pass arbitrarily nested
structs containing pointers pointing to structs ... within a single conversion.
<P>
<DL>
<DT>For call-out functions:<DD>
  <DL>
  <DT>For arguments passed from Lisp to C:<DD>
    <DL>
    <DT>If <VAR>allocation</VAR> is <CODE>:malloc-free</CODE>,
       <DD>Lisp allocates the storage using malloc() and never deallocates it.
       The C function is supposed to call free() when done with it.
    <DT>If <VAR>allocation</VAR> is <CODE>:alloca</CODE>,
       <DD>Lisp allocates the storage on the stack, with dynamic extent. It is
       freed when the C function returns.
    <DT>If <VAR>allocation</VAR> is <CODE>:none</CODE>,
       <DD>Lisp assumes that the pointer already points to a valid area of the
       proper size and puts the result value there. This is dangerous! and
       deprecated.
    </DL>
  <DT>For results passed from C to Lisp:<DD>
    <DL>
    <DT>If <VAR>allocation</VAR> is <CODE>:malloc-free</CODE>,
       <DD>Lisp calls free() on it when done.
    <DT>If <VAR>allocation</VAR> is <CODE>:none</CODE>,
       <DD>Lisp does nothing.
    </DL>
  </DL>
<DT>For call-in functions:<DD>
  <DL>
  <DT>For arguments passed from C to Lisp:<DD>
    <DL>
    <DT>If <VAR>allocation</VAR> is <CODE>:malloc-free</CODE>,
       <DD>Lisp calls free() on it when done.
    <DT>If <VAR>allocation</VAR> is <CODE>:alloca</CODE> or <CODE>:none</CODE>,
       <DD>Lisp does nothing.
    </DL>
  <DT>For results passed from Lisp to C:<DD>
    <DL>
    <DT>If <VAR>allocation</VAR> is <CODE>:malloc-free</CODE>,
       <DD>Lisp allocates the storage using malloc() and never deallocates it.
       The C function is supposed to call free() when done with it.
    <DT>If <VAR>allocation</VAR> is <CODE>:none</CODE>,
       <DD>Lisp assumes that the pointer already points to a valid area of the
       proper size and puts the result value there. This is dangerous! and
       deprecated.
    </DL>
  </DL>
</DL>
<P>
A function parameter's <VAR>param-mode</VAR> may be
<DL>
<DT>either <CODE>:in</CODE> (means: read-only):
<DD>       The caller passes information to the callee.
<DT>or     <CODE>:out</CODE> (means: write-only):
<DD>       The callee passes information back to the caller on return.
       When viewed as a Lisp function, there is no Lisp argument corresponding
       to this, instead it means an additional return value.
<DT>or     <CODE>:in-out</CODE> (means: read-write):
<DD>       Information is passed from the caller to the callee and then back to
       the caller. When viewed as a Lisp function, the &quot;<CODE>:out</CODE>&quot; value is
       returned as an additional multiple value.
</DL>
The default is <CODE>:in</CODE>.
<P>
[Currently, only <CODE>:in</CODE> is fully implemented. <CODE>:out</CODE> works only with
<VAR>allocation</VAR> = <CODE>:alloca</CODE>.]
<P>
<DL>
<DT><EM>Platform dependent: Amiga platforms only.
</EM></DT>
<DD>
<VAR>allocation</VAR> may not be <CODE>:malloc-free</CODE> because there is no commonly
used <CODE>malloc()/free()</CODE> library function.
<P>
The <VAR>allocation</VAR> may be followed by a register specification,
any of the symbols <CODE>:d0</CODE>, <CODE>:d1</CODE>, <CODE>:d2</CODE>, <CODE>:d3</CODE>, <CODE>:d4</CODE>, <CODE>:d5</CODE>, <CODE>:d6</CODE>, <CODE>:d7</CODE>, <CODE>:a0</CODE>, <CODE>:a1</CODE>, <CODE>:a2</CODE>,
<CODE>:a3</CODE>, <CODE>:a4</CODE>, <CODE>:a5</CODE>, <CODE>:a6</CODE>, each representing one 680x0 register. This works only
for integral types: integers, pointers, <CODE>c-string</CODE>, <CODE>c-function</CODE>.
</DD>
</DL>
<P>
Passing <CODE>c-struct</CODE>, <CODE>c-union</CODE>, <CODE>c-array</CODE>, <CODE>c-array-max</CODE> values as arguments (not via
pointers) is only possible to the extent the C compiler supports it. Most C
compilers do it right, but some C compilers (such as gcc on hppa) have
problems with this.

<H4>Examples</H4>

Ex. 1: The C declaration
<CODE><PRE>
       struct foo {
           int a;
           struct foo * b[100];
       };
</PRE></CODE>
corresponds to
<CODE><PRE>
       (def-c-struct foo
         (a int)
         (b (c-array (c-ptr foo) 100))
       )
</PRE></CODE>
The element access
<CODE><PRE>
       struct foo f;
       f.b[7].a
</PRE></CODE>
corresponds to
<CODE><PRE>
       (declare (type foo f))
       (foo-a (aref (foo-b f) 7)) or (slot-value (aref (slot-value f 'b) 7) 'a)
</PRE></CODE>
Ex. 2: Here is an example of an external C variable and some accesses:
<CODE><PRE>
       struct bar {
           short x, y;
           char a, b;
           int z;
           struct bar * n;
       };

       extern struct bar * my_struct;

       my_struct-&gt;x++;
       my_struct-&gt;a = 5;
       my_struct = my_struct-&gt;n;
</PRE></CODE>
corresponds to
<CODE><PRE>
       (def-c-struct bar
         (x short)
         (y short)
         (a char)
         (b char) ; or (b character) if it represents a character, not a number
         (z int)
         (n (c-ptr bar))
       )

       (def-c-var my_struct (:type (c-ptr bar)))

       (setq my_struct (let ((s my_struct)) (incf (slot-value s 'x)) s))
       or (incf (slot my_struct 'x))
       (setq my_struct (let ((s my_struct)) (setf (slot-value s 'a) 5) s))
       or (setf (slot my_struct 'a) 5)
       (setq my_struct (slot-value my_struct 'n))
       or (setq my_struct (deref (slot my_struct 'n)))
</PRE></CODE>
Ex. 3: An example for calling an external function:
On ANSI C systems, &lt;stdlib.h&gt; contains the declarations
<CODE><PRE>
       typedef struct {
         int quot;   /* Quotient */
         int rem;    /* Remainder */
       } div_t;
       extern div_t div (int numer, int denom);
</PRE></CODE>
This translates to
<CODE><PRE>
       (def-c-struct div_t
         (quot int)
         (rem int)
       )
       (def-c-call-out div (:arguments (numer int) (denom int))
                           (:return-type div_t)
       )
</PRE></CODE>
Sample call from within Lisp:
<CODE><PRE>
       &gt; (div 20 3)
       #S(DIV :QUOT 6 :REM 2)
</PRE></CODE>
Ex. 4: Another example for calling an external function:
<P>
Suppose the following is defined in a file <CODE>&quot;cfun.c&quot;</CODE>:
<CODE><PRE>
       struct cfunr { int x; char *s; };
       struct cfunr * cfun (i,s,r,a)
           int i;
           char *s;
           struct cfunr * r;
           int a[10];
       {
           int j;
           struct cfunr * r2;
           printf(&quot;i = %d\n&quot;, i);
           printf(&quot;s = %s\n&quot;, s);
           printf(&quot;r-&gt;x = %d\n&quot;, r-&gt;x);
           printf(&quot;r-&gt;s = %s\n&quot;, r-&gt;s);
           for (j = 0; j &lt; 10; j++) printf(&quot;a[%d] = %d.\n&quot;, j, a[j]);
           r2 = (struct cfunr *) malloc (sizeof (struct cfunr));
           r2-&gt;x = i+5;
           r2-&gt;s = &quot;A C string&quot;;
           return r2;
       }
</PRE></CODE>
It is possible to call this function from Lisp using the file <CODE>&quot;callcfun.lsp&quot;</CODE>
(don't call it <CODE>&quot;cfun.lsp&quot;</CODE> - <CODE>compile-file</CODE> would overwrite <CODE>&quot;cfun.c&quot;</CODE>) whose
contents is:
<CODE><PRE>
       (in-package &quot;TEST-C-CALL&quot; :use '(&quot;LISP&quot; &quot;FFI&quot;))
       (def-c-struct cfunr (x int) (s c-string))
       (def-c-call-out cfun (:arguments (i int)
                                        (s c-string)
                                        (r (c-ptr cfunr) :in :alloca)
                                        (a (c-ptr (c-array int 10)) :in :alloca)
                            )
                            (:return-type (c-ptr cfunr))
       )
       (defun call-cfun ()
         (cfun 5 &quot;A Lisp string&quot; (make-cfunr :x 10 :s &quot;Another Lisp string&quot;)
               '#(0 1 2 3 4 5 6 7 8 9)
       ) )
</PRE></CODE>
Use the module facility:
<CODE><PRE>
       $ clisp-link create-module-set cfun callcfun.c
       $ cc -O -c cfun.c
       $ cd cfun
       $ ln -s ../cfun.o cfun.o
       Add cfun.o to NEW_LIBS and NEW_FILES in link.sh.
       $ cd ..
       $ base/lisp.run -M base/lispinit.mem -c callcfun.lsp
       $ clisp-link add-module-set cfun base base+cfun
       $ base+cfun/lisp.run -M base+cfun/lispinit.mem -i callcfun
       &gt; (test-c-call::call-cfun)
       i = 5
       s = A Lisp string
       r-&gt;x = 10
       r-&gt;s = Another Lisp string
       a[0] = 0.
       a[1] = 1.
       a[2] = 2.
       a[3] = 3.
       a[4] = 4.
       a[5] = 5.
       a[6] = 6.
       a[7] = 7.
       a[8] = 8.
       a[9] = 9.
       #S(TEST-C-CALL::CFUNR :X 10 :S &quot;A C string&quot;)
       &gt; 
       $ rm -r base+cfun
</PRE></CODE>
Note that there is a memory leak here: The return value <CODE>r2</CODE> of <CODE>cfun()</CODE> is
<CODE>malloc()</CODE>ed but never <CODE>free()</CODE>d. Specifying
<CODE><PRE>
       (:return-type (c-ptr cfunr) :malloc-free)
</PRE></CODE>
is not an alternative because this would also <CODE>free(r2-&gt;x)</CODE> but <CODE>r2-&gt;x</CODE> is a
pointer to static data.
<P>
Ex. 5: To sort an array of double-floats using the Lisp function <CODE>sort</CODE>
instead of the C library function <CODE>qsort()</CODE>, one can use the following
interface code <CODE>&quot;sort1.c&quot;</CODE>. The main problem is to pass a variable-sized array.
<CODE><PRE>
       extern void lispsort_begin (int);
       void* lispsort_function;
       void lispsort_double (int n, double * array)
       {
           double * sorted_array;
           int i;
           lispsort_begin(n); /* store #'sort2 in lispsort_function */
           sorted_array = ((double * (*) (double *)) lispsort_function) (array);
           for (i = 0; i &lt; n; i++) array[i] = sorted_array[i];
           free(sorted_array);
       }
</PRE></CODE>
This is accompanied by <CODE>&quot;sort2.lsp&quot;</CODE>:
<CODE><PRE>
       (use-package &quot;FFI&quot;)
       (def-call-in lispsort_begin (:arguments (n int))
                                   (:return-type nil)
                                   (:language :stdc)
       )
       (def-c-var lispsort_function (:type c-pointer))
       (defun lispsort_begin (n)
         (setf (cast lispsort_function
                     `(c-function
                        (:arguments (v (c-ptr (c-array double-float ,n))))
                        (:return-type (c-ptr (c-array double-float ,n))
                                      :malloc-free
                      ) )
               )
               #'sort2
       ) )
       (defun sort2 (v)
         (declare (type vector v))
         (sort v #'&lt;)
       )
</PRE></CODE>
To test this, use the following test file <CODE>&quot;sorttest.lsp&quot;</CODE>:
<CODE><PRE>
       (def-call-out sort10
                     (:name &quot;lispsort_double&quot;)
                     (:language :stdc)
                     (:arguments (n int)
                                 (array (c-ptr (c-array double-float 10))
                                        :in-out
       )             )           )
</PRE></CODE>
Now try
<CODE><PRE>
       $ clisp-link create-module-set sort sort2.c sorttest.c
       $ cc -O -c sort1.c
       $ cd sort
       $ ln -s ../sort1.o sort1.o
       Add sort1.o to NEW_LIBS and NEW_FILES in link.sh.
       $ cd ..
       $ base/lisp.run -M base/lispinit.mem -c sort2.lsp sorttest.lsp
       $ clisp-link add-module-set sort base base+sort
       $ base+sort/lisp.run -M base+sort/lispinit.mem -i sort2 sorttest
       &gt; (sort10 10 '#(0.501d0 0.528d0 0.615d0 0.550d0 0.711d0
                       0.523d0 0.585d0 0.670d0 0.271d0 0.063d0))
       #(0.063d0 0.271d0 0.501d0 0.523d0 0.528d0 0.55d0 0.585d0 0.615d0 0.67d0 0.711d0)
       $ rm -r base+sort
</PRE></CODE>
<!-- #endif -->
<!-- #ifdef HAVE_AFFI -->
<H3>99.4'. The Amiga Foreign Function Call Facility</H3>

<EM>Platform dependent: Amiga platforms only.</EM>

<H4>Another Foreign Function Interface</H4>

All symbols relating to the simple foreign function interface are
exported from the package <CODE>AFFI</CODE>. To use them, <CODE>(use-package &quot;AFFI&quot;)</CODE>.

<H4>Design issues</H4>

AFFI was designed to be small in size but powerful enough to use most
library functions. Lisp files may be compiled to <CODE>.fas</CODE> files without the need
to load function definition files at run-time and without external C or
linker support. Memory images can be created, provided that the function
libraries are opened at run-time.
<P>
Therefore, AFFI supports only primitive C types (integers 8, 16 and 32 bits
wide, signed or unsigned, pointers) and defines no new types or classes.
Foreign functions are not first-class objects (you can define a lambda
yourself), name spaces are separate.
<P>
The AFFI does no tracking of resources. Use <CODE>finalize</CODE>.

<H4>Overview</H4>

These are the AFFI forms:
<P>
<CODE>(declare-library-base <VAR>keyword-base</VAR> <VAR>library-name</VAR>)</CODE>
<P>
<CODE>(require-library-functions <VAR>library-name</VAR> [(:import {<VAR>string-name</VAR>}*))</CODE>
<P>
<CODE>(open-library <VAR>base-symbol</VAR>)</CODE>
<P>
<CODE>(clos-library <VAR>base-symbol</VAR>)</CODE>
<P>
<CODE>(with-open-library (<VAR>base-symbol</VAR> | <VAR>library-name</VAR>) {<VAR>form</VAR>}*)</CODE>
<P>
<CODE>(defflibfun <VAR>function-name</VAR> <VAR>base-symbol</VAR> <VAR>offset</VAR> <VAR>mask</VAR> <VAR>result-type</VAR> {<VAR>argument-type</VAR>}*)</CODE>
<P>
<CODE>(declare-library-function <VAR>function-name</VAR> <VAR>library-name</VAR> {<VAR>option</VAR>}*)</CODE>
<P>
<CODE>(flibcall <VAR>function-name</VAR> {<VAR>argument</VAR>}*)</CODE>
<P>
<CODE>(mlibcall <VAR>function-name</VAR> {<VAR>argument</VAR>}*)</CODE>
<P>
<CODE>(mem-read <VAR>address</VAR> <VAR>result-type</VAR> [<VAR>offset</VAR>])</CODE>
<P>
<CODE>(mem-write <VAR>address</VAR> <VAR>type</VAR> <VAR>value</VAR> [<VAR>offset</VAR>])</CODE>
<P>
<CODE>(mem-write-vector <VAR>address</VAR> <VAR>vector</VAR> [<VAR>offset</VAR>])</CODE>
<P>
<CODE>(nzero-pointer-p <VAR>value</VAR>)</CODE>
<P>
Except for <CODE>with-open-library</CODE>, <CODE>declare-library-function</CODE> and <CODE>mlibcall</CODE>,
all of the above are functions.
<P>
A library contains a collection of functions. The library is referred to by
a symbol referred as library-base at the AFFI level. This symbol is
created in the package <CODE>AFFI</CODE>. The link between this symbol and the OS-level
library name is established by <CODE>declare-library-base</CODE>. To avoid multiple
package conflicts, this and only this function requires the symbol-name to
be in the <CODE>KEYWORD</CODE> package. The function returns the library-base.
<P>
A library may be opened by <CODE>open-library</CODE> and closed by <CODE>close-library</CODE>. An
opened library must be closed. <CODE>with-open-library</CODE> is provided to
automatically close the library for you, thus it's much safer to use.
<P>
A function is contained in a library. Every function is referred to by a
symbol. A function is defined through <CODE>defflibfun</CODE> or <CODE>declare-library-function</CODE>
by giving the function name, the library-base, an offset into the library, a
mask (or <CODE>nil</CODE>) for register-based library calls, the result type and all
parameter-types.  <CODE>require-library-functions</CODE> loads the complete set of
functions defined in a library file. Symbols are created in the package <CODE>AFFI</CODE>
and imported into the current package.
<P>
<CODE>flibcall</CODE> and <CODE>mlibcall</CODE> call library functions. <CODE>mlibcall</CODE> is a macro that does
a few cheks at macroexpansion time and allows the compiler to inline the
call, not requiring the foreign function to be defined again at load or
execution time. The use of this macro is advertised wherever possible.
<P>
<CODE>mem-read</CODE> reads an arbitrary address (with offset for structure references)
and returns the given type.
<P>
<CODE>mem-write</CODE> writes an arbitrary address. <CODE>mem-write-vector</CODE> copies the content
of a Lisp string or unsigned-byte vector into memory.
<P>
<CODE>nzero-pointer-p</CODE> tests for non-<CODE>NULL</CODE> pointers in all recognized
representations (<CODE>null</CODE>, <CODE>unsigned-byte</CODE> and <CODE>foreign-pointer</CODE>).

<H4>Foreign Libraries</H4>

<CODE>declare-library-base</CODE> ought to be wrapped in an <CODE>eval-when (compile eval load)</CODE>
form and come before any function is referenced, because the library base
symbol must be known.
<P>
<CODE>open-library</CODE> tries to open the library referenced by the base symbol.
Therefore it must have been preceeded with <CODE>declare-library-base</CODE>. The call
returns <CODE>nil</CODE> on failure. <CODE>open-library</CODE> calls nest. Every successful call must
be matched by <CODE>close-library</CODE>. <CODE>with-open-library</CODE> does this for you and also
allows you to specify the library by name, provided that its base has been
declared. It is recommended to use this macro and to reference the library
by name.
<P>
CLISP will not close libraries for you at program exit. [A previous version
did so but now AFFI is a module and there are no module exit functions.]
Programmers, watch <CODE>affi::*libraries-alist*</CODE>.

<H4>(Foreign) C types</H4>

The following foreign C types are used in AFFI. They are <EM>not</EM> regular
Common Lisp types or CLOS classes.
<P>
<TABLE BORDER>
<TR> <TH>AFFI name     <TH>Lisp equiv              <TH>C equiv     <TH>Comment
<TR>  <TD><CODE>nil</CODE>           <TD><CODE>nil</CODE>                     <TD><CODE>void</CODE>            <TD>as a result type for functions only
<TR>  <TD><CODE>4</CODE>             <TD><CODE>(unsigned-byte 32)</CODE>      <TD><CODE>unsigned long</CODE>
<TR>  <TD><CODE>2</CODE>             <TD><CODE>(unsigned-byte 16)</CODE>      <TD><CODE>unsigned short</CODE>
<TR>  <TD><CODE>1</CODE>             <TD><CODE>(unsigned-byte 8)</CODE>       <TD><CODE>unsigned char</CODE>
<TR>  <TD><CODE>-4</CODE>            <TD><CODE>(signed-byte 32)</CODE>        <TD><CODE>long</CODE>
<TR>  <TD><CODE>-2</CODE>            <TD><CODE>(signed-byte 16)</CODE>        <TD><CODE>short</CODE>
<TR>  <TD><CODE>-1</CODE>            <TD><CODE>(signed-byte 8)</CODE>         <TD><CODE>signed char</CODE>
<TR>  <TD><CODE>0</CODE>             <TD><CODE>boolean</CODE>                 <TD><CODE>BOOL</CODE>          <TD>as a result type for functions only
<TR>  <TD><CODE>*</CODE>             <TD>opaque                  <TD><CODE>void*</CODE>
<TR>  <TD><CODE>:external</CODE>     <TD>opaque                  <TD><CODE>void*</CODE>
<TR>  <TD><CODE>string</CODE>        <TD><CODE>string</CODE> or <CODE>vector</CODE>        <TD><CODE>char*</CODE>
<TR>  <TD><CODE>:io</CODE>           <TD><CODE>string</CODE> or <CODE>vector</CODE>        <TD><CODE>char*</CODE>
</TABLE>
<P>
Objects of type <CODE>string</CODE> are copied and passed NUL-terminated on the execution
stack.  On return, a Lisp string is allocated and filled from the address
returned (unless NULL). Functions with <CODE>:io</CODE> parameters are passed the address
of the Lisp string or unsigned byte vector. These are not NUL-terminated!
This is useful for functions like like <CODE>read()</CODE> which do not need an array at
a constant address longer than the dynamic extent of the call (it is
dangerous to define callback functions with <CODE>:io</CODE> (or <CODE>string</CODE>) type
parameters). Arguments of type <CODE>integer</CODE> and <CODE>foreign-pointer</CODE> are always
acceptable where a <CODE>string</CODE> or <CODE>:io</CODE> type is specified.
<P>
To meet the design goals, predefined types and objects were used. As such,
pointers were represented as integers. Now that there is the <CODE>foreign-pointer</CODE>
type, both representations may be used on input. The pointer type should be
therefore considered as opaque. Use <CODE>nzero-pointer-p</CODE> for NULL tests.

<H4>Foreign functions</H4>

Foreign Functions are declared either through <CODE>defflibfun</CODE> or
<CODE>declare-library-function</CODE>. The former is closer to the low-level
implementation of the interface, the latter is closer to the other FFI.
<P>
<CODE>defflibfun</CODE> requires the library base symbol and register mask to be
specified, <CODE>declare-library-function</CODE> requires the library name and computes
the mask from the declaration of the arguments.
<P>
The value of mask is implementation-dependent. On the Amiga, it's an integer
whose hexadecimal value is the reverse of the function argument register
numbers, where d0 has number <CODE>1</CODE> and a6 number <CODE>#xF</CODE>. A <CODE>nil</CODE> mask is reserved for
stack-based calls (unimplemented).
<P>
The AFFI type <CODE>0</CODE> is only acceptable as a function result type and yields
either <CODE>t</CODE> or <CODE>nil</CODE>. The difference between <CODE>*</CODE> and <CODE>:external</CODE> is the following: <CODE>*</CODE>
uses integers, <CODE>:external</CODE> uses <CODE>foreign-pointer</CODE> as function result-type (except
from <CODE>nil</CODE> for a NULL pointer) and refuses objects of type <CODE>string</CODE> or unsigned
byte vector as input. Thus <CODE>:external</CODE> provides some security on the input and
the ability to use <CODE>finalize</CODE> for resource-tracking on the output side.
<P>
<CODE>(declare-library-function <VAR>name</VAR> <VAR>library-name</VAR> {<VAR>option</VAR>}*)</CODE>
<P>
<TABLE>
<TR>  <VAR>option</VAR> ::=
<TR><TD ALIGN=RIGHT>      <TD><CODE>(:offset <VAR>library-offset</VAR>)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:arguments {(<VAR>arg-name</VAR> <VAR>AFFI-type</VAR> <VAR>register</VAR>)}*)</CODE>
<TR><TD ALIGN=RIGHT>    | <TD><CODE>(:return-type <VAR>AFFI-type</VAR>)</CODE>
</TABLE>
<TABLE>
<TR>  <TD><VAR>register</VAR> ::= <TD> <CODE>:d0</CODE> | <CODE>:d1</CODE> | ... | <CODE>:d7</CODE> | <CODE>:a0</CODE> | ... | <CODE>:a6</CODE>
</TABLE>
declares a named library funtion for further reference through
<CODE>flibcall</CODE> and <CODE>mlibcall</CODE>.
<P>
<CODE>mlibcall</CODE> should be the preferred way of calling foreign functions (when they
are known at compile-time) as macroexpansion-time checks may be performed
and the call can be sort of inlined.

<H4>Memory access</H4>

<CODE>(mem-read <VAR>address</VAR> <VAR>type</VAR> <VAR>offset</VAR>)</CODE> can read 8, 16 and 32 bit signed or unsigned
integers (AFFI types <CODE>-4</CODE>, <CODE>-2</CODE>, <CODE>-1</CODE>, <CODE>1</CODE>, <CODE>2</CODE>, <CODE>4</CODE>), a pointer (<CODE>*</CODE>), a NUL-terminated
string (<CODE>string</CODE>) or, if the type argument is of type <CODE>string</CODE> or unsigned
byte vector, it can fill this vector. <CODE>:external</CODE> is not an acceptable type as
no object can be created by using <CODE>mem-read</CODE>.
<P>
<CODE>(mem-write <VAR>address</VAR> <VAR>type</VAR> <VAR>value</VAR> [<VAR>offset</VAR>])</CODE> writes integers (AFFI type <CODE>-4</CODE>, <CODE>-2</CODE>,
<CODE>-1</CODE>, <CODE>1</CODE>, <CODE>2</CODE> and <CODE>4</CODE>) or pointer values (type <CODE>*</CODE>), but not vectors to the specified
memory address.
<P>
<CODE>(mem-write-vector <VAR>address</VAR> <VAR>vector</VAR> [<VAR>offset</VAR>])</CODE> can write memory from the given
vector (of type <CODE>string</CODE> or unsigned byte vector).

<H4>Function Definition Files</H4>

<CODE>require-library-functions</CODE> will <CODE>require</CODE> a file of name derived from the
library name and with type <CODE>&quot;affi&quot;</CODE>. It may be used to import all names into
the current package or only a given subset identified by string names, using
the <CODE>:import</CODE> keword (recommended use). Some definition files for standard
Amiga libraries are provided. See example 1 below.
<P>
As <CODE>require-library-functions</CODE> loads a global file which you, the programmer,
may have not defined, you may consider declaring every function yourself to
be certain what the return and argument types are. See example 4 below.
<P>
The file <CODE>read-fd.lsp</CODE> defines the function <CODE>make-partial-fd-file</CODE> with which
the provided <CODE>&quot;.affi&quot;</CODE> files have been prepared from the original Amiga FD
files (located in the directory <CODE>FD:</CODE>). They must still be edited as the
function cannot know whether a function accepts a <CODE>*</CODE>, <CODE>:io</CODE>, <CODE>string</CODE> or
<CODE>:external</CODE> argument and because files in <CODE>FD:</CODE> only contain a register
specification, not the width of integer arguments (<CODE>-4</CODE>, <CODE>-2</CODE>, <CODE>-1</CODE>, <CODE>1</CODE>, <CODE>2</CODE>, or <CODE>4</CODE>).

<H4>Hints</H4>

By using appropriate <CODE>eval-when</CODE> forms for <CODE>declare-library-base</CODE> and
<CODE>require-library-functions</CODE> and not using <CODE>flibcall</CODE>, it is possible to write
code that only loads library function definition files at compile-time. See
example 1 below.
<P>
Do not rely on <CODE>finalize</CODE> to free resources for you, as CLISP does not call
finalizers when it exits, use <CODE>unwind-protect</CODE>.

<H4>Caveats</H4>

You can consider the library bases being symbols in need of being imported
from the package AFFI originating from a brain-damage, causing the usual
symbol headaches when using foreign functions calls within macros. Luckily,
even if the high-level interface (or its implementation in <CODE>affi1.lsp</CODE>) were
to change, the low-level part (<CODE>affi.d</CODE>) should remain untouched as all it
knows are integers and foreign-pointers, no symbols. The difficulty is just
to get the library base value at run-time. Feel free to suggest enhancements
to this facility!

<H4>Examples</H4>

NB: These examples are somewhat specific to the Amiga.
<P>
1. Using a predefined library function file
<CODE><PRE>
(use-package &quot;AFFI&quot;)

;; SysBase is the conventional name for exec.library
;; It is only enforced by the file loaded by REQUIRE-LIBRARY-FUNCTIONS
(eval-when (compile eval load)
  (declare-library-base :SysBase &quot;exec.library&quot;)) ;keyword avoids name conflicts

;; using only MLIBCALL allows not to load definitions at load-time
(eval-when (compile eval)
  (require-library-functions &quot;exec.library&quot;
    :import '(&quot;FindTask&quot;)))

(with-open-library (&quot;exec.library&quot;)
  (print (mlibcall FindTask 0)))
</PRE></CODE>
This file can be used in interpreted and compiled mode. Compiled, it will
have inlined the library function calls.
<P>

2. Using flibcall
<CODE><PRE>
(use-package &quot;AFFI&quot;)

(eval-when (compile eval load)
  (declare-library-base :SysBase &quot;exec.library&quot;)) ;keyword avoids name conflicts

;; The load situation permits the use of flibcall
(eval-when (eval compile load)
  (require-library-functions &quot;exec.library&quot;))

(unless (open-library 'SysBase) (error &quot;No library for SysBase&quot;))
(flibcall (if t 'FindTask 'Debug) 0)
(close-library 'SysBase)
</PRE></CODE>
<P>

3. Be fully dynamic, defining library bases ourselves
<CODE><PRE>
(use-package &quot;AFFI&quot;)

(eval-when (compile eval load)
  (defvar mylib (declare-library-base :foobase &quot;foo.library&quot;)))
(eval-when (eval compile load)          ;eval allows mlibcall, load flibcall
  (defflibfun 'foo1 mylib -30 '#xA '* 'string)
  (defflibfun 'foo2 mylib -36 '#x21 0 * 4))

(defun foo (name)
  (when (open-library mylib)
    (list (mlibcall foo1 name) (flibcall 'foo2 name 123213))
    (close-library mylib)))
</PRE></CODE>
<P>
4. Some sample function definitions
<CODE><PRE>
(defflibfun 'FindTask 'SysBase -294 #xA '* 'string)
(declare-library-function FindTask &quot;exec.library&quot;
  (:offset -294)
  (:return-type *)
  (:arguments
   (name   string   :A1)))
(declare-library-function NameFromLock &quot;dos.library&quot;
  (:offset -402)
  (:return-type 0)
  (:arguments
   (lock   4   :D1)
   (buffer :io :D2)
   (len    4   :D3)))

(eval-when (compile eval)
  (defconstant GVF_LOCAL_ONLY (ash 1 9))
  (defflibfun 'SetVar 'DosBase -900 #x5432 0 'string 'string -4 4))
(defun setvar (name value)
  (with-open-library (DosBase)
    ;; length of -1 means find length of NUL-terminated-string
    (mlibcall SetVar name value -1 GVF_LOCAL_ONLY)))
</PRE></CODE>

</DD>
</DL>
<!-- #endif -->
<!-- #ifdef AMIGAOS -->
<H3>99.5. ARexx</H3>

<EM>Platform dependent: Amiga platforms only.</EM>
<P>
CLISP comes with a small yet extensible and powerful ARexx interface.
<P>
<CODE>(rexx-do-command &quot;return address()&quot; :string t :result t)</CODE>
<BR>tells you the
name of the CLISP ARexx port. The default extension for CLISP ARexx
scripts is <CODE>&quot;cl&quot;</CODE>.
<P>
<CODE>(REXX-DO-COMMAND <VAR>command</VAR> &amp;key :string :result :token :io :host)</CODE>
<BR>  -&gt; <CODE>(RC &amp;optional <VAR>result</VAR>)</CODE>, or <CODE>nil</CODE> on failure
<P>
<CODE>(REXX-RUN-COMMAND <VAR>command</VAR> &amp;KEY :string :token)</CODE>
<BR>  -&gt; <CODE>t</CODE>, or <CODE>nil</CODE> on failure
<P>
<CODE>(REXX-SEND-COMMAND <VAR>command</VAR> &amp;KEY :string :result :token :io :host)</CODE>
<BR>  -&gt; <VAR>arexx-msg-handle</VAR>, or <CODE>nil</CODE> on failure
<P>
<CODE>(REXX-WAIT-SENT-COMMAND <VAR>arexx-msg-handle</VAR>)</CODE>
<BR>  -&gt; <CODE>(RC &amp;optional <VAR>result</VAR>)</CODE>, or <CODE>nil</CODE> on failure
<P>
<CODE>(REXX-LOOP)</CODE>
<BR>  -&gt; no return, use the <CODE>exit-loop.cl</CODE> ARexx script to abort the loop
<P>
<VAR>command</VAR> may be a string denoting a command with optional arguments or a
vector of strings thus denoting an ARexx function call. The first
element in the vector is the function name, the others are the up to 15
arguments.
<P>
Messages may be sent to an arbitrary ARexx host, special cases are <CODE>nil</CODE>
(meaning <CODE>&quot;REXX&quot;</CODE>, the default) and <CODE>t</CODE> (<CODE>&quot;AREXX&quot;</CODE> for asynchronouns execution).
<P>
ARexx server mode: Like Ispell, Csh and SKsh, you can run it in server
mode by calling <CODE>(rexx-loop)</CODE>. You can then only exit with the ARexx
<CODE>exit-loop.cl</CODE> script.
<P>
Restrictions: Currently CLISP is not able to wait for input from
several sources, e.g. both a console and ARexx, at the same time.

<!-- #endif -->
<!-- #ifdef GRAPHICS -->
<H3>99.6. Graphics Primitives</H3>

<EM>Platform dependent: Linux/x86, DOS, OS/2 platforms only.</EM>
<P>
In CLISP 1994-01-07 or newer,
<UL>
<LI>DOS version,
<LI>Linux version, installed setuid root,
</UL>
there are some pixel graphics primitives in the <CODE>SYSTEM</CODE> package.
They operate on a VGA card.
<P>
Similar pixel graphics primitives can be used in the
<UL>
<LI>Unix version running under X11
</UL>
by use of the small <CODE>xterm</CODE> package available on
<CODE>ftp2.cons.org</CODE>.
<P>
This is the description of the PC/VGA graphics primitives:
<P>
<DL>
<DT>
<CODE>(system::<STRONG>graph-init</STRONG> [<VAR>width</VAR> [<VAR>height</VAR> [<VAR>colors</VAR>]]])</CODE>
<DD>
initializes the graphics system. The <VAR>width</VAR>, <VAR>height</VAR> parameters are hints for
the size of the desired graphics screen (positive integers). The <VAR>colors</VAR>
parameter is a hint for the number of colors. The actual width, height
is implementation dependent, currently up to 640x480 on VGA cards and up to
1024x768 on ET4000 SVGA cards.
Returns an alist <CODE>((<VAR>color-value</VAR> <VAR>color-keyword</VAR>) ...)</CODE> which lists the available
colours and their numerical equivalents.
<DT>
<CODE>(system::<STRONG>graph-show</STRONG>)</CODE>
<DD>
switches the graphics hardware so that the graphics screen is visible. The
text screen is activated on any text output.
<DT>
<CODE>(system::<STRONG>graph-clear</STRONG> [<VAR>color</VAR>])</CODE>
<DD>
fills the entire graphics screen with a single color.
<DT>
<CODE>(system::<STRONG>graph-dims</STRONG>)</CODE>
<DD>
returns two values: the actual width and the actual height of the graphics
screen (in pixels).
<BR>
If <CODE>(system::graph-dims)</CODE> returns the values <VAR>w</VAR> and <VAR>h</VAR>, then valid screen
coordinates are pairs <VAR>(x,y)</VAR> with 0 &lt;= <VAR>x</VAR> &lt; <VAR>w</VAR> and 0 &lt;= <VAR>y</VAR> &lt; <VAR>h</VAR>. <VAR>x</VAR>=0 denotes the
left edge, <VAR>y</VAR>=0 the top edge.
<DT>
<CODE>(system::<STRONG>graph-dot</STRONG> <VAR>x</VAR> <VAR>y</VAR>)</CODE>
<DD>
returns the colour of the pixel <VAR>(x,y)</VAR>.
<DT>
<CODE>(system::<STRONG>graph-dot</STRONG> <VAR>x</VAR> <VAR>y</VAR> <VAR>color</VAR>)</CODE>
<DD>
sets the colour of the pixel <VAR>(x,y)</VAR> to <VAR>color</VAR>.
<DT>
<CODE>(system::<STRONG>graph-box</STRONG> <VAR>x<SUB>1</SUB></VAR> <VAR>y<SUB>1</SUB></VAR> <VAR>x<SUB>2</SUB></VAR> <VAR>y<SUB>2</SUB></VAR> <VAR>color</VAR>)</CODE>
<DD>
draws a box (= filled rectangle) in colour <VAR>color</VAR>, the vertices being the pixels
<TABLE>
<TR>        <TD><VAR>(x<SUB>1</SUB>,y<SUB>1</SUB>)</VAR>   <TD><VAR>(x<SUB>2</SUB>,y<SUB>1</SUB>)</VAR>
<TR>        <TD><VAR>(x<SUB>1</SUB>,y<SUB>2</SUB>)</VAR>   <TD><VAR>(x<SUB>2</SUB>,y<SUB>2</SUB>)</VAR>
</TABLE>
<DT>
<CODE>(system::<STRONG>graph-line</STRONG> <VAR>x<SUB>1</SUB></VAR> <VAR>y<SUB>1</SUB></VAR> <VAR>x<SUB>2</SUB></VAR> <VAR>y<SUB>2</SUB></VAR> <VAR>color</VAR>)</CODE>
<DD>
Draws a line in colour <VAR>color</VAR> from pixel <VAR>(x<SUB>1</SUB>,y<SUB>1</SUB>)</VAR> to pixel <VAR>(x<SUB>2</SUB>,y<SUB>2</SUB>)</VAR>.
<DT>
<CODE>(system::<STRONG>graph-text</STRONG> <VAR>x</VAR> <VAR>y</VAR> <VAR>dir</VAR> <VAR>string</VAR> <VAR>color</VAR>)</CODE>
<DD>
Paints the text contained in <VAR>string</VAR>, starting at <VAR>(x,y)</VAR>, in colour <VAR>color</VAR>,
and returns as values the end coordinates <VAR>(x,y)</VAR>. <VAR>dir</VAR> is the direction:
0 goes to the right, 90 vertically up, 180 to the left, 270 vertically down.
</DL>
<P>
This specification is subject to change.

<!-- #endif -->
<!-- #ifdef SOCKET_STREAMS -->
<H3>99.7 Socket Streams</H3>

<EM>Platform dependent: UNIX, Win32 platforms only.</EM>

<DL>
<DT>
<CODE>(<STRONG>socket-server</STRONG> [<VAR>port</VAR>])</CODE>
<DD>
This function creates a socket, and binds a port the socket, and then
listens for connect attempts.  The server exists to watch for client 
connect attempts.
<DT>
<CODE>(<STRONG>socket-server-close</STRONG> <VAR>socket-server</VAR>)</CODE>
<DD>
Closes down the server socket.
<DT>
<CODE>(<STRONG>socket-server-port</STRONG> <VAR>socket-server</VAR>)</CODE>
<DD>
Returns the port which was bound using <CODE>socket-server</CODE>.
<DT>
<CODE>(<STRONG>socket-wait</STRONG> <VAR>socket-server</VAR> [<VAR>seconds</VAR> [<VAR>microseconds</VAR>]])</CODE>
<DD>
Given time argument(s), waits for (possibly zero) fixed duration for a connect
on the socket-server.  Without an argument, <CODE>socket-wait</CODE> blocks indefinitely.
<DT>
<CODE>(<STRONG>socket-accept</STRONG> <VAR>socket-server</VAR>)</CODE>
<DD>
Creates the server-side two-way stream for the connection.
<DT>
<CODE>(<STRONG>socket-connect</STRONG> <VAR>port</VAR> [<VAR>host</VAR>])</CODE>
<DD>
Attempts to create a client-side two-way stream.  Blocks until
the server accepts the connections.
<DT>
<CODE>(<STRONG>socket-stream-host</STRONG> <VAR>socket-stream</VAR>)</CODE>
<DT>
<CODE>(<STRONG>socket-stream-port</STRONG> <VAR>socket-stream</VAR>)</CODE>
<DD>
These two functions return information about the 
socket stream.  For a server, <CODE>socket-stream-host</CODE>
returns <CODE>nil</CODE>.
<DT>
<CODE>(<STRONG>socket-service-port</STRONG> &quot;<VAR>service-name</VAR>&quot;)</CODE>
<DD>
A convenience function for looking up a port given the service name.
<DT>
<CODE>(<STRONG>socket-stream-peer-host</STRONG> <VAR>socket-stream</VAR>)</CODE>
<DD>
Given a stream, this function returns the name
of the host on the opposite side of the connection;
the server-side can use this to see who connected.
</DL>
<!-- #endif -->
<!-- #ifdef UNIX -->
<H3>99.8. CLISP as a script interpreter</H3>

<EM>Platform dependent: UNIX platforms only.</EM>
<P>
On Unix, a script can be made executable by adding a first line of the form
<CODE><PRE>
#!<VAR>interpreter</VAR> [<VAR>interpreter-args</VAR>]
</PRE></CODE>
and <CODE>chmod</CODE>ing the script to be executable. CLISP can be used as a script
interpreter under the following circumstances:
<OL>
<LI>The <VAR>interpreter</VAR> must be a full pathname of CLISP. I recommend using
   <CODE>/usr/local/bin/clisp</CODE>, and if CLISP is actually installed elsewhere,
   letting <CODE>/usr/local/bin/clisp</CODE> be a symbolic link to the real CLISP.
<P>
<LI>The CLISP <VAR>interpreter</VAR> must be a real executable, not a script.
   Unfortunately, in the binary distributions of CLISP on Solaris, <CODE>clisp</CODE>
   is a shell script because a C compiler cannot be assumed to be installed
   on this platform. If you have a C compiler installed, build CLISP from
   source yourself; &quot;<CODE>make install</CODE>&quot; will install <CODE>clisp</CODE> as a real executable.
<P>
<LI>On some platforms, the first line &quot;<CODE>#!<VAR>interpreter</VAR> [<VAR>interpreter-args</VAR>]</CODE>&quot;
   is limited in length:
   <UL>
         <LI>max. 32 characters on SunOS 4,
         <LI>max. 80 characters on HP-UX,
         <LI>max. 127 characters on Linux.
   </UL>
   Characters exceeding this limit are simply cut off by the system.
   At least 128 characters are accepted on Solaris, IRIX, AIX, OSF/1.
   There is no workaround: You have to keep the interpreter pathname
   and arguments short.
<P>
<LI>On Solaris and HP-UX, only the first <VAR>interpreter-arg</VAR> is passed to
   the <VAR>interpreter</VAR>. In order to pass more than one option (for example,
   &quot;<CODE>-Msomewhere.mem</CODE>&quot; and &quot;<CODE>-C</CODE>&quot;) to <CODE>clisp</CODE>, separate them by hard spaces
   (ISO Latin-1 character 160) instead of normal spaces. (But the separator
   between <VAR>interpreter</VAR> and <VAR>interpreter-args</VAR> must still be a normal
   space!) CLISP will split the <VAR>interpreter-args</VAR> at hard spaces and at
   normal spaces.
</UL>
<P>
The script should contain Lisp forms, except in the #! line. The file
is normally loaded, through the function <CODE>load</CODE>. Before it is loaded,
the variable <CODE>*args*</CODE> is bound to a list of strings, representing the
arguments given to the Lisp script. <CODE>*standard-input*</CODE> and <CODE>*standard-output*</CODE>
are bound, as usual, to the Unix standard input and output. <CODE>*error-output*</CODE>
is bound to the Unix error output. Continuable errors will be turned
to warnings. Non-continuable errors and Ctrl-C interrupts will terminate
the execution of the Lisp script with error status.

<!-- #endif -->
<!-- #ifdef AMIGAOS -->
<H3>99.9. Other</H3>
<DL>
<DT><EM>Platform dependent: Amiga platforms only.
</EM></DT>
<DD>
To have <CODE>*debug-io*</CODE> and <CODE>*error-output*</CODE> point to separate console windows
(thus keeping your standard console window clean from error messages)
you can use
<CODE><PRE>
  (setq *error-output*
    (setq *debug-io*
      (open &quot;CON:0/0/500/300/CLISP-Debugger/AUTO/CLOSE&quot; :direction :io)
  ) )
</PRE></CODE>
at startup.

</DD>
</DL>
<!-- #endif -->
<!-- #endif -->

<H2>Authors</H2>

<TABLE>
<TR>   <TD>    <TD>Bruno Haible                  <TD>  <TD>    <TD>Michael Stoll
<TR>   <TD>    <TD>17, rue Danton                <TD>  <TD>    <TD>Westerwaldweg 22
<TR>   <TD>F - <TD>94270 Le Kremlin-Bic&ecirc;tre<TD WIDTH=50>  <TD>D - <TD>53424 Remagen-Oberwinter
<TR>   <TD>    <TD>France                        <TD>  <TD>    <TD>Germany
</TABLE>

<H2>Maintainer</H2>
<UL>
  <LI><CODE>haible@clisp.cons.org</CODE>
  <LI><CODE>marcus@sysc.pdx.edu</CODE>
</UL>

<HR>

<ADDRESS>CLISP implementation notes<BR>
Bruno Haible &lt;haible@clisp.cons.org&gt;
</ADDRESS>
<P>
Last modified: 13 December 1997.

</BODY>
</HTML>
