# Makefile for installing CLISP

# -------------- Start of configurable section --------------------

# Linking sets to be installed:
#ifdef UNIX_BINARY_DISTRIB
linkingsets = base
#else
linkingsets = base full
#endif

# Directories used by "make install":
# Common base directory for not architecture dependent files.
prefix = /usr/local
# Common base directory for architecture dependent files.
exec_prefix = $(prefix)
# Directory where executables are installed.
bindir = $(exec_prefix)/bin
mandir = $(exec_prefix)/man
# Directory where documentation is installed.
docdir = $(exec_prefix)/doc
lispdocdir = $(docdir)/clisp
libdir = $(exec_prefix)/lib
lisplibdir = $(libdir)/clisp
#ifdef GNU_GETTEXT
# If you have $(exec_prefix) different from $(prefix), and indend to use
# different versions of CLISP on different architectures, replace the
# following line with:  datadir = $(exec_prefix)/@DATADIRNAME@
datadir = $(prefix)/@DATADIRNAME@
localedir = $(datadir)/locale
#endif

#ifndef UNIX_BINARY_DISTRIB
# Programs used by "make":
#ifdef UNIX_AIX
CC = xlc
#else
#if defined(UNIX_SUNOS4) || defined(UNIX_CYGWIN32)
CC = gcc
#else
#ifdef UNIX_HPUX
CC = cc -Aa
#else
CC = cc
#endif
#endif
#endif
CFLAGS = -O

#endif
# Programs used by "make install":
INSTALL = cp
INSTALL_PROGRAM = $(INSTALL)
INSTALL_DATA = $(INSTALL)

# -------------- End of configurable section --------------------

SHELL = /bin/sh

#ifdef UNIX_BINARY_DISTRIB
all : base/lisp.run
#else
all : base/lisp.run full/lisp.run
#endif

#ifndef UNIX_BINARY_DISTRIB
base/lisp.run : @@BASE_FILES@@
	$(CC) $(CFLAGS) @@BASE_LIBS@@ -o base/lisp.run

full/lisp.run : @@FULL_FILES@@
	$(CC) $(CFLAGS) @@FULL_LIBS@@ -o full/lisp.run

#endif
install : install-bin install-man install-doc

install-bin : all force
	if [ ! -d $(prefix) ] ; then mkdir $(prefix) ; fi
	if [ ! -d $(exec_prefix) ] ; then mkdir $(exec_prefix) ; fi
	if [ ! -d $(libdir) ] ; then mkdir $(libdir) ; fi
	if [ ! -d $(lisplibdir) ] ; then mkdir $(lisplibdir) ; fi
	(cd $(lisplibdir) && rm -rf $(linkingsets))
	tar cf - clisp-link linkkit | (cd $(lisplibdir) && tar xf -)
	tar cf - $(linkingsets) | (cd $(lisplibdir) && tar xf -)
#ifdef GNU_GETTEXT
	if [ ! -d $(datadir) ] ; then mkdir $(datadir) ; fi
	if [ ! -d $(localedir) ] ; then mkdir $(localedir) ; fi
	(cd locale && tar cf - .) | (cd $(localedir) && tar xf -)
#endif
	if [ ! -d $(bindir) ] ; then mkdir $(bindir) ; fi
#ifdef UNIX_BINARY_DISTRIB /* old shell script */
#ifdef GNU_GETTEXT
#ifndef UNIX_BROKEN_SH
#ifdef UNIX_USE_KSH
	(echo '#!/bin/ksh' ; echo 'exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem -N $(localedir) "$$@"') > $(bindir)/clisp
#else
	(echo '#!/bin/sh' ; echo 'exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem -N $(localedir) "$$@"') > $(bindir)/clisp
#endif
#else
	(echo '#!/bin/sh' ; echo 'if test $$# = 0; then' ; echo '  exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem -N $(localedir)' ; echo 'else' ; echo '  exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem -N $(localedir) "$$@"' ; echo 'fi') > $(bindir)/clisp
#endif
#else
#ifndef UNIX_BROKEN_SH
#ifdef UNIX_USE_KSH
	(echo '#!/bin/ksh' ; echo 'exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem "$$@"') > $(bindir)/clisp
#else
	(echo '#!/bin/sh' ; echo 'exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem "$$@"') > $(bindir)/clisp
#endif
#else
	(echo '#!/bin/sh' ; echo 'if test $$# = 0; then' ; echo '  exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem' ; echo 'else' ; echo '  exec $(lisplibdir)/lisp.run -M $(lisplibdir)/lispinit.mem "$$@"' ; echo 'fi') > $(bindir)/clisp
#endif
#endif
	chmod a+x $(bindir)/clisp
#else /* new executable */
	$(CC) $(CFLAGS) -DLISPLIBDIR='"$(lisplibdir)"' -DLOCALEDIR='"$(localedir)"' src/clisp.c -o $(bindir)/clisp
#endif

#ifdef GNU_READLINE
install-man : doc/clisp.1 doc/clreadline.3 force
#else
install-man : doc/clisp.1 force
#endif
	if [ ! -d $(prefix) ] ; then mkdir $(prefix) ; fi
	if [ ! -d $(exec_prefix) ] ; then mkdir $(exec_prefix) ; fi
	if [ ! -d $(mandir) ] ; then mkdir $(mandir) ; fi
	if [ ! -d $(mandir)/man1 ] ; then mkdir $(mandir)/man1 ; fi
	sed -e 's,/usr/local/bin/,$(bindir)/,g' < doc/clisp.1 > /tmp/clisp.1.inst \
	  && $(INSTALL_DATA) /tmp/clisp.1.inst $(mandir)/man1/clisp.1 \
	  && rm -f /tmp/clisp.1.inst
#ifdef GNU_READLINE
	if [ ! -d $(mandir)/man3 ] ; then mkdir $(mandir)/man3 ; fi
	$(INSTALL_DATA) doc/clreadline.3 $(mandir)/man3/clreadline.3
#endif

install-doc : force
	if [ ! -d $(prefix) ] ; then mkdir $(prefix) ; fi
	if [ ! -d $(exec_prefix) ] ; then mkdir $(exec_prefix) ; fi
	if [ ! -d $(docdir) ] ; then mkdir $(docdir) ; fi
	if [ ! -d $(lispdocdir) ] ; then mkdir $(lispdocdir) ; fi
	tar cf - ANNOUNCE COPYRIGHT GNU-GPL SUMMARY NEWS README README.de README.es MAGIC.add doc | (cd $(lispdocdir) && tar xf -)

force:

